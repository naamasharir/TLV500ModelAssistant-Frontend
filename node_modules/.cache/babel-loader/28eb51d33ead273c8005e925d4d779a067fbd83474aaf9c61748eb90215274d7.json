{"ast":null,"code":"var _jsxFileName = \"/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { Box, Drawer, Typography, List, ListItem, ListItemText, ListItemIcon, Paper, TextField, Button, Avatar, Divider, Chip, Fab, useMediaQuery, useTheme, Dialog, DialogTitle, DialogContent, DialogActions, CircularProgress, Alert, Snackbar, CssBaseline, FormControl, InputLabel, Select, MenuItem } from '@mui/material';\nimport { Folder, Send, Person, Description, CloudSync, TableChart, ChevronLeft, Menu, Save } from '@mui/icons-material';\nimport { GoogleGenerativeAI } from '@google/generative-ai';\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\nimport './App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst theme = createTheme({\n  palette: {\n    mode: 'dark',\n    primary: {\n      main: '#8B5CF6',\n      // Brighter purple\n      light: '#A78BFA',\n      dark: '#7C3AED'\n    },\n    secondary: {\n      main: '#6366F1',\n      // Indigo accent\n      light: '#818CF8',\n      dark: '#4F46E5'\n    },\n    background: {\n      default: '#000000',\n      // Pure black\n      paper: '#0A0A0A' // Very dark gray\n    },\n    text: {\n      primary: '#FFFFFF',\n      // Pure white for better contrast\n      secondary: '#E5E7EB' // Light gray\n    },\n    success: {\n      main: '#10B981',\n      // Green for approved changes\n      light: '#34D399',\n      dark: '#059669'\n    },\n    error: {\n      main: '#EF4444',\n      // Red for pending changes\n      light: '#F87171',\n      dark: '#DC2626'\n    }\n  },\n  typography: {\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\n    h4: {\n      fontWeight: 700\n    },\n    h6: {\n      fontWeight: 600\n    }\n  },\n  components: {\n    MuiButton: {\n      styleOverrides: {\n        root: {\n          borderRadius: 12,\n          textTransform: 'none',\n          fontWeight: 600,\n          padding: '10px 20px'\n        },\n        contained: {\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n          '&:hover': {\n            transform: 'translateY(-1px)',\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)'\n          }\n        }\n      }\n    },\n    MuiPaper: {\n      styleOverrides: {\n        root: {\n          background: 'rgba(20, 20, 20, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(139, 92, 246, 0.3)',\n          borderRadius: 16\n        }\n      }\n    }\n  }\n});\nconst drawerWidth = 280;\nfunction App() {\n  _s();\n  const muiTheme = useTheme();\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\n  const [messages, setMessages] = useState([{\n    text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n    sender: 'assistant',\n    timestamp: new Date()\n  }]);\n  const [question, setQuestion] = useState('');\n  const [fileName, setFileName] = useState('');\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\n  const [sheetData, setSheetData] = useState([]);\n  const [lastInternalNotes, setLastInternalNotes] = useState(\"\"); // State for conversation context\n  const [changesCount, setChangesCount] = useState(0);\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\n  const [projects, setProjects] = useState([{\n    name: 'הערכת שווי טק-גלובל',\n    status: 'פעיל',\n    lastModified: 'לפני 2 דקות'\n  }, {\n    name: 'ניתוח Q3 פין-קורפ',\n    status: 'טיוטה',\n    lastModified: 'לפני שעה'\n  }, {\n    name: 'מצגת סטארט-אפ',\n    status: 'הושלם',\n    lastModified: 'לפני יומיים'\n  }]);\n\n  // Google Drive integration state\n  const [isConnectingToDrive, setIsConnectingToDrive] = useState(false);\n  const [isPickerReady, setIsPickerReady] = useState(false);\n\n  // Simplified Google Sheets API state\n  const [accessToken, setAccessToken] = useState('');\n  const [authError, setAuthError] = useState('');\n  const [showSnackbar, setShowSnackbar] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState('');\n\n  // Sheet selection state\n  const [availableSheets, setAvailableSheets] = useState([]);\n  const [selectedSheetName, setSelectedSheetName] = useState('');\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\n\n  // PDF state\n  const [uploadedPdfFile, setUploadedPdfFile] = useState(null);\n  const [isUploadingPdf, setIsUploadingPdf] = useState(false);\n\n  // Handle token from URL on initial load\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const token = params.get('token');\n    if (token) {\n      setAccessToken(token);\n      setSnackbarMessage('התחברת בהצלחה!');\n      setShowSnackbar(true);\n      window.history.replaceState({}, document.title, \"/\");\n    }\n  }, []);\n\n  // Load Google API and Picker scripts on component mount\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = 'https://apis.google.com/js/api.js';\n    script.onload = () => {\n      // After the main script is loaded, load the picker-specific script\n      window.gapi.load('picker', {\n        'callback': () => setIsPickerReady(true)\n      });\n    };\n    document.head.appendChild(script);\n  }, []);\n  // ==========================================================\n  // === הוראה מס' 1: הדבק את שתי הפונקציות הבאות כאן ===\n  // ==========================================================\n\n  /**\r\n   * מתרגם אינדקס של עמודה (מבוסס 0) לאות המייצגת אותה בגיליון (A, B, ..., Z, AA).\r\n   * @param {number} colIndex - האינדקס של העמודה (מתחיל ב-0).\r\n   * @returns {string} - אות העמודה.\r\n   */\n  function columnIndexToLetter(colIndex) {\n    let temp,\n      letter = '';\n    let column = colIndex + 1;\n    while (column > 0) {\n      temp = (column - 1) % 26;\n      letter = String.fromCharCode(temp + 65) + letter;\n      column = (column - temp - 1) / 26;\n    }\n    return letter;\n  }\n\n  /**\r\n   * מעבד את הפלט הגולמי מה-Google Sheets API והופך אותו לאובייקט נוח לשימוש.\r\n   * @param {Array<Array<string>>} values - מערך הנתונים הגולמי מה-API.\r\n   * @returns {Object} - אובייקט שממפה כתובת תא לערך שלו, ללא תאים ריקים.\r\n   */\n  function processSheetData(values) {\n    const mappedData = {};\n    if (!Array.isArray(values)) {\n      // במקרה שה-API לא החזיר מערך, נחזיר אובייקט ריק כדי למנוע קריסה\n      return mappedData;\n    }\n    values.forEach((row, rowIndex) => {\n      if (row && row.length > 0) {\n        row.forEach((cellValue, colIndex) => {\n          if (cellValue !== null && cellValue !== '') {\n            const cellAddress = columnIndexToLetter(colIndex) + (rowIndex + 1);\n            mappedData[cellAddress] = cellValue;\n          }\n        });\n      }\n    });\n    return mappedData;\n  }\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET') => {\n    if (!accessToken) {\n      setAuthError('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\n      setShowSnackbar(true);\n      setSnackbarMessage('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\n      throw new Error('No access token available. Please log in.');\n    }\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n    try {\n      let url, options;\n      if (method === 'GET') {\n        // Read data from sheet\n        url = `${baseUrl}/values/${range}`;\n        options = {\n          method: 'GET',\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          }\n        };\n      } else if (method === 'PUT') {\n        // Update data in sheet\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\n        options = {\n          method: 'PUT',\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            values: values\n          })\n        };\n      } else if (method === 'POST') {\n        // Append data to sheet\n        url = `${baseUrl}/values/${range}:append?valueInputOption=RAW`;\n        options = {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            values: values\n          })\n        };\n      }\n      const response = await fetch(url, options);\n      const data = await response.json();\n\n      // *** THE ONLY CHANGE IS HERE: ***\n      console.log(\"--- RAW RESPONSE FROM GOOGLE SHEETS API ---\");\n      console.log(JSON.stringify(data, null, 2));\n      console.log(\"-----------------------------------------\");\n      if (!response.ok) {\n        var _data$error;\n        throw new Error(((_data$error = data.error) === null || _data$error === void 0 ? void 0 : _data$error.message) || 'API call failed');\n      }\n      return data;\n    } catch (error) {\n      console.error('Google Sheets API error:', error);\n      throw error;\n    }\n  };\n\n  // Function to extract spreadsheet ID from URL\n  const extractSpreadsheetId = url => {\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\n    return match ? match[1] : null;\n  };\n\n  // Function to get available sheets in a spreadsheet\n  const getSpreadsheetMetadata = async spreadsheetId => {\n    if (!accessToken) {\n      setAuthError('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\n      setShowSnackbar(true);\n      return [];\n    }\n    try {\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n      const response = await fetch(url, {\n        headers: {\n          'Authorization': `Bearer ${accessToken}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) {\n        throw new Error('Failed to fetch spreadsheet metadata');\n      }\n      const metadata = await response.json();\n      return metadata.sheets.map(sheet => ({\n        name: sheet.properties.title,\n        id: sheet.properties.sheetId,\n        index: sheet.properties.index\n      }));\n    } catch (error) {\n      console.error('Error fetching spreadsheet metadata:', error);\n      setMessages(prev => [...prev, {\n        text: `❌ שגיאה בטעינת רשימת גליונות: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date()\n      }]);\n      return [];\n    }\n  };\n\n  // Function to simulate AI making changes to the sheet\n  const simulateAIChanges = async () => {\n    if (!accessToken || !googleSheetsUrl) {\n      setMessages(prev => [...prev, {\n        text: `❌ אין גישה לגיליון. אנא התחבר ל-Google Sheets תחילה.`,\n        sender: 'system',\n        timestamp: new Date()\n      }]);\n      return;\n    }\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n    if (!spreadsheetId) {\n      setMessages(prev => [...prev, {\n        text: `❌ לא ניתן לזהות את מזהה הגיליון.`,\n        sender: 'system',\n        timestamp: new Date()\n      }]);\n      return;\n    }\n    try {\n      // Example: Read data from A1:C10\n      const readRange = selectedSheetName ? `${selectedSheetName}!A1:C10` : 'A1:C10';\n      const readResult = await makeGoogleSheetsAPICall(spreadsheetId, readRange, null, 'GET');\n      console.log('Read data:', readResult);\n\n      // Example: Update a cell\n      const updateRange = selectedSheetName ? `${selectedSheetName}!A1` : 'A1';\n      const updateResult = await makeGoogleSheetsAPICall(spreadsheetId, updateRange, [['עודכן על ידי AI - ' + new Date().toLocaleTimeString('he-IL')]], 'PUT');\n      console.log('Update result:', updateResult);\n      setChangesCount(prev => prev + 1);\n      setMessages(prev => [...prev, {\n        text: `✅ ביצעתי שינוי בגיליון! עדכנתי את תא A1 עם חותמת זמן.`,\n        sender: 'assistant',\n        timestamp: new Date()\n      }]);\n    } catch (error) {\n      setMessages(prev => [...prev, {\n        text: `❌ שגיאה בביצוע שינויים: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date()\n      }]);\n    }\n  };\n  const handleFileUpload = async (event, fileType) => {\n    const file = event.target.files[0];\n    if (!file) return;\n    if (fileType === 'PDF') {\n      setIsUploadingPdf(true);\n      setMessages(prev => [...prev, {\n        text: `⏳ מעלה את הקובץ \"${file.name}\"...`,\n        sender: 'system',\n        timestamp: new Date()\n      }]);\n      const formData = new FormData();\n      formData.append('pdf', file);\n      try {\n        const response = await fetch('http://localhost:3001/api/upload-pdf', {\n          method: 'POST',\n          body: formData,\n          credentials: 'include'\n        });\n        if (!response.ok) {\n          const error = await response.json();\n          throw new Error(error.error || 'Upload failed');\n        }\n        const result = await response.json();\n        setUploadedPdfFile(result.file);\n\n        // Remove uploading message and add success message\n        setMessages(prev => {\n          const filtered = prev.filter(msg => !msg.text.includes('⏳ מעלה את הקובץ'));\n          return [...filtered, {\n            text: `📎 קובץ PDF \"${file.name}\" הועלה בהצלחה! אתה יכול לשאול אותי שאלות על התוכן.`,\n            sender: 'system',\n            timestamp: new Date()\n          }];\n        });\n      } catch (error) {\n        console.error('PDF upload failed:', error);\n        setMessages(prev => {\n          const filtered = prev.filter(msg => !msg.text.includes('⏳ מעלה את הקובץ') && !msg.isLoading);\n          return [...filtered, {\n            text: `❌ שגיאה בהעלאת PDF: ${error.message}`,\n            sender: 'system',\n            timestamp: new Date()\n          }];\n        });\n      } finally {\n        setIsUploadingPdf(false);\n      }\n    } else if (fileType === 'Excel') {\n      const timestamp = new Date();\n      setFileName(file.name.replace(/\\.[^/.]+$/, \"\"));\n      setMessages(prev => [...prev, {\n        text: `📎 קובץ ${fileType} \"${file.name}\" הועלה בהצלחה`,\n        sender: 'system',\n        timestamp\n      }]);\n\n      // Simulate AI analysis and changes\n      setTimeout(() => {\n        setChangesCount(prev => prev + Math.floor(Math.random() * 5) + 3);\n        setMessages(prev => [...prev, {\n          text: `🔍 סיימתי לנתח את הקובץ. מצאתי ${Math.floor(Math.random() * 5) + 3} שינויים מומלצים בגיליון שלך.`,\n          sender: 'assistant',\n          timestamp: new Date()\n        }]);\n      }, 2000);\n    }\n  };\n  const handleGoogleSheetsUrl = async url => {\n    setGoogleSheetsUrl(url);\n    setIsSheetLoaded(true);\n\n    // Load available sheets for the entered URL\n    const spreadsheetId = extractSpreadsheetId(url);\n    if (spreadsheetId && accessToken) {\n      await loadAvailableSheets(spreadsheetId);\n    }\n  };\n\n  // Function to load available sheets for a spreadsheet\n  const loadAvailableSheets = async spreadsheetId => {\n    setIsLoadingSheets(true);\n    try {\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\n      setAvailableSheets(sheets);\n\n      // Set first sheet as default\n      if (sheets.length > 0) {\n        setSelectedSheetName(sheets[0].name);\n        // Load data for the first sheet\n        await getSheetData(spreadsheetId, sheets[0].name);\n      }\n      setMessages(prev => {\n        var _sheets$;\n        return [...prev, {\n          text: `🔍 נמצאו ${sheets.length} גליונות. גליון פעיל: ${((_sheets$ = sheets[0]) === null || _sheets$ === void 0 ? void 0 : _sheets$.name) || 'לא ידוע'}`,\n          sender: 'system',\n          timestamp: new Date()\n        }];\n      });\n    } catch (error) {\n      console.error('Error loading available sheets:', error);\n    } finally {\n      setIsLoadingSheets(false);\n    }\n  };\n\n  // Function to handle sheet selection change\n  const handleSheetChange = async newSheetName => {\n    if (newSheetName === selectedSheetName) return;\n    setSelectedSheetName(newSheetName);\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n    if (spreadsheetId) {\n      try {\n        await getSheetData(spreadsheetId, newSheetName);\n        setMessages(prev => [...prev, {\n          text: `📋 החלפנו לגליון: ${newSheetName}`,\n          sender: 'system',\n          timestamp: new Date()\n        }]);\n      } catch (error) {\n        console.error('Error switching sheet:', error);\n        setMessages(prev => [...prev, {\n          text: `❌ שגיאה בהחלפת גליון: ${error.message}`,\n          sender: 'system',\n          timestamp: new Date()\n        }]);\n      }\n    }\n  };\n  const pickerCallback = async data => {\n    if (data.action === window.google.picker.Action.PICKED) {\n      const doc = data.docs[0];\n      setFileName(doc.name);\n      handleGoogleSheetsUrl(doc.url);\n\n      // Load available sheets for the selected spreadsheet\n      const spreadsheetId = extractSpreadsheetId(doc.url);\n      if (spreadsheetId) {\n        await loadAvailableSheets(spreadsheetId);\n      }\n      setSnackbarMessage(`טען גיליון: ${doc.name}`);\n      setShowSnackbar(true);\n    }\n  };\n  const createPicker = () => {\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY; // The correct Gemini/Cloud API Key\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\n    if (!clientId || !developerKey) {\n      setAuthError('מפתחות ה-API של גוגל אינם מוגדרים כראוי בקובץ .env');\n      setShowSnackbar(true);\n      return;\n    }\n    const appId = clientId.split('-')[0];\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\n    const picker = new window.google.picker.PickerBuilder().setAppId(appId).setOAuthToken(accessToken).setDeveloperKey(developerKey).addView(view).setCallback(pickerCallback).build();\n    picker.setVisible(true);\n  };\n  const handleConnectToDrive = () => {\n    if (!accessToken) {\n      setAuthError('יש להתחבר תחילה לחשבון Google.');\n      setShowSnackbar(true);\n      return;\n    }\n    createPicker();\n  };\n\n  // ==========================================================\n  // === הוראה מס' 2: החלף את הפונקציה הקיימת בזו ===\n  // ==========================================================\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\n    if (!accessToken) {\n      setAuthError('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\n      setShowSnackbar(true);\n      return null;\n    }\n    try {\n      // 1. קרא את הנתונים הגולמיים מה-API עם שם הגליון הנבחר\n      const range = sheetName ? `${sheetName}!A1:Z1000` : 'A1:Z1000';\n      const apiResponse = await makeGoogleSheetsAPICall(spreadsheetId, range);\n      const rawValues = apiResponse && Array.isArray(apiResponse.values) ? apiResponse.values : [];\n\n      // 2. השתמש בפונקציית העזר כדי לעבד את הנתונים לפורמט הנקי\n      const cleanData = processSheetData(rawValues);\n\n      // 3. עדכן את ה-state עם הנתונים המעובדים (אם רלוונטי לשימושים אחרים)\n      setSheetData(cleanData);\n\n      // 4. החזר את הנתונים המעובדים והנקיים\n      return cleanData;\n    } catch (error) {\n      console.error('Failed to fetch sheet data:', error);\n      setMessages(prev => [...prev, {\n        text: `❌ שגיאה בטעינת נתוני הגיליון: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date()\n      }]);\n      return null;\n    }\n  };\n  const sendMessage = async () => {\n    if (!question.trim() || !isSheetLoaded) {\n      if (!isSheetLoaded) {\n        setAuthError('יש לבחור גיליון תחילה.');\n        setShowSnackbar(true);\n      }\n      return;\n    }\n    const timestamp = new Date();\n    const userMessage = {\n      text: question,\n      sender: 'user',\n      timestamp\n    };\n    setMessages(prev => [...prev, userMessage]);\n    setQuestion('');\n    setMessages(prev => [...prev, {\n      text: '...',\n      sender: 'assistant',\n      isLoading: true,\n      timestamp: new Date()\n    }]);\n    try {\n      const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n      if (!spreadsheetId) throw new Error(\"Invalid Google Sheets URL\");\n\n      // --- התחלת התיקון ---\n      // אנו נשתמש בפונקציית העזר הקיימת כדי להבטיח שהמידע תמיד נשלף באותה הדרך\n      const rawData = await getSheetData(spreadsheetId, selectedSheetName);\n\n      // נוסיף בדיקה לוודא שהמידע אכן התקבל לפני שממשיכים\n      if (!rawData) {\n        console.error(\"sendMessage: לא הצלחתי לקבל מידע מהגיליון, הפעולה בוטלה.\");\n        setMessages(prev => prev.filter(m => !m.isLoading)); // הסרת הודעת הטעינה\n        return; // יציאה מהפונקציה\n      }\n      // --- סוף התיקון ---\n\n      const genAI = new GoogleGenerativeAI(process.env.REACT_APP_GEMINI_API_KEY);\n      const model = genAI.getGenerativeModel({\n        model: \"gemini-2.5-flash\"\n      });\n      const historyForPrompt = messages.filter(m => !m.isAction).slice(-6).map(m => `${m.sender === 'user' ? 'User' : 'Assistant'}: ${m.text}`).join('\\n');\n\n      // ==========================================================\n      // === הוראה מס' 3: החלף את הפרומפט הקיים בזה ===\n      // ==========================================================\n      const context = `\n       אתה עוזר פיננסי מומחה, קפדן ודקדקן. תפקידך הוא לנתח נתונים מגיליון אלקטרוני ולבצע שינויים מדויקים לפי בקשת המשתמש.\n\n***תהליך חשיבה וניתוח (חובה!)***\nלפני שאתה מחליט על פעולה, עליך לבצע את תהליך החשיבה הבא בראשך:\n1.  **זיהוי שדה ותיאור:** זהה את התא המכיל את התיאור שהמשתמש ביקש (למשל, \"רווח נקי מבוקר\" בתא E23). זהו \"השדה\".\n2.  **ניתוח כיווניות (Directionality Analysis):**\n    -   בדוק את התאים הסמוכים לשדה, במיוחד באותה שורה.\n    -   שים לב! בעברית ממלאים דוחות לרוב מימין לשמאל, כלומר השייכות היא למה שמופיע משמאל ולא מימין. לרוב זה ככה, לא תמיד, אם אתה נתקל במקרה שאפשר לפרש ל2 הכיוונים תשאל. גם אם אתה בטוח שהבנת את המבנה, בעברית זה שונה. אז תשאל. כמעט תמיד תשאל ותוודא \n3.  **הערכת רמת ודאות:**\n    -   האם המספרים קרובים יותר לצד אחד? לרוב זה מעיד שהם שייכים אליו\n    -   **ודאות נמוכה (עמימות):** אם יש ערכים משני הצדדים, אם יש מספר טורים של נתונים, או אם המבנה לא ברור.\n\n***הוראה קריטית:*** אם רמת הוודאות שלך נמוכה, **חובה עליך** לשאול את המשתמש שאלה מבהירה ב-\"chatResponse\" ולהשאיר את \"sheetActions\" כמערך ריק. אל תבצע שינוי אם אינך בטוח ב-100%.\nאני רוצה שתיפול על הצד החשדני, אם יש ספק, אין ספק - שואלים. אם יש משהו שאפשר לפרש ל2 כיוונים, שואלים. \n\n---\n***הוראות קריטיות לפורמט הפלט***\nעליך להחזיר תמיד תגובת JSON מובנית בלבד, עם שלושת המפתחות הבאים. אין להוסיף טקסט מחוץ ל-JSON.\n\n1.  **\"chatResponse\"**: (מחרוזת) התגובה הטקסטואלית שתוצג למשתמש בצ'אט. אם הוודאות נמוכה, זו חייבת להיות שאלה מבהירה.\n2.  **\"sheetActions\"**: (מערך) רשימת פעולות לביצוע. אם הוודאות נמוכה, המערך חייב להיות ריק.\n    -   \"range\": (מחרוזת) הטווח לעדכון (למשל, \"Sheet1!A5\").\n    -   \"values\": (מערך של מערכים) הנתונים החדשים.\n3.  **\"internalNotes\"**: (מחרוזת) **תיעוד מפורט של תהליך החשיבה שלך.** שדה זה ישמש כזיכרון הפנימי שלך. עליו לכלול את ניתוח השדה, ניתוח הכיווניות, והערכת רמת הוודאות שלך.\n\n---\n***דוגמה לתגובה במקרה של ודאות גבוהה:***\n{\n  \"chatResponse\": \"בטח, עדכנתי את הרווח הנקי המבוקר ל-50,000.\",\n  \"sheetActions\": [\n    {\n      \"range\": \"Sheet1!H23\",\n      \"values\": [[\"50000\"]]\n    }\n  ],\n  \"internalNotes\": \"ניתוח: המשתמש ביקש לעדכן 'רווח נקי מבוקר'. השדה זוהה ב-E23. הערך המספרי נמצא ב-H23. המבנה ברור. ודאות: גבוהה. פעולה: עדכון תא H23.\"\n}\n\n***דוגמה לתגובה במקרה של עמימות (ודאות נמוכה):***\n{\n  \"chatResponse\": \"בהחלט. זיהיתי את 'מזומנים לפעילות שוטפת', אך אני רואה נתונים עבור שתי תקופות שונות. האם תרצה לעדכן את הערך של 2024 (17,630) או את הערך של 2025 (28,765)?\",\n  \"sheetActions\": [],\n  \"internalNotes\": \"ניתוח: המשתמש ביקש לעדכן 'מזומנים'. השדה זוהה ב-E16. קיימת עמימות כי יש שני טורים של נתונים, ב-H16 וב-I16. ודאות: נמוכה. פעולה: שאילת הבהרה.\"\n}\n\n---\n***הקשר מהשיחה הקודמת (הערות פנימיות שלך):***\n${lastInternalNotes || \"זו ההודעה הראשונה בשיחה.\"}\n\n---\n***נתוני הגיליון הנוכחיים:***\nהנתונים מגיעים בפורמט JSON, כאשר המפתח הוא כתובת התא והערך הוא התוכן.\n${JSON.stringify(rawData)}\n\n---\n***היסטוריית השיחה האחרונה:***\n${historyForPrompt}\n      `;\n\n      // Add PDF context if available\n      let pdfContext = '';\n      if (uploadedPdfFile) {\n        pdfContext = `\n---\n***מסמך PDF מצורף:***\nהמשתמש העלה קובץ PDF: \"${uploadedPdfFile.displayName}\"\nהשתמש במידע מהPDF יחד עם נתוני הגיליון כדי לענות על השאלות ולבצע שינויים.\n`;\n      }\n      const fullContext = `${context}${pdfContext}`;\n      const prompt = `${fullContext}\\n\\n***שאלת המשתמש החדשה:*** ${question}`;\n\n      // *** ADD DEBUG LOGS HERE ***\n      console.log(\"=== DEBUG: WHAT WE'RE SENDING TO GEMINI ===\");\n      console.log(\"Raw data from sheets:\", rawData);\n      if (uploadedPdfFile) {\n        console.log(\"PDF attached:\", uploadedPdfFile.displayName);\n      }\n      console.log(\"Full prompt being sent to Gemini:\");\n      console.log(prompt);\n      console.log(\"=== END DEBUG ===\");\n\n      // Check if PDF hasn't expired\n      if (uploadedPdfFile && new Date(uploadedPdfFile.expirationTime) < new Date()) {\n        setUploadedPdfFile(null);\n        setMessages(prev => [...prev, {\n          text: '⚠️ קובץ הPDF פג תוקף. יש להעלות מחדש.',\n          sender: 'system',\n          timestamp: new Date()\n        }]);\n        setMessages(prev => prev.filter(m => !m.isLoading));\n        return;\n      }\n\n      // If we have a PDF, use the backend endpoint that processes PDF + question\n      let result;\n      if (uploadedPdfFile && uploadedPdfFile.filename) {\n        const pdfResponse = await fetch('http://localhost:3001/api/process-pdf-question', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            fileId: uploadedPdfFile.id,\n            filename: uploadedPdfFile.filename,\n            question: prompt,\n            conversationHistory: historyForPrompt\n          }),\n          credentials: 'include'\n        });\n        if (!pdfResponse.ok) {\n          throw new Error('Failed to process PDF question');\n        }\n        const pdfResult = await pdfResponse.json();\n\n        // Create a response object that matches Gemini's format\n        result = {\n          response: {\n            text: () => pdfResult.response\n          }\n        };\n      } else {\n        // No PDF, use direct Gemini API\n        result = await model.generateContent(prompt);\n      }\n      const responseText = await result.response.text();\n\n      // *** ADD DEBUG LOG FOR GEMINI RESPONSE ***\n      console.log(\"=== DEBUG: GEMINI RESPONSE ===\");\n      console.log(\"Raw response from Gemini:\", responseText);\n      console.log(\"=== END GEMINI RESPONSE DEBUG ===\");\n      let parsedResponse;\n      try {\n        // Find the JSON part of the response, as Gemini might add backticks\n        const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n        if (!jsonMatch) throw new Error(\"No valid JSON object found in response.\");\n        parsedResponse = JSON.parse(jsonMatch[0]);\n      } catch (e) {\n        console.error(\"Failed to parse Gemini's response as JSON:\", responseText);\n        throw new Error(\"תגובת ה-AI אינה בפורמט JSON תקין.\");\n      }\n      const {\n        chatResponse,\n        sheetActions,\n        internalNotes\n      } = parsedResponse;\n\n      // 1. Update internal notes for the next turn\n      setLastInternalNotes(internalNotes);\n\n      // Remove the initial loading message and show the preliminary chat response\n      setMessages(prev => {\n        const newMessages = prev.filter(m => !m.isLoading);\n        newMessages.push({\n          text: chatResponse,\n          sender: 'assistant',\n          timestamp: new Date()\n        });\n        return newMessages;\n      });\n\n      // 2. Perform sheet actions if any\n      if (sheetActions && sheetActions.length > 0) {\n        setMessages(prev => [...prev, {\n          text: `מבצע ${sheetActions.length} שינויים בגיליון...`,\n          sender: 'system',\n          isAction: true,\n          timestamp: new Date()\n        }]);\n        await Promise.all(sheetActions.map(action => {\n          // Add sheet name to range if not already present\n          const range = action.range.includes('!') ? action.range : selectedSheetName ? `${selectedSheetName}!${action.range}` : action.range;\n          return makeGoogleSheetsAPICall(spreadsheetId, range, action.values, 'PUT');\n        }));\n        setChangesCount(prev => prev + sheetActions.length);\n\n        // ** CRITICAL FIX: ** Re-fetch data AFTER updates to ensure consistency\n        await getSheetData(spreadsheetId, selectedSheetName);\n\n        // Remove the \"Performing actions...\" message\n        setMessages(prev => prev.filter(m => !m.isAction));\n      }\n    } catch (error) {\n      console.error('Error in sendMessage:', error);\n      const errorMessage = `אירעה שגיאה: ${error.message}`;\n      setMessages(prev => {\n        const newMessages = prev.filter(msg => !msg.isLoading);\n        newMessages.push({\n          text: errorMessage,\n          sender: 'assistant',\n          timestamp: new Date()\n        });\n        return newMessages;\n      });\n    }\n  };\n  const saveAllChanges = () => {\n    setMessages(prev => [...prev, {\n      text: `💾 כל השינויים נשמרו לגיליון ${fileName}`,\n      sender: 'system',\n      timestamp: new Date()\n    }]);\n  };\n  return /*#__PURE__*/_jsxDEV(ThemeProvider, {\n    theme: theme,\n    children: [/*#__PURE__*/_jsxDEV(CssBaseline, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 862,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        display: 'flex',\n        height: '100vh',\n        bgcolor: 'background.default',\n        overflow: 'hidden',\n        // Only add scroll for very small screens\n        '@media (max-height: 600px)': {\n          overflow: 'auto'\n        }\n      },\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          background: `\n            radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%),\n            radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%),\n            radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.04) 0%, transparent 70%)\n          `,\n          pointerEvents: 'none',\n          zIndex: 0\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 874,\n        columnNumber: 9\n      }, this), !isMobile && /*#__PURE__*/_jsxDEV(Drawer, {\n        variant: \"permanent\",\n        sx: {\n          width: drawerWidth,\n          flexShrink: 0,\n          zIndex: 1,\n          '& .MuiDrawer-paper': {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            bgcolor: 'rgba(10, 10, 10, 0.98)',\n            borderRight: '1px solid rgba(139, 92, 246, 0.4)',\n            backdropFilter: 'blur(20px)'\n          }\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            sx: {\n              background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n              backgroundClip: 'text',\n              WebkitBackgroundClip: 'text',\n              WebkitTextFillColor: 'transparent',\n              fontWeight: 700\n            },\n            children: \"TLV500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 904,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            color: \"text.secondary\",\n            children: \"AI Assistant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 913,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 903,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 918,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3,\n            display: 'flex',\n            alignItems: 'center',\n            gap: 2\n          },\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            sx: {\n              width: 45,\n              height: 45,\n              background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)'\n            },\n            children: /*#__PURE__*/_jsxDEV(Person, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 926,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 922,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              fontWeight: 600,\n              children: \"\\u05D3\\u05D5\\u05D3 \\u05D0\\u05E0\\u05DC\\u05D9\\u05E1\\u05D8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 929,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"caption\",\n              color: \"text.secondary\",\n              children: \"\\u05DE\\u05E9\\u05EA\\u05DE\\u05E9 \\u05E4\\u05E8\\u05D9\\u05DE\\u05D9\\u05D5\\u05DD\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 930,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 928,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 921,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 934,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"subtitle2\",\n            color: \"text.secondary\",\n            gutterBottom: true,\n            fontWeight: 600,\n            children: \"\\u05E4\\u05E8\\u05D5\\u05D9\\u05E7\\u05D8\\u05D9\\u05DD \\u05D0\\u05D7\\u05E8\\u05D5\\u05E0\\u05D9\\u05DD\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 938,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(List, {\n            dense: true,\n            children: projects.map((project, index) => /*#__PURE__*/_jsxDEV(ListItem, {\n              sx: {\n                px: 0,\n                py: 1,\n                borderRadius: 2,\n                mb: 1,\n                '&:hover': {\n                  bgcolor: 'rgba(139, 92, 246, 0.15)',\n                  transform: 'translateX(4px)'\n                }\n              },\n              children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n                sx: {\n                  minWidth: 36\n                },\n                children: /*#__PURE__*/_jsxDEV(Folder, {\n                  sx: {\n                    color: 'primary.main',\n                    fontSize: 20\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 951,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 950,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                primary: project.name,\n                secondary: project.lastModified,\n                primaryTypographyProps: {\n                  variant: 'body2',\n                  fontWeight: 500\n                },\n                secondaryTypographyProps: {\n                  variant: 'caption'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 953,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Chip, {\n                label: project.status,\n                size: \"small\",\n                color: project.status === 'פעיל' ? 'primary' : 'default',\n                sx: {\n                  fontSize: '0.65rem',\n                  fontWeight: 600\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 959,\n                columnNumber: 21\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 943,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 941,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 937,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 888,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          flexGrow: 1,\n          display: 'flex',\n          flexDirection: isMobile ? 'column' : 'row',\n          zIndex: 1,\n          ml: isMobile ? 0 : 0,\n          height: '100vh',\n          overflow: 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            flex: isMobile ? '1 1 60%' : '0 0 65%',\n            p: 2,\n            display: 'flex',\n            flexDirection: 'column',\n            height: isMobile ? '60%' : '100%',\n            overflow: 'hidden'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              mb: 2,\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              flexWrap: 'wrap',\n              gap: 2\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: 2\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                color: \"text.primary\",\n                children: fileName || 'לא נבחר גיליון'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 994,\n                columnNumber: 17\n              }, this), availableSheets.length > 1 && /*#__PURE__*/_jsxDEV(FormControl, {\n                size: \"small\",\n                sx: {\n                  minWidth: 180\n                },\n                children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                  sx: {\n                    color: 'text.secondary'\n                  },\n                  children: \"\\u05D1\\u05D7\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1001,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Select, {\n                  value: selectedSheetName,\n                  label: \"\\u05D1\\u05D7\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF\",\n                  onChange: e => handleSheetChange(e.target.value),\n                  disabled: isLoadingSheets,\n                  sx: {\n                    '& .MuiOutlinedInput-notchedOutline': {\n                      borderColor: 'rgba(139, 92, 246, 0.5)'\n                    },\n                    '&:hover .MuiOutlinedInput-notchedOutline': {\n                      borderColor: 'rgba(139, 92, 246, 0.7)'\n                    },\n                    '&.Mui-focused .MuiOutlinedInput-notchedOutline': {\n                      borderColor: 'primary.main'\n                    }\n                  },\n                  children: availableSheets.map(sheet => /*#__PURE__*/_jsxDEV(MenuItem, {\n                    value: sheet.name,\n                    children: sheet.name\n                  }, sheet.id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1020,\n                    columnNumber: 25\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1002,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1000,\n                columnNumber: 19\n              }, this), isLoadingSheets && /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                sx: {\n                  color: 'primary.main'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1029,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 993,\n              columnNumber: 15\n            }, this), !accessToken ? /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              href: \"http://localhost:3001\",\n              sx: {\n                background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n                color: 'white',\n                borderRadius: '12px',\n                px: 3,\n                py: 1,\n                fontWeight: 600\n              },\n              children: \"\\u05D4\\u05EA\\u05D7\\u05D1\\u05E8 \\u05E2\\u05DD Google\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1033,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              onClick: handleConnectToDrive,\n              disabled: !isPickerReady,\n              sx: {\n                borderColor: '#8B5CF6',\n                color: '#A78BFA',\n                borderRadius: '12px',\n                px: 3\n              },\n              children: !isPickerReady ? 'טוען API...' : 'בחר גיליון מ-Drive'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1048,\n              columnNumber: 17\n            }, this), changesCount > 0 && /*#__PURE__*/_jsxDEV(Chip, {\n              label: `${changesCount} שינויים לא שמורים`,\n              size: \"small\",\n              color: \"warning\",\n              sx: {\n                fontSize: '0.7rem',\n                fontWeight: 500\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1063,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1072,\n                columnNumber: 30\n              }, this),\n              onClick: saveAllChanges,\n              color: \"primary\",\n              size: \"small\",\n              children: \"\\u05E9\\u05DE\\u05D5\\u05E8 \\u05D4\\u05DB\\u05DC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1070,\n              columnNumber: 17\n            }, this), isSheetLoaded && /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              onClick: simulateAIChanges,\n              color: \"secondary\",\n              size: \"small\",\n              children: \"\\u05D1\\u05D3\\u05D5\\u05E7 API\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1080,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 992,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              p: 2,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(15, 15, 15, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                mb: 2\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"subtitle1\",\n                fontWeight: 600,\n                children: \"\\u05D2\\u05D9\\u05DC\\u05D9\\u05D5\\u05DF \\u05E2\\u05D1\\u05D5\\u05D3\\u05D4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1102,\n                columnNumber: 17\n              }, this), !isSheetLoaded && /*#__PURE__*/_jsxDEV(TextField, {\n                placeholder: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1...\",\n                size: \"small\",\n                sx: {\n                  minWidth: 300\n                },\n                onKeyPress: async e => {\n                  if (e.key === 'Enter' && e.target.value) {\n                    await handleGoogleSheetsUrl(e.target.value);\n                    e.target.value = '';\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1106,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1101,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flexGrow: 1,\n                border: '1px solid rgba(139, 92, 246, 0.4)',\n                borderRadius: 1,\n                bgcolor: 'rgba(5, 5, 5, 0.8)',\n                position: 'relative',\n                overflow: 'hidden'\n              },\n              children: isSheetLoaded ? /*#__PURE__*/_jsxDEV(\"iframe\", {\n                src: googleSheetsUrl,\n                width: \"100%\",\n                height: \"100%\",\n                style: {\n                  border: 'none',\n                  borderRadius: '4px'\n                },\n                title: \"Google Sheets\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1130,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  height: '100%',\n                  color: 'text.secondary'\n                },\n                children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                  sx: {\n                    fontSize: 60,\n                    mb: 2,\n                    opacity: 0.5\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1149,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  gutterBottom: true,\n                  children: \"\\u05D8\\u05E2\\u05DF \\u05D2\\u05D9\\u05DC\\u05D9\\u05D5\\u05DF \\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1150,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  textAlign: \"center\",\n                  sx: {\n                    maxWidth: 400\n                  },\n                  children: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1 \\u05D1\\u05E9\\u05D3\\u05D4 \\u05DC\\u05DE\\u05E2\\u05DC\\u05D4 \\u05DB\\u05D3\\u05D9 \\u05DC\\u05D4\\u05EA\\u05D7\\u05D9\\u05DC \\u05DC\\u05E2\\u05D1\\u05D5\\u05D3 \\u05E2\\u05DD \\u05D4\\u05E0\\u05EA\\u05D5\\u05E0\\u05D9\\u05DD \\u05E9\\u05DC\\u05DA\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1153,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1141,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1121,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1092,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 983,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            width: isMobile ? '100%' : '35%',\n            flex: isMobile ? '1 1 40%' : '0 0 35%',\n            p: 2,\n            height: isMobile ? '40%' : '100%',\n            display: 'flex',\n            flexDirection: 'column'\n          },\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(25, 25, 25, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                children: \"\\u05E2\\u05D5\\u05D6\\u05E8 AI\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1181,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"text.secondary\",\n                children: \"\\u05DE\\u05D5\\u05DB\\u05DF \\u05DC\\u05E2\\u05D6\\u05D5\\u05E8 \\u05E2\\u05DD \\u05D4\\u05E0\\u05D9\\u05EA\\u05D5\\u05D7 \\u05E9\\u05DC\\u05DA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1182,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1180,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    gap: 1\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(Description, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1194,\n                      columnNumber: 34\n                    }, this),\n                    size: \"small\",\n                    disabled: isUploadingPdf,\n                    sx: {\n                      flex: 1,\n                      background: 'transparent',\n                      color: 'text.primary',\n                      borderColor: 'rgba(139, 92, 246, 0.5)',\n                      '&:hover': {\n                        background: 'rgba(139, 92, 246, 0.1)',\n                        borderColor: 'rgba(139, 92, 246, 0.7)',\n                        color: 'text.primary'\n                      },\n                      '&.Mui-disabled': {\n                        borderColor: 'rgba(139, 92, 246, 0.3)',\n                        color: 'text.secondary'\n                      }\n                    },\n                    children: [isUploadingPdf ? 'מעלה...' : 'PDF', /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".pdf\",\n                      onChange: e => handleFileUpload(e, 'PDF'),\n                      disabled: isUploadingPdf\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1214,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1191,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(TableChart, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1219,\n                      columnNumber: 34\n                    }, this),\n                    size: \"small\",\n                    sx: {\n                      flex: 1,\n                      background: 'transparent',\n                      color: 'text.primary',\n                      borderColor: 'rgba(139, 92, 246, 0.5)',\n                      '&:hover': {\n                        background: 'rgba(139, 92, 246, 0.1)',\n                        borderColor: 'rgba(139, 92, 246, 0.7)',\n                        color: 'text.primary'\n                      }\n                    },\n                    children: [\"Excel\", /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".xlsx,.xls,.csv\",\n                      onChange: e => handleFileUpload(e, 'Excel')\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1234,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1216,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1190,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    gap: 1\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    startIcon: /*#__PURE__*/_jsxDEV(CloudSync, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1241,\n                      columnNumber: 34\n                    }, this),\n                    size: \"small\",\n                    onClick: () => {\n                      const currentUrl = window.location.href;\n                      const newUrl = `${currentUrl}?token=${accessToken}`;\n                      window.history.pushState({}, document.title, newUrl);\n                    },\n                    sx: {\n                      flex: 1,\n                      background: 'transparent',\n                      color: 'text.primary',\n                      borderColor: 'rgba(139, 92, 246, 0.5)',\n                      '&:hover': {\n                        background: 'rgba(139, 92, 246, 0.1)',\n                        borderColor: 'rgba(139, 92, 246, 0.7)',\n                        color: 'text.primary'\n                      }\n                    },\n                    children: \"Google Sheets\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1239,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1238,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1\n                  },\n                  children: /*#__PURE__*/_jsxDEV(TextField, {\n                    fullWidth: true,\n                    placeholder: \"\\u05D0\\u05D5 \\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1...\",\n                    size: \"small\",\n                    variant: \"outlined\",\n                    onKeyPress: async e => {\n                      if (e.key === 'Enter' && e.target.value) {\n                        await handleGoogleSheetsUrl(e.target.value);\n                        e.target.value = '';\n                      }\n                    },\n                    sx: {\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2\n                      }\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1265,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1264,\n                  columnNumber: 19\n                }, this), uploadedPdfFile && /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    mt: 1,\n                    p: 1,\n                    bgcolor: 'rgba(139, 92, 246, 0.1)',\n                    borderRadius: 2,\n                    border: '1px solid rgba(139, 92, 246, 0.3)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Description, {\n                    sx: {\n                      color: 'primary.main',\n                      fontSize: 20\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1296,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    sx: {\n                      flex: 1,\n                      color: 'text.primary'\n                    },\n                    children: uploadedPdfFile.displayName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1297,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    onClick: () => {\n                      setUploadedPdfFile(null);\n                      setMessages(prev => [...prev, {\n                        text: '📄 קובץ PDF הוסר',\n                        sender: 'system',\n                        timestamp: new Date()\n                      }]);\n                    },\n                    sx: {\n                      color: 'error.main',\n                      minWidth: 'auto',\n                      p: 0.5\n                    },\n                    children: \"\\u2715\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1300,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1286,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1189,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1188,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flexGrow: 1,\n                overflow: 'auto',\n                p: 2\n              },\n              children: messages.map((msg, index) => /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 2\n                },\n                className: \"chat-message\",\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start',\n                    mb: 1\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    sx: {\n                      p: 1.5,\n                      maxWidth: '85%',\n                      background: msg.sender === 'user' ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' : 'rgba(35, 35, 35, 0.9)',\n                      color: 'white',\n                      borderRadius: 3\n                    },\n                    children: msg.isLoading ? /*#__PURE__*/_jsxDEV(Box, {\n                      sx: {\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: 1\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                        size: 16,\n                        sx: {\n                          color: 'white'\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1343,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"body2\",\n                        children: \"\\u05DE\\u05E2\\u05D1\\u05D3 \\u05D0\\u05EA \\u05D4\\u05E9\\u05D0\\u05DC\\u05D4...\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1344,\n                        columnNumber: 29\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1342,\n                      columnNumber: 27\n                    }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n                      variant: \"body2\",\n                      children: msg.text\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1347,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1332,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1327,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  color: \"text.secondary\",\n                  sx: {\n                    display: 'block',\n                    textAlign: msg.sender === 'user' ? 'right' : 'left',\n                    px: 1\n                  },\n                  children: msg.timestamp.toLocaleTimeString('he-IL')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1351,\n                  columnNumber: 21\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1326,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1324,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderTop: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  gap: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(TextField, {\n                  fullWidth: true,\n                  variant: \"outlined\",\n                  placeholder: \"\\u05E9\\u05D0\\u05DC \\u05D0\\u05D5\\u05EA\\u05D9 \\u05DB\\u05DC \\u05D3\\u05D1\\u05E8 \\u05E2\\u05DC \\u05D4\\u05E0\\u05EA\\u05D5\\u05E0\\u05D9\\u05DD \\u05D4\\u05E4\\u05D9\\u05E0\\u05E0\\u05E1\\u05D9\\u05D9\\u05DD...\",\n                  value: question,\n                  onChange: e => setQuestion(e.target.value),\n                  onKeyPress: e => e.key === 'Enter' && sendMessage(),\n                  size: \"small\",\n                  sx: {\n                    '& .MuiOutlinedInput-root': {\n                      borderRadius: 3\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1365,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Fab, {\n                  color: \"primary\",\n                  onClick: sendMessage,\n                  size: \"small\",\n                  sx: {\n                    background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n                    '&:hover': {\n                      background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)'\n                    }\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Send, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1390,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1379,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1364,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1363,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1171,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1163,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 973,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n        open: showSnackbar,\n        autoHideDuration: 6000,\n        onClose: () => setShowSnackbar(false),\n        anchorOrigin: {\n          vertical: 'bottom',\n          horizontal: 'center'\n        },\n        sx: {\n          bottom: {\n            xs: 90,\n            sm: 24\n          }\n        },\n        children: /*#__PURE__*/_jsxDEV(Alert, {\n          onClose: () => setShowSnackbar(false),\n          severity: authError ? \"error\" : \"success\",\n          sx: {\n            width: '100%',\n            bgcolor: '#2E2E2E',\n            color: 'white'\n          },\n          children: snackbarMessage || authError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1406,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1399,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 863,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 861,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"O9PORWvdSF+MEkGOUlNvoQGbwPE=\", false, function () {\n  return [useTheme, useMediaQuery];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","Box","Drawer","Typography","List","ListItem","ListItemText","ListItemIcon","Paper","TextField","Button","Avatar","Divider","Chip","Fab","useMediaQuery","useTheme","Dialog","DialogTitle","DialogContent","DialogActions","CircularProgress","Alert","Snackbar","CssBaseline","FormControl","InputLabel","Select","MenuItem","Folder","Send","Person","Description","CloudSync","TableChart","ChevronLeft","Menu","Save","GoogleGenerativeAI","createTheme","ThemeProvider","jsxDEV","_jsxDEV","theme","palette","mode","primary","main","light","dark","secondary","background","default","paper","text","success","error","typography","fontFamily","h4","fontWeight","h6","components","MuiButton","styleOverrides","root","borderRadius","textTransform","padding","contained","boxShadow","transform","MuiPaper","backdropFilter","border","drawerWidth","App","_s","muiTheme","isMobile","breakpoints","down","messages","setMessages","sender","timestamp","Date","question","setQuestion","fileName","setFileName","googleSheetsUrl","setGoogleSheetsUrl","sheetData","setSheetData","lastInternalNotes","setLastInternalNotes","changesCount","setChangesCount","isSheetLoaded","setIsSheetLoaded","projects","setProjects","name","status","lastModified","isConnectingToDrive","setIsConnectingToDrive","isPickerReady","setIsPickerReady","accessToken","setAccessToken","authError","setAuthError","showSnackbar","setShowSnackbar","snackbarMessage","setSnackbarMessage","availableSheets","setAvailableSheets","selectedSheetName","setSelectedSheetName","isLoadingSheets","setIsLoadingSheets","uploadedPdfFile","setUploadedPdfFile","isUploadingPdf","setIsUploadingPdf","params","URLSearchParams","window","location","search","token","get","history","replaceState","document","title","script","createElement","src","onload","gapi","load","callback","head","appendChild","columnIndexToLetter","colIndex","temp","letter","column","String","fromCharCode","processSheetData","values","mappedData","Array","isArray","forEach","row","rowIndex","length","cellValue","cellAddress","makeGoogleSheetsAPICall","spreadsheetId","range","method","Error","baseUrl","url","options","headers","body","JSON","stringify","response","fetch","data","json","console","log","ok","_data$error","message","extractSpreadsheetId","match","getSpreadsheetMetadata","metadata","sheets","map","sheet","properties","id","sheetId","index","prev","simulateAIChanges","readRange","readResult","updateRange","updateResult","toLocaleTimeString","handleFileUpload","event","fileType","file","target","files","formData","FormData","append","credentials","result","filtered","filter","msg","includes","isLoading","replace","setTimeout","Math","floor","random","handleGoogleSheetsUrl","loadAvailableSheets","getSheetData","_sheets$","handleSheetChange","newSheetName","pickerCallback","action","google","picker","Action","PICKED","doc","docs","createPicker","developerKey","process","env","REACT_APP_GEMINI_API_KEY","clientId","REACT_APP_GOOGLE_CLIENT_ID","appId","split","view","View","ViewId","SPREADSHEETS","setMimeTypes","PickerBuilder","setAppId","setOAuthToken","setDeveloperKey","addView","setCallback","build","setVisible","handleConnectToDrive","sheetName","apiResponse","rawValues","cleanData","sendMessage","trim","userMessage","rawData","m","genAI","model","getGenerativeModel","historyForPrompt","isAction","slice","join","context","pdfContext","displayName","fullContext","prompt","expirationTime","filename","pdfResponse","fileId","conversationHistory","pdfResult","generateContent","responseText","parsedResponse","jsonMatch","parse","e","chatResponse","sheetActions","internalNotes","newMessages","push","Promise","all","errorMessage","saveAllChanges","children","_jsxFileName","lineNumber","columnNumber","sx","display","height","bgcolor","overflow","position","top","left","right","bottom","pointerEvents","zIndex","variant","width","flexShrink","boxSizing","borderRight","p","backgroundClip","WebkitBackgroundClip","WebkitTextFillColor","color","borderColor","alignItems","gap","gutterBottom","dense","project","px","py","mb","minWidth","fontSize","primaryTypographyProps","secondaryTypographyProps","label","size","flexGrow","flexDirection","ml","flex","justifyContent","flexWrap","value","onChange","disabled","href","onClick","startIcon","placeholder","onKeyPress","key","style","opacity","textAlign","maxWidth","borderBottom","component","type","hidden","accept","currentUrl","newUrl","pushState","fullWidth","mt","className","borderTop","open","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","xs","sm","severity","_c","$RefreshReg$"],"sources":["/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Box, \r\n  Drawer, \r\n  Typography, \r\n  List, \r\n  ListItem, \r\n  ListItemText, \r\n  ListItemIcon,\r\n  Paper,\r\n  TextField,\r\n  Button,\r\n  Avatar,\r\n  Divider,\r\n  Chip,\r\n  Fab,\r\n  useMediaQuery,\r\n  useTheme,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  CircularProgress,\r\n  Alert,\r\n  Snackbar,\r\n  CssBaseline,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem\r\n} from '@mui/material';\r\nimport { \r\n  Folder, \r\n  Send, \r\n  Person,\r\n  Description,\r\n  CloudSync,\r\n  TableChart,\r\n  ChevronLeft,\r\n  Menu,\r\n  Save\r\n} from '@mui/icons-material';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\nimport './App.css';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    mode: 'dark',\r\n    primary: {\r\n      main: '#8B5CF6', // Brighter purple\r\n      light: '#A78BFA',\r\n      dark: '#7C3AED',\r\n    },\r\n    secondary: {\r\n      main: '#6366F1', // Indigo accent\r\n      light: '#818CF8',\r\n      dark: '#4F46E5',\r\n    },\r\n    background: {\r\n      default: '#000000', // Pure black\r\n      paper: '#0A0A0A', // Very dark gray\r\n    },\r\n    text: {\r\n      primary: '#FFFFFF', // Pure white for better contrast\r\n      secondary: '#E5E7EB', // Light gray\r\n    },\r\n    success: {\r\n      main: '#10B981', // Green for approved changes\r\n      light: '#34D399',\r\n      dark: '#059669',\r\n    },\r\n    error: {\r\n      main: '#EF4444', // Red for pending changes\r\n      light: '#F87171',\r\n      dark: '#DC2626',\r\n    }\r\n  },\r\n  typography: {\r\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\r\n    h4: { fontWeight: 700 },\r\n    h6: { fontWeight: 600 }\r\n  },\r\n  components: {\r\n    MuiButton: {\r\n      styleOverrides: {\r\n        root: {\r\n          borderRadius: 12,\r\n          textTransform: 'none',\r\n          fontWeight: 600,\r\n          padding: '10px 20px',\r\n        },\r\n        contained: {\r\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\r\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\r\n          '&:hover': {\r\n            transform: 'translateY(-1px)',\r\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\r\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)',\r\n          }\r\n        },\r\n      },\r\n    },\r\n    MuiPaper: {\r\n      styleOverrides: {\r\n        root: {\r\n          background: 'rgba(20, 20, 20, 0.95)',\r\n          backdropFilter: 'blur(20px)',\r\n          border: '1px solid rgba(139, 92, 246, 0.3)',\r\n          borderRadius: 16,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nconst drawerWidth = 280;\r\n\r\nfunction App() {\r\n  const muiTheme = useTheme();\r\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\r\n  \r\n  const [messages, setMessages] = useState([\r\n    { text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date() }\r\n  ]);\r\n  const [question, setQuestion] = useState('');\r\n  const [fileName, setFileName] = useState('');\r\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\r\n  const [sheetData, setSheetData] = useState([]);\r\n  const [lastInternalNotes, setLastInternalNotes] = useState(\"\"); // State for conversation context\r\n  const [changesCount, setChangesCount] = useState(0);\r\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\r\n  const [projects, setProjects] = useState([\r\n    { name: 'הערכת שווי טק-גלובל', status: 'פעיל', lastModified: 'לפני 2 דקות' },\r\n    { name: 'ניתוח Q3 פין-קורפ', status: 'טיוטה', lastModified: 'לפני שעה' },\r\n    { name: 'מצגת סטארט-אפ', status: 'הושלם', lastModified: 'לפני יומיים' }\r\n  ]);\r\n\r\n  // Google Drive integration state\r\n  const [isConnectingToDrive, setIsConnectingToDrive] = useState(false);\r\n  const [isPickerReady, setIsPickerReady] = useState(false);\r\n\r\n  // Simplified Google Sheets API state\r\n  const [accessToken, setAccessToken] = useState('');\r\n  const [authError, setAuthError] = useState('');\r\n  const [showSnackbar, setShowSnackbar] = useState(false);\r\n  const [snackbarMessage, setSnackbarMessage] = useState('');\r\n\r\n  // Sheet selection state\r\n  const [availableSheets, setAvailableSheets] = useState([]);\r\n  const [selectedSheetName, setSelectedSheetName] = useState('');\r\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\r\n\r\n  // PDF state\r\n  const [uploadedPdfFile, setUploadedPdfFile] = useState(null);\r\n  const [isUploadingPdf, setIsUploadingPdf] = useState(false);\r\n\r\n  // Handle token from URL on initial load\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const token = params.get('token');\r\n\r\n    if (token) {\r\n      setAccessToken(token);\r\n      setSnackbarMessage('התחברת בהצלחה!');\r\n      setShowSnackbar(true);\r\n      window.history.replaceState({}, document.title, \"/\");\r\n    }\r\n  }, []);\r\n\r\n  // Load Google API and Picker scripts on component mount\r\n  useEffect(() => {\r\n          const script = document.createElement('script');\r\n          script.src = 'https://apis.google.com/js/api.js';\r\n          script.onload = () => {\r\n      // After the main script is loaded, load the picker-specific script\r\n      window.gapi.load('picker', { 'callback': () => setIsPickerReady(true) });\r\n          };\r\n          document.head.appendChild(script);\r\n  }, []);\r\n// ==========================================================\r\n// === הוראה מס' 1: הדבק את שתי הפונקציות הבאות כאן ===\r\n// ==========================================================\r\n\r\n/**\r\n * מתרגם אינדקס של עמודה (מבוסס 0) לאות המייצגת אותה בגיליון (A, B, ..., Z, AA).\r\n * @param {number} colIndex - האינדקס של העמודה (מתחיל ב-0).\r\n * @returns {string} - אות העמודה.\r\n */\r\nfunction columnIndexToLetter(colIndex) {\r\n  let temp, letter = '';\r\n  let column = colIndex + 1;\r\n  while (column > 0) {\r\n    temp = (column - 1) % 26;\r\n    letter = String.fromCharCode(temp + 65) + letter;\r\n    column = (column - temp - 1) / 26;\r\n  }\r\n  return letter;\r\n}\r\n\r\n/**\r\n * מעבד את הפלט הגולמי מה-Google Sheets API והופך אותו לאובייקט נוח לשימוש.\r\n * @param {Array<Array<string>>} values - מערך הנתונים הגולמי מה-API.\r\n * @returns {Object} - אובייקט שממפה כתובת תא לערך שלו, ללא תאים ריקים.\r\n */\r\nfunction processSheetData(values) {\r\n  const mappedData = {};\r\n  if (!Array.isArray(values)) {\r\n    // במקרה שה-API לא החזיר מערך, נחזיר אובייקט ריק כדי למנוע קריסה\r\n    return mappedData;\r\n  }\r\n  \r\n  values.forEach((row, rowIndex) => {\r\n    if (row && row.length > 0) {\r\n      row.forEach((cellValue, colIndex) => {\r\n        if (cellValue !== null && cellValue !== '') {\r\n          const cellAddress = columnIndexToLetter(colIndex) + (rowIndex + 1);\r\n          mappedData[cellAddress] = cellValue;\r\n        }\r\n      });\r\n    }\r\n  });\r\n  \r\n  return mappedData;\r\n}\r\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET') => {\r\n    if (!accessToken) {\r\n      setAuthError('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\r\n      setShowSnackbar(true);\r\n      setSnackbarMessage('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\r\n      throw new Error('No access token available. Please log in.');\r\n    }\r\n\r\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n    \r\n    try {\r\n      let url, options;\r\n      \r\n      if (method === 'GET') {\r\n        // Read data from sheet\r\n        url = `${baseUrl}/values/${range}`;\r\n        options = {\r\n          method: 'GET',\r\n          headers: {\r\n            'Authorization': `Bearer ${accessToken}`,\r\n            'Content-Type': 'application/json',\r\n          }\r\n        };\r\n      } else if (method === 'PUT') {\r\n        // Update data in sheet\r\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\r\n        options = {\r\n          method: 'PUT',\r\n          headers: {\r\n            'Authorization': `Bearer ${accessToken}`,\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            values: values\r\n          })\r\n        };\r\n      } else if (method === 'POST') {\r\n        // Append data to sheet\r\n        url = `${baseUrl}/values/${range}:append?valueInputOption=RAW`;\r\n        options = {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': `Bearer ${accessToken}`,\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            values: values\r\n          })\r\n        };\r\n      }\r\n\r\n      const response = await fetch(url, options);\r\n      const data = await response.json();\r\n      \r\n      // *** THE ONLY CHANGE IS HERE: ***\r\n      console.log(\"--- RAW RESPONSE FROM GOOGLE SHEETS API ---\");\r\n      console.log(JSON.stringify(data, null, 2));\r\n      console.log(\"-----------------------------------------\");\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error?.message || 'API call failed');\r\n      }\r\n      \r\n      return data;\r\n    } catch (error) {\r\n      console.error('Google Sheets API error:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // Function to extract spreadsheet ID from URL\r\n  const extractSpreadsheetId = (url) => {\r\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\r\n    return match ? match[1] : null;\r\n  };\r\n\r\n  // Function to get available sheets in a spreadsheet\r\n  const getSpreadsheetMetadata = async (spreadsheetId) => {\r\n    if (!accessToken) {\r\n      setAuthError('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\r\n      setShowSnackbar(true);\r\n      return [];\r\n    }\r\n\r\n    try {\r\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n      const response = await fetch(url, {\r\n        headers: {\r\n          'Authorization': `Bearer ${accessToken}`,\r\n          'Content-Type': 'application/json',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch spreadsheet metadata');\r\n      }\r\n\r\n      const metadata = await response.json();\r\n      return metadata.sheets.map(sheet => ({\r\n        name: sheet.properties.title,\r\n        id: sheet.properties.sheetId,\r\n        index: sheet.properties.index\r\n      }));\r\n    } catch (error) {\r\n      console.error('Error fetching spreadsheet metadata:', error);\r\n      setMessages(prev => [...prev, {\r\n        text: `❌ שגיאה בטעינת רשימת גליונות: ${error.message}`,\r\n        sender: 'system',\r\n        timestamp: new Date()\r\n      }]);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  // Function to simulate AI making changes to the sheet\r\n  const simulateAIChanges = async () => {\r\n    if (!accessToken || !googleSheetsUrl) {\r\n      setMessages(prev => [...prev, {\r\n        text: `❌ אין גישה לגיליון. אנא התחבר ל-Google Sheets תחילה.`,\r\n        sender: 'system',\r\n        timestamp: new Date()\r\n      }]);\r\n      return;\r\n    }\r\n\r\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n    if (!spreadsheetId) {\r\n      setMessages(prev => [...prev, {\r\n        text: `❌ לא ניתן לזהות את מזהה הגיליון.`,\r\n        sender: 'system',\r\n        timestamp: new Date()\r\n      }]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Example: Read data from A1:C10\r\n      const readRange = selectedSheetName ? `${selectedSheetName}!A1:C10` : 'A1:C10';\r\n      const readResult = await makeGoogleSheetsAPICall(spreadsheetId, readRange, null, 'GET');\r\n      console.log('Read data:', readResult);\r\n\r\n      // Example: Update a cell\r\n      const updateRange = selectedSheetName ? `${selectedSheetName}!A1` : 'A1';\r\n      const updateResult = await makeGoogleSheetsAPICall(\r\n        spreadsheetId, \r\n        updateRange, \r\n        [['עודכן על ידי AI - ' + new Date().toLocaleTimeString('he-IL')]], \r\n        'PUT'\r\n      );\r\n      console.log('Update result:', updateResult);\r\n\r\n      setChangesCount(prev => prev + 1);\r\n      setMessages(prev => [...prev, {\r\n        text: `✅ ביצעתי שינוי בגיליון! עדכנתי את תא A1 עם חותמת זמן.`,\r\n        sender: 'assistant',\r\n        timestamp: new Date()\r\n      }]);\r\n\r\n    } catch (error) {\r\n      setMessages(prev => [...prev, {\r\n        text: `❌ שגיאה בביצוע שינויים: ${error.message}`,\r\n        sender: 'system',\r\n        timestamp: new Date()\r\n      }]);\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (event, fileType) => {\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n\r\n    if (fileType === 'PDF') {\r\n      setIsUploadingPdf(true);\r\n      setMessages(prev => [...prev, {\r\n        text: `⏳ מעלה את הקובץ \"${file.name}\"...`,\r\n        sender: 'system',\r\n        timestamp: new Date()\r\n      }]);\r\n\r\n      const formData = new FormData();\r\n      formData.append('pdf', file);\r\n\r\n      try {\r\n        const response = await fetch('http://localhost:3001/api/upload-pdf', {\r\n          method: 'POST',\r\n          body: formData,\r\n          credentials: 'include'\r\n        });\r\n\r\n        if (!response.ok) {\r\n          const error = await response.json();\r\n          throw new Error(error.error || 'Upload failed');\r\n        }\r\n        \r\n        const result = await response.json();\r\n        setUploadedPdfFile(result.file);\r\n        \r\n        // Remove uploading message and add success message\r\n        setMessages(prev => {\r\n          const filtered = prev.filter(msg => !msg.text.includes('⏳ מעלה את הקובץ'));\r\n          return [...filtered, {\r\n            text: `📎 קובץ PDF \"${file.name}\" הועלה בהצלחה! אתה יכול לשאול אותי שאלות על התוכן.`,\r\n            sender: 'system',\r\n            timestamp: new Date()\r\n          }];\r\n        });\r\n\r\n      } catch (error) {\r\n        console.error('PDF upload failed:', error);\r\n        setMessages(prev => {\r\n          const filtered = prev.filter(msg => !msg.text.includes('⏳ מעלה את הקובץ') && !msg.isLoading);\r\n          return [...filtered, {\r\n            text: `❌ שגיאה בהעלאת PDF: ${error.message}`,\r\n            sender: 'system',\r\n            timestamp: new Date()\r\n          }];\r\n        });\r\n      } finally {\r\n        setIsUploadingPdf(false);\r\n      }\r\n    } else if (fileType === 'Excel') {\r\n      const timestamp = new Date();\r\n      setFileName(file.name.replace(/\\.[^/.]+$/, \"\"));\r\n      setMessages(prev => [...prev, {\r\n        text: `📎 קובץ ${fileType} \"${file.name}\" הועלה בהצלחה`,\r\n        sender: 'system',\r\n        timestamp\r\n      }]);\r\n      \r\n      // Simulate AI analysis and changes\r\n      setTimeout(() => {\r\n        setChangesCount(prev => prev + Math.floor(Math.random() * 5) + 3);\r\n        setMessages(prev => [...prev, {\r\n          text: `🔍 סיימתי לנתח את הקובץ. מצאתי ${Math.floor(Math.random() * 5) + 3} שינויים מומלצים בגיליון שלך.`,\r\n          sender: 'assistant',\r\n          timestamp: new Date()\r\n        }]);\r\n      }, 2000);\r\n    }\r\n  };\r\n\r\n  const handleGoogleSheetsUrl = async (url) => {\r\n    setGoogleSheetsUrl(url);\r\n    setIsSheetLoaded(true);\r\n    \r\n    // Load available sheets for the entered URL\r\n    const spreadsheetId = extractSpreadsheetId(url);\r\n    if (spreadsheetId && accessToken) {\r\n      await loadAvailableSheets(spreadsheetId);\r\n    }\r\n  };\r\n\r\n  // Function to load available sheets for a spreadsheet\r\n  const loadAvailableSheets = async (spreadsheetId) => {\r\n    setIsLoadingSheets(true);\r\n    try {\r\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\r\n      setAvailableSheets(sheets);\r\n      \r\n      // Set first sheet as default\r\n      if (sheets.length > 0) {\r\n        setSelectedSheetName(sheets[0].name);\r\n        // Load data for the first sheet\r\n        await getSheetData(spreadsheetId, sheets[0].name);\r\n      }\r\n      \r\n      setMessages(prev => [...prev, {\r\n        text: `🔍 נמצאו ${sheets.length} גליונות. גליון פעיל: ${sheets[0]?.name || 'לא ידוע'}`,\r\n        sender: 'system',\r\n        timestamp: new Date()\r\n      }]);\r\n    } catch (error) {\r\n      console.error('Error loading available sheets:', error);\r\n    } finally {\r\n      setIsLoadingSheets(false);\r\n    }\r\n  };\r\n\r\n  // Function to handle sheet selection change\r\n  const handleSheetChange = async (newSheetName) => {\r\n    if (newSheetName === selectedSheetName) return;\r\n    \r\n    setSelectedSheetName(newSheetName);\r\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n    \r\n    if (spreadsheetId) {\r\n      try {\r\n        await getSheetData(spreadsheetId, newSheetName);\r\n        setMessages(prev => [...prev, {\r\n          text: `📋 החלפנו לגליון: ${newSheetName}`,\r\n          sender: 'system',\r\n          timestamp: new Date()\r\n        }]);\r\n      } catch (error) {\r\n        console.error('Error switching sheet:', error);\r\n        setMessages(prev => [...prev, {\r\n          text: `❌ שגיאה בהחלפת גליון: ${error.message}`,\r\n          sender: 'system',\r\n          timestamp: new Date()\r\n        }]);\r\n      }\r\n    }\r\n  };\r\n\r\n  const pickerCallback = async (data) => {\r\n    if (data.action === window.google.picker.Action.PICKED) {\r\n      const doc = data.docs[0];\r\n      setFileName(doc.name);\r\n      handleGoogleSheetsUrl(doc.url);\r\n      \r\n      // Load available sheets for the selected spreadsheet\r\n      const spreadsheetId = extractSpreadsheetId(doc.url);\r\n      if (spreadsheetId) {\r\n        await loadAvailableSheets(spreadsheetId);\r\n      }\r\n      \r\n      setSnackbarMessage(`טען גיליון: ${doc.name}`);\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const createPicker = () => {\r\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY; // The correct Gemini/Cloud API Key\r\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\r\n\r\n    if (!clientId || !developerKey) {\r\n      setAuthError('מפתחות ה-API של גוגל אינם מוגדרים כראוי בקובץ .env');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n    const appId = clientId.split('-')[0];\r\n\r\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\r\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\r\n\r\n    const picker = new window.google.picker.PickerBuilder()\r\n      .setAppId(appId)\r\n      .setOAuthToken(accessToken)\r\n      .setDeveloperKey(developerKey)\r\n      .addView(view)\r\n      .setCallback(pickerCallback)\r\n      .build();\r\n    \r\n    picker.setVisible(true);\r\n  };\r\n\r\n  const handleConnectToDrive = () => {\r\n    if (!accessToken) {\r\n      setAuthError('יש להתחבר תחילה לחשבון Google.');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n    createPicker();\r\n  };\r\n\r\n  // ==========================================================\r\n  // === הוראה מס' 2: החלף את הפונקציה הקיימת בזו ===\r\n  // ==========================================================\r\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\r\n    if (!accessToken) {\r\n      setAuthError('אינך מחובר. יש להתחבר דרך עמוד ההתחברות.');\r\n      setShowSnackbar(true);\r\n      return null;\r\n    }\r\n    try {\r\n      // 1. קרא את הנתונים הגולמיים מה-API עם שם הגליון הנבחר\r\n      const range = sheetName ? `${sheetName}!A1:Z1000` : 'A1:Z1000';\r\n      const apiResponse = await makeGoogleSheetsAPICall(spreadsheetId, range);\r\n      const rawValues = (apiResponse && Array.isArray(apiResponse.values)) ? apiResponse.values : [];\r\n\r\n      // 2. השתמש בפונקציית העזר כדי לעבד את הנתונים לפורמט הנקי\r\n      const cleanData = processSheetData(rawValues);\r\n\r\n      // 3. עדכן את ה-state עם הנתונים המעובדים (אם רלוונטי לשימושים אחרים)\r\n      setSheetData(cleanData); \r\n\r\n      // 4. החזר את הנתונים המעובדים והנקיים\r\n      return cleanData; \r\n\r\n    } catch (error) {\r\n      console.error('Failed to fetch sheet data:', error);\r\n      setMessages(prev => [...prev, {\r\n        text: `❌ שגיאה בטעינת נתוני הגיליון: ${error.message}`,\r\n        sender: 'system',\r\n        timestamp: new Date()\r\n      }]);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (!question.trim() || !isSheetLoaded) {\r\n      if (!isSheetLoaded) {\r\n        setAuthError('יש לבחור גיליון תחילה.');\r\n        setShowSnackbar(true);\r\n      }\r\n      return;\r\n    }\r\n    \r\n    const timestamp = new Date();\r\n    const userMessage = { text: question, sender: 'user', timestamp };\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setQuestion('');\r\n\r\n    setMessages(prev => [...prev, { text: '...', sender: 'assistant', isLoading: true, timestamp: new Date() }]);\r\n\r\n    try {\r\n      const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n      if (!spreadsheetId) throw new Error(\"Invalid Google Sheets URL\");\r\n    \r\n      // --- התחלת התיקון ---\r\n      // אנו נשתמש בפונקציית העזר הקיימת כדי להבטיח שהמידע תמיד נשלף באותה הדרך\r\n      const rawData = await getSheetData(spreadsheetId, selectedSheetName);\r\n    \r\n      // נוסיף בדיקה לוודא שהמידע אכן התקבל לפני שממשיכים\r\n      if (!rawData) {\r\n        console.error(\"sendMessage: לא הצלחתי לקבל מידע מהגיליון, הפעולה בוטלה.\");\r\n        setMessages(prev => prev.filter(m => !m.isLoading)); // הסרת הודעת הטעינה\r\n        return; // יציאה מהפונקציה\r\n      }\r\n      // --- סוף התיקון ---\r\n      \r\n      const genAI = new GoogleGenerativeAI(process.env.REACT_APP_GEMINI_API_KEY);\r\n      const model = genAI.getGenerativeModel({ model: \"gemini-2.5-flash\" });\r\n\r\n      const historyForPrompt = messages\r\n        .filter(m => !m.isAction)\r\n        .slice(-6)\r\n        .map(m => `${m.sender === 'user' ? 'User' : 'Assistant'}: ${m.text}`)\r\n        .join('\\n');\r\n\r\n           // ==========================================================\r\n      // === הוראה מס' 3: החלף את הפרומפט הקיים בזה ===\r\n      // ==========================================================\r\n      const context = `\r\n       אתה עוזר פיננסי מומחה, קפדן ודקדקן. תפקידך הוא לנתח נתונים מגיליון אלקטרוני ולבצע שינויים מדויקים לפי בקשת המשתמש.\r\n\r\n***תהליך חשיבה וניתוח (חובה!)***\r\nלפני שאתה מחליט על פעולה, עליך לבצע את תהליך החשיבה הבא בראשך:\r\n1.  **זיהוי שדה ותיאור:** זהה את התא המכיל את התיאור שהמשתמש ביקש (למשל, \"רווח נקי מבוקר\" בתא E23). זהו \"השדה\".\r\n2.  **ניתוח כיווניות (Directionality Analysis):**\r\n    -   בדוק את התאים הסמוכים לשדה, במיוחד באותה שורה.\r\n    -   שים לב! בעברית ממלאים דוחות לרוב מימין לשמאל, כלומר השייכות היא למה שמופיע משמאל ולא מימין. לרוב זה ככה, לא תמיד, אם אתה נתקל במקרה שאפשר לפרש ל2 הכיוונים תשאל. גם אם אתה בטוח שהבנת את המבנה, בעברית זה שונה. אז תשאל. כמעט תמיד תשאל ותוודא \r\n3.  **הערכת רמת ודאות:**\r\n    -   האם המספרים קרובים יותר לצד אחד? לרוב זה מעיד שהם שייכים אליו\r\n    -   **ודאות נמוכה (עמימות):** אם יש ערכים משני הצדדים, אם יש מספר טורים של נתונים, או אם המבנה לא ברור.\r\n\r\n***הוראה קריטית:*** אם רמת הוודאות שלך נמוכה, **חובה עליך** לשאול את המשתמש שאלה מבהירה ב-\"chatResponse\" ולהשאיר את \"sheetActions\" כמערך ריק. אל תבצע שינוי אם אינך בטוח ב-100%.\r\nאני רוצה שתיפול על הצד החשדני, אם יש ספק, אין ספק - שואלים. אם יש משהו שאפשר לפרש ל2 כיוונים, שואלים. \r\n\r\n---\r\n***הוראות קריטיות לפורמט הפלט***\r\nעליך להחזיר תמיד תגובת JSON מובנית בלבד, עם שלושת המפתחות הבאים. אין להוסיף טקסט מחוץ ל-JSON.\r\n\r\n1.  **\"chatResponse\"**: (מחרוזת) התגובה הטקסטואלית שתוצג למשתמש בצ'אט. אם הוודאות נמוכה, זו חייבת להיות שאלה מבהירה.\r\n2.  **\"sheetActions\"**: (מערך) רשימת פעולות לביצוע. אם הוודאות נמוכה, המערך חייב להיות ריק.\r\n    -   \"range\": (מחרוזת) הטווח לעדכון (למשל, \"Sheet1!A5\").\r\n    -   \"values\": (מערך של מערכים) הנתונים החדשים.\r\n3.  **\"internalNotes\"**: (מחרוזת) **תיעוד מפורט של תהליך החשיבה שלך.** שדה זה ישמש כזיכרון הפנימי שלך. עליו לכלול את ניתוח השדה, ניתוח הכיווניות, והערכת רמת הוודאות שלך.\r\n\r\n---\r\n***דוגמה לתגובה במקרה של ודאות גבוהה:***\r\n{\r\n  \"chatResponse\": \"בטח, עדכנתי את הרווח הנקי המבוקר ל-50,000.\",\r\n  \"sheetActions\": [\r\n    {\r\n      \"range\": \"Sheet1!H23\",\r\n      \"values\": [[\"50000\"]]\r\n    }\r\n  ],\r\n  \"internalNotes\": \"ניתוח: המשתמש ביקש לעדכן 'רווח נקי מבוקר'. השדה זוהה ב-E23. הערך המספרי נמצא ב-H23. המבנה ברור. ודאות: גבוהה. פעולה: עדכון תא H23.\"\r\n}\r\n\r\n***דוגמה לתגובה במקרה של עמימות (ודאות נמוכה):***\r\n{\r\n  \"chatResponse\": \"בהחלט. זיהיתי את 'מזומנים לפעילות שוטפת', אך אני רואה נתונים עבור שתי תקופות שונות. האם תרצה לעדכן את הערך של 2024 (17,630) או את הערך של 2025 (28,765)?\",\r\n  \"sheetActions\": [],\r\n  \"internalNotes\": \"ניתוח: המשתמש ביקש לעדכן 'מזומנים'. השדה זוהה ב-E16. קיימת עמימות כי יש שני טורים של נתונים, ב-H16 וב-I16. ודאות: נמוכה. פעולה: שאילת הבהרה.\"\r\n}\r\n\r\n---\r\n***הקשר מהשיחה הקודמת (הערות פנימיות שלך):***\r\n${lastInternalNotes || \"זו ההודעה הראשונה בשיחה.\"}\r\n\r\n---\r\n***נתוני הגיליון הנוכחיים:***\r\nהנתונים מגיעים בפורמט JSON, כאשר המפתח הוא כתובת התא והערך הוא התוכן.\r\n${JSON.stringify(rawData)}\r\n\r\n---\r\n***היסטוריית השיחה האחרונה:***\r\n${historyForPrompt}\r\n      `;\r\n      \r\n      // Add PDF context if available\r\n      let pdfContext = '';\r\n      if (uploadedPdfFile) {\r\n        pdfContext = `\r\n---\r\n***מסמך PDF מצורף:***\r\nהמשתמש העלה קובץ PDF: \"${uploadedPdfFile.displayName}\"\r\nהשתמש במידע מהPDF יחד עם נתוני הגיליון כדי לענות על השאלות ולבצע שינויים.\r\n`;\r\n      }\r\n\r\n      const fullContext = `${context}${pdfContext}`;\r\n      const prompt = `${fullContext}\\n\\n***שאלת המשתמש החדשה:*** ${question}`;\r\n\r\n      // *** ADD DEBUG LOGS HERE ***\r\n      console.log(\"=== DEBUG: WHAT WE'RE SENDING TO GEMINI ===\");\r\n      console.log(\"Raw data from sheets:\", rawData);\r\n      if (uploadedPdfFile) {\r\n        console.log(\"PDF attached:\", uploadedPdfFile.displayName);\r\n      }\r\n      console.log(\"Full prompt being sent to Gemini:\");\r\n      console.log(prompt);\r\n      console.log(\"=== END DEBUG ===\");\r\n\r\n      // Check if PDF hasn't expired\r\n      if (uploadedPdfFile && new Date(uploadedPdfFile.expirationTime) < new Date()) {\r\n        setUploadedPdfFile(null);\r\n        setMessages(prev => [...prev, {\r\n          text: '⚠️ קובץ הPDF פג תוקף. יש להעלות מחדש.',\r\n          sender: 'system',\r\n          timestamp: new Date()\r\n        }]);\r\n        setMessages(prev => prev.filter(m => !m.isLoading));\r\n        return;\r\n      }\r\n\r\n      // If we have a PDF, use the backend endpoint that processes PDF + question\r\n      let result;\r\n      if (uploadedPdfFile && uploadedPdfFile.filename) {\r\n        const pdfResponse = await fetch('http://localhost:3001/api/process-pdf-question', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            fileId: uploadedPdfFile.id,\r\n            filename: uploadedPdfFile.filename,\r\n            question: prompt,\r\n            conversationHistory: historyForPrompt\r\n          }),\r\n          credentials: 'include'\r\n        });\r\n\r\n        if (!pdfResponse.ok) {\r\n          throw new Error('Failed to process PDF question');\r\n        }\r\n\r\n        const pdfResult = await pdfResponse.json();\r\n        \r\n        // Create a response object that matches Gemini's format\r\n        result = {\r\n          response: {\r\n            text: () => pdfResult.response\r\n          }\r\n        };\r\n      } else {\r\n        // No PDF, use direct Gemini API\r\n        result = await model.generateContent(prompt);\r\n      }\r\n      const responseText = await result.response.text();\r\n\r\n      // *** ADD DEBUG LOG FOR GEMINI RESPONSE ***\r\n      console.log(\"=== DEBUG: GEMINI RESPONSE ===\");\r\n      console.log(\"Raw response from Gemini:\", responseText);\r\n      console.log(\"=== END GEMINI RESPONSE DEBUG ===\");\r\n\r\n      let parsedResponse;\r\n      try {\r\n        // Find the JSON part of the response, as Gemini might add backticks\r\n        const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\r\n        if (!jsonMatch) throw new Error(\"No valid JSON object found in response.\");\r\n        parsedResponse = JSON.parse(jsonMatch[0]);\r\n      } catch (e) {\r\n        console.error(\"Failed to parse Gemini's response as JSON:\", responseText);\r\n        throw new Error(\"תגובת ה-AI אינה בפורמט JSON תקין.\");\r\n      }\r\n\r\n      const { chatResponse, sheetActions, internalNotes } = parsedResponse;\r\n\r\n      // 1. Update internal notes for the next turn\r\n      setLastInternalNotes(internalNotes);\r\n\r\n      // Remove the initial loading message and show the preliminary chat response\r\n      setMessages(prev => {\r\n        const newMessages = prev.filter(m => !m.isLoading);\r\n        newMessages.push({ text: chatResponse, sender: 'assistant', timestamp: new Date() });\r\n        return newMessages;\r\n      });\r\n\r\n      // 2. Perform sheet actions if any\r\n      if (sheetActions && sheetActions.length > 0) {\r\n        setMessages(prev => [...prev, { text: `מבצע ${sheetActions.length} שינויים בגיליון...`, sender: 'system', isAction: true, timestamp: new Date() }]);\r\n        \r\n        await Promise.all(\r\n          sheetActions.map(action => {\r\n            // Add sheet name to range if not already present\r\n            const range = action.range.includes('!') ? action.range : \r\n                         selectedSheetName ? `${selectedSheetName}!${action.range}` : action.range;\r\n            return makeGoogleSheetsAPICall(spreadsheetId, range, action.values, 'PUT');\r\n          })\r\n        );\r\n        \r\n        setChangesCount(prev => prev + sheetActions.length);\r\n\r\n        // ** CRITICAL FIX: ** Re-fetch data AFTER updates to ensure consistency\r\n        await getSheetData(spreadsheetId, selectedSheetName); \r\n        \r\n        // Remove the \"Performing actions...\" message\r\n        setMessages(prev => prev.filter(m => !m.isAction));\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error in sendMessage:', error);\r\n      const errorMessage = `אירעה שגיאה: ${error.message}`;\r\n      setMessages(prev => {\r\n        const newMessages = prev.filter(msg => !msg.isLoading);\r\n        newMessages.push({ text: errorMessage, sender: 'assistant', timestamp: new Date() });\r\n        return newMessages;\r\n      });\r\n    }\r\n  };\r\n\r\n  const saveAllChanges = () => {\r\n    setMessages(prev => [...prev, {\r\n      text: `💾 כל השינויים נשמרו לגיליון ${fileName}`,\r\n      sender: 'system',\r\n      timestamp: new Date()\r\n    }]);\r\n  };\r\n\r\n \r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      <Box sx={{ \r\n        display: 'flex', \r\n        height: '100vh', \r\n        bgcolor: 'background.default',\r\n        overflow: 'hidden',\r\n        // Only add scroll for very small screens\r\n        '@media (max-height: 600px)': {\r\n          overflow: 'auto'\r\n        }\r\n      }}>\r\n        {/* Ambient Background */}\r\n        <Box sx={{\r\n          position: 'fixed',\r\n          top: 0, left: 0, right: 0, bottom: 0,\r\n          background: `\r\n            radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%),\r\n            radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%),\r\n            radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.04) 0%, transparent 70%)\r\n          `,\r\n          pointerEvents: 'none',\r\n          zIndex: 0\r\n        }} />\r\n\r\n        {/* Sidebar */}\r\n        {!isMobile && (\r\n          <Drawer\r\n            variant=\"permanent\"\r\n            sx={{\r\n              width: drawerWidth,\r\n              flexShrink: 0,\r\n              zIndex: 1,\r\n              '& .MuiDrawer-paper': {\r\n                width: drawerWidth,\r\n                boxSizing: 'border-box',\r\n                bgcolor: 'rgba(10, 10, 10, 0.98)',\r\n                borderRight: '1px solid rgba(139, 92, 246, 0.4)',\r\n                backdropFilter: 'blur(20px)',\r\n              },\r\n            }}\r\n          >\r\n            <Box sx={{ p: 3 }}>\r\n              <Typography variant=\"h6\" sx={{ \r\n                background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\r\n                backgroundClip: 'text',\r\n                WebkitBackgroundClip: 'text',\r\n                WebkitTextFillColor: 'transparent',\r\n                fontWeight: 700 \r\n              }}>\r\n                TLV500\r\n              </Typography>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">\r\n                AI Assistant\r\n              </Typography>\r\n            </Box>\r\n            \r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            \r\n            {/* User Profile */}\r\n            <Box sx={{ p: 3, display: 'flex', alignItems: 'center', gap: 2 }}>\r\n              <Avatar sx={{ \r\n                width: 45, height: 45,\r\n                background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)'\r\n              }}>\r\n                <Person />\r\n              </Avatar>\r\n              <Box>\r\n                <Typography variant=\"body2\" fontWeight={600}>דוד אנליסט</Typography>\r\n                <Typography variant=\"caption\" color=\"text.secondary\">משתמש פרימיום</Typography>\r\n              </Box>\r\n            </Box>\r\n            \r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            \r\n            {/* Projects */}\r\n            <Box sx={{ p: 3 }}>\r\n              <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom fontWeight={600}>\r\n                פרויקטים אחרונים\r\n              </Typography>\r\n              <List dense>\r\n                {projects.map((project, index) => (\r\n                  <ListItem key={index} sx={{ \r\n                    px: 0, py: 1, borderRadius: 2, mb: 1,\r\n                    '&:hover': { \r\n                      bgcolor: 'rgba(139, 92, 246, 0.15)',\r\n                      transform: 'translateX(4px)'\r\n                    }\r\n                  }}>\r\n                    <ListItemIcon sx={{ minWidth: 36 }}>\r\n                      <Folder sx={{ color: 'primary.main', fontSize: 20 }} />\r\n                    </ListItemIcon>\r\n                    <ListItemText\r\n                      primary={project.name}\r\n                      secondary={project.lastModified}\r\n                      primaryTypographyProps={{ variant: 'body2', fontWeight: 500 }}\r\n                      secondaryTypographyProps={{ variant: 'caption' }}\r\n                    />\r\n                    <Chip \r\n                      label={project.status} \r\n                      size=\"small\" \r\n                      color={project.status === 'פעיל' ? 'primary' : 'default'}\r\n                      sx={{ fontSize: '0.65rem', fontWeight: 600 }}\r\n                    />\r\n                  </ListItem>\r\n                ))}\r\n              </List>\r\n            </Box>\r\n          </Drawer>\r\n        )}\r\n\r\n        {/* Main Content */}\r\n        <Box sx={{ \r\n          flexGrow: 1, \r\n          display: 'flex', \r\n          flexDirection: isMobile ? 'column' : 'row',\r\n          zIndex: 1,\r\n          ml: isMobile ? 0 : 0,\r\n          height: '100vh',\r\n          overflow: 'hidden'\r\n        }}>\r\n          {/* Excel Area */}\r\n          <Box sx={{ \r\n            flex: isMobile ? '1 1 60%' : '0 0 65%',\r\n            p: 2,\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            height: isMobile ? '60%' : '100%',\r\n            overflow: 'hidden'\r\n          }}>\r\n            {/* Controls outside table */}\r\n            <Box sx={{ mb: 2, display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: 2 }}>\r\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                <Typography variant=\"h6\" fontWeight={600} color=\"text.primary\">\r\n                  {fileName || 'לא נבחר גיליון'}\r\n                </Typography>\r\n                \r\n                {/* Sheet selection dropdown */}\r\n                {availableSheets.length > 1 && (\r\n                  <FormControl size=\"small\" sx={{ minWidth: 180 }}>\r\n                    <InputLabel sx={{ color: 'text.secondary' }}>בחר גליון</InputLabel>\r\n                    <Select\r\n                      value={selectedSheetName}\r\n                      label=\"בחר גליון\"\r\n                      onChange={(e) => handleSheetChange(e.target.value)}\r\n                      disabled={isLoadingSheets}\r\n                      sx={{\r\n                        '& .MuiOutlinedInput-notchedOutline': {\r\n                          borderColor: 'rgba(139, 92, 246, 0.5)',\r\n                        },\r\n                        '&:hover .MuiOutlinedInput-notchedOutline': {\r\n                          borderColor: 'rgba(139, 92, 246, 0.7)',\r\n                        },\r\n                        '&.Mui-focused .MuiOutlinedInput-notchedOutline': {\r\n                          borderColor: 'primary.main',\r\n                        },\r\n                      }}\r\n                    >\r\n                      {availableSheets.map(sheet => (\r\n                        <MenuItem key={sheet.id} value={sheet.name}>\r\n                          {sheet.name}\r\n                        </MenuItem>\r\n                      ))}\r\n                    </Select>\r\n                  </FormControl>\r\n                )}\r\n                \r\n                {isLoadingSheets && (\r\n                  <CircularProgress size={20} sx={{ color: 'primary.main' }} />\r\n                )}\r\n              </Box>\r\n              {!accessToken ? (\r\n                <Button\r\n                  variant=\"contained\"\r\n                  href=\"http://localhost:3001\"\r\n                  sx={{\r\n                    background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\r\n                    color: 'white',\r\n                    borderRadius: '12px',\r\n                    px: 3,\r\n                    py: 1, \r\n                    fontWeight: 600,\r\n                  }}\r\n                >\r\n                  התחבר עם Google\r\n                </Button>\r\n              ) : (\r\n                <Button\r\n                  variant=\"outlined\"\r\n                  onClick={handleConnectToDrive}\r\n                  disabled={!isPickerReady}\r\n                  sx={{\r\n                    borderColor: '#8B5CF6',\r\n                    color: '#A78BFA',\r\n                    borderRadius: '12px',\r\n                    px: 3,\r\n                  }}\r\n                >\r\n                  {!isPickerReady ? 'טוען API...' : 'בחר גיליון מ-Drive'}\r\n                </Button>\r\n              )}\r\n              {changesCount > 0 && (\r\n                <Chip \r\n                  label={`${changesCount} שינויים לא שמורים`} \r\n                  size=\"small\" \r\n                  color=\"warning\" \r\n                  sx={{ fontSize: '0.7rem', fontWeight: 500 }}\r\n                />\r\n                )}\r\n                <Button \r\n                  variant=\"contained\"\r\n                  startIcon={<Save />}\r\n                  onClick={saveAllChanges}\r\n                  color=\"primary\"\r\n                  size=\"small\"\r\n                >\r\n                  שמור הכל\r\n                </Button>\r\n              {isSheetLoaded && (\r\n                  <Button \r\n                    variant=\"outlined\"\r\n                    onClick={simulateAIChanges}\r\n                    color=\"secondary\"\r\n                    size=\"small\"\r\n                  >\r\n                    בדוק API\r\n                  </Button>\r\n                )}\r\n            </Box>\r\n            \r\n            {/* Google Sheets Container */}\r\n            <Paper sx={{ \r\n              flexGrow: 1, \r\n              p: 2,\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n              overflow: 'hidden',\r\n              background: 'rgba(15, 15, 15, 0.98)',\r\n              border: '1px solid rgba(139, 92, 246, 0.25)'\r\n            }}>\r\n              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n                <Typography variant=\"subtitle1\" fontWeight={600}>\r\n                  גיליון עבודה\r\n                </Typography>\r\n                {!isSheetLoaded && (\r\n                  <TextField\r\n                    placeholder=\"הכנס קישור לגוגל שיטס...\"\r\n                    size=\"small\"\r\n                    sx={{ minWidth: 300 }}\r\n                    onKeyPress={async (e) => {\r\n                      if (e.key === 'Enter' && e.target.value) {\r\n                        await handleGoogleSheetsUrl(e.target.value);\r\n                        e.target.value = '';\r\n                      }\r\n                    }}\r\n                  />\r\n                )}\r\n              </Box>\r\n              \r\n              {/* Google Sheets Embed */}\r\n              <Box sx={{ \r\n                flexGrow: 1,\r\n                border: '1px solid rgba(139, 92, 246, 0.4)',\r\n                borderRadius: 1,\r\n                bgcolor: 'rgba(5, 5, 5, 0.8)',\r\n                position: 'relative',\r\n                overflow: 'hidden'\r\n              }}>\r\n                {isSheetLoaded ? (\r\n                  <iframe\r\n                    src={googleSheetsUrl}\r\n                    width=\"100%\"\r\n                    height=\"100%\"\r\n                    style={{\r\n                      border: 'none',\r\n                      borderRadius: '4px'\r\n                    }}\r\n                    title=\"Google Sheets\"\r\n                  />\r\n                ) : (\r\n                  <Box sx={{\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    height: '100%',\r\n                    color: 'text.secondary'\r\n                  }}>\r\n                    <TableChart sx={{ fontSize: 60, mb: 2, opacity: 0.5 }} />\r\n                    <Typography variant=\"h6\" gutterBottom>\r\n                      טען גיליון גוגל שיטס\r\n                    </Typography>\r\n                    <Typography variant=\"body2\" textAlign=\"center\" sx={{ maxWidth: 400 }}>\r\n                      הכנס קישור לגוגל שיטס בשדה למעלה כדי להתחיל לעבוד עם הנתונים שלך\r\n                    </Typography>\r\n                  </Box>\r\n                )}\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n\r\n          {/* Chat Interface */}\r\n          <Box sx={{ \r\n            width: isMobile ? '100%' : '35%',\r\n            flex: isMobile ? '1 1 40%' : '0 0 35%',\r\n            p: 2,\r\n            height: isMobile ? '40%' : '100%',\r\n            display: 'flex',\r\n            flexDirection: 'column'\r\n          }}>\r\n            <Paper sx={{ \r\n              flexGrow: 1, \r\n              display: 'flex', \r\n              flexDirection: 'column',\r\n              overflow: 'hidden',\r\n              background: 'rgba(25, 25, 25, 0.98)',\r\n              border: '1px solid rgba(139, 92, 246, 0.25)'\r\n            }}>\r\n              {/* Chat Header */}\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Typography variant=\"h6\" fontWeight={600}>עוזר AI</Typography>\r\n                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                  מוכן לעזור עם הניתוח שלך\r\n                </Typography>\r\n              </Box>\r\n\r\n              {/* File Upload Area */}\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                  <Box sx={{ display: 'flex', gap: 1 }}>\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      component=\"label\"\r\n                      startIcon={<Description />}\r\n                      size=\"small\"\r\n                      disabled={isUploadingPdf}\r\n                      sx={{ \r\n                        flex: 1,\r\n                        background: 'transparent',\r\n                        color: 'text.primary',\r\n                        borderColor: 'rgba(139, 92, 246, 0.5)',\r\n                        '&:hover': {\r\n                          background: 'rgba(139, 92, 246, 0.1)',\r\n                          borderColor: 'rgba(139, 92, 246, 0.7)',\r\n                          color: 'text.primary'\r\n                        },\r\n                        '&.Mui-disabled': {\r\n                          borderColor: 'rgba(139, 92, 246, 0.3)',\r\n                          color: 'text.secondary'\r\n                        }\r\n                      }}\r\n                    >\r\n                      {isUploadingPdf ? 'מעלה...' : 'PDF'}\r\n                      <input type=\"file\" hidden accept=\".pdf\" onChange={(e) => handleFileUpload(e, 'PDF')} disabled={isUploadingPdf} />\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      component=\"label\"\r\n                      startIcon={<TableChart />}\r\n                      size=\"small\"\r\n                      sx={{ \r\n                        flex: 1,\r\n                        background: 'transparent',\r\n                        color: 'text.primary',\r\n                        borderColor: 'rgba(139, 92, 246, 0.5)',\r\n                        '&:hover': {\r\n                          background: 'rgba(139, 92, 246, 0.1)',\r\n                          borderColor: 'rgba(139, 92, 246, 0.7)',\r\n                          color: 'text.primary'\r\n                        }\r\n                      }}\r\n                    >\r\n                      Excel\r\n                      <input type=\"file\" hidden accept=\".xlsx,.xls,.csv\" onChange={(e) => handleFileUpload(e, 'Excel')} />\r\n                    </Button>\r\n                  </Box>\r\n                  \r\n                  <Box sx={{ display: 'flex', gap: 1 }}>\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      startIcon={<CloudSync />}\r\n                      size=\"small\"\r\n                      onClick={() => {\r\n                        const currentUrl = window.location.href;\r\n                        const newUrl = `${currentUrl}?token=${accessToken}`;\r\n                        window.history.pushState({}, document.title, newUrl);\r\n                      }}\r\n                      sx={{ \r\n                        flex: 1,\r\n                        background: 'transparent',\r\n                        color: 'text.primary',\r\n                        borderColor: 'rgba(139, 92, 246, 0.5)',\r\n                        '&:hover': {\r\n                          background: 'rgba(139, 92, 246, 0.1)',\r\n                          borderColor: 'rgba(139, 92, 246, 0.7)',\r\n                          color: 'text.primary'\r\n                        }\r\n                      }}\r\n                    >\r\n                      Google Sheets\r\n                    </Button>\r\n                  </Box>\r\n                  \r\n                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <TextField\r\n                      fullWidth\r\n                      placeholder=\"או הכנס קישור לגוגל שיטס...\"\r\n                      size=\"small\"\r\n                      variant=\"outlined\"\r\n                      onKeyPress={async (e) => {\r\n                        if (e.key === 'Enter' && e.target.value) {\r\n                          await handleGoogleSheetsUrl(e.target.value);\r\n                          e.target.value = '';\r\n                        }\r\n                      }}\r\n                      sx={{\r\n                        '& .MuiOutlinedInput-root': {\r\n                          borderRadius: 2,\r\n                        }\r\n                      }}\r\n                    />\r\n                  </Box>\r\n                  \r\n                  {/* Display loaded PDF info */}\r\n                  {uploadedPdfFile && (\r\n                    <Box sx={{ \r\n                      display: 'flex', \r\n                      alignItems: 'center', \r\n                      gap: 1, \r\n                      mt: 1,\r\n                      p: 1,\r\n                      bgcolor: 'rgba(139, 92, 246, 0.1)',\r\n                      borderRadius: 2,\r\n                      border: '1px solid rgba(139, 92, 246, 0.3)'\r\n                    }}>\r\n                      <Description sx={{ color: 'primary.main', fontSize: 20 }} />\r\n                      <Typography variant=\"body2\" sx={{ flex: 1, color: 'text.primary' }}>\r\n                        {uploadedPdfFile.displayName}\r\n                      </Typography>\r\n                      <Button\r\n                        size=\"small\"\r\n                        onClick={() => {\r\n                          setUploadedPdfFile(null);\r\n                          setMessages(prev => [...prev, {\r\n                            text: '📄 קובץ PDF הוסר',\r\n                            sender: 'system',\r\n                            timestamp: new Date()\r\n                          }]);\r\n                        }}\r\n                        sx={{ \r\n                          color: 'error.main',\r\n                          minWidth: 'auto',\r\n                          p: 0.5\r\n                        }}\r\n                      >\r\n                        ✕\r\n                      </Button>\r\n                    </Box>\r\n                  )}\r\n                </Box>\r\n              </Box>\r\n\r\n              {/* Messages */}\r\n              <Box sx={{ flexGrow: 1, overflow: 'auto', p: 2 }}>\r\n                {messages.map((msg, index) => (\r\n                  <Box key={index} sx={{ mb: 2 }} className=\"chat-message\">\r\n                    <Box sx={{ \r\n                      display: 'flex', \r\n                      justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start',\r\n                      mb: 1\r\n                    }}>\r\n                      <Paper sx={{ \r\n                        p: 1.5, \r\n                        maxWidth: '85%',\r\n                        background: msg.sender === 'user' \r\n                          ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)'\r\n                          : 'rgba(35, 35, 35, 0.9)',\r\n                        color: 'white',\r\n                        borderRadius: 3\r\n                      }}>\r\n                        {msg.isLoading ? (\r\n                          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                            <CircularProgress size={16} sx={{ color: 'white' }} />\r\n                            <Typography variant=\"body2\">מעבד את השאלה...</Typography>\r\n                          </Box>\r\n                        ) : (\r\n                        <Typography variant=\"body2\">{msg.text}</Typography>\r\n                        )}\r\n                      </Paper>\r\n                    </Box>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ \r\n                      display: 'block', \r\n                      textAlign: msg.sender === 'user' ? 'right' : 'left',\r\n                      px: 1\r\n                    }}>\r\n                      {msg.timestamp.toLocaleTimeString('he-IL')}\r\n                    </Typography>\r\n                  </Box>\r\n                ))}\r\n              </Box>\r\n\r\n              {/* Message Input */}\r\n              <Box sx={{ p: 2, borderTop: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Box sx={{ display: 'flex', gap: 1 }}>\r\n                  <TextField\r\n                    fullWidth\r\n                    variant=\"outlined\"\r\n                    placeholder=\"שאל אותי כל דבר על הנתונים הפיננסיים...\"\r\n                    value={question}\r\n                    onChange={(e) => setQuestion(e.target.value)}\r\n                    onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\r\n                    size=\"small\"\r\n                    sx={{\r\n                      '& .MuiOutlinedInput-root': {\r\n                        borderRadius: 3,\r\n                      }\r\n                    }}\r\n                  />\r\n                  <Fab \r\n                    color=\"primary\"\r\n                    onClick={sendMessage}\r\n                    size=\"small\"\r\n                    sx={{\r\n                      background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\r\n                      '&:hover': {\r\n                        background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)',\r\n                      }\r\n                    }}\r\n                  >\r\n                    <Send />\r\n                  </Fab>\r\n                </Box>\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n        </Box>\r\n\r\n        {/* Snackbar for notifications */}\r\n        <Snackbar\r\n          open={showSnackbar}\r\n          autoHideDuration={6000}\r\n          onClose={() => setShowSnackbar(false)}\r\n          anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\r\n          sx={{ bottom: { xs: 90, sm: 24 } }}\r\n        >\r\n          <Alert onClose={() => setShowSnackbar(false)} severity={authError ? \"error\" : \"success\"} sx={{ width: '100%', bgcolor: '#2E2E2E', color: 'white' }}>\r\n            {snackbarMessage || authError}\r\n          </Alert>\r\n        </Snackbar>\r\n      </Box>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}