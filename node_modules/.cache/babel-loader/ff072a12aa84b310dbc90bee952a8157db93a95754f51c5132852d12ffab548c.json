{"ast":null,"code":"var _jsxFileName = \"/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Box, Drawer, Typography, Paper, TextField, Button, Avatar, Divider, Chip, Fab, useMediaQuery, useTheme, CircularProgress, Alert, Snackbar, CssBaseline, FormControl, InputLabel, Select, MenuItem, Switch, FormControlLabel } from '@mui/material';\nimport { Send, Person, Description, TableChart, Save } from '@mui/icons-material';\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\nimport ChatHistory from './components/ChatHistory';\nimport './App.css';\n\n// API URL configuration\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\nconst theme = createTheme({\n  palette: {\n    mode: 'dark',\n    primary: {\n      main: '#8B5CF6'\n    },\n    secondary: {\n      main: '#6366F1'\n    },\n    background: {\n      default: '#000000',\n      paper: '#0A0A0A'\n    },\n    text: {\n      primary: '#FFFFFF',\n      secondary: '#E5E7EB'\n    },\n    success: {\n      main: '#10B981'\n    },\n    error: {\n      main: '#EF4444'\n    }\n  },\n  typography: {\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\n    h4: {\n      fontWeight: 700\n    },\n    h6: {\n      fontWeight: 600\n    }\n  },\n  components: {\n    MuiButton: {\n      styleOverrides: {\n        root: {\n          borderRadius: 12,\n          textTransform: 'none',\n          fontWeight: 600,\n          padding: '10px 20px'\n        },\n        contained: {\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n          '&:hover': {\n            transform: 'translateY(-1px)',\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)'\n          }\n        }\n      }\n    },\n    MuiPaper: {\n      styleOverrides: {\n        root: {\n          background: 'rgba(20, 20, 20, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(139, 92, 246, 0.3)',\n          borderRadius: 16\n        }\n      }\n    }\n  }\n});\nconst drawerWidth = 280;\nfunction App() {\n  _s();\n  const muiTheme = useTheme();\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\n  const [messages, setMessages] = useState([{\n    text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n    sender: 'assistant',\n    timestamp: new Date(),\n    id: Date.now()\n  }]);\n  const [question, setQuestion] = useState('');\n  const [fileName, setFileName] = useState('');\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\n  const [changesCount, setChangesCount] = useState(0);\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\n  const [isPickerReady, setIsPickerReady] = useState(false);\n  const [accessToken, setAccessToken] = useState('');\n  const [sheetsMetadata, setSheetsMetadata] = useState('');\n  const [authError, setAuthError] = useState('');\n  const [showSnackbar, setShowSnackbar] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState('');\n  const [availableSheets, setAvailableSheets] = useState([]);\n  const [selectedSheetName, setSelectedSheetName] = useState('');\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\n  const [extractedPdf, setExtractedPdf] = useState(null);\n  const [isExtractingData, setIsExtractingData] = useState(false);\n  const [extractedExcel, setExtractedExcel] = useState(null);\n  const [isExtractingExcel, setIsExtractingExcel] = useState(false);\n  const [isAgentMode, setIsAgentMode] = useState(false);\n  const [isStreamingResponse, setIsStreamingResponse] = useState(false);\n  const [isSheetSelected, setIsSheetSelected] = useState(false);\n  const [isIframeHovered, setIsIframeHovered] = useState(false);\n\n  // 🔄 Undo/Redo State\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n  const [hasGreenCells, setHasGreenCells] = useState(false);\n  const [isCheckingGreenCells, setIsCheckingGreenCells] = useState(false);\n\n  // Chat History Management\n  const [currentSessionId, setCurrentSessionId] = useState(null);\n  const [user, setUser] = useState(null);\n  const chatEndRef = useRef(null);\n  const iframeContainerRef = useRef(null);\n  useEffect(() => {\n    // Load saved access token ONLY - no chat messages from localStorage\n    const savedToken = localStorage.getItem('accessToken');\n    if (savedToken) {\n      setAccessToken(savedToken);\n    }\n\n    // Only load PDF/Excel data from localStorage (temporary files, not chat history)\n    const savedPdfJson = localStorage.getItem('extractedPdf');\n    if (savedPdfJson) {\n      try {\n        const savedPdf = JSON.parse(savedPdfJson);\n        if (savedPdf && savedPdf.name && savedPdf.data) {\n          setExtractedPdf(savedPdf);\n          setMessages(prev => [...prev, {\n            text: `📄 נתונים קודמים שחולצו מ-PDF \"${savedPdf.name}\" נטענו.`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }\n      } catch (e) {\n        console.error('Failed to parse extracted PDF data from localStorage', e);\n        localStorage.removeItem('extractedPdf');\n      }\n    }\n    const savedExcelJson = localStorage.getItem('extractedExcel');\n    if (savedExcelJson) {\n      try {\n        const savedExcel = JSON.parse(savedExcelJson);\n        if (savedExcel && savedExcel.name && savedExcel.data) {\n          setExtractedExcel(savedExcel);\n          setMessages(prev => [...prev, {\n            text: `📊 נתונים קודמים שחולצו מ-Excel \"${savedExcel.name}\" נטענו.`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }\n      } catch (e) {\n        console.error('Failed to parse extracted Excel data from localStorage', e);\n        localStorage.removeItem('extractedExcel');\n      }\n    }\n  }, []);\n\n  // Fetch user info when access token is available\n  useEffect(() => {\n    if (accessToken) {\n      fetchUserInfo();\n    }\n  }, [accessToken]);\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const token = params.get('token');\n    if (token) {\n      setAccessToken(token);\n      localStorage.setItem('accessToken', token);\n      setSnackbarMessage('התחברת בהצלחה!');\n      setShowSnackbar(true);\n      window.history.replaceState({}, document.title, \"/\");\n    } else {\n      // Check if user is already authenticated\n      checkAuthStatus();\n    }\n  }, []);\n  const checkAuthStatus = async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/user`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n        if (data.accessToken) {\n          setAccessToken(data.accessToken);\n          localStorage.setItem('accessToken', data.accessToken);\n        }\n        setSnackbarMessage('ברוך הבא בחזרה!');\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.log('Not authenticated:', error);\n      // User is not authenticated, show login button\n    }\n  };\n  useEffect(() => {\n    var _chatEndRef$current;\n    (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = 'https://apis.google.com/js/api.js';\n    script.onload = () => window.gapi.load('picker', {\n      'callback': () => setIsPickerReady(true)\n    });\n    document.head.appendChild(script);\n  }, []);\n\n  // ניהול גלילה עבור iframe - הגנה מיוחדת על Mac gestures\n  useEffect(() => {\n    const handleWheel = e => {\n      if (isIframeHovered) {\n        // הגנה ספציפית על horizontal scrolling במאק\n        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\n          // זה גלילה אופקית - בלוק את הnavigation gesture\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      }\n    };\n    const handleTouchStart = e => {\n      if (isIframeHovered) {\n        e.stopPropagation();\n      }\n    };\n    const handleTouchMove = e => {\n      if (isIframeHovered) {\n        e.stopPropagation();\n      }\n    };\n\n    // הוסף event listeners עם focus על gestures\n    document.addEventListener('wheel', handleWheel, {\n      passive: false\n    });\n    document.addEventListener('touchstart', handleTouchStart, {\n      passive: false\n    });\n    document.addEventListener('touchmove', handleTouchMove, {\n      passive: false\n    });\n    return () => {\n      document.removeEventListener('wheel', handleWheel);\n      document.removeEventListener('touchstart', handleTouchStart);\n      document.removeEventListener('touchmove', handleTouchMove);\n    };\n  }, [isIframeHovered]);\n\n  // בדיקת סטטוס אוטומטית כשגליון נבחר\n  useEffect(() => {\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\n      // Auto-check status when sheet is selected\n      // בדיקה אוטומטית אחרי טעינת הגליון\n      const timer = setTimeout(() => {\n        checkUndoRedoStatus();\n        checkForGreenCells();\n      }, 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [selectedSheetName, isSheetSelected, currentSessionId]);\n\n  // בדיקה אוטומטית כל 5 שניות כשיש session פעיל\n  useEffect(() => {\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\n      console.log('🔄 Starting automatic pending changes check every 5 seconds...');\n      const interval = setInterval(() => {\n        console.log('⏰ Automatic check for pending changes...');\n        checkForGreenCells();\n      }, 5000); // כל 5 שניות\n\n      return () => {\n        console.log('🛑 Stopping automatic pending changes check');\n        clearInterval(interval);\n      };\n    }\n  }, [isSheetSelected, selectedSheetName, currentSessionId]);\n  const fetchUserInfo = async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/user`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n      }\n    } catch (error) {\n      console.error('Error fetching user info:', error);\n    }\n  };\n  const handleSessionSelect = async sessionId => {\n    if (!sessionId) {\n      setCurrentSessionId(null);\n      setMessages([{\n        text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return;\n    }\n    setCurrentSessionId(sessionId);\n    try {\n      const response = await fetch(`${API_URL}/api/chat/session/${sessionId}`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const chatHistory = await response.json();\n        const loadedMessages = chatHistory.messages.map(msg => ({\n          text: msg.content,\n          sender: msg.role === 'user' ? 'user' : 'assistant',\n          timestamp: new Date(msg.timestamp),\n          id: msg._id || Date.now() + Math.random()\n        }));\n        setMessages(loadedMessages);\n\n        // בדיקה אוטומטית לשינויים ממתינים אחרי בחירת session\n        if (isSheetSelected && selectedSheetName) {\n          setTimeout(() => {\n            console.log('🔄 Auto-checking for pending changes after session selection...');\n            checkForGreenCells();\n          }, 500);\n        }\n      }\n    } catch (error) {\n      console.error('Error loading chat session:', error);\n      setSnackbarMessage('שגיאה בטעינת השיחה');\n      setShowSnackbar(true);\n    }\n  };\n  const generateSessionId = () => {\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n  };\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET') => {\n    if (!accessToken) throw new Error('No access token available. Please log in.');\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n    try {\n      var _data$error;\n      let url, options;\n      if (method === 'GET') {\n        url = `${baseUrl}/values/${range}`;\n        options = {\n          method,\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          }\n        };\n      } else {\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\n        options = {\n          method,\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            values\n          })\n        };\n      }\n      const response = await fetch(url, options);\n      const data = await response.json();\n      if (!response.ok) throw new Error(((_data$error = data.error) === null || _data$error === void 0 ? void 0 : _data$error.message) || 'API call failed');\n      return data;\n    } catch (error) {\n      console.error('Google Sheets API error:', error);\n      throw error;\n    }\n  };\n  const extractSpreadsheetId = url => {\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\n    return match ? match[1] : null;\n  };\n\n  // פונקציה ליצור URL עם הגליון הנכון\n  const getSheetUrlWithGid = (baseUrl, sheetName) => {\n    if (!sheetName || !sheetsMetadata) return baseUrl;\n    const selectedSheet = sheetsMetadata.find(sheet => sheet.name === sheetName);\n    if (!selectedSheet) return baseUrl;\n\n    // הסר כל gid קיים מה-URL\n    const cleanUrl = baseUrl.split('#')[0];\n\n    // הוסף את ה-gid החדש\n    return `${cleanUrl}#gid=${selectedSheet.id}`;\n  };\n  const getSpreadsheetMetadata = async spreadsheetId => {\n    if (!accessToken) return [];\n    try {\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n      const response = await fetch(url, {\n        headers: {\n          'Authorization': `Bearer ${accessToken}`\n        }\n      });\n      if (!response.ok) throw new Error('Failed to fetch spreadsheet metadata');\n      const metadata = await response.json();\n      return metadata.sheets.map(sheet => ({\n        name: sheet.properties.title,\n        id: sheet.properties.sheetId\n      }));\n    } catch (error) {\n      console.error('Error fetching spreadsheet metadata:', error);\n      return [];\n    }\n  };\n  const handleFileUpload = async (event, fileType) => {\n    const file = event.target.files[0];\n    if (!file) return;\n    if (file.type === 'application/pdf') {\n      // Clean all previous PDF-related state\n      setExtractedPdf(null);\n      localStorage.removeItem('extractedPdf');\n      setIsExtractingData(true);\n\n      // Remove any previous PDF-related messages\n      setMessages(prev => prev.filter(msg => !msg.text.includes('נתונים חולצו') && !msg.text.includes('שגיאה בחילוץ') && !msg.text.includes('נתוני ה-PDF נוקו')));\n      setMessages(prev => [...prev, {\n        text: `⏳ מחלץ נתונים מקובץ \"${file.name}\"...`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      const formData = new FormData();\n      formData.append('pdf', file);\n      fetch(`${API_URL}/api/extract-pdf-data`, {\n        method: 'POST',\n        body: formData\n      }).then(response => {\n        if (!response.ok) {\n          return response.json().then(err => {\n            throw new Error(err.error || 'Failed to extract data');\n          });\n        }\n        return response.json();\n      }).then(result => {\n        const pdfInfo = {\n          name: file.name,\n          data: result\n        };\n        setExtractedPdf(pdfInfo);\n        localStorage.setItem('extractedPdf', JSON.stringify(pdfInfo));\n        setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\n        setMessages(prev => [...prev, {\n          text: `✅ נתונים חולצו בהצלחה מ-\"${file.name}\". כעת ניתן לשאול שאלות על הקובץ.`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).catch(error => {\n        console.error('PDF data extraction failed:', error);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\n        setMessages(prev => [...prev, {\n          text: `❌ שגיאה בחילוץ נתונים מ-\"${file.name}\": ${error.message}`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).finally(() => {\n        setIsExtractingData(false);\n      });\n    } else if (fileType === 'Excel') {\n      setExtractedExcel(null);\n      localStorage.removeItem('extractedExcel');\n      setIsExtractingExcel(true);\n      setMessages(prev => prev.filter(msg => !msg.text.includes('חולצו מ-Excel') && !msg.text.includes('שגיאה בחילוץ Excel') && !msg.text.includes('נתוני ה-Excel נוקו')));\n      setMessages(prev => [...prev, {\n        text: `⏳ מחלץ נתונים מקובץ Excel \"${file.name}\"...`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      const formData = new FormData();\n      formData.append('excel', file);\n      fetch(`${API_URL}/api/extract-excel-data`, {\n        method: 'POST',\n        body: formData\n      }).then(response => {\n        if (!response.ok) {\n          return response.json().then(err => {\n            throw new Error(err.error || 'Failed to extract Excel data');\n          });\n        }\n        return response.json();\n      }).then(result => {\n        const excelInfo = {\n          name: file.name,\n          data: result.data\n        };\n        setExtractedExcel(excelInfo);\n        localStorage.setItem('extractedExcel', JSON.stringify(excelInfo));\n        setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\n        setMessages(prev => [...prev, {\n          text: `✅ נתונים חולצו בהצלחה מ-Excel \"${file.name}\".`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).catch(error => {\n        console.error('Excel data extraction failed:', error);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\n        setMessages(prev => [...prev, {\n          text: `❌ שגיאה בחילוץ נתוני Excel: ${error.message}`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).finally(() => {\n        setIsExtractingExcel(false);\n      });\n    }\n  };\n  const loadAvailableSheets = async spreadsheetId => {\n    setIsLoadingSheets(true);\n    setIsSheetSelected(false); // Reset selection\n    setSelectedSheetName(''); // Clear any previous selection\n    try {\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\n      setAvailableSheets(sheets);\n      setSheetsMetadata(sheets);\n      // רק הודעה שהגליונות נטענו - בלי לבחור גליון אוטומטית\n      if (sheets.length > 0) {\n        setMessages(prev => [...prev, {\n          text: `📋 נמצאו ${sheets.length} גליונות - בחר גליון כדי להתחיל`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }\n    } finally {\n      setIsLoadingSheets(false);\n    }\n  };\n  const handleGoogleSheetsUrl = async url => {\n    setGoogleSheetsUrl(url);\n    setIsSheetLoaded(true);\n    setIsSheetSelected(false); // Reset sheet selection for new spreadsheet\n    setIsAgentMode(false); // Reset agent mode for new spreadsheet\n    const spreadsheetId = extractSpreadsheetId(url);\n    if (spreadsheetId && accessToken) await loadAvailableSheets(spreadsheetId);\n  };\n  const handleSheetChange = async newSheetName => {\n    if (newSheetName === selectedSheetName) return;\n    setSelectedSheetName(newSheetName);\n    setIsSheetSelected(true); // מסמן שנבחר גליון\n\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n    if (spreadsheetId) {\n      await getSheetData(spreadsheetId, newSheetName);\n      setMessages(prev => [...prev, {\n        text: `✅ מחובר לגליון: ${newSheetName}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n\n      // בדיקה אוטומטית לשינויים ממתינים אחרי בחירת גליון\n      setTimeout(() => {\n        console.log('🔄 Auto-checking for pending changes after sheet selection...');\n        checkForGreenCells();\n      }, 1000);\n    }\n  };\n  const pickerCallback = data => {\n    if (data.action === window.google.picker.Action.PICKED) {\n      const doc = data.docs[0];\n      setFileName(doc.name);\n      handleGoogleSheetsUrl(doc.url);\n      setSnackbarMessage(`טען גיליון: ${doc.name}`);\n      setShowSnackbar(true);\n    }\n  };\n  const createPicker = () => {\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY;\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\n    if (!clientId || !developerKey) {\n      setAuthError('מפתחות API אינם מוגדרים כראוי.');\n      setShowSnackbar(true);\n      return;\n    }\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\n    const picker = new window.google.picker.PickerBuilder().setAppId(clientId.split('-')[0]).setOAuthToken(accessToken).setDeveloperKey(developerKey).addView(view).setCallback(pickerCallback).build();\n    picker.setVisible(true);\n  };\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\n    if (!accessToken) return null;\n    try {\n      const range = sheetName ? `'${sheetName}'!A1:Z1000` : 'A1:Z1000';\n      const apiResponse = await makeGoogleSheetsAPICall(spreadsheetId, range);\n      // The processSheetData function is removed as we will send raw data to backend\n      return apiResponse.values || [];\n    } catch (error) {\n      console.error('Failed to fetch sheet data:', error);\n      setMessages(prev => [...prev, {\n        text: `❌ שגיאה בטעינת גיליון: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return null;\n    }\n  };\n  const startNewChat = () => {\n    setCurrentSessionId(null);\n    setMessages([{\n      text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n      sender: 'assistant',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n    // אפס מצב Agent Mode אם אין גליון נבחר\n    if (!isSheetSelected) {\n      setIsAgentMode(false);\n    }\n    // אפס מצב Undo/Redo\n    setCanUndo(false);\n    setCanRedo(false);\n    setHasGreenCells(false);\n    setChangesCount(0);\n  };\n  const handleLogout = async () => {\n    try {\n      // Call logout endpoint\n      await fetch(`${API_URL}/auth/logout`, {\n        credentials: 'include'\n      });\n\n      // Clear local state\n      setAccessToken('');\n      setUser(null);\n      setCurrentSessionId(null);\n      setIsSheetSelected(false);\n      setIsAgentMode(false);\n      setCanUndo(false);\n      setCanRedo(false);\n      setHasGreenCells(false);\n      setChangesCount(0);\n      localStorage.removeItem('accessToken');\n\n      // Reset messages\n      setMessages([{\n        text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      setSnackbarMessage('התנתקת בהצלחה!');\n      setShowSnackbar(true);\n    } catch (error) {\n      console.error('Error during logout:', error);\n    }\n  };\n\n  // 🔄 Undo/Redo Functions\n  const checkUndoRedoStatus = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\n        method: 'GET',\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n      }\n    } catch (error) {\n      console.error('Error checking undo/redo status:', error);\n    }\n  };\n\n  // 📊 NEW: Check for pending changes instead of green cells\n  const checkForGreenCells = async () => {\n    if (!googleSheetsUrl || !selectedSheetName || isCheckingGreenCells) return;\n\n    // 🔍 Critical check: Make sure we have a session ID\n    if (!currentSessionId) {\n      setHasGreenCells(false);\n      setChangesCount(0);\n      return;\n    }\n    setIsCheckingGreenCells(true);\n    try {\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\n        method: 'GET',\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const result = await response.json();\n        const pendingChanges = result.changesCount || 0;\n        setHasGreenCells(pendingChanges > 0);\n        setChangesCount(pendingChanges);\n        if (pendingChanges > 0) {\n          console.log(`🎉 Found ${pendingChanges} pending changes! Buttons should now be visible.`);\n        }\n      } else {\n        console.error(`❌ Pending changes check failed: ${response.status}`);\n        setHasGreenCells(false);\n        setChangesCount(0);\n      }\n    } catch (error) {\n      console.error('❌ Error checking for pending changes:', error);\n      setHasGreenCells(false);\n      setChangesCount(0);\n    } finally {\n      setIsCheckingGreenCells(false);\n    }\n  };\n\n  // ✅ Simple Approve All - Remove Green Background\n  const approveAllChanges = async () => {\n    if (!googleSheetsUrl || !selectedSheetName) {\n      setSnackbarMessage('❌ חסרים פרטי הגליון');\n      setShowSnackbar(true);\n      return;\n    }\n    try {\n      var _availableSheets$find;\n      const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n      if (!spreadsheetId) {\n        setSnackbarMessage('❌ לא ניתן לחלץ מזהה גיליון');\n        setShowSnackbar(true);\n        return;\n      }\n      const sheetId = (_availableSheets$find = availableSheets.find(s => s.name === selectedSheetName)) === null || _availableSheets$find === void 0 ? void 0 : _availableSheets$find.id;\n      const response = await fetch(`${API_URL}/api/action/approve-all`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          spreadsheetId: spreadsheetId,\n          selectedSheetName: selectedSheetName,\n          sheetId: sheetId,\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const result = await response.json();\n        setSnackbarMessage(result.message || '✅ כל השינויים אושרו');\n        setShowSnackbar(true);\n\n        // Update state immediately\n        setHasGreenCells(false);\n        setChangesCount(0);\n\n        // Refresh the sheet\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 500);\n\n        // Double-check after a moment\n        setTimeout(() => {\n          checkForGreenCells();\n        }, 1000);\n      } else {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || `Server error: ${response.status}`);\n      }\n    } catch (error) {\n      console.error('Error approving all changes:', error);\n      setSnackbarMessage(`❌ שגיאה באישור השינויים: ${error.message}`);\n      setShowSnackbar(true);\n    }\n  };\n\n  // ❌ Simple Reject All - Restore Original Values\n  const rejectAllChanges = async () => {\n    if (!googleSheetsUrl || !selectedSheetName) {\n      setSnackbarMessage('❌ חסרים פרטי הגליון');\n      setShowSnackbar(true);\n      return;\n    }\n    try {\n      var _availableSheets$find2;\n      const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n      if (!spreadsheetId) {\n        setSnackbarMessage('❌ לא ניתן לחלץ מזהה גיליון');\n        setShowSnackbar(true);\n        return;\n      }\n      const sheetId = (_availableSheets$find2 = availableSheets.find(s => s.name === selectedSheetName)) === null || _availableSheets$find2 === void 0 ? void 0 : _availableSheets$find2.id;\n      const response = await fetch(`${API_URL}/api/action/reject-all`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          spreadsheetId: spreadsheetId,\n          selectedSheetName: selectedSheetName,\n          sheetId: sheetId,\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const result = await response.json();\n        setSnackbarMessage(result.message || '❌ כל השינויים נדחו');\n        setShowSnackbar(true);\n\n        // Update state immediately\n        setHasGreenCells(false);\n        setChangesCount(0);\n\n        // Refresh the sheet\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 500);\n\n        // Double-check after a moment\n        setTimeout(() => {\n          checkForGreenCells();\n        }, 1000);\n      } else {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || `Server error: ${response.status}`);\n      }\n    } catch (error) {\n      console.error('Error rejecting all changes:', error);\n      setSnackbarMessage(`❌ שגיאה בדחיית השינויים: ${error.message}`);\n      setShowSnackbar(true);\n    }\n  };\n  const undoAction = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/undo`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n        setSnackbarMessage('↩️ ' + data.message);\n        setShowSnackbar(true);\n\n        // עדכון כפתורי קבל/דחה\n        await checkForGreenCells();\n\n        // רענון חלק של הגליון\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 500); // השהיה קצרה לפני רענון\n        }\n      } else {\n        const error = await response.json();\n        setSnackbarMessage('❌ שגיאה בביטול: ' + error.error);\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.error('Error in undo action:', error);\n      setSnackbarMessage('❌ שגיאה בביטול הפעולה');\n      setShowSnackbar(true);\n    }\n  };\n  const redoAction = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/redo`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n        setSnackbarMessage('⤴️ ' + data.message);\n        setShowSnackbar(true);\n\n        // עדכון כפתורי קבל/דחה\n        await checkForGreenCells();\n\n        // רענון חלק של הגליון\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 500); // השהיה קצרה לפני רענון\n        }\n      } else {\n        const error = await response.json();\n        setSnackbarMessage('❌ שגיאה בשחזור: ' + error.error);\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.error('Error in redo action:', error);\n      setSnackbarMessage('❌ שגיאה בשחזור הפעולה');\n      setShowSnackbar(true);\n    }\n  };\n  const sendMessage = async () => {\n    if (!question.trim() || isStreamingResponse) return;\n\n    // 🛡️ בדיקה חדשה - אם יש גליון אבל לא נבחר גליון ספציפי\n    if (isSheetLoaded && !isSheetSelected) {\n      setMessages(prev => [...prev, {\n        text: '❌ יש לבחור גליון תחילה מהרשימה למעלה',\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return;\n    }\n    const currentQuestion = question;\n    const userMessage = {\n      text: currentQuestion,\n      sender: 'user',\n      timestamp: new Date(),\n      id: Date.now()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    setQuestion('');\n    setIsStreamingResponse(true);\n\n    // Generate session ID if this is a new conversation\n    let sessionId = currentSessionId;\n    if (!sessionId) {\n      sessionId = generateSessionId();\n      setCurrentSessionId(sessionId);\n    }\n    const loadingMessageId = Date.now() + 1;\n    setMessages(prev => [...prev, {\n      text: '',\n      sender: 'assistant',\n      isLoading: true,\n      timestamp: new Date(),\n      id: loadingMessageId\n    }]);\n\n    // User message will be saved automatically by backend in /api/chat-stream\n\n    try {\n      const sheetData = isSheetLoaded && isSheetSelected ? await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\n\n      // We need to get the spreadsheetId here to send it\n      const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\n      const payload = {\n        question: currentQuestion,\n        sheetData: sheetData,\n        extractedPdfData: extractedPdf ? extractedPdf.data : null,\n        extractedExcelData: extractedExcel ? extractedExcel.data : null,\n        isAgentMode: isAgentMode,\n        conversationHistory: messages.filter(m => !m.isLoading).map(m => ({\n          role: m.sender === 'user' ? 'user' : 'model',\n          parts: [{\n            text: m.text\n          }]\n        })),\n        spreadsheetId: spreadsheetId,\n        accessToken: accessToken,\n        sessionId: sessionId,\n        // Include session ID\n        sheetsMetadata: sheetsMetadata,\n        // ודא שהמשתנה הזה קיים ומכיל את המידע\n        selectedSheetName: selectedSheetName // ודא שהמשתנה הזה קיים ומכיל את שם הגיליון\n      };\n      const response = await fetch(`${API_URL}/api/chat-stream`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        // This is crucial for session cookies!\n        body: JSON.stringify(payload)\n      });\n      if (!response.ok || !response.body) {\n        const errorText = await response.text();\n        throw new Error(`Server error: ${response.status} ${errorText}`);\n      }\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let accumulatedResponse = '';\n      while (true) {\n        const {\n          value,\n          done\n        } = await reader.read();\n        if (done) break;\n        accumulatedResponse += decoder.decode(value, {\n          stream: true\n        });\n        const currentResponse = accumulatedResponse;\n        setMessages(prev => prev.map(m => {\n          if (m.id === loadingMessageId) {\n            // Show the accumulated response directly as text\n            return {\n              ...m,\n              text: currentResponse,\n              isLoading: true\n            };\n          }\n          return m;\n        }));\n      }\n\n      // Final response processing - just show the accumulated text\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: accumulatedResponse,\n        isLoading: false\n      } : m));\n\n      // Assistant response is automatically saved by backend in /api/chat-stream\n\n      // אם היה זה פקודת undo/redo, רענן את הגליון\n      const questionLower = currentQuestion.toLowerCase().trim();\n      const undoRedoKeywords = ['בטל', 'undo', 'שחזר', 'redo', 'בטל פעולה', 'שחזר פעולה'];\n      if (undoRedoKeywords.some(keyword => questionLower.includes(keyword))) {\n        // רענון חלק של הגליון\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 800); // השהיה מעט יותר ארוכה עבור פקודות צ'אט\n        }\n      }\n    } catch (error) {\n      console.error('Error in sendMessage:', error);\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: `אירעה שגיאה: ${error.message}`,\n        isLoading: false,\n        isError: true\n      } : m));\n    } finally {\n      setIsStreamingResponse(false);\n\n      // Check status after message completion - make it immediate for Agent Mode\n      if (isAgentMode) {\n        // For Agent Mode, check immediately after response and then again after a short delay\n        console.log('🤖 Agent Mode - checking for changes immediately');\n\n        // Immediate check\n        setTimeout(() => {\n          checkForGreenCells();\n        }, 100);\n\n        // Follow-up check\n        setTimeout(() => {\n          checkUndoRedoStatus();\n          checkForGreenCells();\n        }, 800);\n\n        // Final check to make sure we didn't miss anything\n        setTimeout(() => {\n          checkForGreenCells();\n        }, 1500);\n      } else {\n        // For regular mode, shorter delay\n        setTimeout(() => {\n          checkUndoRedoStatus();\n          checkForGreenCells();\n        }, 1000);\n      }\n    }\n  };\n  const saveAllChanges = () => {\n    setMessages(prev => [...prev, {\n      text: `💾 כל השינויים נשמרו לגיליון ${fileName}`,\n      sender: 'system',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n  };\n  return /*#__PURE__*/_jsxDEV(ThemeProvider, {\n    theme: theme,\n    children: [/*#__PURE__*/_jsxDEV(CssBaseline, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1079,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        display: 'flex',\n        height: '100vh',\n        bgcolor: 'background.default',\n        overflow: 'hidden'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          background: `radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%), radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%)`,\n          pointerEvents: 'none',\n          zIndex: 0\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1084,\n        columnNumber: 9\n      }, this), !isMobile && /*#__PURE__*/_jsxDEV(Drawer, {\n        variant: \"permanent\",\n        sx: {\n          width: drawerWidth,\n          flexShrink: 0,\n          zIndex: 1,\n          '& .MuiDrawer-paper': {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            bgcolor: 'rgba(10, 10, 10, 0.98)',\n            borderRight: '1px solid rgba(139, 92, 246, 0.4)',\n            backdropFilter: 'blur(20px)'\n          }\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            sx: {\n              background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n              backgroundClip: 'text',\n              WebkitBackgroundClip: 'text',\n              WebkitTextFillColor: 'transparent',\n              fontWeight: 700\n            },\n            children: \"TLV500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1088,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            color: \"text.secondary\",\n            children: \"AI Assistant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1089,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1087,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1091,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: 2,\n              mb: 2\n            },\n            children: [/*#__PURE__*/_jsxDEV(Avatar, {\n              src: user === null || user === void 0 ? void 0 : user.profilePicture,\n              sx: {\n                width: 45,\n                height: 45,\n                background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)'\n              },\n              children: user !== null && user !== void 0 && user.name ? user.name.charAt(0) : /*#__PURE__*/_jsxDEV(Person, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1098,\n                columnNumber: 55\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1094,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flex: 1\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                fontWeight: 600,\n                children: (user === null || user === void 0 ? void 0 : user.name) || 'משתמש אורח'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1101,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"caption\",\n                color: \"text.secondary\",\n                children: (user === null || user === void 0 ? void 0 : user.email) || 'לא מחובר'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1104,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1100,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1093,\n            columnNumber: 15\n          }, this), accessToken && /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: handleLogout,\n            size: \"small\",\n            fullWidth: true,\n            sx: {\n              borderColor: 'rgba(239, 68, 68, 0.5)',\n              color: 'error.main',\n              '&:hover': {\n                borderColor: 'error.main',\n                bgcolor: 'rgba(239, 68, 68, 0.1)'\n              }\n            },\n            children: \"\\u05D4\\u05EA\\u05E0\\u05EA\\u05E7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1110,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1092,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1128,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            flexGrow: 1,\n            overflow: 'hidden'\n          },\n          children: /*#__PURE__*/_jsxDEV(ChatHistory, {\n            accessToken: accessToken,\n            onSessionSelect: handleSessionSelect,\n            currentSessionId: currentSessionId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1132,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1131,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1086,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          flexGrow: 1,\n          display: 'flex',\n          flexDirection: isMobile ? 'column' : 'row',\n          zIndex: 1,\n          height: '100vh',\n          overflow: 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            flex: isMobile ? '1 1 60%' : '0 0 65%',\n            p: 2,\n            display: 'flex',\n            flexDirection: 'column',\n            height: '100%',\n            overflow: 'hidden'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              mb: 2,\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              flexWrap: 'wrap',\n              gap: 2\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: 2\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                color: \"text.primary\",\n                children: fileName || 'לא נבחר גיליון'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1144,\n                columnNumber: 17\n              }, this), availableSheets.length > 0 && /*#__PURE__*/_jsxDEV(FormControl, {\n                size: \"small\",\n                sx: {\n                  minWidth: 200,\n                  '& .MuiOutlinedInput-notchedOutline': {\n                    borderColor: !isSheetSelected ? 'rgba(239, 68, 68, 0.7)' : 'rgba(139, 92, 246, 0.5)'\n                  },\n                  '& .MuiInputLabel-root': {\n                    color: !isSheetSelected ? 'error.main' : 'text.secondary'\n                  }\n                },\n                error: !isSheetSelected,\n                children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                  children: !isSheetSelected ? '🔴 בחר גליון (חובה)' : 'גליון נוכחי'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1159,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Select, {\n                  value: selectedSheetName || '',\n                  onChange: e => handleSheetChange(e.target.value),\n                  disabled: isLoadingSheets,\n                  children: availableSheets.map(sheet => /*#__PURE__*/_jsxDEV(MenuItem, {\n                    value: sheet.name,\n                    children: sheet.name\n                  }, sheet.id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1168,\n                    columnNumber: 25\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1162,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1146,\n                columnNumber: 19\n              }, this), isLoadingSheets && /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                sx: {\n                  color: 'primary.main'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1175,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1143,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                gap: 1\n              },\n              children: [!accessToken ? /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                href: API_URL,\n                children: \"\\u05D4\\u05EA\\u05D7\\u05D1\\u05E8 \\u05E2\\u05DD Google\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1179,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                onClick: createPicker,\n                disabled: !isPickerReady,\n                children: !isPickerReady ? 'טוען API...' : 'בחר גיליון מ-Drive'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1181,\n                columnNumber: 19\n              }, this), accessToken && /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                onClick: startNewChat,\n                sx: {\n                  minWidth: 'auto'\n                },\n                children: \"+ \\u05E9\\u05D9\\u05D7\\u05D4 \\u05D7\\u05D3\\u05E9\\u05D4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1186,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1177,\n              columnNumber: 15\n            }, this), changesCount > 0 && /*#__PURE__*/_jsxDEV(Chip, {\n              label: `${changesCount} שינויים לא שמורים`,\n              size: \"small\",\n              color: \"warning\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1191,\n              columnNumber: 36\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              onClick: async () => {\n                console.log(`📊 BEFORE check: hasGreenCells=${hasGreenCells}, changesCount=${changesCount}, sessionId=${currentSessionId}`);\n                await checkForGreenCells();\n                // Force a tiny state change to trigger re-render\n                setTimeout(() => {\n                  console.log(`📊 AFTER check: hasGreenCells=${hasGreenCells}, changesCount=${changesCount}`);\n                  // Force buttons to appear if we have changes\n                  if (changesCount > 0) {\n                    console.log('🔥 Forcing re-render...');\n                    setHasGreenCells(changesCount > 0);\n                  }\n                }, 200);\n              },\n              size: \"small\",\n              sx: {\n                mr: 1\n              },\n              children: [\"\\uD83D\\uDD0D DEBUG (\", changesCount, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1194,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1215,\n                columnNumber: 54\n              }, this),\n              onClick: saveAllChanges,\n              color: \"primary\",\n              size: \"small\",\n              children: \"\\u05E9\\u05DE\\u05D5\\u05E8 \\u05D4\\u05DB\\u05DC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1215,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1142,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(15, 15, 15, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)',\n              position: 'relative'\n            },\n            children: [!isSheetLoaded && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 1,\n                textAlign: 'center',\n                mt: 2\n              },\n              children: /*#__PURE__*/_jsxDEV(TextField, {\n                placeholder: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1...\",\n                size: \"small\",\n                sx: {\n                  minWidth: 400\n                },\n                onKeyPress: async e => {\n                  if (e.key === 'Enter' && e.target.value) {\n                    await handleGoogleSheetsUrl(e.target.value);\n                    e.target.value = '';\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1224,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1223,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              ref: iframeContainerRef,\n              sx: {\n                flexGrow: 1,\n                border: '1px solid rgba(139, 92, 246, 0.4)',\n                borderRadius: 1,\n                bgcolor: 'rgba(5, 5, 5, 0.8)',\n                position: 'relative',\n                overflow: 'hidden',\n                m: 0.5,\n                // רווח מינימלי מהקצוות\n                // הגנה על Mac gestures\n                overscrollBehavior: 'contain',\n                touchAction: 'auto',\n                WebkitOverflowScrolling: 'touch'\n              },\n              onMouseEnter: () => setIsIframeHovered(true),\n              onMouseLeave: () => setIsIframeHovered(false),\n              children: [isSheetLoaded && isSheetSelected && currentSessionId && (changesCount > 0 || hasGreenCells) && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  top: '8px',\n                  right: '8px',\n                  display: 'flex',\n                  gap: '0px',\n                  zIndex: 1000,\n                  backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                  border: '1px solid rgba(255, 255, 255, 0.3)',\n                  borderRadius: '4px',\n                  padding: '2px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: approveAllChanges,\n                  style: {\n                    backgroundColor: '#4caf50',\n                    color: 'white',\n                    border: '1px solid #2e7d32',\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: 'pointer',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n                  },\n                  title: \"\\u05D0\\u05E9\\u05E8 \\u05DB\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD\",\n                  onMouseEnter: e => {\n                    e.target.style.backgroundColor = '#45a049';\n                    e.target.style.transform = 'scale(1.05)';\n                    e.target.style.boxShadow = '0 4px 8px rgba(76, 175, 80, 0.4)';\n                    e.target.style.borderColor = '#4caf50';\n                    e.target.textContent = 'קבל הכל';\n                    e.target.style.fontSize = '0.6rem';\n                  },\n                  onMouseLeave: e => {\n                    e.target.style.backgroundColor = '#4caf50';\n                    e.target.style.transform = 'scale(1)';\n                    e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                    e.target.style.borderColor = '#2e7d32';\n                    e.target.textContent = `✓ (${changesCount || 0})`;\n                    e.target.style.fontSize = '0.65rem';\n                  },\n                  children: [\"\\u2713 (\", changesCount || 0, \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1275,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: rejectAllChanges,\n                  style: {\n                    backgroundColor: '#f44336',\n                    color: 'white',\n                    border: '1px solid #c62828',\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: 'pointer',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n                  },\n                  title: \"\\u05D3\\u05D7\\u05D4 \\u05DB\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD\",\n                  onMouseEnter: e => {\n                    e.target.style.backgroundColor = '#d32f2f';\n                    e.target.style.transform = 'scale(1.05)';\n                    e.target.style.boxShadow = '0 4px 8px rgba(244, 67, 54, 0.4)';\n                    e.target.style.borderColor = '#f44336';\n                    e.target.textContent = 'דחה הכל';\n                    e.target.style.fontSize = '0.6rem';\n                  },\n                  onMouseLeave: e => {\n                    e.target.style.backgroundColor = '#f44336';\n                    e.target.style.transform = 'scale(1)';\n                    e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                    e.target.style.borderColor = '#c62828';\n                    e.target.textContent = `✕ (${changesCount || 0})`;\n                    e.target.style.fontSize = '0.65rem';\n                  },\n                  children: [\"\\u2715 (\", changesCount || 0, \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1316,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1262,\n                columnNumber: 19\n              }, this), isSheetLoaded && isSheetSelected && (canUndo || canRedo) && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  bottom: '8px',\n                  right: '8px',\n                  display: 'flex',\n                  gap: '0px',\n                  zIndex: 1000,\n                  backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                  border: '1px solid rgba(255, 255, 255, 0.3)',\n                  borderRadius: '4px',\n                  padding: '2px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    if (canUndo) undoAction();\n                  },\n                  style: {\n                    backgroundColor: canUndo ? '#2196f3' : '#666',\n                    color: 'white',\n                    border: `1px solid ${canUndo ? '#1976d2' : '#555'}`,\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: canUndo ? 'pointer' : 'not-allowed',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                    opacity: canUndo ? 1 : 0.5\n                  },\n                  title: \"\\u05D1\\u05D8\\u05DC \\u05E4\\u05E2\\u05D5\\u05DC\\u05D4\",\n                  onMouseEnter: e => {\n                    if (canUndo) {\n                      e.target.style.backgroundColor = '#1976d2';\n                      e.target.style.transform = 'scale(1.05)';\n                      e.target.style.boxShadow = '0 4px 8px rgba(33, 150, 243, 0.4)';\n                      e.target.style.borderColor = '#2196f3';\n                      e.target.textContent = 'בטל';\n                      e.target.style.fontSize = '0.6rem';\n                    }\n                  },\n                  onMouseLeave: e => {\n                    if (canUndo) {\n                      e.target.style.backgroundColor = '#2196f3';\n                      e.target.style.transform = 'scale(1)';\n                      e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                      e.target.style.borderColor = '#1976d2';\n                      e.target.textContent = '↩️';\n                      e.target.style.fontSize = '0.65rem';\n                    }\n                  },\n                  children: \"\\u21A9\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1373,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    if (canRedo) redoAction();\n                  },\n                  style: {\n                    backgroundColor: canRedo ? '#ff9800' : '#666',\n                    color: 'white',\n                    border: `1px solid ${canRedo ? '#f57c00' : '#555'}`,\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: canRedo ? 'pointer' : 'not-allowed',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                    opacity: canRedo ? 1 : 0.5\n                  },\n                  title: \"\\u05E9\\u05D7\\u05D6\\u05E8 \\u05E4\\u05E2\\u05D5\\u05DC\\u05D4\",\n                  onMouseEnter: e => {\n                    if (canRedo) {\n                      e.target.style.backgroundColor = '#f57c00';\n                      e.target.style.transform = 'scale(1.05)';\n                      e.target.style.boxShadow = '0 4px 8px rgba(255, 152, 0, 0.4)';\n                      e.target.style.borderColor = '#ff9800';\n                      e.target.textContent = 'שחזר';\n                      e.target.style.fontSize = '0.6rem';\n                    }\n                  },\n                  onMouseLeave: e => {\n                    if (canRedo) {\n                      e.target.style.backgroundColor = '#ff9800';\n                      e.target.style.transform = 'scale(1)';\n                      e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                      e.target.style.borderColor = '#f57c00';\n                      e.target.textContent = '⤴️';\n                      e.target.style.fontSize = '0.65rem';\n                    }\n                  },\n                  children: \"\\u2934\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1421,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1360,\n                columnNumber: 19\n              }, this), isSheetLoaded && isSheetSelected ? /*#__PURE__*/_jsxDEV(\"iframe\", {\n                src: getSheetUrlWithGid(googleSheetsUrl, selectedSheetName),\n                width: \"100%\",\n                height: \"100%\",\n                style: {\n                  border: 'none',\n                  borderRadius: '4px'\n                },\n                title: \"Google Sheets\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1471,\n                columnNumber: 19\n              }, this) : availableSheets.length > 0 && !isSheetSelected ? /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  height: '100%',\n                  color: 'text.secondary'\n                },\n                children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                  sx: {\n                    fontSize: 60,\n                    mb: 2,\n                    opacity: 0.5,\n                    color: 'error.main'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1474,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  gutterBottom: true,\n                  color: \"error.main\",\n                  children: \"\\u05D9\\u05E9 \\u05DC\\u05D1\\u05D7\\u05D5\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF \\u05EA\\u05D7\\u05D9\\u05DC\\u05D4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1475,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  textAlign: \"center\",\n                  sx: {\n                    maxWidth: 400\n                  },\n                  children: \"\\u05D1\\u05D7\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF \\u05DE\\u05D4\\u05E8\\u05E9\\u05D9\\u05DE\\u05D4 \\u05DC\\u05DE\\u05E2\\u05DC\\u05D4 \\u05DB\\u05D3\\u05D9 \\u05DC\\u05D4\\u05EA\\u05D7\\u05D9\\u05DC \\u05DC\\u05E2\\u05D1\\u05D5\\u05D3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1478,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1473,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  height: '100%',\n                  color: 'text.secondary'\n                },\n                children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                  sx: {\n                    fontSize: 60,\n                    mb: 2,\n                    opacity: 0.5\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1484,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  gutterBottom: true,\n                  children: \"\\u05D8\\u05E2\\u05DF \\u05D2\\u05D9\\u05DC\\u05D9\\u05D5\\u05DF \\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1485,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  textAlign: \"center\",\n                  sx: {\n                    maxWidth: 400\n                  },\n                  children: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1 \\u05D1\\u05E9\\u05D3\\u05D4 \\u05DC\\u05DE\\u05E2\\u05DC\\u05D4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1486,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1483,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1242,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1217,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1141,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            width: isMobile ? '100%' : '35%',\n            flex: isMobile ? '1 1 40%' : '0 0 35%',\n            p: 2,\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column'\n          },\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(25, 25, 25, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                children: \"\\u05E2\\u05D5\\u05D6\\u05E8 AI\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1495,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"text.secondary\",\n                children: \"\\u05DE\\u05D5\\u05DB\\u05DF \\u05DC\\u05E2\\u05D6\\u05D5\\u05E8 \\u05E2\\u05DD \\u05D4\\u05E0\\u05D9\\u05EA\\u05D5\\u05D7 \\u05E9\\u05DC\\u05DA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1496,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1494,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    gap: 1\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(Description, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1501,\n                      columnNumber: 77\n                    }, this),\n                    size: \"small\",\n                    disabled: isExtractingData,\n                    sx: {\n                      flex: 1,\n                      borderColor: 'rgba(139, 92, 246, 0.5)',\n                      '&.Mui-disabled': {\n                        color: 'text.secondary'\n                      }\n                    },\n                    children: [isExtractingData ? 'מעבד...' : 'PDF', /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".pdf\",\n                      onChange: e => handleFileUpload(e, 'PDF'),\n                      disabled: isExtractingData\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1503,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1501,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(TableChart, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1505,\n                      columnNumber: 77\n                    }, this),\n                    size: \"small\",\n                    disabled: isExtractingExcel,\n                    sx: {\n                      flex: 1,\n                      borderColor: 'rgba(139, 92, 246, 0.5)'\n                    },\n                    children: [isExtractingExcel ? 'מעבד...' : 'Excel', /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".xlsx,.xls,.csv\",\n                      onChange: e => handleFileUpload(e, 'Excel'),\n                      disabled: isExtractingExcel\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1507,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1505,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1500,\n                  columnNumber: 19\n                }, this), extractedPdf && /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    mt: 1,\n                    p: 1,\n                    bgcolor: 'rgba(139, 92, 246, 0.1)',\n                    borderRadius: 2,\n                    border: '1px solid rgba(139, 92, 246, 0.3)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Description, {\n                    sx: {\n                      color: 'primary.main',\n                      fontSize: 20\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1512,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    sx: {\n                      flex: 1,\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis'\n                    },\n                    children: extractedPdf.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1513,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    onClick: () => {\n                      setExtractedPdf(null);\n                      localStorage.removeItem('extractedPdf');\n                      setMessages(prev => [...prev, {\n                        text: '📄 נתוני ה-PDF נוקו מההקשר.',\n                        sender: 'system',\n                        timestamp: new Date(),\n                        id: Date.now()\n                      }]);\n                    },\n                    sx: {\n                      color: 'error.main',\n                      minWidth: 'auto',\n                      p: 0.5\n                    },\n                    children: \"\\u2715\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1514,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1511,\n                  columnNumber: 21\n                }, this), extractedExcel && /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    mt: 1,\n                    p: 1,\n                    bgcolor: 'rgba(16, 185, 129, 0.1)',\n                    borderRadius: 2,\n                    border: '1px solid rgba(16, 185, 129, 0.3)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                    sx: {\n                      color: 'success.main',\n                      fontSize: 20\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1519,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    sx: {\n                      flex: 1,\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis'\n                    },\n                    children: extractedExcel.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1520,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    onClick: () => {\n                      setExtractedExcel(null);\n                      localStorage.removeItem('extractedExcel');\n                      setMessages(prev => [...prev, {\n                        text: '📊 נתוני ה-Excel נוקו מההקשר.',\n                        sender: 'system',\n                        timestamp: new Date(),\n                        id: Date.now()\n                      }]);\n                    },\n                    sx: {\n                      color: 'error.main',\n                      minWidth: 'auto',\n                      p: 0.5\n                    },\n                    children: \"\\u2715\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1521,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1518,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1499,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1498,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flexGrow: 1,\n                overflow: 'auto',\n                p: 2\n              },\n              children: [messages.map((msg, index) => /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 2\n                },\n                className: \"chat-message\",\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start',\n                    mb: 1\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    sx: {\n                      p: 1.5,\n                      maxWidth: '85%',\n                      background: msg.sender === 'user' ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' : 'rgba(35, 35, 35, 0.9)',\n                      color: 'white',\n                      borderRadius: 3\n                    },\n                    children: msg.isLoading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                      size: 16,\n                      color: \"inherit\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1537,\n                      columnNumber: 42\n                    }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n                      variant: \"body2\",\n                      sx: {\n                        whiteSpace: 'pre-wrap'\n                      },\n                      children: msg.text\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1537,\n                      columnNumber: 91\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1530,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1529,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  color: \"text.secondary\",\n                  sx: {\n                    display: 'block',\n                    textAlign: msg.sender === 'user' ? 'right' : 'left',\n                    px: 1\n                  },\n                  children: msg.timestamp.toLocaleTimeString('he-IL', {\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  })\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1540,\n                  columnNumber: 21\n                }, this)]\n              }, msg.id || index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1528,\n                columnNumber: 19\n              }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n                ref: chatEndRef\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1545,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1526,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderTop: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  gap: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(TextField, {\n                  fullWidth: true,\n                  variant: \"outlined\",\n                  placeholder: \"\\u05E9\\u05D0\\u05DC \\u05D0\\u05D5\\u05EA\\u05D9 \\u05DB\\u05DC \\u05D3\\u05D1\\u05E8... (Shift+Enter \\u05DC\\u05E9\\u05D5\\u05E8\\u05D4 \\u05D7\\u05D3\\u05E9\\u05D4)\",\n                  value: question,\n                  onChange: e => setQuestion(e.target.value),\n                  onKeyPress: e => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault(); // Prevents adding a new line\n                      sendMessage();\n                    }\n                  },\n                  multiline: true,\n                  minRows: 2,\n                  maxRows: 5,\n                  sx: {\n                    direction: 'rtl',\n                    '& .MuiOutlinedInput-root': {\n                      borderRadius: 3,\n                      direction: 'rtl',\n                      '& textarea': {\n                        textAlign: 'right',\n                        direction: 'rtl'\n                      },\n                      '& input': {\n                        textAlign: 'right',\n                        direction: 'rtl'\n                      }\n                    },\n                    '& .MuiInputLabel-root': {\n                      right: 'auto',\n                      left: 0,\n                      transformOrigin: 'top right',\n                      direction: 'rtl'\n                    },\n                    '& .MuiFormLabel-root': {\n                      textAlign: 'right',\n                      direction: 'rtl'\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1552,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Fab, {\n                  color: \"primary\",\n                  onClick: sendMessage,\n                  size: \"small\",\n                  children: /*#__PURE__*/_jsxDEV(Send, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1593,\n                    columnNumber: 75\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1593,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1551,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(FormControlLabel, {\n                control: /*#__PURE__*/_jsxDEV(Switch, {\n                  checked: isAgentMode,\n                  onChange: e => setIsAgentMode(e.target.checked),\n                  disabled: !googleSheetsUrl || !isSheetSelected\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1597,\n                  columnNumber: 21\n                }, this),\n                label: `Agent Mode: Allow Sheet Editing ${!isSheetSelected ? '(בחר גליון תחילה)' : ''}`,\n                sx: {\n                  color: !googleSheetsUrl || !isSheetSelected ? 'text.disabled' : 'text.secondary',\n                  mt: 1,\n                  mr: 0\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1595,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1550,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1493,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1492,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n        open: showSnackbar,\n        autoHideDuration: 6000,\n        onClose: () => setShowSnackbar(false),\n        anchorOrigin: {\n          vertical: 'bottom',\n          horizontal: 'center'\n        },\n        sx: {\n          bottom: {\n            xs: 90,\n            sm: 24\n          }\n        },\n        children: /*#__PURE__*/_jsxDEV(Alert, {\n          onClose: () => setShowSnackbar(false),\n          severity: authError ? \"error\" : \"success\",\n          sx: {\n            width: '100%',\n            bgcolor: '#2E2E2E',\n            color: 'white'\n          },\n          children: snackbarMessage || authError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1615,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1614,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1083,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1078,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"GuXSG0dgjED+SuAeku1wN3dYGv0=\", false, function () {\n  return [useTheme, useMediaQuery];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Box","Drawer","Typography","Paper","TextField","Button","Avatar","Divider","Chip","Fab","useMediaQuery","useTheme","CircularProgress","Alert","Snackbar","CssBaseline","FormControl","InputLabel","Select","MenuItem","Switch","FormControlLabel","Send","Person","Description","TableChart","Save","createTheme","ThemeProvider","ChatHistory","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","theme","palette","mode","primary","main","secondary","background","default","paper","text","success","error","typography","fontFamily","h4","fontWeight","h6","components","MuiButton","styleOverrides","root","borderRadius","textTransform","padding","contained","boxShadow","transform","MuiPaper","backdropFilter","border","drawerWidth","App","_s","muiTheme","isMobile","breakpoints","down","messages","setMessages","sender","timestamp","Date","id","now","question","setQuestion","fileName","setFileName","googleSheetsUrl","setGoogleSheetsUrl","changesCount","setChangesCount","isSheetLoaded","setIsSheetLoaded","isPickerReady","setIsPickerReady","accessToken","setAccessToken","sheetsMetadata","setSheetsMetadata","authError","setAuthError","showSnackbar","setShowSnackbar","snackbarMessage","setSnackbarMessage","availableSheets","setAvailableSheets","selectedSheetName","setSelectedSheetName","isLoadingSheets","setIsLoadingSheets","extractedPdf","setExtractedPdf","isExtractingData","setIsExtractingData","extractedExcel","setExtractedExcel","isExtractingExcel","setIsExtractingExcel","isAgentMode","setIsAgentMode","isStreamingResponse","setIsStreamingResponse","isSheetSelected","setIsSheetSelected","isIframeHovered","setIsIframeHovered","canUndo","setCanUndo","canRedo","setCanRedo","hasGreenCells","setHasGreenCells","isCheckingGreenCells","setIsCheckingGreenCells","currentSessionId","setCurrentSessionId","user","setUser","chatEndRef","iframeContainerRef","savedToken","localStorage","getItem","savedPdfJson","savedPdf","JSON","parse","name","data","prev","e","console","removeItem","savedExcelJson","savedExcel","fetchUserInfo","params","URLSearchParams","window","location","search","token","get","setItem","history","replaceState","document","title","checkAuthStatus","response","fetch","credentials","ok","json","log","_chatEndRef$current","current","scrollIntoView","behavior","script","createElement","src","onload","gapi","load","callback","head","appendChild","handleWheel","Math","abs","deltaX","deltaY","preventDefault","stopPropagation","handleTouchStart","handleTouchMove","addEventListener","passive","removeEventListener","timer","setTimeout","checkUndoRedoStatus","checkForGreenCells","clearTimeout","interval","setInterval","clearInterval","handleSessionSelect","sessionId","chatHistory","loadedMessages","map","msg","content","role","_id","random","generateSessionId","toString","substr","makeGoogleSheetsAPICall","spreadsheetId","range","values","method","Error","baseUrl","_data$error","url","options","headers","body","stringify","message","extractSpreadsheetId","match","getSheetUrlWithGid","sheetName","selectedSheet","find","sheet","cleanUrl","split","getSpreadsheetMetadata","metadata","sheets","properties","sheetId","handleFileUpload","event","fileType","file","target","files","type","filter","includes","formData","FormData","append","then","err","result","pdfInfo","catch","finally","excelInfo","loadAvailableSheets","length","handleGoogleSheetsUrl","handleSheetChange","newSheetName","getSheetData","pickerCallback","action","google","picker","Action","PICKED","doc","docs","createPicker","developerKey","REACT_APP_GEMINI_API_KEY","clientId","REACT_APP_GOOGLE_CLIENT_ID","view","View","ViewId","SPREADSHEETS","setMimeTypes","PickerBuilder","setAppId","setOAuthToken","setDeveloperKey","addView","setCallback","build","setVisible","apiResponse","startNewChat","handleLogout","pendingChanges","status","approveAllChanges","_availableSheets$find","s","iframe","querySelector","errorData","rejectAllChanges","_availableSheets$find2","undoAction","redoAction","sendMessage","trim","currentQuestion","userMessage","loadingMessageId","isLoading","sheetData","payload","extractedPdfData","extractedExcelData","conversationHistory","m","parts","errorText","reader","getReader","decoder","TextDecoder","accumulatedResponse","value","done","read","decode","stream","currentResponse","questionLower","toLowerCase","undoRedoKeywords","some","keyword","isError","saveAllChanges","children","_jsxFileName","lineNumber","columnNumber","sx","display","height","bgcolor","overflow","position","top","left","right","bottom","pointerEvents","zIndex","variant","width","flexShrink","boxSizing","borderRight","p","backgroundClip","WebkitBackgroundClip","WebkitTextFillColor","color","borderColor","alignItems","gap","mb","profilePicture","charAt","flex","email","onClick","size","fullWidth","flexGrow","onSessionSelect","flexDirection","justifyContent","flexWrap","minWidth","onChange","disabled","href","label","mr","startIcon","textAlign","mt","placeholder","onKeyPress","key","ref","overscrollBehavior","touchAction","WebkitOverflowScrolling","onMouseEnter","onMouseLeave","style","backgroundColor","fontSize","cursor","userSelect","transition","textContent","opacity","gutterBottom","maxWidth","borderBottom","component","hidden","accept","whiteSpace","textOverflow","index","className","px","toLocaleTimeString","hour","minute","borderTop","shiftKey","multiline","minRows","maxRows","direction","transformOrigin","control","checked","open","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","xs","sm","severity","_c","$RefreshReg$"],"sources":["/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Drawer,\r\n  Typography,\r\n  Paper,\r\n  TextField,\r\n  Button,\r\n  Avatar,\r\n  Divider,\r\n  Chip,\r\n  Fab,\r\n  useMediaQuery,\r\n  useTheme,\r\n  CircularProgress,\r\n  Alert,\r\n  Snackbar,\r\n  CssBaseline,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  Switch,\r\n  FormControlLabel\r\n} from '@mui/material';\r\nimport {\r\n  Send,\r\n  Person,\r\n  Description,\r\n  TableChart,\r\n  Save\r\n} from '@mui/icons-material';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\nimport ChatHistory from './components/ChatHistory';\r\nimport './App.css';\r\n\r\n// API URL configuration\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    mode: 'dark',\r\n    primary: { main: '#8B5CF6' },\r\n    secondary: { main: '#6366F1' },\r\n    background: { default: '#000000', paper: '#0A0A0A' },\r\n    text: { primary: '#FFFFFF', secondary: '#E5E7EB' },\r\n    success: { main: '#10B981' },\r\n    error: { main: '#EF4444' }\r\n  },\r\n  typography: {\r\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\r\n    h4: { fontWeight: 700 },\r\n    h6: { fontWeight: 600 }\r\n  },\r\n  components: {\r\n    MuiButton: {\r\n      styleOverrides: {\r\n        root: { borderRadius: 12, textTransform: 'none', fontWeight: 600, padding: '10px 20px' },\r\n        contained: {\r\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\r\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\r\n          '&:hover': {\r\n            transform: 'translateY(-1px)',\r\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\r\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)',\r\n          }\r\n        },\r\n      },\r\n    },\r\n    MuiPaper: {\r\n      styleOverrides: {\r\n        root: {\r\n          background: 'rgba(20, 20, 20, 0.95)',\r\n          backdropFilter: 'blur(20px)',\r\n          border: '1px solid rgba(139, 92, 246, 0.3)',\r\n          borderRadius: 16,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nconst drawerWidth = 280;\r\n\r\nfunction App() {\r\n  const muiTheme = useTheme();\r\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\r\n  \r\n  const [messages, setMessages] = useState([\r\n    { text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }\r\n  ]);\r\n  const [question, setQuestion] = useState('');\r\n  const [fileName, setFileName] = useState('');\r\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\r\n  const [changesCount, setChangesCount] = useState(0);\r\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\r\n\r\n  const [isPickerReady, setIsPickerReady] = useState(false);\r\n  const [accessToken, setAccessToken] = useState('');\r\n  const [sheetsMetadata, setSheetsMetadata] = useState('');\r\n  const [authError, setAuthError] = useState('');\r\n  const [showSnackbar, setShowSnackbar] = useState(false);\r\n  const [snackbarMessage, setSnackbarMessage] = useState('');\r\n  const [availableSheets, setAvailableSheets] = useState([]);\r\n  const [selectedSheetName, setSelectedSheetName] = useState('');\r\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\r\n  const [extractedPdf, setExtractedPdf] = useState(null);\r\n  const [isExtractingData, setIsExtractingData] = useState(false);\r\n  const [extractedExcel, setExtractedExcel] = useState(null);\r\n  const [isExtractingExcel, setIsExtractingExcel] = useState(false);\r\n  const [isAgentMode, setIsAgentMode] = useState(false);\r\n  const [isStreamingResponse, setIsStreamingResponse] = useState(false);\r\n  const [isSheetSelected, setIsSheetSelected] = useState(false);\r\n  const [isIframeHovered, setIsIframeHovered] = useState(false);\r\n  \r\n  // 🔄 Undo/Redo State\r\n  const [canUndo, setCanUndo] = useState(false);\r\n  const [canRedo, setCanRedo] = useState(false);\r\n  const [hasGreenCells, setHasGreenCells] = useState(false);\r\n  const [isCheckingGreenCells, setIsCheckingGreenCells] = useState(false);\r\n  \r\n  // Chat History Management\r\n  const [currentSessionId, setCurrentSessionId] = useState(null);\r\n  const [user, setUser] = useState(null);\r\n  \r\n  const chatEndRef = useRef(null);\r\n  const iframeContainerRef = useRef(null);\r\n\r\n\r\n  useEffect(() => {\r\n    // Load saved access token ONLY - no chat messages from localStorage\r\n    const savedToken = localStorage.getItem('accessToken');\r\n    if (savedToken) {\r\n      setAccessToken(savedToken);\r\n    }\r\n\r\n    // Only load PDF/Excel data from localStorage (temporary files, not chat history)\r\n    const savedPdfJson = localStorage.getItem('extractedPdf');\r\n    if (savedPdfJson) {\r\n      try {\r\n        const savedPdf = JSON.parse(savedPdfJson);\r\n        if (savedPdf && savedPdf.name && savedPdf.data) {\r\n          setExtractedPdf(savedPdf);\r\n          setMessages(prev => [...prev, { text: `📄 נתונים קודמים שחולצו מ-PDF \"${savedPdf.name}\" נטענו.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to parse extracted PDF data from localStorage', e);\r\n        localStorage.removeItem('extractedPdf');\r\n      }\r\n    }\r\n\r\n    const savedExcelJson = localStorage.getItem('extractedExcel');\r\n    if (savedExcelJson) {\r\n        try {\r\n            const savedExcel = JSON.parse(savedExcelJson);\r\n            if (savedExcel && savedExcel.name && savedExcel.data) {\r\n                setExtractedExcel(savedExcel);\r\n                setMessages(prev => [...prev, { text: `📊 נתונים קודמים שחולצו מ-Excel \"${savedExcel.name}\" נטענו.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to parse extracted Excel data from localStorage', e);\r\n            localStorage.removeItem('extractedExcel');\r\n        }\r\n    }\r\n  }, []);\r\n\r\n  // Fetch user info when access token is available\r\n  useEffect(() => {\r\n    if (accessToken) {\r\n      fetchUserInfo();\r\n    }\r\n  }, [accessToken]);\r\n\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const token = params.get('token');\r\n    if (token) {\r\n      setAccessToken(token);\r\n      localStorage.setItem('accessToken', token);\r\n      setSnackbarMessage('התחברת בהצלחה!');\r\n      setShowSnackbar(true);\r\n      window.history.replaceState({}, document.title, \"/\");\r\n    } else {\r\n      // Check if user is already authenticated\r\n      checkAuthStatus();\r\n    }\r\n  }, []);\r\n\r\n  const checkAuthStatus = async () => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/api/user`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUser(data.user);\r\n        if (data.accessToken) {\r\n          setAccessToken(data.accessToken);\r\n          localStorage.setItem('accessToken', data.accessToken);\r\n        }\r\n        setSnackbarMessage('ברוך הבא בחזרה!');\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.log('Not authenticated:', error);\r\n      // User is not authenticated, show login button\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    const script = document.createElement('script');\r\n    script.src = 'https://apis.google.com/js/api.js';\r\n    script.onload = () => window.gapi.load('picker', { 'callback': () => setIsPickerReady(true) });\r\n    document.head.appendChild(script);\r\n  }, []);\r\n\r\n  // ניהול גלילה עבור iframe - הגנה מיוחדת על Mac gestures\r\n  useEffect(() => {\r\n    const handleWheel = (e) => {\r\n      if (isIframeHovered) {\r\n        // הגנה ספציפית על horizontal scrolling במאק\r\n        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n          // זה גלילה אופקית - בלוק את הnavigation gesture\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleTouchStart = (e) => {\r\n      if (isIframeHovered) {\r\n        e.stopPropagation();\r\n      }\r\n    };\r\n\r\n    const handleTouchMove = (e) => {\r\n      if (isIframeHovered) {\r\n        e.stopPropagation();\r\n      }\r\n    };\r\n\r\n    // הוסף event listeners עם focus על gestures\r\n    document.addEventListener('wheel', handleWheel, { passive: false });\r\n    document.addEventListener('touchstart', handleTouchStart, { passive: false });\r\n    document.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n\r\n    return () => {\r\n      document.removeEventListener('wheel', handleWheel);\r\n      document.removeEventListener('touchstart', handleTouchStart);\r\n      document.removeEventListener('touchmove', handleTouchMove);\r\n    };\r\n  }, [isIframeHovered]);\r\n\r\n  // בדיקת סטטוס אוטומטית כשגליון נבחר\r\n  useEffect(() => {\r\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\r\n      // Auto-check status when sheet is selected\r\n      // בדיקה אוטומטית אחרי טעינת הגליון\r\n      const timer = setTimeout(() => {\r\n        checkUndoRedoStatus();\r\n        checkForGreenCells();\r\n      }, 2000);\r\n      \r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [selectedSheetName, isSheetSelected, currentSessionId]);\r\n\r\n  // בדיקה אוטומטית כל 5 שניות כשיש session פעיל\r\n  useEffect(() => {\r\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\r\n      console.log('🔄 Starting automatic pending changes check every 5 seconds...');\r\n      \r\n      const interval = setInterval(() => {\r\n        console.log('⏰ Automatic check for pending changes...');\r\n        checkForGreenCells();\r\n      }, 5000); // כל 5 שניות\r\n      \r\n      return () => {\r\n        console.log('🛑 Stopping automatic pending changes check');\r\n        clearInterval(interval);\r\n      };\r\n    }\r\n  }, [isSheetSelected, selectedSheetName, currentSessionId]);\r\n\r\n  const fetchUserInfo = async () => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/api/user`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUser(data.user);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching user info:', error);\r\n    }\r\n  };\r\n\r\n  const handleSessionSelect = async (sessionId) => {\r\n    if (!sessionId) {\r\n      setCurrentSessionId(null);\r\n      setMessages([{ text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n      return;\r\n    }\r\n\r\n    setCurrentSessionId(sessionId);\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/chat/session/${sessionId}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const chatHistory = await response.json();\r\n        const loadedMessages = chatHistory.messages.map(msg => ({\r\n          text: msg.content,\r\n          sender: msg.role === 'user' ? 'user' : 'assistant',\r\n          timestamp: new Date(msg.timestamp),\r\n          id: msg._id || Date.now() + Math.random()\r\n        }));\r\n        \r\n        setMessages(loadedMessages);\r\n        \r\n        // בדיקה אוטומטית לשינויים ממתינים אחרי בחירת session\r\n        if (isSheetSelected && selectedSheetName) {\r\n          setTimeout(() => {\r\n            console.log('🔄 Auto-checking for pending changes after session selection...');\r\n            checkForGreenCells();\r\n          }, 500);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading chat session:', error);\r\n      setSnackbarMessage('שגיאה בטעינת השיחה');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const generateSessionId = () => {\r\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n  };\r\n\r\n\r\n\r\n\r\n  \r\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET') => {\r\n    if (!accessToken) throw new Error('No access token available. Please log in.');\r\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n    try {\r\n      let url, options;\r\n      if (method === 'GET') {\r\n        url = `${baseUrl}/values/${range}`;\r\n        options = { method, headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' }};\r\n      } else {\r\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\r\n        options = { method, headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' }, body: JSON.stringify({ values }) };\r\n      }\r\n      const response = await fetch(url, options);\r\n      const data = await response.json();\r\n      if (!response.ok) throw new Error(data.error?.message || 'API call failed');\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Google Sheets API error:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const extractSpreadsheetId = (url) => {\r\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\r\n    return match ? match[1] : null;\r\n  };\r\n  \r\n  // פונקציה ליצור URL עם הגליון הנכון\r\n  const getSheetUrlWithGid = (baseUrl, sheetName) => {\r\n    if (!sheetName || !sheetsMetadata) return baseUrl;\r\n    \r\n    const selectedSheet = sheetsMetadata.find(sheet => sheet.name === sheetName);\r\n    if (!selectedSheet) return baseUrl;\r\n    \r\n    // הסר כל gid קיים מה-URL\r\n    const cleanUrl = baseUrl.split('#')[0];\r\n    \r\n    // הוסף את ה-gid החדש\r\n    return `${cleanUrl}#gid=${selectedSheet.id}`;\r\n  };\r\n\r\n  const getSpreadsheetMetadata = async (spreadsheetId) => {\r\n    if (!accessToken) return [];\r\n    try {\r\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n      const response = await fetch(url, { headers: { 'Authorization': `Bearer ${accessToken}` } });\r\n      if (!response.ok) throw new Error('Failed to fetch spreadsheet metadata');\r\n      const metadata = await response.json();\r\n      return metadata.sheets.map(sheet => ({ name: sheet.properties.title, id: sheet.properties.sheetId }));\r\n    } catch (error) {\r\n      console.error('Error fetching spreadsheet metadata:', error);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (event, fileType) => {\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n\r\n    if (file.type === 'application/pdf') {\r\n        // Clean all previous PDF-related state\r\n        setExtractedPdf(null);\r\n        localStorage.removeItem('extractedPdf');\r\n        setIsExtractingData(true);\r\n        \r\n        // Remove any previous PDF-related messages\r\n        setMessages(prev => prev.filter(msg => \r\n            !msg.text.includes('נתונים חולצו') && \r\n            !msg.text.includes('שגיאה בחילוץ') &&\r\n            !msg.text.includes('נתוני ה-PDF נוקו')\r\n        ));\r\n        \r\n        setMessages(prev => [...prev, { text: `⏳ מחלץ נתונים מקובץ \"${file.name}\"...`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        \r\n        const formData = new FormData();\r\n        formData.append('pdf', file);\r\n\r\n        fetch(`${API_URL}/api/extract-pdf-data`, {\r\n            method: 'POST', \r\n            body: formData \r\n        })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                return response.json().then(err => { throw new Error(err.error || 'Failed to extract data') });\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(result => {\r\n            const pdfInfo = { name: file.name, data: result };\r\n            setExtractedPdf(pdfInfo);\r\n            localStorage.setItem('extractedPdf', JSON.stringify(pdfInfo));\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\r\n            setMessages(prev => [...prev, { text: `✅ נתונים חולצו בהצלחה מ-\"${file.name}\". כעת ניתן לשאול שאלות על הקובץ.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .catch(error => {\r\n            console.error('PDF data extraction failed:', error);\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\r\n            setMessages(prev => [...prev, { text: `❌ שגיאה בחילוץ נתונים מ-\"${file.name}\": ${error.message}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .finally(() => {\r\n            setIsExtractingData(false);\r\n        });\r\n    } else if (fileType === 'Excel') {\r\n        setExtractedExcel(null);\r\n        localStorage.removeItem('extractedExcel');\r\n        setIsExtractingExcel(true);\r\n        \r\n        setMessages(prev => prev.filter(msg => \r\n            !msg.text.includes('חולצו מ-Excel') && \r\n            !msg.text.includes('שגיאה בחילוץ Excel') &&\r\n            !msg.text.includes('נתוני ה-Excel נוקו')\r\n        ));\r\n        \r\n        setMessages(prev => [...prev, { text: `⏳ מחלץ נתונים מקובץ Excel \"${file.name}\"...`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        \r\n        const formData = new FormData();\r\n        formData.append('excel', file);\r\n\r\n        fetch(`${API_URL}/api/extract-excel-data`, {\r\n            method: 'POST', \r\n            body: formData \r\n        })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                return response.json().then(err => { throw new Error(err.error || 'Failed to extract Excel data') });\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(result => {\r\n            const excelInfo = { name: file.name, data: result.data };\r\n            setExtractedExcel(excelInfo);\r\n            localStorage.setItem('extractedExcel', JSON.stringify(excelInfo));\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\r\n            setMessages(prev => [...prev, { text: `✅ נתונים חולצו בהצלחה מ-Excel \"${file.name}\".`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .catch(error => {\r\n            console.error('Excel data extraction failed:', error);\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\r\n            setMessages(prev => [...prev, { text: `❌ שגיאה בחילוץ נתוני Excel: ${error.message}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .finally(() => {\r\n            setIsExtractingExcel(false);\r\n        });\r\n    }\r\n  };\r\n\r\n  const loadAvailableSheets = async (spreadsheetId) => {\r\n    setIsLoadingSheets(true);\r\n    setIsSheetSelected(false); // Reset selection\r\n    setSelectedSheetName(''); // Clear any previous selection\r\n    try {\r\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\r\n      setAvailableSheets(sheets);\r\n      setSheetsMetadata(sheets);\r\n      // רק הודעה שהגליונות נטענו - בלי לבחור גליון אוטומטית\r\n      if (sheets.length > 0) {\r\n        setMessages(prev => [...prev, { \r\n          text: `📋 נמצאו ${sheets.length} גליונות - בחר גליון כדי להתחיל`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      }\r\n    } finally {\r\n      setIsLoadingSheets(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleSheetsUrl = async (url) => {\r\n    setGoogleSheetsUrl(url);\r\n    setIsSheetLoaded(true);\r\n    setIsSheetSelected(false); // Reset sheet selection for new spreadsheet\r\n    setIsAgentMode(false); // Reset agent mode for new spreadsheet\r\n    const spreadsheetId = extractSpreadsheetId(url);\r\n    if (spreadsheetId && accessToken) await loadAvailableSheets(spreadsheetId);\r\n  };\r\n  \r\n  const handleSheetChange = async (newSheetName) => {\r\n    if (newSheetName === selectedSheetName) return;\r\n    \r\n    setSelectedSheetName(newSheetName);\r\n    setIsSheetSelected(true); // מסמן שנבחר גליון\r\n    \r\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n    if (spreadsheetId) {\r\n      await getSheetData(spreadsheetId, newSheetName);\r\n      setMessages(prev => [...prev, {\r\n        text: `✅ מחובר לגליון: ${newSheetName}`,\r\n        sender: 'system',\r\n        timestamp: new Date(),\r\n        id: Date.now()\r\n      }]);\r\n      \r\n      // בדיקה אוטומטית לשינויים ממתינים אחרי בחירת גליון\r\n      setTimeout(() => {\r\n        console.log('🔄 Auto-checking for pending changes after sheet selection...');\r\n        checkForGreenCells();\r\n      }, 1000);\r\n    }\r\n  };\r\n\r\n  const pickerCallback = (data) => {\r\n    if (data.action === window.google.picker.Action.PICKED) {\r\n      const doc = data.docs[0];\r\n      setFileName(doc.name);\r\n      handleGoogleSheetsUrl(doc.url);\r\n      setSnackbarMessage(`טען גיליון: ${doc.name}`);\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const createPicker = () => {\r\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY;\r\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\r\n    if (!clientId || !developerKey) {\r\n      setAuthError('מפתחות API אינם מוגדרים כראוי.');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\r\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\r\n    const picker = new window.google.picker.PickerBuilder()\r\n      .setAppId(clientId.split('-')[0])\r\n      .setOAuthToken(accessToken)\r\n      .setDeveloperKey(developerKey)\r\n      .addView(view)\r\n      .setCallback(pickerCallback)\r\n      .build();\r\n    picker.setVisible(true);\r\n  };\r\n\r\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\r\n    if (!accessToken) return null;\r\n    try {\r\n      const range = sheetName ? `'${sheetName}'!A1:Z1000` : 'A1:Z1000';\r\n      const apiResponse = await makeGoogleSheetsAPICall(spreadsheetId, range);\r\n      // The processSheetData function is removed as we will send raw data to backend\r\n      return apiResponse.values || [];\r\n    } catch (error) {\r\n      console.error('Failed to fetch sheet data:', error);\r\n      setMessages(prev => [...prev, { text: `❌ שגיאה בטעינת גיליון: ${error.message}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const startNewChat = () => {\r\n    setCurrentSessionId(null);\r\n    setMessages([{ text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n    // אפס מצב Agent Mode אם אין גליון נבחר\r\n    if (!isSheetSelected) {\r\n      setIsAgentMode(false);\r\n    }\r\n    // אפס מצב Undo/Redo\r\n    setCanUndo(false);\r\n    setCanRedo(false);\r\n    setHasGreenCells(false);\r\n    setChangesCount(0);\r\n  };\r\n\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      // Call logout endpoint\r\n      await fetch(`${API_URL}/auth/logout`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      // Clear local state\r\n      setAccessToken('');\r\n      setUser(null);\r\n      setCurrentSessionId(null);\r\n      setIsSheetSelected(false);\r\n      setIsAgentMode(false);\r\n      setCanUndo(false);\r\n      setCanRedo(false);\r\n      setHasGreenCells(false);\r\n      setChangesCount(0);\r\n      localStorage.removeItem('accessToken');\r\n      \r\n      // Reset messages\r\n      setMessages([{ text: 'שלום! אני TLV500 AI Assistant. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n      \r\n      setSnackbarMessage('התנתקת בהצלחה!');\r\n      setShowSnackbar(true);\r\n    } catch (error) {\r\n      console.error('Error during logout:', error);\r\n    }\r\n  };\r\n\r\n  // 🔄 Undo/Redo Functions\r\n  const checkUndoRedoStatus = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\r\n        method: 'GET',\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking undo/redo status:', error);\r\n    }\r\n  };\r\n\r\n  // 📊 NEW: Check for pending changes instead of green cells\r\n  const checkForGreenCells = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName || isCheckingGreenCells) return;\r\n    \r\n    // 🔍 Critical check: Make sure we have a session ID\r\n    if (!currentSessionId) {\r\n      setHasGreenCells(false);\r\n      setChangesCount(0);\r\n      return;\r\n    }\r\n    \r\n    setIsCheckingGreenCells(true);\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\r\n        method: 'GET',\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        const pendingChanges = result.changesCount || 0;\r\n        \r\n        setHasGreenCells(pendingChanges > 0);\r\n        setChangesCount(pendingChanges);\r\n        \r\n        if (pendingChanges > 0) {\r\n          console.log(`🎉 Found ${pendingChanges} pending changes! Buttons should now be visible.`);\r\n        }\r\n        \r\n      } else {\r\n        console.error(`❌ Pending changes check failed: ${response.status}`);\r\n        setHasGreenCells(false);\r\n        setChangesCount(0);\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ Error checking for pending changes:', error);\r\n      setHasGreenCells(false);\r\n      setChangesCount(0);\r\n    } finally {\r\n      setIsCheckingGreenCells(false);\r\n    }\r\n  };\r\n\r\n  // ✅ Simple Approve All - Remove Green Background\r\n  const approveAllChanges = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName) {\r\n      setSnackbarMessage('❌ חסרים פרטי הגליון');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n      if (!spreadsheetId) {\r\n        setSnackbarMessage('❌ לא ניתן לחלץ מזהה גיליון');\r\n        setShowSnackbar(true);\r\n        return;\r\n      }\r\n\r\n      const sheetId = availableSheets.find(s => s.name === selectedSheetName)?.id;\r\n\r\n      const response = await fetch(`${API_URL}/api/action/approve-all`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          spreadsheetId: spreadsheetId,\r\n          selectedSheetName: selectedSheetName,\r\n          sheetId: sheetId,\r\n          sessionId: currentSessionId\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        setSnackbarMessage(result.message || '✅ כל השינויים אושרו');\r\n        setShowSnackbar(true);\r\n        \r\n        // Update state immediately\r\n        setHasGreenCells(false);\r\n        setChangesCount(0);\r\n        \r\n        // Refresh the sheet\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 500);\r\n        \r\n        // Double-check after a moment\r\n        setTimeout(() => {\r\n          checkForGreenCells();\r\n        }, 1000);\r\n        \r\n      } else {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Server error: ${response.status}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error approving all changes:', error);\r\n      setSnackbarMessage(`❌ שגיאה באישור השינויים: ${error.message}`);\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  // ❌ Simple Reject All - Restore Original Values\r\n  const rejectAllChanges = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName) {\r\n      setSnackbarMessage('❌ חסרים פרטי הגליון');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n      if (!spreadsheetId) {\r\n        setSnackbarMessage('❌ לא ניתן לחלץ מזהה גיליון');\r\n        setShowSnackbar(true);\r\n        return;\r\n      }\r\n\r\n      const sheetId = availableSheets.find(s => s.name === selectedSheetName)?.id;\r\n\r\n      const response = await fetch(`${API_URL}/api/action/reject-all`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          spreadsheetId: spreadsheetId,\r\n          selectedSheetName: selectedSheetName,\r\n          sheetId: sheetId,\r\n          sessionId: currentSessionId\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        setSnackbarMessage(result.message || '❌ כל השינויים נדחו');\r\n        setShowSnackbar(true);\r\n        \r\n        // Update state immediately\r\n        setHasGreenCells(false);\r\n        setChangesCount(0);\r\n        \r\n        // Refresh the sheet\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 500);\r\n        \r\n        // Double-check after a moment\r\n        setTimeout(() => {\r\n          checkForGreenCells();\r\n        }, 1000);\r\n        \r\n      } else {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Server error: ${response.status}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error rejecting all changes:', error);\r\n      setSnackbarMessage(`❌ שגיאה בדחיית השינויים: ${error.message}`);\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const undoAction = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/undo`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ sessionId: currentSessionId })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n        setSnackbarMessage('↩️ ' + data.message);\r\n        setShowSnackbar(true);\r\n        \r\n        // עדכון כפתורי קבל/דחה\r\n        await checkForGreenCells();\r\n        \r\n        // רענון חלק של הגליון\r\n        if (googleSheetsUrl && selectedSheetName) {\r\n          setTimeout(() => {\r\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n            if (iframe) {\r\n              iframe.src = iframe.src;\r\n            }\r\n          }, 500); // השהיה קצרה לפני רענון\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setSnackbarMessage('❌ שגיאה בביטול: ' + error.error);\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in undo action:', error);\r\n      setSnackbarMessage('❌ שגיאה בביטול הפעולה');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const redoAction = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/redo`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ sessionId: currentSessionId })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n        setSnackbarMessage('⤴️ ' + data.message);\r\n        setShowSnackbar(true);\r\n        \r\n        // עדכון כפתורי קבל/דחה\r\n        await checkForGreenCells();\r\n        \r\n        // רענון חלק של הגליון\r\n        if (googleSheetsUrl && selectedSheetName) {\r\n          setTimeout(() => {\r\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n            if (iframe) {\r\n              iframe.src = iframe.src;\r\n            }\r\n          }, 500); // השהיה קצרה לפני רענון\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setSnackbarMessage('❌ שגיאה בשחזור: ' + error.error);\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in redo action:', error);\r\n      setSnackbarMessage('❌ שגיאה בשחזור הפעולה');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (!question.trim() || isStreamingResponse) return;\r\n\r\n    // 🛡️ בדיקה חדשה - אם יש גליון אבל לא נבחר גליון ספציפי\r\n    if (isSheetLoaded && !isSheetSelected) {\r\n      setMessages(prev => [...prev, { \r\n        text: '❌ יש לבחור גליון תחילה מהרשימה למעלה', \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n      return;\r\n    }\r\n\r\n    const currentQuestion = question;\r\n    const userMessage = { text: currentQuestion, sender: 'user', timestamp: new Date(), id: Date.now() };\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setQuestion('');\r\n    setIsStreamingResponse(true);\r\n    \r\n    // Generate session ID if this is a new conversation\r\n    let sessionId = currentSessionId;\r\n    if (!sessionId) {\r\n      sessionId = generateSessionId();\r\n      setCurrentSessionId(sessionId);\r\n    }\r\n    \r\n    const loadingMessageId = Date.now() + 1;\r\n    setMessages(prev => [...prev, { text: '', sender: 'assistant', isLoading: true, timestamp: new Date(), id: loadingMessageId }]);\r\n\r\n    // User message will be saved automatically by backend in /api/chat-stream\r\n\r\n    try {\r\n        const sheetData = (isSheetLoaded && isSheetSelected) ? \r\n          await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\r\n        \r\n        // We need to get the spreadsheetId here to send it\r\n        const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\r\n\r\n        const payload = {\r\n          question: currentQuestion,\r\n          sheetData: sheetData,\r\n          extractedPdfData: extractedPdf ? extractedPdf.data : null,\r\n          extractedExcelData: extractedExcel ? extractedExcel.data : null,\r\n          isAgentMode: isAgentMode,\r\n          conversationHistory: messages.filter(m => !m.isLoading).map(m => ({\r\n              role: m.sender === 'user' ? 'user' : 'model',\r\n              parts: [{ text: m.text }]\r\n          })),\r\n          spreadsheetId: spreadsheetId,\r\n          accessToken: accessToken,\r\n          sessionId: sessionId,  // Include session ID\r\n          sheetsMetadata: sheetsMetadata,       // ודא שהמשתנה הזה קיים ומכיל את המידע\r\n          selectedSheetName: selectedSheetName  // ודא שהמשתנה הזה קיים ומכיל את שם הגיליון\r\n        };\r\n    \r\n        \r\n        const response = await fetch(`${API_URL}/api/chat-stream`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            credentials: 'include', // This is crucial for session cookies!\r\n            body: JSON.stringify(payload),\r\n        });\r\n\r\n        if (!response.ok || !response.body) {\r\n            const errorText = await response.text();\r\n            throw new Error(`Server error: ${response.status} ${errorText}`);\r\n        }\r\n\r\n        const reader = response.body.getReader();\r\n        const decoder = new TextDecoder();\r\n        let accumulatedResponse = '';\r\n\r\n        while (true) {\r\n            const { value, done } = await reader.read();\r\n            if (done) break;\r\n            \r\n            accumulatedResponse += decoder.decode(value, { stream: true });\r\n\r\n            const currentResponse = accumulatedResponse;\r\n            setMessages(prev => prev.map(m => {\r\n                if (m.id === loadingMessageId) {\r\n                    // Show the accumulated response directly as text\r\n                    return { ...m, text: currentResponse, isLoading: true };\r\n                }\r\n                return m;\r\n            }));\r\n        }\r\n\r\n        // Final response processing - just show the accumulated text\r\n        setMessages(prev => prev.map(m =>\r\n            m.id === loadingMessageId\r\n            ? { ...m, text: accumulatedResponse, isLoading: false }\r\n            : m\r\n        ));\r\n\r\n        // Assistant response is automatically saved by backend in /api/chat-stream\r\n        \r\n                 // אם היה זה פקודת undo/redo, רענן את הגליון\r\n         const questionLower = currentQuestion.toLowerCase().trim();\r\n         const undoRedoKeywords = ['בטל', 'undo', 'שחזר', 'redo', 'בטל פעולה', 'שחזר פעולה'];\r\n         if (undoRedoKeywords.some(keyword => questionLower.includes(keyword))) {\r\n             // רענון חלק של הגליון\r\n             if (googleSheetsUrl && selectedSheetName) {\r\n                 setTimeout(() => {\r\n                     const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n                     if (iframe) {\r\n                         iframe.src = iframe.src;\r\n                     }\r\n                 }, 800); // השהיה מעט יותר ארוכה עבור פקודות צ'אט\r\n             }\r\n         }\r\n\r\n    } catch (error) {\r\n        console.error('Error in sendMessage:', error);\r\n        setMessages(prev => prev.map(m => \r\n            m.id === loadingMessageId \r\n            ? { ...m, text: `אירעה שגיאה: ${error.message}`, isLoading: false, isError: true } \r\n            : m\r\n        ));\r\n    } finally {\r\n        setIsStreamingResponse(false);\r\n        \r\n        // Check status after message completion - make it immediate for Agent Mode\r\n        if (isAgentMode) {\r\n          // For Agent Mode, check immediately after response and then again after a short delay\r\n          console.log('🤖 Agent Mode - checking for changes immediately');\r\n          \r\n          // Immediate check\r\n          setTimeout(() => {\r\n            checkForGreenCells();\r\n          }, 100);\r\n          \r\n          // Follow-up check\r\n          setTimeout(() => {\r\n            checkUndoRedoStatus();\r\n            checkForGreenCells();\r\n          }, 800);\r\n          \r\n          // Final check to make sure we didn't miss anything\r\n          setTimeout(() => {\r\n            checkForGreenCells();\r\n          }, 1500);\r\n        } else {\r\n          // For regular mode, shorter delay\r\n          setTimeout(() => {\r\n            checkUndoRedoStatus();\r\n            checkForGreenCells();\r\n          }, 1000);\r\n        }\r\n    }\r\n  };\r\n\r\n  const saveAllChanges = () => {\r\n    setMessages(prev => [...prev, { text: `💾 כל השינויים נשמרו לגיליון ${fileName}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n  };\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      \r\n\r\n      \r\n      <Box sx={{ display: 'flex', height: '100vh', bgcolor: 'background.default', overflow: 'hidden' }}>\r\n        <Box sx={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: `radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%), radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%)`, pointerEvents: 'none', zIndex: 0 }} />\r\n        {!isMobile && (\r\n          <Drawer variant=\"permanent\" sx={{ width: drawerWidth, flexShrink: 0, zIndex: 1, '& .MuiDrawer-paper': { width: drawerWidth, boxSizing: 'border-box', bgcolor: 'rgba(10, 10, 10, 0.98)', borderRight: '1px solid rgba(139, 92, 246, 0.4)', backdropFilter: 'blur(20px)' }}}>\r\n            <Box sx={{ p: 3 }}>\r\n              <Typography variant=\"h6\" sx={{ background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)', backgroundClip: 'text', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontWeight: 700 }}>TLV500</Typography>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">AI Assistant</Typography>\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            <Box sx={{ p: 3 }}>\r\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\r\n                <Avatar\r\n                  src={user?.profilePicture}\r\n                  sx={{ width: 45, height: 45, background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' }}\r\n                >\r\n                  {user?.name ? user.name.charAt(0) : <Person />}\r\n                </Avatar>\r\n                <Box sx={{ flex: 1 }}>\r\n                  <Typography variant=\"body2\" fontWeight={600}>\r\n                    {user?.name || 'משתמש אורח'}\r\n                  </Typography>\r\n                  <Typography variant=\"caption\" color=\"text.secondary\">\r\n                    {user?.email || 'לא מחובר'}\r\n                  </Typography>\r\n                </Box>\r\n              </Box>\r\n              {accessToken && (\r\n                <Button\r\n                  variant=\"outlined\"\r\n                  onClick={handleLogout}\r\n                  size=\"small\"\r\n                  fullWidth\r\n                  sx={{\r\n                    borderColor: 'rgba(239, 68, 68, 0.5)',\r\n                    color: 'error.main',\r\n                    '&:hover': {\r\n                      borderColor: 'error.main',\r\n                      bgcolor: 'rgba(239, 68, 68, 0.1)'\r\n                    }\r\n                  }}\r\n                >\r\n                  התנתק\r\n                </Button>\r\n              )}\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            \r\n            {/* Chat History */}\r\n            <Box sx={{ flexGrow: 1, overflow: 'hidden' }}>\r\n              <ChatHistory\r\n                accessToken={accessToken}\r\n                onSessionSelect={handleSessionSelect}\r\n                currentSessionId={currentSessionId}\r\n              />\r\n            </Box>\r\n          </Drawer>\r\n        )}\r\n        <Box sx={{ flexGrow: 1, display: 'flex', flexDirection: isMobile ? 'column' : 'row', zIndex: 1, height: '100vh', overflow: 'hidden' }}>\r\n          <Box sx={{ flex: isMobile ? '1 1 60%' : '0 0 65%', p: 2, display: 'flex', flexDirection: 'column', height: '100%', overflow: 'hidden' }}>\r\n            <Box sx={{ mb: 2, display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: 2 }}>\r\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                <Typography variant=\"h6\" fontWeight={600} color=\"text.primary\">{fileName || 'לא נבחר גיליון'}</Typography>\r\n                {availableSheets.length > 0 && (\r\n                  <FormControl \r\n                    size=\"small\" \r\n                    sx={{ \r\n                      minWidth: 200,\r\n                      '& .MuiOutlinedInput-notchedOutline': { \r\n                        borderColor: !isSheetSelected ? 'rgba(239, 68, 68, 0.7)' : 'rgba(139, 92, 246, 0.5)' \r\n                      },\r\n                      '& .MuiInputLabel-root': {\r\n                        color: !isSheetSelected ? 'error.main' : 'text.secondary'\r\n                      }\r\n                    }}\r\n                    error={!isSheetSelected}\r\n                  >\r\n                    <InputLabel>\r\n                      {!isSheetSelected ? '🔴 בחר גליון (חובה)' : 'גליון נוכחי'}\r\n                    </InputLabel>\r\n                    <Select \r\n                      value={selectedSheetName || ''} \r\n                      onChange={(e) => handleSheetChange(e.target.value)} \r\n                      disabled={isLoadingSheets}\r\n                    >\r\n                      {availableSheets.map(sheet => (\r\n                        <MenuItem key={sheet.id} value={sheet.name}>\r\n                          {sheet.name}\r\n                        </MenuItem>\r\n                      ))}\r\n                    </Select>\r\n                  </FormControl>\r\n                )}\r\n                {isLoadingSheets && <CircularProgress size={20} sx={{ color: 'primary.main' }} />}\r\n              </Box>\r\n              <Box sx={{ display: 'flex', gap: 1 }}>\r\n                {!accessToken ? (\r\n                  <Button variant=\"contained\" href={API_URL}>התחבר עם Google</Button>\r\n                ) : (\r\n                  <Button variant=\"outlined\" onClick={createPicker} disabled={!isPickerReady}>\r\n                    {!isPickerReady ? 'טוען API...' : 'בחר גיליון מ-Drive'}\r\n                  </Button>\r\n                )}\r\n                {accessToken && (\r\n                  <Button variant=\"outlined\" onClick={startNewChat} sx={{ minWidth: 'auto' }}>\r\n                    + שיחה חדשה\r\n                  </Button>\r\n                )}\r\n              </Box>\r\n              {changesCount > 0 && <Chip label={`${changesCount} שינויים לא שמורים`} size=\"small\" color=\"warning\" />}\r\n              \r\n              {/* כפתור בדיקה זמני לדיבוג */}\r\n              <Button\r\n                variant=\"outlined\"\r\n                onClick={async () => {\r\n                  console.log(`📊 BEFORE check: hasGreenCells=${hasGreenCells}, changesCount=${changesCount}, sessionId=${currentSessionId}`);\r\n                  await checkForGreenCells();\r\n                  // Force a tiny state change to trigger re-render\r\n                  setTimeout(() => {\r\n                    console.log(`📊 AFTER check: hasGreenCells=${hasGreenCells}, changesCount=${changesCount}`);\r\n                    // Force buttons to appear if we have changes\r\n                    if (changesCount > 0) {\r\n                      console.log('🔥 Forcing re-render...');\r\n                      setHasGreenCells(changesCount > 0);\r\n                    }\r\n                  }, 200);\r\n                }}\r\n                size=\"small\"\r\n                sx={{ mr: 1 }}\r\n              >\r\n                🔍 DEBUG ({changesCount})\r\n              </Button>\r\n              \r\n              <Button variant=\"contained\" startIcon={<Save />} onClick={saveAllChanges} color=\"primary\" size=\"small\">שמור הכל</Button>\r\n            </Box>\r\n            <Paper sx={{ flexGrow: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', background: 'rgba(15, 15, 15, 0.98)', border: '1px solid rgba(139, 92, 246, 0.25)', position: 'relative' }}>\r\n              \r\n\r\n\r\n              {/* שדה קישור - רק כשאין גליון */}\r\n              {!isSheetLoaded && (\r\n                <Box sx={{ p: 1, textAlign: 'center', mt: 2 }}>\r\n                  <TextField \r\n                    placeholder=\"הכנס קישור לגוגל שיטס...\" \r\n                    size=\"small\" \r\n                    sx={{ minWidth: 400 }} \r\n                    onKeyPress={async (e) => { \r\n                      if (e.key === 'Enter' && e.target.value) { \r\n                        await handleGoogleSheetsUrl(e.target.value); \r\n                        e.target.value = ''; \r\n                      } \r\n                    }} \r\n                  />\r\n                </Box>\r\n              )}\r\n              \r\n              {/* כפתורי קבל/דחה מרובעים צמודים למסגרת מבחוץ */}\r\n\r\n              \r\n\r\n              <Box \r\n                ref={iframeContainerRef} \r\n                sx={{ \r\n                  flexGrow: 1, \r\n                  border: '1px solid rgba(139, 92, 246, 0.4)', \r\n                  borderRadius: 1, \r\n                  bgcolor: 'rgba(5, 5, 5, 0.8)', \r\n                  position: 'relative', \r\n                  overflow: 'hidden',\r\n                  m: 0.5, // רווח מינימלי מהקצוות\r\n                  // הגנה על Mac gestures\r\n                  overscrollBehavior: 'contain',\r\n                  touchAction: 'auto',\r\n                  WebkitOverflowScrolling: 'touch'\r\n                }} \r\n                onMouseEnter={() => setIsIframeHovered(true)} \r\n                onMouseLeave={() => setIsIframeHovered(false)}\r\n              >\r\n                {/* כפתורי קבל/דחה צמודים לצד ימין של הקונטיינר */}\r\n                {(isSheetLoaded && isSheetSelected && currentSessionId && (changesCount > 0 || hasGreenCells)) && (\r\n                  <div style={{ \r\n                    position: 'absolute',\r\n                    top: '8px',\r\n                    right: '8px',\r\n                    display: 'flex', \r\n                    gap: '0px',\r\n                    zIndex: 1000,\r\n                    backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.3)',\r\n                    borderRadius: '4px',\r\n                    padding: '2px'\r\n                  }}>\r\n                    {/* כפתור קבל */}\r\n                    <div\r\n                      onClick={approveAllChanges}\r\n                      style={{\r\n                        backgroundColor: '#4caf50',\r\n                        color: 'white',\r\n                        border: '1px solid #2e7d32',\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: 'pointer',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\r\n                      }}\r\n                      title=\"אשר כל השינויים\"\r\n                      onMouseEnter={(e) => {\r\n                        e.target.style.backgroundColor = '#45a049';\r\n                        e.target.style.transform = 'scale(1.05)';\r\n                        e.target.style.boxShadow = '0 4px 8px rgba(76, 175, 80, 0.4)';\r\n                        e.target.style.borderColor = '#4caf50';\r\n                        e.target.textContent = 'קבל הכל';\r\n                        e.target.style.fontSize = '0.6rem';\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        e.target.style.backgroundColor = '#4caf50';\r\n                        e.target.style.transform = 'scale(1)';\r\n                        e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                        e.target.style.borderColor = '#2e7d32';\r\n                        e.target.textContent = `✓ (${changesCount || 0})`;\r\n                        e.target.style.fontSize = '0.65rem';\r\n                      }}\r\n                    >\r\n                      ✓ ({changesCount || 0})\r\n                    </div>\r\n\r\n                    {/* כפתור דחה */}\r\n                    <div\r\n                      onClick={rejectAllChanges}\r\n                      style={{\r\n                        backgroundColor: '#f44336',\r\n                        color: 'white',\r\n                        border: '1px solid #c62828',\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: 'pointer',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\r\n                      }}\r\n                      title=\"דחה כל השינויים\"\r\n                      onMouseEnter={(e) => {\r\n                        e.target.style.backgroundColor = '#d32f2f';\r\n                        e.target.style.transform = 'scale(1.05)';\r\n                        e.target.style.boxShadow = '0 4px 8px rgba(244, 67, 54, 0.4)';\r\n                        e.target.style.borderColor = '#f44336';\r\n                        e.target.textContent = 'דחה הכל';\r\n                        e.target.style.fontSize = '0.6rem';\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        e.target.style.backgroundColor = '#f44336';\r\n                        e.target.style.transform = 'scale(1)';\r\n                        e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                        e.target.style.borderColor = '#c62828';\r\n                        e.target.textContent = `✕ (${changesCount || 0})`;\r\n                        e.target.style.fontSize = '0.65rem';\r\n                      }}\r\n                    >\r\n                      ✕ ({changesCount || 0})\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* כפתורי Undo/Redo בצד ימין תחתון */}\r\n                {isSheetLoaded && isSheetSelected && (canUndo || canRedo) && (\r\n                  <div style={{ \r\n                    position: 'absolute',\r\n                    bottom: '8px',\r\n                    right: '8px',\r\n                    display: 'flex', \r\n                    gap: '0px',\r\n                    zIndex: 1000,\r\n                    backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.3)',\r\n                    borderRadius: '4px',\r\n                    padding: '2px'\r\n                  }}>\r\n                    {/* כפתור Undo */}\r\n                    <div\r\n                      onClick={() => {\r\n                        if (canUndo) undoAction();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: canUndo ? '#2196f3' : '#666',\r\n                        color: 'white',\r\n                        border: `1px solid ${canUndo ? '#1976d2' : '#555'}`,\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: canUndo ? 'pointer' : 'not-allowed',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n                        opacity: canUndo ? 1 : 0.5\r\n                      }}\r\n                      title=\"בטל פעולה\"\r\n                      onMouseEnter={(e) => {\r\n                        if (canUndo) {\r\n                          e.target.style.backgroundColor = '#1976d2';\r\n                          e.target.style.transform = 'scale(1.05)';\r\n                          e.target.style.boxShadow = '0 4px 8px rgba(33, 150, 243, 0.4)';\r\n                          e.target.style.borderColor = '#2196f3';\r\n                          e.target.textContent = 'בטל';\r\n                          e.target.style.fontSize = '0.6rem';\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        if (canUndo) {\r\n                          e.target.style.backgroundColor = '#2196f3';\r\n                          e.target.style.transform = 'scale(1)';\r\n                          e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                          e.target.style.borderColor = '#1976d2';\r\n                          e.target.textContent = '↩️';\r\n                          e.target.style.fontSize = '0.65rem';\r\n                        }\r\n                      }}\r\n                    >\r\n                      ↩️\r\n                    </div>\r\n\r\n                    {/* כפתור Redo */}\r\n                    <div\r\n                      onClick={() => {\r\n                        if (canRedo) redoAction();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: canRedo ? '#ff9800' : '#666',\r\n                        color: 'white',\r\n                        border: `1px solid ${canRedo ? '#f57c00' : '#555'}`,\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: canRedo ? 'pointer' : 'not-allowed',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n                        opacity: canRedo ? 1 : 0.5\r\n                      }}\r\n                      title=\"שחזר פעולה\"\r\n                      onMouseEnter={(e) => {\r\n                        if (canRedo) {\r\n                          e.target.style.backgroundColor = '#f57c00';\r\n                          e.target.style.transform = 'scale(1.05)';\r\n                          e.target.style.boxShadow = '0 4px 8px rgba(255, 152, 0, 0.4)';\r\n                          e.target.style.borderColor = '#ff9800';\r\n                          e.target.textContent = 'שחזר';\r\n                          e.target.style.fontSize = '0.6rem';\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        if (canRedo) {\r\n                          e.target.style.backgroundColor = '#ff9800';\r\n                          e.target.style.transform = 'scale(1)';\r\n                          e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                          e.target.style.borderColor = '#f57c00';\r\n                          e.target.textContent = '⤴️';\r\n                          e.target.style.fontSize = '0.65rem';\r\n                        }\r\n                      }}\r\n                    >\r\n                      ⤴️\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {isSheetLoaded && isSheetSelected ? (\r\n                  <iframe src={getSheetUrlWithGid(googleSheetsUrl, selectedSheetName)} width=\"100%\" height=\"100%\" style={{ border: 'none', borderRadius: '4px' }} title=\"Google Sheets\" />\r\n                ) : availableSheets.length > 0 && !isSheetSelected ? (\r\n                  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'text.secondary' }}>\r\n                    <TableChart sx={{ fontSize: 60, mb: 2, opacity: 0.5, color: 'error.main' }} />\r\n                    <Typography variant=\"h6\" gutterBottom color=\"error.main\">\r\n                      יש לבחור גליון תחילה\r\n                    </Typography>\r\n                    <Typography variant=\"body2\" textAlign=\"center\" sx={{ maxWidth: 400 }}>\r\n                      בחר גליון מהרשימה למעלה כדי להתחיל לעבוד\r\n                    </Typography>\r\n                  </Box>\r\n                ) : (\r\n                  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'text.secondary' }}>\r\n                    <TableChart sx={{ fontSize: 60, mb: 2, opacity: 0.5 }} />\r\n                    <Typography variant=\"h6\" gutterBottom>טען גיליון גוגל שיטס</Typography>\r\n                    <Typography variant=\"body2\" textAlign=\"center\" sx={{ maxWidth: 400 }}>הכנס קישור לגוגל שיטס בשדה למעלה</Typography>\r\n                  </Box>\r\n                )}\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n          <Box sx={{ width: isMobile ? '100%' : '35%', flex: isMobile ? '1 1 40%' : '0 0 35%', p: 2, height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n            <Paper sx={{ flexGrow: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', background: 'rgba(25, 25, 25, 0.98)', border: '1px solid rgba(139, 92, 246, 0.25)' }}>\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Typography variant=\"h6\" fontWeight={600}>עוזר AI</Typography>\r\n                <Typography variant=\"body2\" color=\"text.secondary\">מוכן לעזור עם הניתוח שלך</Typography>\r\n              </Box>\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                  <Box sx={{ display: 'flex', gap: 1 }}>\r\n                    <Button variant=\"outlined\" component=\"label\" startIcon={<Description />} size=\"small\" disabled={isExtractingData} sx={{ flex: 1, borderColor: 'rgba(139, 92, 246, 0.5)', '&.Mui-disabled': { color: 'text.secondary' } }}>\r\n                      {isExtractingData ? 'מעבד...' : 'PDF'}\r\n                      <input type=\"file\" hidden accept=\".pdf\" onChange={(e) => handleFileUpload(e, 'PDF')} disabled={isExtractingData} />\r\n                    </Button>\r\n                    <Button variant=\"outlined\" component=\"label\" startIcon={<TableChart />} size=\"small\" disabled={isExtractingExcel} sx={{ flex: 1, borderColor: 'rgba(139, 92, 246, 0.5)' }}>\r\n                      {isExtractingExcel ? 'מעבד...' : 'Excel'}\r\n                      <input type=\"file\" hidden accept=\".xlsx,.xls,.csv\" onChange={(e) => handleFileUpload(e, 'Excel')} disabled={isExtractingExcel}/>\r\n                    </Button>\r\n                  </Box>\r\n                  {extractedPdf && (\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 1, p: 1, bgcolor: 'rgba(139, 92, 246, 0.1)', borderRadius: 2, border: '1px solid rgba(139, 92, 246, 0.3)' }}>\r\n                      <Description sx={{ color: 'primary.main', fontSize: 20 }} />\r\n                      <Typography variant=\"body2\" sx={{ flex: 1, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{extractedPdf.name}</Typography>\r\n                      <Button size=\"small\" onClick={() => { setExtractedPdf(null); localStorage.removeItem('extractedPdf'); setMessages(prev => [...prev, { text: '📄 נתוני ה-PDF נוקו מההקשר.', sender: 'system', timestamp: new Date(), id: Date.now() }]); }} sx={{ color: 'error.main', minWidth: 'auto', p: 0.5 }}>✕</Button>\r\n                    </Box>\r\n                  )}\r\n                  {extractedExcel && (\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 1, p: 1, bgcolor: 'rgba(16, 185, 129, 0.1)', borderRadius: 2, border: '1px solid rgba(16, 185, 129, 0.3)' }}>\r\n                        <TableChart sx={{ color: 'success.main', fontSize: 20 }} />\r\n                        <Typography variant=\"body2\" sx={{ flex: 1, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{extractedExcel.name}</Typography>\r\n                        <Button size=\"small\" onClick={() => { setExtractedExcel(null); localStorage.removeItem('extractedExcel'); setMessages(prev => [...prev, { text: '📊 נתוני ה-Excel נוקו מההקשר.', sender: 'system', timestamp: new Date(), id: Date.now() }]); }} sx={{ color: 'error.main', minWidth: 'auto', p: 0.5 }}>✕</Button>\r\n                    </Box>\r\n                  )}\r\n                </Box>\r\n              </Box>\r\n              <Box sx={{ flexGrow: 1, overflow: 'auto', p: 2 }}>\r\n                {messages.map((msg, index) => (\r\n                  <Box key={msg.id || index} sx={{ mb: 2 }} className=\"chat-message\">\r\n                    <Box sx={{ display: 'flex', justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start', mb: 1 }}>\r\n                      <Paper sx={{ \r\n                        p: 1.5, \r\n                        maxWidth: '85%', \r\n                        background: msg.sender === 'user' ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' : 'rgba(35, 35, 35, 0.9)', \r\n                        color: 'white', \r\n                        borderRadius: 3\r\n                      }}>\r\n                        {msg.isLoading ? <CircularProgress size={16} color=\"inherit\" /> : <Typography variant=\"body2\" sx={{ whiteSpace: 'pre-wrap' }}>{msg.text}</Typography>}\r\n                      </Paper>\r\n                    </Box>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', textAlign: msg.sender === 'user' ? 'right' : 'left', px: 1 }}>\r\n                      {msg.timestamp.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' })}\r\n                    </Typography>\r\n                  </Box>\r\n                ))}\r\n                <div ref={chatEndRef} />\r\n              </Box>\r\n              \r\n\r\n              \r\n              <Box sx={{ p: 2, borderTop: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Box sx={{ display: 'flex', gap: 1 }}>\r\n                  <TextField \r\n                    fullWidth \r\n                    variant=\"outlined\" \r\n                    placeholder=\"שאל אותי כל דבר... (Shift+Enter לשורה חדשה)\" \r\n                    value={question} \r\n                    onChange={(e) => setQuestion(e.target.value)} \r\n                    onKeyPress={(e) => {\r\n                      if (e.key === 'Enter' && !e.shiftKey) {\r\n                        e.preventDefault(); // Prevents adding a new line\r\n                        sendMessage();\r\n                      }\r\n                    }} \r\n                    multiline\r\n                    minRows={2}\r\n                    maxRows={5}\r\n                    sx={{\r\n                      direction: 'rtl',\r\n                      '& .MuiOutlinedInput-root': {\r\n                        borderRadius: 3,\r\n                        direction: 'rtl',\r\n                        '& textarea': {\r\n                          textAlign: 'right',\r\n                          direction: 'rtl',\r\n                        },\r\n                        '& input': {\r\n                          textAlign: 'right',\r\n                          direction: 'rtl',\r\n                        },\r\n                      },\r\n                      '& .MuiInputLabel-root': {\r\n                        right: 'auto',\r\n                        left: 0,\r\n                        transformOrigin: 'top right',\r\n                        direction: 'rtl',\r\n                      },\r\n                      '& .MuiFormLabel-root': {\r\n                        textAlign: 'right',\r\n                        direction: 'rtl',\r\n                      },\r\n                    }}\r\n                  />\r\n                  <Fab color=\"primary\" onClick={sendMessage} size=\"small\"><Send /></Fab>\r\n                </Box>\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={isAgentMode}\r\n                      onChange={(e) => setIsAgentMode(e.target.checked)}\r\n                      disabled={!googleSheetsUrl || !isSheetSelected}\r\n                    />\r\n                  }\r\n                  label={`Agent Mode: Allow Sheet Editing ${!isSheetSelected ? '(בחר גליון תחילה)' : ''}`}\r\n                  sx={{ \r\n                    color: (!googleSheetsUrl || !isSheetSelected) ? 'text.disabled' : 'text.secondary', \r\n                    mt: 1, \r\n                    mr: 0 \r\n                  }}\r\n                />\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n        </Box>\r\n        <Snackbar open={showSnackbar} autoHideDuration={6000} onClose={() => setShowSnackbar(false)} anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }} sx={{ bottom: { xs: 90, sm: 24 } }}>\r\n          <Alert onClose={() => setShowSnackbar(false)} severity={authError ? \"error\" : \"success\"} sx={{ width: '100%', bgcolor: '#2E2E2E', color: 'white' }}>\r\n            {snackbarMessage || authError}\r\n          </Alert>\r\n        </Snackbar>\r\n      </Box>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}