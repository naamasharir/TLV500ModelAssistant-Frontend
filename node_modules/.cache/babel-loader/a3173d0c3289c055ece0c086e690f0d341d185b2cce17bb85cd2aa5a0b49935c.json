{"ast":null,"code":"var _jsxFileName = \"/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Box, Drawer, Typography, Paper, TextField, Button, Avatar, Divider, Chip, Fab, useMediaQuery, useTheme, CircularProgress, Alert, Snackbar, CssBaseline, FormControl, InputLabel, Select, MenuItem, Switch, FormControlLabel } from '@mui/material';\nimport { Send, Person, Description, TableChart, Save } from '@mui/icons-material';\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\nimport ChatHistory from './components/ChatHistory';\nimport './App.css';\n\n// API URL configuration\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\nconst theme = createTheme({\n  palette: {\n    mode: 'dark',\n    primary: {\n      main: '#8B5CF6'\n    },\n    secondary: {\n      main: '#6366F1'\n    },\n    background: {\n      default: '#000000',\n      paper: '#0A0A0A'\n    },\n    text: {\n      primary: '#FFFFFF',\n      secondary: '#E5E7EB'\n    },\n    success: {\n      main: '#10B981'\n    },\n    error: {\n      main: '#EF4444'\n    },\n    warning: {\n      main: '#FFC107'\n    }\n  },\n  typography: {\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\n    h4: {\n      fontWeight: 700\n    },\n    h6: {\n      fontWeight: 600\n    }\n  },\n  components: {\n    MuiButton: {\n      styleOverrides: {\n        root: {\n          borderRadius: 12,\n          textTransform: 'none',\n          fontWeight: 600,\n          padding: '10px 20px'\n        },\n        contained: {\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n          '&:hover': {\n            transform: 'translateY(-1px)',\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)'\n          }\n        }\n      }\n    },\n    MuiPaper: {\n      styleOverrides: {\n        root: {\n          background: 'rgba(20, 20, 20, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(139, 92, 246, 0.3)',\n          borderRadius: 16\n        }\n      }\n    }\n  }\n});\nconst drawerWidth = 280;\n\n// Function to handle mixed Hebrew-English text\nconst formatMixedText = text => {\n  if (!text) return text;\n\n  // Simple regex to detect English words/phrases\n  const englishPattern = /([a-zA-Z0-9]+(?:\\s+[a-zA-Z0-9]+)*)/g;\n  return text.replace(englishPattern, match => {\n    // If it's a common English term in Hebrew context, wrap it\n    return `<span class=\"english-term\" dir=\"ltr\">${match}</span>`;\n  });\n};\nfunction App() {\n  _s();\n  const muiTheme = useTheme();\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\n  const [messages, setMessages] = useState([{\n    text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n    sender: 'assistant',\n    timestamp: new Date(),\n    id: Date.now()\n  }]);\n  const [question, setQuestion] = useState('');\n  const [fileName, setFileName] = useState('');\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\n  const [changesCount, setChangesCount] = useState(0);\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\n  const [isPickerReady, setIsPickerReady] = useState(false);\n  const [accessToken, setAccessToken] = useState('');\n  const [sheetsMetadata, setSheetsMetadata] = useState('');\n  const [authError, setAuthError] = useState('');\n  const [showSnackbar, setShowSnackbar] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState('');\n  const [availableSheets, setAvailableSheets] = useState([]);\n  const [selectedSheetName, setSelectedSheetName] = useState('');\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\n  const [extractedPdf, setExtractedPdf] = useState(null);\n  const [isExtractingData, setIsExtractingData] = useState(false);\n  const [extractedExcel, setExtractedExcel] = useState(null);\n  const [isExtractingExcel, setIsExtractingExcel] = useState(false);\n  const [isAgentMode, setIsAgentMode] = useState(false);\n  const [isStreamingResponse, setIsStreamingResponse] = useState(false);\n  const [isSheetSelected, setIsSheetSelected] = useState(false);\n  const [isIframeHovered, setIsIframeHovered] = useState(false);\n\n  // 🔄 Undo/Redo State\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n  const [hasGreenCells, setHasGreenCells] = useState(false);\n  const [isCheckingGreenCells, setIsCheckingGreenCells] = useState(false);\n\n  // Chat History Management\n  const [currentSessionId, setCurrentSessionId] = useState(null);\n  const [user, setUser] = useState(null);\n  const chatEndRef = useRef(null);\n  const iframeContainerRef = useRef(null);\n\n  // 🔥 State חדש לניתוח הגליון עם Gemini\n  const [sheetAnalysis, setSheetAnalysis] = useState(null);\n  const [sheetInstructions, setSheetInstructions] = useState(null);\n\n  // 🔥 State חדש לתוכניות שינויים מורכבות\n  const [pendingChangePlan, setPendingChangePlan] = useState(null);\n  const [clarificationAnswers, setClarificationAnswers] = useState(['', '', '', '', '']);\n  const [isAnsweringQuestions, setIsAnsweringQuestions] = useState(false);\n\n  // 🎚️ State חדש לבחירת מצב שינוי משמעותי\n  const [isSignificantChange, setIsSignificantChange] = useState(false);\n\n  // 🔑 Session ID for backend session storage\n  const [sessionId, setSessionId] = useState(() => {\n    return Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15);\n  });\n\n  // Helper function to extract questions from change plan response\n  const extractQuestionsFromResponse = response => {\n    console.log('Extracting questions from response:', response);\n    const questionSection = response.split('🤔 שאלות הבהרה')[1];\n    if (!questionSection) {\n      console.log('No question section found');\n      return [];\n    }\n    console.log('Question section found:', questionSection);\n    const questions = [];\n    // Pattern matches \"**1.** question text\"\n    const questionMatches = questionSection.match(/\\*\\*\\d+\\.\\*\\*\\s*([^\\n*]+)/g);\n    if (questionMatches) {\n      console.log('Raw question matches:', questionMatches);\n      questionMatches.forEach(match => {\n        const question = match.replace(/\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\n        if (question && question.length > 5) {\n          questions.push(question);\n        }\n      });\n    } else {\n      console.log('No question matches found, trying alternative pattern');\n      // Alternative: look for lines that start with numbers\n      const lines = questionSection.split('\\n');\n      for (let line of lines) {\n        line = line.trim();\n        if (line.match(/^\\*\\*\\d+\\.\\*\\*/)) {\n          const question = line.replace(/^\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\n          if (question && question.length > 5) {\n            questions.push(question);\n          }\n        }\n      }\n    }\n    console.log('Frontend extracted questions:', questions);\n    return questions.slice(0, 5); // Ensure max 5 questions\n  };\n\n  // Function to execute change plan with clarification answers\n  const executeChangePlan = async () => {\n    if (!pendingChangePlan || clarificationAnswers.some(answer => !answer.trim())) {\n      setSnackbarMessage('❌ יש לענות על כל 5 השאלות');\n      setShowSnackbar(true);\n      return;\n    }\n    setIsStreamingResponse(true);\n    const loadingMessageId = Date.now();\n    setMessages(prev => [...prev, {\n      text: '',\n      sender: 'assistant',\n      isLoading: true,\n      timestamp: new Date(),\n      id: loadingMessageId\n    }]);\n    try {\n      const sheetData = isSheetLoaded && isSheetSelected ? await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\n      const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\n      const payload = {\n        planId: pendingChangePlan.id,\n        clarificationAnswers: clarificationAnswers,\n        spreadsheetId: spreadsheetId,\n        accessToken: accessToken,\n        sheetsMetadata: sheetsMetadata,\n        selectedSheetName: selectedSheetName\n      };\n      const response = await fetch(`${API_URL}/api/execute-change-plan`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify(payload)\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Server error: ${response.status} ${errorText}`);\n      }\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let accumulatedResponse = '';\n      while (true) {\n        const {\n          value,\n          done\n        } = await reader.read();\n        if (done) break;\n        accumulatedResponse += decoder.decode(value, {\n          stream: true\n        });\n        setMessages(prev => prev.map(m => {\n          if (m.id === loadingMessageId) {\n            return {\n              ...m,\n              text: accumulatedResponse,\n              isLoading: true\n            };\n          }\n          return m;\n        }));\n      }\n\n      // Final processing\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: accumulatedResponse,\n        isLoading: false\n      } : m));\n\n      // Reset change plan state\n      setPendingChangePlan(null);\n      setIsAnsweringQuestions(false);\n      setClarificationAnswers(['', '', '', '', '']);\n\n      // Refresh the sheet if needed\n      if (googleSheetsUrl && selectedSheetName) {\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 1000);\n      }\n    } catch (error) {\n      console.error('Error executing change plan:', error);\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: `❌ שגיאה בביצוע התוכנית: ${error.message}`,\n        isLoading: false\n      } : m));\n    } finally {\n      setIsStreamingResponse(false);\n    }\n  };\n  useEffect(() => {\n    // Load saved access token ONLY - no chat messages from localStorage\n    const savedToken = localStorage.getItem('accessToken');\n    if (savedToken) {\n      setAccessToken(savedToken);\n    }\n\n    // Only load PDF/Excel data from localStorage (temporary files, not chat history)\n    const savedPdfJson = localStorage.getItem('extractedPdf');\n    if (savedPdfJson) {\n      try {\n        const savedPdf = JSON.parse(savedPdfJson);\n        if (savedPdf && savedPdf.name && savedPdf.data) {\n          // Check if PDF still exists on server if it has a fileId\n          if (savedPdf.fileId) {\n            fetch(`${API_URL}/api/download-pdf/${savedPdf.fileId}`, {\n              method: 'HEAD',\n              credentials: 'include'\n            }).then(response => {\n              if (response.ok) {\n                setExtractedPdf(savedPdf);\n                setMessages(prev => [...prev, {\n                  text: `📄 נתונים קודמים שחולצו מ-PDF \"${savedPdf.name}\" נטענו.`,\n                  sender: 'system',\n                  timestamp: new Date(),\n                  id: Date.now()\n                }]);\n              } else {\n                // PDF no longer exists on server\n                console.log('📄 PDF from localStorage no longer exists on server, removing...');\n                localStorage.removeItem('extractedPdf');\n              }\n            }).catch(() => {\n              // Error checking PDF, remove from localStorage\n              localStorage.removeItem('extractedPdf');\n            });\n          } else {\n            // Old PDF without fileId, just load it\n            setExtractedPdf(savedPdf);\n            setMessages(prev => [...prev, {\n              text: `📄 נתונים קודמים שחולצו מ-PDF \"${savedPdf.name}\" נטענו.`,\n              sender: 'system',\n              timestamp: new Date(),\n              id: Date.now()\n            }]);\n          }\n        }\n      } catch (e) {\n        console.error('Failed to parse extracted PDF data from localStorage', e);\n        localStorage.removeItem('extractedPdf');\n      }\n    }\n    const savedExcelJson = localStorage.getItem('extractedExcel');\n    if (savedExcelJson) {\n      try {\n        const savedExcel = JSON.parse(savedExcelJson);\n        if (savedExcel && savedExcel.name && savedExcel.data) {\n          setExtractedExcel(savedExcel);\n          setMessages(prev => [...prev, {\n            text: `📊 נתונים קודמים שחולצו מ-Excel \"${savedExcel.name}\" נטענו.`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }\n      } catch (e) {\n        console.error('Failed to parse extracted Excel data from localStorage', e);\n        localStorage.removeItem('extractedExcel');\n      }\n    }\n  }, []);\n\n  // Fetch user info when access token is available\n  useEffect(() => {\n    if (accessToken) {\n      fetchUserInfo();\n    }\n  }, [accessToken]);\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const token = params.get('token');\n    if (token) {\n      setAccessToken(token);\n      localStorage.setItem('accessToken', token);\n      setSnackbarMessage('התחברת בהצלחה!');\n      setShowSnackbar(true);\n      window.history.replaceState({}, document.title, \"/\");\n    } else {\n      // Check if user is already authenticated\n      checkAuthStatus();\n    }\n  }, []);\n  const checkAuthStatus = async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/user`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n        if (data.accessToken) {\n          setAccessToken(data.accessToken);\n          localStorage.setItem('accessToken', data.accessToken);\n        }\n        setSnackbarMessage('ברוך הבא בחזרה!');\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.log('Not authenticated:', error);\n      // User is not authenticated, show login button\n    }\n  };\n  useEffect(() => {\n    var _chatEndRef$current;\n    (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = 'https://apis.google.com/js/api.js';\n    script.onload = () => window.gapi.load('picker', {\n      'callback': () => setIsPickerReady(true)\n    });\n    document.head.appendChild(script);\n  }, []);\n\n  // ניהול גלילה עבור iframe - הגנה מיוחדת על Mac gestures\n  useEffect(() => {\n    const handleWheel = e => {\n      if (isIframeHovered) {\n        // הגנה ספציפית על horizontal scrolling במאק\n        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\n          // זה גלילה אופקית - בלוק את הnavigation gesture\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      }\n    };\n    const handleTouchStart = e => {\n      if (isIframeHovered) {\n        e.stopPropagation();\n      }\n    };\n    const handleTouchMove = e => {\n      if (isIframeHovered) {\n        e.stopPropagation();\n      }\n    };\n\n    // הוסף event listeners עם focus על gestures\n    document.addEventListener('wheel', handleWheel, {\n      passive: false\n    });\n    document.addEventListener('touchstart', handleTouchStart, {\n      passive: false\n    });\n    document.addEventListener('touchmove', handleTouchMove, {\n      passive: false\n    });\n    return () => {\n      document.removeEventListener('wheel', handleWheel);\n      document.removeEventListener('touchstart', handleTouchStart);\n      document.removeEventListener('touchmove', handleTouchMove);\n    };\n  }, [isIframeHovered]);\n\n  // בדיקת סטטוס אוטומטית כשגליון נבחר\n  useEffect(() => {\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\n      // Auto-check status when sheet is selected\n      // בדיקה אוטומטית אחרי טעינת הגליון\n      const timer = setTimeout(() => {\n        checkUndoRedoStatus();\n        checkForGreenCells();\n      }, 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [selectedSheetName, isSheetSelected, currentSessionId]);\n  const fetchUserInfo = async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/user`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n      }\n    } catch (error) {\n      console.error('Error fetching user info:', error);\n    }\n  };\n  const handleSessionSelect = async sessionId => {\n    if (!sessionId) {\n      setCurrentSessionId(null);\n      setMessages([{\n        text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return;\n    }\n    setCurrentSessionId(sessionId);\n    try {\n      const response = await fetch(`${API_URL}/api/chat/session/${sessionId}`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const chatHistory = await response.json();\n        const loadedMessages = chatHistory.messages.map(msg => ({\n          text: msg.content,\n          sender: msg.role === 'user' ? 'user' : 'assistant',\n          timestamp: new Date(msg.timestamp),\n          id: msg._id || Date.now() + Math.random()\n        }));\n        setMessages(loadedMessages);\n        // Chat history loaded\n      }\n    } catch (error) {\n      console.error('Error loading chat session:', error);\n      setSnackbarMessage('שגיאה בטעינת השיחה');\n      setShowSnackbar(true);\n    }\n  };\n  const generateSessionId = () => {\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n  };\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET', valueRenderOption = 'FORMATTED_VALUE') => {\n    if (!accessToken) throw new Error('No access token available. Please log in.');\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n    try {\n      var _data$error;\n      let url, options;\n      if (method === 'GET') {\n        // 🔥 הוסף את valueRenderOption לקריאות GET\n        const params = new URLSearchParams({\n          valueRenderOption\n        });\n        url = `${baseUrl}/values/${range}?${params}`;\n        console.log('🔥 Google Sheets API call:', url);\n        options = {\n          method,\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          }\n        };\n      } else {\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\n        options = {\n          method,\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            values\n          })\n        };\n      }\n      const response = await fetch(url, options);\n      const data = await response.json();\n      if (!response.ok) throw new Error(((_data$error = data.error) === null || _data$error === void 0 ? void 0 : _data$error.message) || 'API call failed');\n      return data;\n    } catch (error) {\n      console.error('Google Sheets API error:', error);\n      throw error;\n    }\n  };\n\n  // 🔥 פונקציה חדשה לשילוב ערכים ונוסחאות\n  const combineValuesAndFormulas = (values, formulas) => {\n    const combined = [];\n    console.log('🔥 Starting combineValuesAndFormulas...');\n    console.log('📊 Values:', (values === null || values === void 0 ? void 0 : values.length) || 0, 'rows');\n    console.log('📋 Formulas:', (formulas === null || formulas === void 0 ? void 0 : formulas.length) || 0, 'rows');\n    for (let row = 0; row < Math.max(values.length, formulas.length); row++) {\n      const valueRow = values[row] || [];\n      const formulaRow = formulas[row] || [];\n      const combinedRow = [];\n      for (let col = 0; col < Math.max(valueRow.length, formulaRow.length); col++) {\n        const value = valueRow[col] || '';\n        const formula = formulaRow[col] || '';\n\n        // 🔥 לוג לבדיקה (רק לשורה ראשונה)\n        if (row === 0 && col < 3) {\n          console.log(`Cell [${row},${col}]: value=\"${value}\" (${typeof value}), formula=\"${formula}\" (${typeof formula})`);\n        }\n\n        // 🔥 תיקון: בדוק שזה string ומתחיל ב-= לפני שמגדירים כנוסחה\n        if (typeof formula === 'string' && formula.length > 0 && formula.startsWith('=')) {\n          // זו נוסחה אמיתית\n          combinedRow.push({\n            value: value,\n            formula: formula,\n            type: 'formula'\n          });\n        } else {\n          // זה ערך רגיל (לא נוסחה) - קח את הערך או את מה שיש בformula אם הערך ריק\n          const finalValue = value !== '' ? value : formula !== '' ? formula : '';\n          combinedRow.push({\n            value: finalValue,\n            type: 'literal'\n          });\n        }\n      }\n      combined.push(combinedRow);\n    }\n    console.log('🔥 Combined values and formulas:', combined.slice(0, 2)); // רק 2 שורות ראשונות\n    return combined;\n  };\n\n  // 🔥 פונקציה חדשה לניתוח הגליון עם Gemini\n  const analyzeSheetWithGemini = async (sheetData, sheetName, currentExtractedPdf = null) => {\n    try {\n      var _result$summary, _result$instructions;\n      setMessages(prev => [...prev, {\n        text: `🔍 מנתח את מבנה הגליון \"${sheetName}\" עם AI...`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      const payload = {\n        sheetData: sheetData,\n        sheetName: sheetName,\n        sessionId: sessionId,\n        analysisType: 'initial_analysis'\n      };\n      const response = await fetch(`${API_URL}/api/analyze-sheet`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify(payload)\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n\n      // שמור את התוצאות\n      setSheetAnalysis(result.summary);\n      setSheetInstructions(result.instructions); // שמור את ההוראות שחזרו מהבקאנד\n\n      // הצג את הסיכום למשתמש\n      setMessages(prev => [...prev, {\n        text: `📊 ניתוח הגליון:\\n${result.summary}`,\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      console.log('🔥 Sheet analysis completed:', result);\n      console.log('📝 Sheet summary saved:', (_result$summary = result.summary) === null || _result$summary === void 0 ? void 0 : _result$summary.length, 'characters');\n      console.log('📋 Sheet instructions saved:', (_result$instructions = result.instructions) === null || _result$instructions === void 0 ? void 0 : _result$instructions.length, 'characters');\n\n      // הודעה קצרה שההוראות נשמרו\n      setTimeout(() => {\n        setMessages(prev => [...prev, {\n          text: `✅ הוראות עבודה מפורטות נשמרו למערכת עבור שיחות עתידיות`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }, 1000);\n\n      // Return the analysis results for use in handleSheetChange\n      return {\n        instructions: result.instructions,\n        summary: result.summary\n      };\n    } catch (error) {\n      console.error('Error analyzing sheet:', error);\n      setMessages(prev => [...prev, {\n        text: `❌ שגיאה בניתוח הגליון: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n    }\n  };\n  const extractSpreadsheetId = url => {\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\n    return match ? match[1] : null;\n  };\n\n  // פונקציה ליצור URL עם הגליון הנכון\n  const getSheetUrlWithGid = (baseUrl, sheetName) => {\n    if (!sheetName || !sheetsMetadata) return baseUrl;\n    const selectedSheet = sheetsMetadata.find(sheet => sheet.name === sheetName);\n    if (!selectedSheet) return baseUrl;\n\n    // הסר כל gid קיים מה-URL\n    const cleanUrl = baseUrl.split('#')[0];\n\n    // הוסף את ה-gid החדש\n    return `${cleanUrl}#gid=${selectedSheet.id}`;\n  };\n  const getSpreadsheetMetadata = async spreadsheetId => {\n    if (!accessToken) return [];\n    try {\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n      const response = await fetch(url, {\n        headers: {\n          'Authorization': `Bearer ${accessToken}`\n        }\n      });\n      if (!response.ok) throw new Error('Failed to fetch spreadsheet metadata');\n      const metadata = await response.json();\n      return metadata.sheets.map(sheet => ({\n        name: sheet.properties.title,\n        id: sheet.properties.sheetId\n      }));\n    } catch (error) {\n      console.error('Error fetching spreadsheet metadata:', error);\n      return [];\n    }\n  };\n  const handleFileUpload = async (event, fileType) => {\n    const file = event.target.files[0];\n    if (!file) return;\n    if (file.type === 'application/pdf') {\n      // Clean all previous PDF-related state\n      setExtractedPdf(null);\n      localStorage.removeItem('extractedPdf');\n      setIsExtractingData(true);\n\n      // Remove any previous PDF-related messages\n      setMessages(prev => prev.filter(msg => !msg.text.includes('נתונים חולצו') && !msg.text.includes('שגיאה בחילוץ') && !msg.text.includes('נתוני ה-PDF נוקו')));\n      setMessages(prev => [...prev, {\n        text: `⏳ מחלץ נתונים מקובץ \"${file.name}\"...`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      const formData = new FormData();\n      formData.append('pdf', file);\n\n      // 🔥 אם יש גליון טעון, שלוף את הנתונים ושלח אותם\n      if (isSheetLoaded && isSheetSelected) {\n        const currentSheetData = await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName);\n        if (currentSheetData) {\n          formData.append('sheetData', JSON.stringify(currentSheetData));\n        }\n        if (sheetInstructions) {\n          formData.append('sheetInstructions', sheetInstructions);\n        }\n        if (sheetAnalysis) {\n          formData.append('sheetAnalysis', sheetAnalysis);\n        }\n        if (selectedSheetName) {\n          formData.append('sheetName', selectedSheetName);\n        }\n        console.log('🔥 Sending PDF with full sheet context:', {\n          hasSheetData: !!currentSheetData,\n          sheetDataLength: currentSheetData ? currentSheetData.length : 0,\n          hasInstructions: !!sheetInstructions,\n          instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\n          hasAnalysis: !!sheetAnalysis,\n          analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\n          sheetName: selectedSheetName\n        });\n      } else {\n        console.log('🔥 Sending PDF without sheet context (simple OCR mode)');\n      }\n      fetch(`${API_URL}/api/extract-pdf-data`, {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      }).then(response => {\n        if (!response.ok) {\n          return response.json().then(err => {\n            throw new Error(err.error || 'Failed to extract data');\n          });\n        }\n        return response.json();\n      }).then(result => {\n        const pdfInfo = {\n          name: file.name,\n          data: result,\n          fileId: result.fileId,\n          // שמירת fileId לפתיחה עתידית\n          processingMode: result.processingMode || 'structured',\n          // track processing mode\n          isFullText: result.isFullText || false // track if this is full text\n        };\n        setExtractedPdf(pdfInfo);\n        localStorage.setItem('extractedPdf', JSON.stringify(pdfInfo));\n        setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\n\n        // Different success messages based on processing mode\n        let successMessage;\n        if (result.processingMode === 'simple_ocr') {\n          successMessage = `✅ טקסט חולץ מ-\"${file.name}\". ניתן לשאול שאלות על התוכן. טען גיליון לניתוח מפורט.`;\n        } else {\n          successMessage = result.fileId ? `✅ נתונים חולצו בהצלחה מ-\"${file.name}\". כעת ניתן לשאול שאלות על הקובץ או לחזור לקובץ המקורי.` : `✅ נתונים חולצו בהצלחה מ-\"${file.name}\". כעת ניתן לשאול שאלות על הקובץ.`;\n        }\n        setMessages(prev => [...prev, {\n          text: successMessage,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).catch(error => {\n        console.error('PDF data extraction failed:', error);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\n        setMessages(prev => [...prev, {\n          text: `❌ שגיאה בחילוץ נתונים מ-\"${file.name}\": ${error.message}`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).finally(() => {\n        setIsExtractingData(false);\n      });\n    } else if (fileType === 'Excel') {\n      // Ask user if they want to convert to Google Sheets\n      const shouldConvert = window.confirm(`האם ברצונך להמיר את קובץ ה-Excel \"${file.name}\" ל-Google Sheets?\\n\\n` + `כן - העלאה ל-Google Drive והמרה ל-Google Sheets\\n` + `לא - חילוץ נתונים מקומי בלבד`);\n      if (shouldConvert) {\n        // Convert to Google Sheets\n        setIsExtractingExcel(true);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('ממיר') && !msg.text.includes('Google Sheets') && !msg.text.includes('שגיאה בהמרה')));\n        setMessages(prev => [...prev, {\n          text: `🔄 ממיר את \"${file.name}\" ל-Google Sheets...`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n        const formData = new FormData();\n        formData.append('excel', file);\n        fetch(`${API_URL}/api/excel-to-sheets`, {\n          method: 'POST',\n          body: formData,\n          credentials: 'include'\n        }).then(response => {\n          if (!response.ok) {\n            return response.json().then(err => {\n              throw new Error(err.error || 'Failed to convert Excel to Google Sheets');\n            });\n          }\n          return response.json();\n        }).then(result => {\n          setMessages(prev => prev.filter(msg => !msg.text.includes('🔄 ממיר')));\n          setMessages(prev => [...prev, {\n            text: `✅ הקובץ \"${file.name}\" הומר בהצלחה ל-Google Sheets ונשמר בתיקיית \"TLV500-AI\"!`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n\n          // Open the created Google Sheet in a new tab\n          const sheetUrl = result.spreadsheetUrl || result.url;\n          if (sheetUrl) {\n            window.open(sheetUrl, '_blank');\n            setMessages(prev => [...prev, {\n              text: `📊 Google Sheets נפתח בכרטיסייה חדשה`,\n              sender: 'system',\n              timestamp: new Date(),\n              id: Date.now()\n            }]);\n\n            // Optionally, also load it in the current interface\n            handleGoogleSheetsUrl(sheetUrl);\n          }\n        }).catch(error => {\n          console.error('Excel to Google Sheets conversion failed:', error);\n          setMessages(prev => prev.filter(msg => !msg.text.includes('🔄 ממיר')));\n          setMessages(prev => [...prev, {\n            text: `❌ שגיאה בהמרה ל-Google Sheets: ${error.message}`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }).finally(() => {\n          setIsExtractingExcel(false);\n        });\n      } else {\n        // Original local extraction logic\n        setExtractedExcel(null);\n        localStorage.removeItem('extractedExcel');\n        setIsExtractingExcel(true);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('חולצו מ-Excel') && !msg.text.includes('שגיאה בחילוץ Excel') && !msg.text.includes('נתוני ה-Excel נוקו')));\n        setMessages(prev => [...prev, {\n          text: `⏳ מחלץ נתונים מקובץ Excel \"${file.name}\"...`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n        const formData = new FormData();\n        formData.append('excel', file);\n        fetch(`${API_URL}/api/extract-excel-data`, {\n          method: 'POST',\n          body: formData\n        }).then(response => {\n          if (!response.ok) {\n            return response.json().then(err => {\n              throw new Error(err.error || 'Failed to extract Excel data');\n            });\n          }\n          return response.json();\n        }).then(result => {\n          const excelInfo = {\n            name: file.name,\n            data: result.data\n          };\n          setExtractedExcel(excelInfo);\n          localStorage.setItem('extractedExcel', JSON.stringify(excelInfo));\n          setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\n          setMessages(prev => [...prev, {\n            text: `✅ נתונים חולצו בהצלחה מ-Excel \"${file.name}\".`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }).catch(error => {\n          console.error('Excel data extraction failed:', error);\n          setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\n          setMessages(prev => [...prev, {\n            text: `❌ שגיאה בחילוץ נתוני Excel: ${error.message}`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }).finally(() => {\n          setIsExtractingExcel(false);\n        });\n      }\n    }\n  };\n  const loadAvailableSheets = async spreadsheetId => {\n    setIsLoadingSheets(true);\n    setIsSheetSelected(false); // Reset selection\n    setSelectedSheetName(''); // Clear any previous selection\n    try {\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\n      setAvailableSheets(sheets);\n      setSheetsMetadata(sheets);\n      // רק הודעה שהגליונות נטענו - בלי לבחור גליון אוטומטית\n      if (sheets.length > 0) {\n        setMessages(prev => [...prev, {\n          text: `📋 נמצאו ${sheets.length} גליונות - בחר גליון כדי להתחיל`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }\n    } finally {\n      setIsLoadingSheets(false);\n    }\n  };\n  const handleGoogleSheetsUrl = async url => {\n    setGoogleSheetsUrl(url);\n    setIsSheetLoaded(true);\n    setIsSheetSelected(false); // Reset sheet selection for new spreadsheet\n    setIsAgentMode(false); // Reset agent mode for new spreadsheet\n    const spreadsheetId = extractSpreadsheetId(url);\n    if (spreadsheetId && accessToken) await loadAvailableSheets(spreadsheetId);\n  };\n  const handleSheetChange = async newSheetName => {\n    if (newSheetName === selectedSheetName) return;\n    setSelectedSheetName(newSheetName);\n    setIsSheetSelected(true); // מסמן שנבחר גליון\n\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n    if (spreadsheetId) {\n      // 🔥 שלוף נתוני גליון עם ערכים ונוסחאות\n      const sheetData = await getSheetData(spreadsheetId, newSheetName);\n      setMessages(prev => [...prev, {\n        text: `✅ מחובר לגליון: ${newSheetName}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n\n      // 🔥 נתח את הגליון עם Gemini\n      if (sheetData) {\n        const analysisResult = await analyzeSheetWithGemini(sheetData, newSheetName, extractedPdf);\n\n        // 🔥 Reanalyze PDF if it exists and is in simple OCR mode\n        if (extractedPdf && extractedPdf.processingMode === 'simple_ocr' && analysisResult) {\n          console.log('🔄 PDF found in simple_ocr mode, triggering reanalysis with sheet context...');\n          await reanalyzePdfWithSheetContext(sheetData, analysisResult.instructions, analysisResult.summary, newSheetName);\n        }\n      }\n    }\n  };\n\n  // 🔥 Function to reanalyze PDF when sheet context becomes available\n  const reanalyzePdfWithSheetContext = async (sheetData, sheetInstructions, sheetAnalysis, selectedSheetName) => {\n    if (!extractedPdf || !extractedPdf.fileId || extractedPdf.processingMode === 'structured') {\n      return; // No PDF to reanalyze or already analyzed\n    }\n    console.log('🔄 Reanalyzing PDF with new sheet context...');\n    setMessages(prev => [...prev, {\n      text: `🔄 מנתח מחדש את \"${extractedPdf.name}\" עם הקשר הגליון החדש...`,\n      sender: 'system',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n    try {\n      // Create FormData for re-analysis\n      const formData = new FormData();\n\n      // We need to fetch the PDF file again - check if it exists first\n      const pdfResponse = await fetch(`${API_URL}/api/download-pdf/${extractedPdf.fileId}`, {\n        credentials: 'include'\n      });\n      if (!pdfResponse.ok) {\n        // PDF no longer exists on server - clean up state\n        console.log('❌ PDF file no longer exists on server, cleaning up...');\n        setExtractedPdf(null);\n        localStorage.removeItem('extractedPdf');\n        setMessages(prev => prev.filter(msg => !msg.text.includes(extractedPdf.name)));\n        return;\n      }\n      const pdfBlob = await pdfResponse.blob();\n      formData.append('pdf', pdfBlob, extractedPdf.name);\n\n      // Add sheet context data directly to FormData\n      console.log('🔄 Reanalyzing PDF with sheet context:', {\n        hasSheetData: !!sheetData,\n        sheetDataLength: sheetData ? sheetData.length : 0,\n        hasInstructions: !!sheetInstructions,\n        instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\n        hasAnalysis: !!sheetAnalysis,\n        analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\n        sheetName: selectedSheetName\n      });\n      if (sheetData) {\n        formData.append('sheetData', JSON.stringify(sheetData));\n      }\n      if (sheetInstructions) {\n        formData.append('sheetInstructions', sheetInstructions);\n      }\n      if (sheetAnalysis) {\n        formData.append('sheetAnalysis', sheetAnalysis);\n      }\n      if (selectedSheetName) {\n        formData.append('sheetName', selectedSheetName);\n      }\n      const response = await fetch(`${API_URL}/api/extract-pdf-data`, {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      if (!response.ok) {\n        throw new Error('Failed to reanalyze PDF');\n      }\n      const result = await response.json();\n\n      // Update PDF info with new analysis\n      const updatedPdfInfo = {\n        ...extractedPdf,\n        data: result,\n        processingMode: result.processingMode || 'structured',\n        isFullText: result.isFullText || false\n      };\n      setExtractedPdf(updatedPdfInfo);\n      localStorage.setItem('extractedPdf', JSON.stringify(updatedPdfInfo));\n      setMessages(prev => [...prev, {\n        text: `✅ \"${extractedPdf.name}\" נותח מחדש בהצלחה עם הקשר הגליון`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n    } catch (error) {\n      console.error('Error reanalyzing PDF:', error);\n      setMessages(prev => [...prev, {\n        text: `❌ שגיאה בניתוח מחדש של \"${extractedPdf.name}\": ${error.message}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n    }\n  };\n  const pickerCallback = data => {\n    if (data.action === window.google.picker.Action.PICKED) {\n      const doc = data.docs[0];\n      setFileName(doc.name);\n      handleGoogleSheetsUrl(doc.url);\n      setSnackbarMessage(`טען גיליון: ${doc.name}`);\n      setShowSnackbar(true);\n    }\n  };\n  const createPicker = () => {\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY;\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\n    if (!clientId || !developerKey) {\n      setAuthError('מפתחות API אינם מוגדרים כראוי.');\n      setShowSnackbar(true);\n      return;\n    }\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\n    const picker = new window.google.picker.PickerBuilder().setAppId(clientId.split('-')[0]).setOAuthToken(accessToken).setDeveloperKey(developerKey).addView(view).setCallback(pickerCallback).build();\n    picker.setVisible(true);\n  };\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\n    if (!accessToken) return null;\n    try {\n      var _valuesResponse$value, _formulasResponse$val, _valuesResponse$value2, _formulasResponse$val2;\n      const range = sheetName ? `'${sheetName}'!A1:Z1000` : 'A1:Z1000';\n      console.log('🔥 Fetching sheet data with values and formulas...');\n\n      // 🔥 קריאה 1: שלוף ערכים מעוצבים\n      const valuesResponse = await makeGoogleSheetsAPICall(spreadsheetId, range, null, 'GET', 'FORMATTED_VALUE');\n\n      // 🔥 קריאה 2: שלוף נוסחאות  \n      const formulasResponse = await makeGoogleSheetsAPICall(spreadsheetId, range, null, 'GET', 'FORMULA');\n      console.log('📊 Values response:', ((_valuesResponse$value = valuesResponse.values) === null || _valuesResponse$value === void 0 ? void 0 : _valuesResponse$value.length) || 0, 'rows');\n      console.log('📋 Formulas response:', ((_formulasResponse$val = formulasResponse.values) === null || _formulasResponse$val === void 0 ? void 0 : _formulasResponse$val.length) || 0, 'rows');\n\n      // 🔥 לוגים נוספים לבדיקה\n      if (((_valuesResponse$value2 = valuesResponse.values) === null || _valuesResponse$value2 === void 0 ? void 0 : _valuesResponse$value2.length) > 0) {\n        console.log('📊 Sample values row 0:', valuesResponse.values[0]);\n      }\n      if (((_formulasResponse$val2 = formulasResponse.values) === null || _formulasResponse$val2 === void 0 ? void 0 : _formulasResponse$val2.length) > 0) {\n        console.log('📋 Sample formulas row 0:', formulasResponse.values[0]);\n      }\n\n      // 🔥 שלב את שניהם לאובייקט עשיר\n      const combinedData = combineValuesAndFormulas(valuesResponse.values || [], formulasResponse.values || []);\n\n      // 🔥 הצג הודעה למשתמש על השיפור\n      const formulaCount = combinedData.flat().filter(cell => cell.type === 'formula').length;\n      if (formulaCount > 0) {\n        console.log('🔥 Sample formula cells:', combinedData.flat().filter(cell => cell.type === 'formula').slice(0, 3));\n        setMessages(prev => [...prev, {\n          text: `✨ גיליון נטען עם ${formulaCount} נוסחאות - כעת ה-AI יכול לראות גם את הנוסחאות וגם את הערכים!`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      } else {\n        setMessages(prev => [...prev, {\n          text: `📊 גיליון נטען בהצלחה - מכיל נתונים אבל לא נמצאו נוסחאות`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }\n      return combinedData;\n    } catch (error) {\n      console.error('Failed to fetch sheet data:', error);\n      console.error('Error details:', {\n        message: error.message,\n        stack: error.stack\n      });\n      setMessages(prev => [...prev, {\n        text: `❌ שגיאה בטעינת גיליון: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return null;\n    }\n  };\n  const startNewChat = () => {\n    setCurrentSessionId(null);\n    setMessages([{\n      text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n      sender: 'assistant',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n    // אפס מצב Agent Mode אם אין גליון נבחר\n    if (!isSheetSelected) {\n      setIsAgentMode(false);\n    }\n    // אפס מצב Undo/Redo\n    setCanUndo(false);\n    setCanRedo(false);\n    setHasGreenCells(false);\n    setChangesCount(0);\n    setSheetAnalysis(null);\n    setSheetInstructions(null);\n  };\n  const handleLogout = async () => {\n    try {\n      // Call logout endpoint\n      await fetch(`${API_URL}/auth/logout`, {\n        credentials: 'include'\n      });\n\n      // Clear local state\n      setAccessToken('');\n      setUser(null);\n      setCurrentSessionId(null);\n      setIsSheetSelected(false);\n      setIsAgentMode(false);\n      setCanUndo(false);\n      setCanRedo(false);\n      setHasGreenCells(false);\n      setChangesCount(0);\n      setSheetAnalysis(null);\n      setSheetInstructions(null);\n      localStorage.removeItem('accessToken');\n\n      // Reset session ID for new session\n      setSessionId(Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15));\n\n      // Reset messages\n      setMessages([{\n        text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.',\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      setSnackbarMessage('התנתקת בהצלחה!');\n      setShowSnackbar(true);\n    } catch (error) {\n      console.error('Error during logout:', error);\n    }\n  };\n\n  // 🔄 Undo/Redo Functions\n  const checkUndoRedoStatus = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\n        method: 'GET',\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n      }\n    } catch (error) {\n      console.error('Error checking undo/redo status:', error);\n    }\n  };\n\n  // 🟢 Check for green cells\n  const checkForGreenCells = async () => {\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId || isCheckingGreenCells) return;\n    setIsCheckingGreenCells(true);\n    try {\n      // Simple check - if there are undo-able actions of type AI_ACTION that were recently executed\n      // we assume there might be green cells\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const status = await response.json();\n        // For now, assume green cells exist if there are recent AI actions to undo\n        const hasChanges = status.canUndo;\n        // Debug: checkForGreenCells result\n        console.log('🟢 Full status from backend:', status);\n        console.log('🟢 hasGreenCells:', hasChanges, 'changesCount:', status.changesCount);\n        setHasGreenCells(hasChanges);\n\n        // עדכון ספירת השינויים מהבקענד\n        setChangesCount(status.changesCount || 0);\n      }\n    } catch (error) {\n      console.error('Error checking for green cells:', error);\n      setHasGreenCells(false);\n      setChangesCount(0);\n    } finally {\n      setIsCheckingGreenCells(false);\n    }\n  };\n\n  // ✅ Approve All Changes\n  const approveAllChanges = async () => {\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\n    try {\n      var _googleSheetsUrl$matc, _availableSheets$find;\n      const spreadsheetId = (_googleSheetsUrl$matc = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)) === null || _googleSheetsUrl$matc === void 0 ? void 0 : _googleSheetsUrl$matc[1];\n      const sheetId = ((_availableSheets$find = availableSheets.find(s => s.name === selectedSheetName)) === null || _availableSheets$find === void 0 ? void 0 : _availableSheets$find.id) || 0;\n      const response = await fetch(`${API_URL}/api/action/approve-all`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          spreadsheetId: spreadsheetId,\n          selectedSheetName: selectedSheetName,\n          sheetId: sheetId,\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const result = await response.json();\n        setSnackbarMessage(result.message || '✅ כל השינויים אושרו');\n        setShowSnackbar(true);\n\n        // Refresh status\n        await checkUndoRedoStatus();\n        await checkForGreenCells();\n\n        // רענון חלק של הגליון\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 500);\n      } else {\n        throw new Error('Failed to approve changes');\n      }\n    } catch (error) {\n      console.error('Error approving all changes:', error);\n      setSnackbarMessage('❌ שגיאה באישור השינויים');\n      setShowSnackbar(true);\n    }\n  };\n\n  // ❌ Reject All Changes\n  const rejectAllChanges = async () => {\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\n    try {\n      var _googleSheetsUrl$matc2, _availableSheets$find2;\n      const spreadsheetId = (_googleSheetsUrl$matc2 = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)) === null || _googleSheetsUrl$matc2 === void 0 ? void 0 : _googleSheetsUrl$matc2[1];\n      const sheetId = ((_availableSheets$find2 = availableSheets.find(s => s.name === selectedSheetName)) === null || _availableSheets$find2 === void 0 ? void 0 : _availableSheets$find2.id) || 0;\n      const response = await fetch(`${API_URL}/api/action/reject-all`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          spreadsheetId: spreadsheetId,\n          selectedSheetName: selectedSheetName,\n          sheetId: sheetId,\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const result = await response.json();\n        setSnackbarMessage(result.message || '❌ כל השינויים נדחו');\n        setShowSnackbar(true);\n\n        // Refresh status\n        await checkUndoRedoStatus();\n        await checkForGreenCells();\n\n        // רענון חלק של הגליון\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 500);\n      } else {\n        throw new Error('Failed to reject changes');\n      }\n    } catch (error) {\n      console.error('Error rejecting all changes:', error);\n      setSnackbarMessage('❌ שגיאה בדחיית השינויים');\n      setShowSnackbar(true);\n    }\n  };\n  const undoAction = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/undo`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n        setSnackbarMessage('↩️ ' + data.message);\n        setShowSnackbar(true);\n\n        // עדכון כפתורי קבל/דחה\n        await checkForGreenCells();\n\n        // רענון חלק של הגליון\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 500); // השהיה קצרה לפני רענון\n        }\n      } else {\n        const error = await response.json();\n        setSnackbarMessage('❌ שגיאה בביטול: ' + error.error);\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.error('Error in undo action:', error);\n      setSnackbarMessage('❌ שגיאה בביטול הפעולה');\n      setShowSnackbar(true);\n    }\n  };\n  const redoAction = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/redo`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n        setSnackbarMessage('⤴️ ' + data.message);\n        setShowSnackbar(true);\n\n        // עדכון כפתורי קבל/דחה\n        await checkForGreenCells();\n\n        // רענון חלק של הגליון\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 500); // השהיה קצרה לפני רענון\n        }\n      } else {\n        const error = await response.json();\n        setSnackbarMessage('❌ שגיאה בשחזור: ' + error.error);\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.error('Error in redo action:', error);\n      setSnackbarMessage('❌ שגיאה בשחזור הפעולה');\n      setShowSnackbar(true);\n    }\n  };\n  const sendMessage = async () => {\n    if (!question.trim() || isStreamingResponse) return;\n\n    // 🛡️ בדיקה חדשה - אם יש גליון אבל לא נבחר גליון ספציפי\n    if (isSheetLoaded && !isSheetSelected) {\n      setMessages(prev => [...prev, {\n        text: '❌ יש לבחור גליון תחילה מהרשימה למעלה',\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return;\n    }\n    const currentQuestion = question;\n    const userMessage = {\n      text: currentQuestion,\n      sender: 'user',\n      timestamp: new Date(),\n      id: Date.now()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    setQuestion('');\n    setIsStreamingResponse(true);\n\n    // Generate session ID if this is a new conversation\n    let sessionId = currentSessionId;\n    if (!sessionId) {\n      sessionId = generateSessionId();\n      setCurrentSessionId(sessionId);\n    }\n    const loadingMessageId = Date.now() + 1;\n    setMessages(prev => [...prev, {\n      text: '',\n      sender: 'assistant',\n      isLoading: true,\n      timestamp: new Date(),\n      id: loadingMessageId\n    }]);\n\n    // User message will be saved automatically by backend in /api/chat-stream\n\n    try {\n      const sheetData = isSheetLoaded && isSheetSelected ? await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\n\n      // We need to get the spreadsheetId here to send it\n      const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\n      const payload = {\n        question: currentQuestion,\n        sheetData: sheetData,\n        extractedPdfData: extractedPdf ? extractedPdf.data : null,\n        extractedExcelData: extractedExcel ? extractedExcel.data : null,\n        isAgentMode: isAgentMode,\n        isSignificantChange: isSignificantChange,\n        // 🎚️ הוסף מצב שינוי משמעותי\n        conversationHistory: messages.filter(m => !m.isLoading).map(m => ({\n          role: m.sender === 'user' ? 'user' : 'model',\n          parts: [{\n            text: m.text\n          }]\n        })),\n        spreadsheetId: spreadsheetId,\n        accessToken: accessToken,\n        sessionId: sessionId,\n        // Include session ID\n        sheetsMetadata: sheetsMetadata,\n        // ודא שהמשתנה הזה קיים ומכיל את המידע\n        selectedSheetName: selectedSheetName,\n        // ודא שהמשתנה הזה קיים ומכיל את שם הגיליון\n        sheetInstructions: sheetInstructions,\n        // 🔥 הוסף הוראות ניתוח\n        sheetAnalysis: sheetAnalysis // 🔥 הוסף ניתוח הגליון\n      };\n      console.log('🔥 Sending payload with sheet instructions:', !!sheetInstructions);\n      if (sheetInstructions) {\n        console.log('📋 Sheet instructions preview:', sheetInstructions.substring(0, 200) + '...');\n      }\n      const response = await fetch(`${API_URL}/api/chat-stream`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        // This is crucial for session cookies!\n        body: JSON.stringify(payload)\n      });\n      if (!response.ok || !response.body) {\n        const errorText = await response.text();\n        throw new Error(`Server error: ${response.status} ${errorText}`);\n      }\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let accumulatedResponse = '';\n      while (true) {\n        const {\n          value,\n          done\n        } = await reader.read();\n        if (done) break;\n        accumulatedResponse += decoder.decode(value, {\n          stream: true\n        });\n        const currentResponse = accumulatedResponse;\n        setMessages(prev => prev.map(m => {\n          if (m.id === loadingMessageId) {\n            // Show the accumulated response directly as text\n            return {\n              ...m,\n              text: currentResponse,\n              isLoading: true\n            };\n          }\n          return m;\n        }));\n      }\n\n      // Final response processing - check if this is a change plan with clarification questions\n      const isChangePlanResponse = accumulatedResponse.includes('🤔 שאלות הבהרה') && accumulatedResponse.includes('מזהה תוכנית:');\n      if (isChangePlanResponse) {\n        // Extract plan ID from response\n        const planIdMatch = accumulatedResponse.match(/מזהה תוכנית:\\s*`([^`]+)`/);\n        if (planIdMatch) {\n          const planId = planIdMatch[1];\n          setPendingChangePlan({\n            id: planId,\n            response: accumulatedResponse,\n            questions: extractQuestionsFromResponse(accumulatedResponse)\n          });\n          setIsAnsweringQuestions(true);\n          setClarificationAnswers(['', '', '', '', '']); // Reset answers\n        }\n      }\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: accumulatedResponse,\n        isLoading: false\n      } : m));\n\n      // Assistant response is automatically saved by backend in /api/chat-stream\n\n      // אם היה זה פקודת undo/redo, רענן את הגליון\n      const questionLower = currentQuestion.toLowerCase().trim();\n      const undoRedoKeywords = ['בטל', 'undo', 'שחזר', 'redo', 'בטל פעולה', 'שחזר פעולה'];\n      if (undoRedoKeywords.some(keyword => questionLower.includes(keyword))) {\n        // רענון חלק של הגליון\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 800); // השהיה מעט יותר ארוכה עבור פקודות צ'אט\n        }\n      }\n    } catch (error) {\n      console.error('Error in sendMessage:', error);\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: `אירעה שגיאה: ${error.message}`,\n        isLoading: false,\n        isError: true\n      } : m));\n    } finally {\n      setIsStreamingResponse(false);\n      // בדוק סטטוס Undo/Redo ותאים ירוקים אחרי כל הודעה\n      console.log('📋 Message completed, checking status...', {\n        isAgentMode,\n        currentSessionId\n      });\n      setTimeout(() => {\n        console.log('⏰ Running status checks...');\n        checkUndoRedoStatus();\n        checkForGreenCells();\n      }, 1000); // השהיה קצרה כדי לוודא שהבק-אנד סיים\n    }\n  };\n  const saveAllChanges = () => {\n    setMessages(prev => [...prev, {\n      text: `💾 כל השינויים נשמרו לגיליון ${fileName}`,\n      sender: 'system',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n  };\n  return /*#__PURE__*/_jsxDEV(ThemeProvider, {\n    theme: theme,\n    children: [/*#__PURE__*/_jsxDEV(CssBaseline, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1646,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        display: 'flex',\n        height: '100vh',\n        bgcolor: 'background.default',\n        overflow: 'hidden'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          background: `radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%), radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%)`,\n          pointerEvents: 'none',\n          zIndex: 0\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1651,\n        columnNumber: 9\n      }, this), !isMobile && /*#__PURE__*/_jsxDEV(Drawer, {\n        variant: \"permanent\",\n        sx: {\n          width: drawerWidth,\n          flexShrink: 0,\n          zIndex: 1,\n          '& .MuiDrawer-paper': {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            bgcolor: 'rgba(10, 10, 10, 0.98)',\n            borderRight: '1px solid rgba(139, 92, 246, 0.4)',\n            backdropFilter: 'blur(20px)'\n          }\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            sx: {\n              background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n              backgroundClip: 'text',\n              WebkitBackgroundClip: 'text',\n              WebkitTextFillColor: 'transparent',\n              fontWeight: 700\n            },\n            children: \"TLV500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1655,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            color: \"text.secondary\",\n            children: \"AI Assistant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1656,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1654,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1658,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: 2,\n              mb: 2\n            },\n            children: [/*#__PURE__*/_jsxDEV(Avatar, {\n              src: user === null || user === void 0 ? void 0 : user.profilePicture,\n              sx: {\n                width: 45,\n                height: 45,\n                background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)'\n              },\n              children: user !== null && user !== void 0 && user.name ? user.name.charAt(0) : /*#__PURE__*/_jsxDEV(Person, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1665,\n                columnNumber: 55\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1661,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flex: 1\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                fontWeight: 600,\n                children: (user === null || user === void 0 ? void 0 : user.name) || 'משתמש אורח'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1668,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"caption\",\n                color: \"text.secondary\",\n                children: (user === null || user === void 0 ? void 0 : user.email) || 'לא מחובר'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1671,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1667,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1660,\n            columnNumber: 15\n          }, this), accessToken && /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: handleLogout,\n            size: \"small\",\n            fullWidth: true,\n            sx: {\n              borderColor: 'rgba(239, 68, 68, 0.5)',\n              color: 'error.main',\n              '&:hover': {\n                borderColor: 'error.main',\n                bgcolor: 'rgba(239, 68, 68, 0.1)'\n              }\n            },\n            children: \"\\u05D4\\u05EA\\u05E0\\u05EA\\u05E7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1677,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1659,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1695,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            flexGrow: 1,\n            overflow: 'hidden'\n          },\n          children: /*#__PURE__*/_jsxDEV(ChatHistory, {\n            accessToken: accessToken,\n            onSessionSelect: handleSessionSelect,\n            currentSessionId: currentSessionId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1699,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1698,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1653,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          flexGrow: 1,\n          display: 'flex',\n          flexDirection: isMobile ? 'column' : 'row',\n          zIndex: 1,\n          height: '100vh',\n          overflow: 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            flex: isMobile ? '1 1 60%' : '0 0 65%',\n            p: 2,\n            display: 'flex',\n            flexDirection: 'column',\n            height: '100%',\n            overflow: 'hidden'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              mb: 2,\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              flexWrap: 'wrap',\n              gap: 2\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: 2\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                color: \"text.primary\",\n                children: fileName || 'לא נבחר גיליון'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1711,\n                columnNumber: 17\n              }, this), availableSheets.length > 0 && /*#__PURE__*/_jsxDEV(FormControl, {\n                size: \"small\",\n                sx: {\n                  minWidth: 200,\n                  '& .MuiOutlinedInput-notchedOutline': {\n                    borderColor: !isSheetSelected ? 'rgba(239, 68, 68, 0.7)' : 'rgba(139, 92, 246, 0.5)'\n                  },\n                  '& .MuiInputLabel-root': {\n                    color: !isSheetSelected ? 'error.main' : 'text.secondary'\n                  }\n                },\n                error: !isSheetSelected,\n                children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                  children: !isSheetSelected ? '🔴 בחר גליון (חובה)' : 'גליון נוכחי'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1726,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Select, {\n                  value: selectedSheetName || '',\n                  onChange: e => handleSheetChange(e.target.value),\n                  disabled: isLoadingSheets,\n                  children: availableSheets.map(sheet => /*#__PURE__*/_jsxDEV(MenuItem, {\n                    value: sheet.name,\n                    children: sheet.name\n                  }, sheet.id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1735,\n                    columnNumber: 25\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1729,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1713,\n                columnNumber: 19\n              }, this), isLoadingSheets && /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                sx: {\n                  color: 'primary.main'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1742,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1710,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                gap: 1\n              },\n              children: [!accessToken ? /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                href: API_URL,\n                children: \"\\u05D4\\u05EA\\u05D7\\u05D1\\u05E8 \\u05E2\\u05DD Google\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1746,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                onClick: createPicker,\n                disabled: !isPickerReady,\n                children: !isPickerReady ? 'טוען API...' : 'בחר גיליון מ-Drive'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1748,\n                columnNumber: 19\n              }, this), accessToken && /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                onClick: startNewChat,\n                sx: {\n                  minWidth: 'auto'\n                },\n                children: \"+ \\u05E9\\u05D9\\u05D7\\u05D4 \\u05D7\\u05D3\\u05E9\\u05D4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1753,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1744,\n              columnNumber: 15\n            }, this), changesCount > 0 && /*#__PURE__*/_jsxDEV(Chip, {\n              label: `${changesCount} שינויים לא שמורים`,\n              size: \"small\",\n              color: \"warning\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1758,\n              columnNumber: 36\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1759,\n                columnNumber: 54\n              }, this),\n              onClick: saveAllChanges,\n              color: \"primary\",\n              size: \"small\",\n              children: \"\\u05E9\\u05DE\\u05D5\\u05E8 \\u05D4\\u05DB\\u05DC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1759,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1709,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(15, 15, 15, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)',\n              position: 'relative'\n            },\n            children: [!isSheetLoaded && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 1,\n                textAlign: 'center',\n                mt: 2\n              },\n              children: /*#__PURE__*/_jsxDEV(TextField, {\n                placeholder: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1...\",\n                size: \"small\",\n                sx: {\n                  minWidth: 400\n                },\n                onKeyPress: async e => {\n                  if (e.key === 'Enter' && e.target.value) {\n                    await handleGoogleSheetsUrl(e.target.value);\n                    e.target.value = '';\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1768,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1767,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              ref: iframeContainerRef,\n              sx: {\n                flexGrow: 1,\n                border: '1px solid rgba(139, 92, 246, 0.4)',\n                borderRadius: 1,\n                bgcolor: 'rgba(5, 5, 5, 0.8)',\n                position: 'relative',\n                overflow: 'hidden',\n                m: 0.5,\n                // רווח מינימלי מהקצוות\n                // הגנה על Mac gestures\n                overscrollBehavior: 'contain',\n                touchAction: 'auto',\n                WebkitOverflowScrolling: 'touch'\n              },\n              onMouseEnter: () => setIsIframeHovered(true),\n              onMouseLeave: () => setIsIframeHovered(false),\n              children: [isSheetLoaded && isSheetSelected && (hasGreenCells || changesCount > 0) && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  top: '8px',\n                  right: '8px',\n                  display: 'flex',\n                  gap: '0px',\n                  zIndex: 1000,\n                  backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                  border: '1px solid rgba(255, 255, 255, 0.3)',\n                  borderRadius: '4px',\n                  padding: '2px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    approveAllChanges();\n                  },\n                  style: {\n                    backgroundColor: '#4caf50',\n                    color: 'white',\n                    border: '1px solid #2e7d32',\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: 'pointer',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n                  },\n                  title: \"\\u05D0\\u05E9\\u05E8 \\u05DB\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD\",\n                  onMouseEnter: e => {\n                    e.target.style.backgroundColor = '#45a049';\n                    e.target.style.transform = 'scale(1.05)';\n                    e.target.style.boxShadow = '0 4px 8px rgba(76, 175, 80, 0.4)';\n                    e.target.style.borderColor = '#4caf50';\n                    e.target.textContent = 'קבל הכל';\n                    e.target.style.fontSize = '0.6rem';\n                  },\n                  onMouseLeave: e => {\n                    e.target.style.backgroundColor = '#4caf50';\n                    e.target.style.transform = 'scale(1)';\n                    e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                    e.target.style.borderColor = '#2e7d32';\n                    e.target.textContent = `✓ (${changesCount || 0})`;\n                    e.target.style.fontSize = '0.65rem';\n                  },\n                  children: [\"\\u2713 (\", changesCount || 0, \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1819,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    rejectAllChanges();\n                  },\n                  style: {\n                    backgroundColor: '#f44336',\n                    color: 'white',\n                    border: '1px solid #c62828',\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: 'pointer',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n                  },\n                  title: \"\\u05D3\\u05D7\\u05D4 \\u05DB\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD\",\n                  onMouseEnter: e => {\n                    e.target.style.backgroundColor = '#d32f2f';\n                    e.target.style.transform = 'scale(1.05)';\n                    e.target.style.boxShadow = '0 4px 8px rgba(244, 67, 54, 0.4)';\n                    e.target.style.borderColor = '#f44336';\n                    e.target.textContent = 'דחה הכל';\n                    e.target.style.fontSize = '0.6rem';\n                  },\n                  onMouseLeave: e => {\n                    e.target.style.backgroundColor = '#f44336';\n                    e.target.style.transform = 'scale(1)';\n                    e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                    e.target.style.borderColor = '#c62828';\n                    e.target.textContent = `✕ (${changesCount || 0})`;\n                    e.target.style.fontSize = '0.65rem';\n                  },\n                  children: [\"\\u2715 (\", changesCount || 0, \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1862,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1806,\n                columnNumber: 19\n              }, this), isSheetLoaded && isSheetSelected && (canUndo || canRedo) && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  bottom: '8px',\n                  right: '8px',\n                  display: 'flex',\n                  gap: '0px',\n                  zIndex: 1000,\n                  backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                  border: '1px solid rgba(255, 255, 255, 0.3)',\n                  borderRadius: '4px',\n                  padding: '2px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    if (canUndo) undoAction();\n                  },\n                  style: {\n                    backgroundColor: canUndo ? '#2196f3' : '#666',\n                    color: 'white',\n                    border: `1px solid ${canUndo ? '#1976d2' : '#555'}`,\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: canUndo ? 'pointer' : 'not-allowed',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                    opacity: canUndo ? 1 : 0.5\n                  },\n                  title: \"\\u05D1\\u05D8\\u05DC \\u05E4\\u05E2\\u05D5\\u05DC\\u05D4\",\n                  onMouseEnter: e => {\n                    if (canUndo) {\n                      e.target.style.backgroundColor = '#1976d2';\n                      e.target.style.transform = 'scale(1.05)';\n                      e.target.style.boxShadow = '0 4px 8px rgba(33, 150, 243, 0.4)';\n                      e.target.style.borderColor = '#2196f3';\n                      e.target.textContent = 'בטל';\n                      e.target.style.fontSize = '0.6rem';\n                    }\n                  },\n                  onMouseLeave: e => {\n                    if (canUndo) {\n                      e.target.style.backgroundColor = '#2196f3';\n                      e.target.style.transform = 'scale(1)';\n                      e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                      e.target.style.borderColor = '#1976d2';\n                      e.target.textContent = '↩️';\n                      e.target.style.fontSize = '0.65rem';\n                    }\n                  },\n                  children: \"\\u21A9\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1921,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    if (canRedo) redoAction();\n                  },\n                  style: {\n                    backgroundColor: canRedo ? '#ff9800' : '#666',\n                    color: 'white',\n                    border: `1px solid ${canRedo ? '#f57c00' : '#555'}`,\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: canRedo ? 'pointer' : 'not-allowed',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                    opacity: canRedo ? 1 : 0.5\n                  },\n                  title: \"\\u05E9\\u05D7\\u05D6\\u05E8 \\u05E4\\u05E2\\u05D5\\u05DC\\u05D4\",\n                  onMouseEnter: e => {\n                    if (canRedo) {\n                      e.target.style.backgroundColor = '#f57c00';\n                      e.target.style.transform = 'scale(1.05)';\n                      e.target.style.boxShadow = '0 4px 8px rgba(255, 152, 0, 0.4)';\n                      e.target.style.borderColor = '#ff9800';\n                      e.target.textContent = 'שחזר';\n                      e.target.style.fontSize = '0.6rem';\n                    }\n                  },\n                  onMouseLeave: e => {\n                    if (canRedo) {\n                      e.target.style.backgroundColor = '#ff9800';\n                      e.target.style.transform = 'scale(1)';\n                      e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                      e.target.style.borderColor = '#f57c00';\n                      e.target.textContent = '⤴️';\n                      e.target.style.fontSize = '0.65rem';\n                    }\n                  },\n                  children: \"\\u2934\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1969,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1908,\n                columnNumber: 19\n              }, this), isSheetLoaded && isSheetSelected ? /*#__PURE__*/_jsxDEV(\"iframe\", {\n                src: getSheetUrlWithGid(googleSheetsUrl, selectedSheetName),\n                width: \"100%\",\n                height: \"100%\",\n                style: {\n                  border: 'none',\n                  borderRadius: '4px'\n                },\n                title: \"Google Sheets\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2019,\n                columnNumber: 19\n              }, this) : availableSheets.length > 0 && !isSheetSelected ? /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  height: '100%',\n                  color: 'text.secondary'\n                },\n                children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                  sx: {\n                    fontSize: 60,\n                    mb: 2,\n                    opacity: 0.5,\n                    color: 'error.main'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2022,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  gutterBottom: true,\n                  color: \"error.main\",\n                  children: \"\\u05D9\\u05E9 \\u05DC\\u05D1\\u05D7\\u05D5\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF \\u05EA\\u05D7\\u05D9\\u05DC\\u05D4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2023,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  textAlign: \"center\",\n                  sx: {\n                    maxWidth: 400\n                  },\n                  children: \"\\u05D1\\u05D7\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF \\u05DE\\u05D4\\u05E8\\u05E9\\u05D9\\u05DE\\u05D4 \\u05DC\\u05DE\\u05E2\\u05DC\\u05D4 \\u05DB\\u05D3\\u05D9 \\u05DC\\u05D4\\u05EA\\u05D7\\u05D9\\u05DC \\u05DC\\u05E2\\u05D1\\u05D5\\u05D3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2026,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2021,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  height: '100%',\n                  color: 'text.secondary'\n                },\n                children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                  sx: {\n                    fontSize: 60,\n                    mb: 2,\n                    opacity: 0.5\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2032,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  gutterBottom: true,\n                  children: \"\\u05D8\\u05E2\\u05DF \\u05D2\\u05D9\\u05DC\\u05D9\\u05D5\\u05DF \\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2033,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  textAlign: \"center\",\n                  sx: {\n                    maxWidth: 400\n                  },\n                  children: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1 \\u05D1\\u05E9\\u05D3\\u05D4 \\u05DC\\u05DE\\u05E2\\u05DC\\u05D4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2034,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2031,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1786,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1761,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1708,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            width: isMobile ? '100%' : '35%',\n            flex: isMobile ? '1 1 40%' : '0 0 35%',\n            p: 2,\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column'\n          },\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(25, 25, 25, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                children: \"\\u05E2\\u05D5\\u05D6\\u05E8 AI\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2043,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"text.secondary\",\n                children: \"\\u05DE\\u05D5\\u05DB\\u05DF \\u05DC\\u05E2\\u05D6\\u05D5\\u05E8 \\u05E2\\u05DD \\u05D4\\u05E0\\u05D9\\u05EA\\u05D5\\u05D7 \\u05E9\\u05DC\\u05DA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2044,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2042,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    gap: 1\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(Description, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2049,\n                      columnNumber: 77\n                    }, this),\n                    size: \"small\",\n                    disabled: isExtractingData,\n                    sx: {\n                      flex: 1,\n                      borderColor: 'rgba(139, 92, 246, 0.5)',\n                      '&.Mui-disabled': {\n                        color: 'text.secondary'\n                      }\n                    },\n                    children: [isExtractingData ? 'מעבד...' : 'PDF', /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".pdf\",\n                      onChange: e => handleFileUpload(e, 'PDF'),\n                      disabled: isExtractingData\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2051,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2049,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(TableChart, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2053,\n                      columnNumber: 77\n                    }, this),\n                    size: \"small\",\n                    disabled: isExtractingExcel,\n                    sx: {\n                      flex: 1,\n                      borderColor: 'rgba(139, 92, 246, 0.5)'\n                    },\n                    children: [isExtractingExcel ? 'מעבד...' : 'Excel', /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".xlsx,.xls,.csv\",\n                      onChange: e => handleFileUpload(e, 'Excel'),\n                      disabled: isExtractingExcel\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2055,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2053,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2048,\n                  columnNumber: 19\n                }, this), extractedPdf && /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    mt: 1,\n                    p: 1,\n                    bgcolor: extractedPdf.processingMode === 'simple_ocr' ? 'rgba(255, 193, 7, 0.1)' : 'rgba(139, 92, 246, 0.1)',\n                    borderRadius: 2,\n                    border: extractedPdf.processingMode === 'simple_ocr' ? '1px solid rgba(255, 193, 7, 0.3)' : '1px solid rgba(139, 92, 246, 0.3)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Description, {\n                    sx: {\n                      color: extractedPdf.processingMode === 'simple_ocr' ? 'warning.main' : 'primary.main',\n                      fontSize: 20\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2069,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    sx: {\n                      flex: 1,\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis'\n                    },\n                    children: [extractedPdf.name, extractedPdf.processingMode === 'simple_ocr' && ' 📑', extractedPdf.processingMode === 'structured' && ' 🔍']\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2073,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    onClick: () => {\n                      setExtractedPdf(null);\n                      localStorage.removeItem('extractedPdf');\n                      setMessages(prev => [...prev, {\n                        text: '📄 נתוני ה-PDF נוקו מההקשר.',\n                        sender: 'system',\n                        timestamp: new Date(),\n                        id: Date.now()\n                      }]);\n                    },\n                    sx: {\n                      color: 'error.main',\n                      minWidth: 'auto',\n                      p: 0.5\n                    },\n                    children: \"\\u2715\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2083,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2059,\n                  columnNumber: 21\n                }, this), extractedExcel && /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    mt: 1,\n                    p: 1,\n                    bgcolor: 'rgba(16, 185, 129, 0.1)',\n                    borderRadius: 2,\n                    border: '1px solid rgba(16, 185, 129, 0.3)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                    sx: {\n                      color: 'success.main',\n                      fontSize: 20\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2103,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    sx: {\n                      flex: 1,\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis'\n                    },\n                    children: extractedExcel.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2104,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    onClick: () => {\n                      setExtractedExcel(null);\n                      localStorage.removeItem('extractedExcel');\n                      setMessages(prev => [...prev, {\n                        text: '📊 נתוני ה-Excel נוקו מההקשר.',\n                        sender: 'system',\n                        timestamp: new Date(),\n                        id: Date.now()\n                      }]);\n                    },\n                    sx: {\n                      color: 'error.main',\n                      minWidth: 'auto',\n                      p: 0.5\n                    },\n                    children: \"\\u2715\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2105,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2102,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2047,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2046,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flexGrow: 1,\n                overflow: 'auto',\n                p: 2\n              },\n              children: [messages.map((msg, index) => /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 2\n                },\n                className: \"chat-message\",\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start',\n                    mb: 1\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    sx: {\n                      p: 1.5,\n                      maxWidth: '85%',\n                      background: msg.sender === 'user' ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' : 'rgba(35, 35, 35, 0.9)',\n                      color: 'white',\n                      borderRadius: 3\n                    },\n                    children: msg.isLoading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                      size: 16,\n                      color: \"inherit\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2121,\n                      columnNumber: 42\n                    }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n                      variant: \"body2\",\n                      className: \"chat-message-text\",\n                      sx: {\n                        whiteSpace: 'pre-wrap'\n                      },\n                      dangerouslySetInnerHTML: {\n                        __html: formatMixedText(msg.text)\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2122,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2114,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2113,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  color: \"text.secondary\",\n                  sx: {\n                    display: 'block',\n                    textAlign: msg.sender === 'user' ? 'right' : 'left',\n                    px: 1\n                  },\n                  children: msg.timestamp.toLocaleTimeString('he-IL', {\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  })\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2133,\n                  columnNumber: 21\n                }, this)]\n              }, msg.id || index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2112,\n                columnNumber: 19\n              }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n                ref: chatEndRef\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2138,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2110,\n              columnNumber: 15\n            }, this), isAnsweringQuestions && pendingChangePlan && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderTop: '1px solid rgba(139, 92, 246, 0.4)',\n                backgroundColor: 'rgba(139, 92, 246, 0.1)'\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                sx: {\n                  mb: 2,\n                  color: '#8b5cf6'\n                },\n                children: \"\\uD83E\\uDD14 \\u05E9\\u05D0\\u05DC\\u05D5\\u05EA \\u05D4\\u05D1\\u05D4\\u05E8\\u05D4 \\u05DC\\u05D1\\u05D9\\u05E6\\u05D5\\u05E2 \\u05D4\\u05EA\\u05D5\\u05DB\\u05E0\\u05D9\\u05EA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2144,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mb: 2,\n                  color: 'text.secondary'\n                },\n                children: \"\\u05D0\\u05E0\\u05D0 \\u05E2\\u05E0\\u05D4 \\u05E2\\u05DC \\u05DB\\u05DC 5 \\u05D4\\u05E9\\u05D0\\u05DC\\u05D5\\u05EA \\u05DC\\u05D1\\u05D9\\u05E6\\u05D5\\u05E2 \\u05DE\\u05D3\\u05D5\\u05D9\\u05E7 \\u05E9\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2147,\n                columnNumber: 19\n              }, this), pendingChangePlan.questions.map((question, index) => /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  sx: {\n                    mb: 1,\n                    fontWeight: 'bold'\n                  },\n                  children: [index + 1, \". \", question]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2153,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(TextField, {\n                  fullWidth: true,\n                  multiline: true,\n                  rows: 2,\n                  value: clarificationAnswers[index],\n                  onChange: e => {\n                    const newAnswers = [...clarificationAnswers];\n                    newAnswers[index] = e.target.value;\n                    setClarificationAnswers(newAnswers);\n                  },\n                  placeholder: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05EA\\u05E9\\u05D5\\u05D1\\u05D4...\",\n                  variant: \"outlined\",\n                  size: \"small\",\n                  sx: {\n                    '& .MuiOutlinedInput-root': {\n                      backgroundColor: 'rgba(255, 255, 255, 0.05)',\n                      '& fieldset': {\n                        borderColor: 'rgba(139, 92, 246, 0.3)'\n                      },\n                      '& textarea': {\n                        textAlign: 'right',\n                        direction: 'rtl'\n                      }\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2156,\n                  columnNumber: 23\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2152,\n                columnNumber: 21\n              }, this)), /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  gap: 1,\n                  mt: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  onClick: executeChangePlan,\n                  disabled: isStreamingResponse || clarificationAnswers.some(answer => !answer.trim()),\n                  sx: {\n                    bgcolor: '#8b5cf6',\n                    '&:hover': {\n                      bgcolor: '#7c3aed'\n                    },\n                    flex: 1\n                  },\n                  children: isStreamingResponse ? 'מבצע...' : 'בצע תוכנית'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2186,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outlined\",\n                  onClick: () => {\n                    setIsAnsweringQuestions(false);\n                    setPendingChangePlan(null);\n                    setClarificationAnswers(['', '', '', '', '']);\n                  },\n                  disabled: isStreamingResponse,\n                  sx: {\n                    borderColor: 'rgba(139, 92, 246, 0.5)'\n                  },\n                  children: \"\\u05D1\\u05D9\\u05D8\\u05D5\\u05DC\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2198,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2185,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2143,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderTop: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: [isAgentMode && isSheetLoaded && isSheetSelected && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 1,\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(Switch, {\n                  checked: isSignificantChange,\n                  onChange: e => setIsSignificantChange(e.target.checked),\n                  sx: {\n                    '& .MuiSwitch-switchBase.Mui-checked': {\n                      color: '#8B5CF6'\n                    },\n                    '& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track': {\n                      backgroundColor: '#8B5CF6'\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2218,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  sx: {\n                    color: isSignificantChange ? '#8B5CF6' : '#666'\n                  },\n                  children: isSignificantChange ? '🤔 שינוי משמעותי (עם הבהרות)' : '⚡ שינוי רגיל (מיידי)'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2230,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2217,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  gap: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(TextField, {\n                  fullWidth: true,\n                  variant: \"outlined\",\n                  placeholder: isAnsweringQuestions ? \"ענה על השאלות למעלה תחילה...\" : \"שאל אותי כל דבר... (Shift+Enter לשורה חדשה)\",\n                  value: question,\n                  onChange: e => setQuestion(e.target.value),\n                  onKeyPress: e => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault(); // Prevents adding a new line\n                      sendMessage();\n                    }\n                  },\n                  multiline: true,\n                  minRows: 2,\n                  maxRows: 5,\n                  disabled: isStreamingResponse || isAnsweringQuestions,\n                  className: \"hebrew-input\",\n                  sx: {\n                    '& .MuiOutlinedInput-root': {\n                      borderRadius: 3\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2237,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Fab, {\n                  color: \"primary\",\n                  onClick: sendMessage,\n                  size: \"small\",\n                  disabled: isStreamingResponse || isAnsweringQuestions,\n                  children: /*#__PURE__*/_jsxDEV(Send, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2266,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2260,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2236,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(FormControlLabel, {\n                control: /*#__PURE__*/_jsxDEV(Switch, {\n                  checked: isAgentMode,\n                  onChange: e => setIsAgentMode(e.target.checked),\n                  disabled: !googleSheetsUrl || !isSheetSelected\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2271,\n                  columnNumber: 21\n                }, this),\n                label: `Agent Mode: Allow Sheet Editing ${!isSheetSelected ? '(בחר גליון תחילה)' : ''}`,\n                sx: {\n                  color: !googleSheetsUrl || !isSheetSelected ? 'text.disabled' : 'text.secondary',\n                  mt: 1,\n                  mr: 0\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2269,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2214,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2041,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2040,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1707,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n        open: showSnackbar,\n        autoHideDuration: 6000,\n        onClose: () => setShowSnackbar(false),\n        anchorOrigin: {\n          vertical: 'bottom',\n          horizontal: 'center'\n        },\n        sx: {\n          bottom: {\n            xs: 90,\n            sm: 24\n          }\n        },\n        children: /*#__PURE__*/_jsxDEV(Alert, {\n          onClose: () => setShowSnackbar(false),\n          severity: authError ? \"error\" : \"success\",\n          sx: {\n            width: '100%',\n            bgcolor: '#2E2E2E',\n            color: 'white'\n          },\n          children: snackbarMessage || authError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2289,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2288,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1650,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1645,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"+en/9kMHFvvbHmLXUkmOGkXcQv4=\", false, function () {\n  return [useTheme, useMediaQuery];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Box","Drawer","Typography","Paper","TextField","Button","Avatar","Divider","Chip","Fab","useMediaQuery","useTheme","CircularProgress","Alert","Snackbar","CssBaseline","FormControl","InputLabel","Select","MenuItem","Switch","FormControlLabel","Send","Person","Description","TableChart","Save","createTheme","ThemeProvider","ChatHistory","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","theme","palette","mode","primary","main","secondary","background","default","paper","text","success","error","warning","typography","fontFamily","h4","fontWeight","h6","components","MuiButton","styleOverrides","root","borderRadius","textTransform","padding","contained","boxShadow","transform","MuiPaper","backdropFilter","border","drawerWidth","formatMixedText","englishPattern","replace","match","App","_s","muiTheme","isMobile","breakpoints","down","messages","setMessages","sender","timestamp","Date","id","now","question","setQuestion","fileName","setFileName","googleSheetsUrl","setGoogleSheetsUrl","changesCount","setChangesCount","isSheetLoaded","setIsSheetLoaded","isPickerReady","setIsPickerReady","accessToken","setAccessToken","sheetsMetadata","setSheetsMetadata","authError","setAuthError","showSnackbar","setShowSnackbar","snackbarMessage","setSnackbarMessage","availableSheets","setAvailableSheets","selectedSheetName","setSelectedSheetName","isLoadingSheets","setIsLoadingSheets","extractedPdf","setExtractedPdf","isExtractingData","setIsExtractingData","extractedExcel","setExtractedExcel","isExtractingExcel","setIsExtractingExcel","isAgentMode","setIsAgentMode","isStreamingResponse","setIsStreamingResponse","isSheetSelected","setIsSheetSelected","isIframeHovered","setIsIframeHovered","canUndo","setCanUndo","canRedo","setCanRedo","hasGreenCells","setHasGreenCells","isCheckingGreenCells","setIsCheckingGreenCells","currentSessionId","setCurrentSessionId","user","setUser","chatEndRef","iframeContainerRef","sheetAnalysis","setSheetAnalysis","sheetInstructions","setSheetInstructions","pendingChangePlan","setPendingChangePlan","clarificationAnswers","setClarificationAnswers","isAnsweringQuestions","setIsAnsweringQuestions","isSignificantChange","setIsSignificantChange","sessionId","setSessionId","toString","Math","random","substring","extractQuestionsFromResponse","response","console","log","questionSection","split","questions","questionMatches","forEach","trim","length","push","lines","line","slice","executeChangePlan","some","answer","loadingMessageId","prev","isLoading","sheetData","getSheetData","extractSpreadsheetId","spreadsheetId","payload","planId","fetch","method","headers","credentials","body","JSON","stringify","ok","errorText","Error","status","reader","getReader","decoder","TextDecoder","accumulatedResponse","value","done","read","decode","stream","map","m","setTimeout","iframe","document","querySelector","src","message","savedToken","localStorage","getItem","savedPdfJson","savedPdf","parse","name","data","fileId","then","removeItem","catch","e","savedExcelJson","savedExcel","fetchUserInfo","params","URLSearchParams","window","location","search","token","get","setItem","history","replaceState","title","checkAuthStatus","json","_chatEndRef$current","current","scrollIntoView","behavior","script","createElement","onload","gapi","load","callback","head","appendChild","handleWheel","abs","deltaX","deltaY","preventDefault","stopPropagation","handleTouchStart","handleTouchMove","addEventListener","passive","removeEventListener","timer","checkUndoRedoStatus","checkForGreenCells","clearTimeout","handleSessionSelect","chatHistory","loadedMessages","msg","content","role","_id","generateSessionId","substr","makeGoogleSheetsAPICall","range","values","valueRenderOption","baseUrl","_data$error","url","options","combineValuesAndFormulas","formulas","combined","row","max","valueRow","formulaRow","combinedRow","col","formula","startsWith","type","finalValue","analyzeSheetWithGemini","sheetName","currentExtractedPdf","_result$summary","_result$instructions","analysisType","result","summary","instructions","getSheetUrlWithGid","selectedSheet","find","sheet","cleanUrl","getSpreadsheetMetadata","metadata","sheets","properties","sheetId","handleFileUpload","event","fileType","file","target","files","filter","includes","formData","FormData","append","currentSheetData","hasSheetData","sheetDataLength","hasInstructions","instructionsLength","hasAnalysis","analysisLength","err","pdfInfo","processingMode","isFullText","successMessage","finally","shouldConvert","confirm","sheetUrl","spreadsheetUrl","open","handleGoogleSheetsUrl","excelInfo","loadAvailableSheets","handleSheetChange","newSheetName","analysisResult","reanalyzePdfWithSheetContext","pdfResponse","pdfBlob","blob","updatedPdfInfo","pickerCallback","action","google","picker","Action","PICKED","doc","docs","createPicker","developerKey","REACT_APP_GEMINI_API_KEY","clientId","REACT_APP_GOOGLE_CLIENT_ID","view","View","ViewId","SPREADSHEETS","setMimeTypes","PickerBuilder","setAppId","setOAuthToken","setDeveloperKey","addView","setCallback","build","setVisible","_valuesResponse$value","_formulasResponse$val","_valuesResponse$value2","_formulasResponse$val2","valuesResponse","formulasResponse","combinedData","formulaCount","flat","cell","stack","startNewChat","handleLogout","hasChanges","approveAllChanges","_googleSheetsUrl$matc","_availableSheets$find","s","rejectAllChanges","_googleSheetsUrl$matc2","_availableSheets$find2","undoAction","redoAction","sendMessage","currentQuestion","userMessage","extractedPdfData","extractedExcelData","conversationHistory","parts","currentResponse","isChangePlanResponse","planIdMatch","questionLower","toLowerCase","undoRedoKeywords","keyword","isError","saveAllChanges","children","_jsxFileName","lineNumber","columnNumber","sx","display","height","bgcolor","overflow","position","top","left","right","bottom","pointerEvents","zIndex","variant","width","flexShrink","boxSizing","borderRight","p","backgroundClip","WebkitBackgroundClip","WebkitTextFillColor","color","borderColor","alignItems","gap","mb","profilePicture","charAt","flex","email","onClick","size","fullWidth","flexGrow","onSessionSelect","flexDirection","justifyContent","flexWrap","minWidth","onChange","disabled","href","label","startIcon","textAlign","mt","placeholder","onKeyPress","key","ref","overscrollBehavior","touchAction","WebkitOverflowScrolling","onMouseEnter","onMouseLeave","style","backgroundColor","fontSize","cursor","userSelect","transition","textContent","opacity","gutterBottom","maxWidth","borderBottom","component","hidden","accept","whiteSpace","textOverflow","index","className","dangerouslySetInnerHTML","__html","px","toLocaleTimeString","hour","minute","borderTop","multiline","rows","newAnswers","direction","checked","shiftKey","minRows","maxRows","control","mr","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","xs","sm","severity","_c","$RefreshReg$"],"sources":["/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Drawer,\r\n  Typography,\r\n  Paper,\r\n  TextField,\r\n  Button,\r\n  Avatar,\r\n  Divider,\r\n  Chip,\r\n  Fab,\r\n  useMediaQuery,\r\n  useTheme,\r\n  CircularProgress,\r\n  Alert,\r\n  Snackbar,\r\n  CssBaseline,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  Switch,\r\n  FormControlLabel\r\n} from '@mui/material';\r\nimport {\r\n  Send,\r\n  Person,\r\n  Description,\r\n  TableChart,\r\n  Save\r\n} from '@mui/icons-material';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\nimport ChatHistory from './components/ChatHistory';\r\nimport './App.css';\r\n\r\n// API URL configuration\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    mode: 'dark',\r\n    primary: { main: '#8B5CF6' },\r\n    secondary: { main: '#6366F1' },\r\n    background: { default: '#000000', paper: '#0A0A0A' },\r\n    text: { primary: '#FFFFFF', secondary: '#E5E7EB' },\r\n    success: { main: '#10B981' },\r\n    error: { main: '#EF4444' },\r\n    warning: { main: '#FFC107' }\r\n  },\r\n  typography: {\r\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\r\n    h4: { fontWeight: 700 },\r\n    h6: { fontWeight: 600 }\r\n  },\r\n  components: {\r\n    MuiButton: {\r\n      styleOverrides: {\r\n        root: { borderRadius: 12, textTransform: 'none', fontWeight: 600, padding: '10px 20px' },\r\n        contained: {\r\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\r\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\r\n          '&:hover': {\r\n            transform: 'translateY(-1px)',\r\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\r\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)',\r\n          }\r\n        },\r\n      },\r\n    },\r\n    MuiPaper: {\r\n      styleOverrides: {\r\n        root: {\r\n          background: 'rgba(20, 20, 20, 0.95)',\r\n          backdropFilter: 'blur(20px)',\r\n          border: '1px solid rgba(139, 92, 246, 0.3)',\r\n          borderRadius: 16,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nconst drawerWidth = 280;\r\n\r\n// Function to handle mixed Hebrew-English text\r\nconst formatMixedText = (text) => {\r\n  if (!text) return text;\r\n  \r\n  // Simple regex to detect English words/phrases\r\n  const englishPattern = /([a-zA-Z0-9]+(?:\\s+[a-zA-Z0-9]+)*)/g;\r\n  \r\n  return text.replace(englishPattern, (match) => {\r\n    // If it's a common English term in Hebrew context, wrap it\r\n    return `<span class=\"english-term\" dir=\"ltr\">${match}</span>`;\r\n  });\r\n};\r\n\r\nfunction App() {\r\n  const muiTheme = useTheme();\r\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\r\n  \r\n  const [messages, setMessages] = useState([\r\n    { text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }\r\n  ]);\r\n  const [question, setQuestion] = useState('');\r\n  const [fileName, setFileName] = useState('');\r\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\r\n  const [changesCount, setChangesCount] = useState(0);\r\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\r\n\r\n  const [isPickerReady, setIsPickerReady] = useState(false);\r\n  const [accessToken, setAccessToken] = useState('');\r\n  const [sheetsMetadata, setSheetsMetadata] = useState('');\r\n  const [authError, setAuthError] = useState('');\r\n  const [showSnackbar, setShowSnackbar] = useState(false);\r\n  const [snackbarMessage, setSnackbarMessage] = useState('');\r\n  const [availableSheets, setAvailableSheets] = useState([]);\r\n  const [selectedSheetName, setSelectedSheetName] = useState('');\r\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\r\n  const [extractedPdf, setExtractedPdf] = useState(null);\r\n  const [isExtractingData, setIsExtractingData] = useState(false);\r\n  const [extractedExcel, setExtractedExcel] = useState(null);\r\n  const [isExtractingExcel, setIsExtractingExcel] = useState(false);\r\n  const [isAgentMode, setIsAgentMode] = useState(false);\r\n  const [isStreamingResponse, setIsStreamingResponse] = useState(false);\r\n  const [isSheetSelected, setIsSheetSelected] = useState(false);\r\n  const [isIframeHovered, setIsIframeHovered] = useState(false);\r\n  \r\n  // 🔄 Undo/Redo State\r\n  const [canUndo, setCanUndo] = useState(false);\r\n  const [canRedo, setCanRedo] = useState(false);\r\n  const [hasGreenCells, setHasGreenCells] = useState(false);\r\n  const [isCheckingGreenCells, setIsCheckingGreenCells] = useState(false);\r\n  \r\n  // Chat History Management\r\n  const [currentSessionId, setCurrentSessionId] = useState(null);\r\n  const [user, setUser] = useState(null);\r\n  \r\n  const chatEndRef = useRef(null);\r\n  const iframeContainerRef = useRef(null);\r\n\r\n  // 🔥 State חדש לניתוח הגליון עם Gemini\r\n  const [sheetAnalysis, setSheetAnalysis] = useState(null);\r\n  const [sheetInstructions, setSheetInstructions] = useState(null);\r\n  \r\n  // 🔥 State חדש לתוכניות שינויים מורכבות\r\n  const [pendingChangePlan, setPendingChangePlan] = useState(null);\r\n  const [clarificationAnswers, setClarificationAnswers] = useState(['', '', '', '', '']);\r\n  const [isAnsweringQuestions, setIsAnsweringQuestions] = useState(false);\r\n  \r\n  // 🎚️ State חדש לבחירת מצב שינוי משמעותי\r\n  const [isSignificantChange, setIsSignificantChange] = useState(false);\r\n  \r\n  // 🔑 Session ID for backend session storage\r\n  const [sessionId, setSessionId] = useState(() => {\r\n    return Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15);\r\n  });\r\n\r\n  // Helper function to extract questions from change plan response\r\n  const extractQuestionsFromResponse = (response) => {\r\n    console.log('Extracting questions from response:', response);\r\n    const questionSection = response.split('🤔 שאלות הבהרה')[1];\r\n    if (!questionSection) {\r\n      console.log('No question section found');\r\n      return [];\r\n    }\r\n    \r\n    console.log('Question section found:', questionSection);\r\n    \r\n    const questions = [];\r\n    // Pattern matches \"**1.** question text\"\r\n    const questionMatches = questionSection.match(/\\*\\*\\d+\\.\\*\\*\\s*([^\\n*]+)/g);\r\n    \r\n    if (questionMatches) {\r\n      console.log('Raw question matches:', questionMatches);\r\n      questionMatches.forEach(match => {\r\n        const question = match.replace(/\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\r\n        if (question && question.length > 5) {\r\n          questions.push(question);\r\n        }\r\n      });\r\n    } else {\r\n      console.log('No question matches found, trying alternative pattern');\r\n      // Alternative: look for lines that start with numbers\r\n      const lines = questionSection.split('\\n');\r\n      for (let line of lines) {\r\n        line = line.trim();\r\n        if (line.match(/^\\*\\*\\d+\\.\\*\\*/)) {\r\n          const question = line.replace(/^\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\r\n          if (question && question.length > 5) {\r\n            questions.push(question);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    console.log('Frontend extracted questions:', questions);\r\n    return questions.slice(0, 5); // Ensure max 5 questions\r\n  };\r\n\r\n  // Function to execute change plan with clarification answers\r\n  const executeChangePlan = async () => {\r\n    if (!pendingChangePlan || clarificationAnswers.some(answer => !answer.trim())) {\r\n      setSnackbarMessage('❌ יש לענות על כל 5 השאלות');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n\r\n    setIsStreamingResponse(true);\r\n    const loadingMessageId = Date.now();\r\n    setMessages(prev => [...prev, { \r\n      text: '', \r\n      sender: 'assistant', \r\n      isLoading: true, \r\n      timestamp: new Date(), \r\n      id: loadingMessageId \r\n    }]);\r\n\r\n    try {\r\n      const sheetData = (isSheetLoaded && isSheetSelected) ? \r\n        await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\r\n      const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\r\n\r\n      const payload = {\r\n        planId: pendingChangePlan.id,\r\n        clarificationAnswers: clarificationAnswers,\r\n        spreadsheetId: spreadsheetId,\r\n        accessToken: accessToken,\r\n        sheetsMetadata: sheetsMetadata,\r\n        selectedSheetName: selectedSheetName\r\n      };\r\n\r\n      const response = await fetch(`${API_URL}/api/execute-change-plan`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw new Error(`Server error: ${response.status} ${errorText}`);\r\n      }\r\n\r\n      const reader = response.body.getReader();\r\n      const decoder = new TextDecoder();\r\n      let accumulatedResponse = '';\r\n\r\n      while (true) {\r\n        const { value, done } = await reader.read();\r\n        if (done) break;\r\n        \r\n        accumulatedResponse += decoder.decode(value, { stream: true });\r\n\r\n        setMessages(prev => prev.map(m => {\r\n          if (m.id === loadingMessageId) {\r\n            return { ...m, text: accumulatedResponse, isLoading: true };\r\n          }\r\n          return m;\r\n        }));\r\n      }\r\n\r\n      // Final processing\r\n      setMessages(prev => prev.map(m =>\r\n        m.id === loadingMessageId\r\n        ? { ...m, text: accumulatedResponse, isLoading: false }\r\n        : m\r\n      ));\r\n\r\n      // Reset change plan state\r\n      setPendingChangePlan(null);\r\n      setIsAnsweringQuestions(false);\r\n      setClarificationAnswers(['', '', '', '', '']);\r\n\r\n      // Refresh the sheet if needed\r\n      if (googleSheetsUrl && selectedSheetName) {\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 1000);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error executing change plan:', error);\r\n      setMessages(prev => prev.map(m =>\r\n        m.id === loadingMessageId\r\n        ? { ...m, text: `❌ שגיאה בביצוע התוכנית: ${error.message}`, isLoading: false }\r\n        : m\r\n      ));\r\n    } finally {\r\n      setIsStreamingResponse(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Load saved access token ONLY - no chat messages from localStorage\r\n    const savedToken = localStorage.getItem('accessToken');\r\n    if (savedToken) {\r\n      setAccessToken(savedToken);\r\n    }\r\n\r\n    // Only load PDF/Excel data from localStorage (temporary files, not chat history)\r\n    const savedPdfJson = localStorage.getItem('extractedPdf');\r\n    if (savedPdfJson) {\r\n      try {\r\n        const savedPdf = JSON.parse(savedPdfJson);\r\n        if (savedPdf && savedPdf.name && savedPdf.data) {\r\n          // Check if PDF still exists on server if it has a fileId\r\n          if (savedPdf.fileId) {\r\n            fetch(`${API_URL}/api/download-pdf/${savedPdf.fileId}`, {\r\n              method: 'HEAD',\r\n              credentials: 'include'\r\n            }).then(response => {\r\n              if (response.ok) {\r\n                setExtractedPdf(savedPdf);\r\n                setMessages(prev => [...prev, { text: `📄 נתונים קודמים שחולצו מ-PDF \"${savedPdf.name}\" נטענו.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n              } else {\r\n                // PDF no longer exists on server\r\n                console.log('📄 PDF from localStorage no longer exists on server, removing...');\r\n                localStorage.removeItem('extractedPdf');\r\n              }\r\n            }).catch(() => {\r\n              // Error checking PDF, remove from localStorage\r\n              localStorage.removeItem('extractedPdf');\r\n            });\r\n          } else {\r\n            // Old PDF without fileId, just load it\r\n            setExtractedPdf(savedPdf);\r\n            setMessages(prev => [...prev, { text: `📄 נתונים קודמים שחולצו מ-PDF \"${savedPdf.name}\" נטענו.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to parse extracted PDF data from localStorage', e);\r\n        localStorage.removeItem('extractedPdf');\r\n      }\r\n    }\r\n\r\n    const savedExcelJson = localStorage.getItem('extractedExcel');\r\n    if (savedExcelJson) {\r\n        try {\r\n            const savedExcel = JSON.parse(savedExcelJson);\r\n            if (savedExcel && savedExcel.name && savedExcel.data) {\r\n                setExtractedExcel(savedExcel);\r\n                setMessages(prev => [...prev, { text: `📊 נתונים קודמים שחולצו מ-Excel \"${savedExcel.name}\" נטענו.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to parse extracted Excel data from localStorage', e);\r\n            localStorage.removeItem('extractedExcel');\r\n        }\r\n    }\r\n  }, []);\r\n\r\n  // Fetch user info when access token is available\r\n  useEffect(() => {\r\n    if (accessToken) {\r\n      fetchUserInfo();\r\n    }\r\n  }, [accessToken]);\r\n\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const token = params.get('token');\r\n    if (token) {\r\n      setAccessToken(token);\r\n      localStorage.setItem('accessToken', token);\r\n      setSnackbarMessage('התחברת בהצלחה!');\r\n      setShowSnackbar(true);\r\n      window.history.replaceState({}, document.title, \"/\");\r\n    } else {\r\n      // Check if user is already authenticated\r\n      checkAuthStatus();\r\n    }\r\n  }, []);\r\n\r\n  const checkAuthStatus = async () => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/api/user`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUser(data.user);\r\n        if (data.accessToken) {\r\n          setAccessToken(data.accessToken);\r\n          localStorage.setItem('accessToken', data.accessToken);\r\n        }\r\n        setSnackbarMessage('ברוך הבא בחזרה!');\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.log('Not authenticated:', error);\r\n      // User is not authenticated, show login button\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    const script = document.createElement('script');\r\n    script.src = 'https://apis.google.com/js/api.js';\r\n    script.onload = () => window.gapi.load('picker', { 'callback': () => setIsPickerReady(true) });\r\n    document.head.appendChild(script);\r\n  }, []);\r\n\r\n  // ניהול גלילה עבור iframe - הגנה מיוחדת על Mac gestures\r\n  useEffect(() => {\r\n    const handleWheel = (e) => {\r\n      if (isIframeHovered) {\r\n        // הגנה ספציפית על horizontal scrolling במאק\r\n        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n          // זה גלילה אופקית - בלוק את הnavigation gesture\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleTouchStart = (e) => {\r\n      if (isIframeHovered) {\r\n        e.stopPropagation();\r\n      }\r\n    };\r\n\r\n    const handleTouchMove = (e) => {\r\n      if (isIframeHovered) {\r\n        e.stopPropagation();\r\n      }\r\n    };\r\n\r\n    // הוסף event listeners עם focus על gestures\r\n    document.addEventListener('wheel', handleWheel, { passive: false });\r\n    document.addEventListener('touchstart', handleTouchStart, { passive: false });\r\n    document.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n\r\n    return () => {\r\n      document.removeEventListener('wheel', handleWheel);\r\n      document.removeEventListener('touchstart', handleTouchStart);\r\n      document.removeEventListener('touchmove', handleTouchMove);\r\n    };\r\n  }, [isIframeHovered]);\r\n\r\n  // בדיקת סטטוס אוטומטית כשגליון נבחר\r\n  useEffect(() => {\r\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\r\n      // Auto-check status when sheet is selected\r\n      // בדיקה אוטומטית אחרי טעינת הגליון\r\n      const timer = setTimeout(() => {\r\n        checkUndoRedoStatus();\r\n        checkForGreenCells();\r\n      }, 2000);\r\n      \r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [selectedSheetName, isSheetSelected, currentSessionId]);\r\n\r\n  const fetchUserInfo = async () => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/api/user`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUser(data.user);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching user info:', error);\r\n    }\r\n  };\r\n\r\n  const handleSessionSelect = async (sessionId) => {\r\n    if (!sessionId) {\r\n      setCurrentSessionId(null);\r\n      setMessages([{ text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n      return;\r\n    }\r\n\r\n    setCurrentSessionId(sessionId);\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/chat/session/${sessionId}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const chatHistory = await response.json();\r\n        const loadedMessages = chatHistory.messages.map(msg => ({\r\n          text: msg.content,\r\n          sender: msg.role === 'user' ? 'user' : 'assistant',\r\n          timestamp: new Date(msg.timestamp),\r\n          id: msg._id || Date.now() + Math.random()\r\n        }));\r\n        \r\n        setMessages(loadedMessages);\r\n        // Chat history loaded\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading chat session:', error);\r\n      setSnackbarMessage('שגיאה בטעינת השיחה');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const generateSessionId = () => {\r\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n  };\r\n\r\n\r\n\r\n\r\n  \r\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET', valueRenderOption = 'FORMATTED_VALUE') => {\r\n    if (!accessToken) throw new Error('No access token available. Please log in.');\r\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n    try {\r\n      let url, options;\r\n      if (method === 'GET') {\r\n        // 🔥 הוסף את valueRenderOption לקריאות GET\r\n        const params = new URLSearchParams({ valueRenderOption });\r\n        url = `${baseUrl}/values/${range}?${params}`;\r\n        console.log('🔥 Google Sheets API call:', url);\r\n        options = { method, headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' }};\r\n      } else {\r\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\r\n        options = { method, headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' }, body: JSON.stringify({ values }) };\r\n      }\r\n      const response = await fetch(url, options);\r\n      const data = await response.json();\r\n      if (!response.ok) throw new Error(data.error?.message || 'API call failed');\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Google Sheets API error:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // 🔥 פונקציה חדשה לשילוב ערכים ונוסחאות\r\n  const combineValuesAndFormulas = (values, formulas) => {\r\n    const combined = [];\r\n    \r\n    console.log('🔥 Starting combineValuesAndFormulas...');\r\n    console.log('📊 Values:', values?.length || 0, 'rows');\r\n    console.log('📋 Formulas:', formulas?.length || 0, 'rows');\r\n    \r\n    for (let row = 0; row < Math.max(values.length, formulas.length); row++) {\r\n      const valueRow = values[row] || [];\r\n      const formulaRow = formulas[row] || [];\r\n      const combinedRow = [];\r\n      \r\n      for (let col = 0; col < Math.max(valueRow.length, formulaRow.length); col++) {\r\n        const value = valueRow[col] || '';\r\n        const formula = formulaRow[col] || '';\r\n        \r\n        // 🔥 לוג לבדיקה (רק לשורה ראשונה)\r\n        if (row === 0 && col < 3) {\r\n          console.log(`Cell [${row},${col}]: value=\"${value}\" (${typeof value}), formula=\"${formula}\" (${typeof formula})`);\r\n        }\r\n        \r\n        // 🔥 תיקון: בדוק שזה string ומתחיל ב-= לפני שמגדירים כנוסחה\r\n        if (typeof formula === 'string' && formula.length > 0 && formula.startsWith('=')) {\r\n          // זו נוסחה אמיתית\r\n          combinedRow.push({\r\n            value: value,\r\n            formula: formula,\r\n            type: 'formula'\r\n          });\r\n        } else {\r\n          // זה ערך רגיל (לא נוסחה) - קח את הערך או את מה שיש בformula אם הערך ריק\r\n          const finalValue = value !== '' ? value : (formula !== '' ? formula : '');\r\n          combinedRow.push({\r\n            value: finalValue,\r\n            type: 'literal'\r\n          });\r\n        }\r\n      }\r\n      combined.push(combinedRow);\r\n    }\r\n    \r\n    console.log('🔥 Combined values and formulas:', combined.slice(0, 2)); // רק 2 שורות ראשונות\r\n    return combined;\r\n  };\r\n\r\n  // 🔥 פונקציה חדשה לניתוח הגליון עם Gemini\r\n  const analyzeSheetWithGemini = async (sheetData, sheetName, currentExtractedPdf = null) => {\r\n    try {\r\n      setMessages(prev => [...prev, { \r\n        text: `🔍 מנתח את מבנה הגליון \"${sheetName}\" עם AI...`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n\r\n      const payload = {\r\n        sheetData: sheetData,\r\n        sheetName: sheetName,\r\n        sessionId: sessionId,\r\n        analysisType: 'initial_analysis'\r\n      };\r\n\r\n      const response = await fetch(`${API_URL}/api/analyze-sheet`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      \r\n      // שמור את התוצאות\r\n      setSheetAnalysis(result.summary);\r\n      setSheetInstructions(result.instructions); // שמור את ההוראות שחזרו מהבקאנד\r\n\r\n      // הצג את הסיכום למשתמש\r\n      setMessages(prev => [...prev, { \r\n        text: `📊 ניתוח הגליון:\\n${result.summary}`, \r\n        sender: 'assistant', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n\r\n      console.log('🔥 Sheet analysis completed:', result);\r\n      console.log('📝 Sheet summary saved:', result.summary?.length, 'characters');\r\n      console.log('📋 Sheet instructions saved:', result.instructions?.length, 'characters');\r\n\r\n      // הודעה קצרה שההוראות נשמרו\r\n      setTimeout(() => {\r\n        setMessages(prev => [...prev, { \r\n          text: `✅ הוראות עבודה מפורטות נשמרו למערכת עבור שיחות עתידיות`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      }, 1000);\r\n\r\n      // Return the analysis results for use in handleSheetChange\r\n      return {\r\n        instructions: result.instructions,\r\n        summary: result.summary\r\n      };\r\n\r\n    } catch (error) {\r\n      console.error('Error analyzing sheet:', error);\r\n      setMessages(prev => [...prev, { \r\n        text: `❌ שגיאה בניתוח הגליון: ${error.message}`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n    }\r\n  };\r\n\r\n  const extractSpreadsheetId = (url) => {\r\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\r\n    return match ? match[1] : null;\r\n  };\r\n  \r\n  // פונקציה ליצור URL עם הגליון הנכון\r\n  const getSheetUrlWithGid = (baseUrl, sheetName) => {\r\n    if (!sheetName || !sheetsMetadata) return baseUrl;\r\n    \r\n    const selectedSheet = sheetsMetadata.find(sheet => sheet.name === sheetName);\r\n    if (!selectedSheet) return baseUrl;\r\n    \r\n    // הסר כל gid קיים מה-URL\r\n    const cleanUrl = baseUrl.split('#')[0];\r\n    \r\n    // הוסף את ה-gid החדש\r\n    return `${cleanUrl}#gid=${selectedSheet.id}`;\r\n  };\r\n\r\n  const getSpreadsheetMetadata = async (spreadsheetId) => {\r\n    if (!accessToken) return [];\r\n    try {\r\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n      const response = await fetch(url, { headers: { 'Authorization': `Bearer ${accessToken}` } });\r\n      if (!response.ok) throw new Error('Failed to fetch spreadsheet metadata');\r\n      const metadata = await response.json();\r\n      return metadata.sheets.map(sheet => ({ name: sheet.properties.title, id: sheet.properties.sheetId }));\r\n    } catch (error) {\r\n      console.error('Error fetching spreadsheet metadata:', error);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (event, fileType) => {\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n\r\n    if (file.type === 'application/pdf') {\r\n        // Clean all previous PDF-related state\r\n        setExtractedPdf(null);\r\n        localStorage.removeItem('extractedPdf');\r\n        setIsExtractingData(true);\r\n        \r\n        // Remove any previous PDF-related messages\r\n        setMessages(prev => prev.filter(msg => \r\n            !msg.text.includes('נתונים חולצו') && \r\n            !msg.text.includes('שגיאה בחילוץ') &&\r\n            !msg.text.includes('נתוני ה-PDF נוקו')\r\n        ));\r\n        \r\n        setMessages(prev => [...prev, { text: `⏳ מחלץ נתונים מקובץ \"${file.name}\"...`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        \r\n        const formData = new FormData();\r\n        formData.append('pdf', file);\r\n        \r\n        // 🔥 אם יש גליון טעון, שלוף את הנתונים ושלח אותם\r\n        if (isSheetLoaded && isSheetSelected) {\r\n          const currentSheetData = await getSheetData(\r\n            extractSpreadsheetId(googleSheetsUrl), \r\n            selectedSheetName\r\n          );\r\n          \r\n          if (currentSheetData) {\r\n            formData.append('sheetData', JSON.stringify(currentSheetData));\r\n          }\r\n          if (sheetInstructions) {\r\n            formData.append('sheetInstructions', sheetInstructions);\r\n          }\r\n          if (sheetAnalysis) {\r\n            formData.append('sheetAnalysis', sheetAnalysis);\r\n          }\r\n          if (selectedSheetName) {\r\n            formData.append('sheetName', selectedSheetName);\r\n          }\r\n          \r\n          console.log('🔥 Sending PDF with full sheet context:', {\r\n            hasSheetData: !!currentSheetData,\r\n            sheetDataLength: currentSheetData ? currentSheetData.length : 0,\r\n            hasInstructions: !!sheetInstructions,\r\n            instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\r\n            hasAnalysis: !!sheetAnalysis,\r\n            analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\r\n            sheetName: selectedSheetName\r\n          });\r\n        } else {\r\n          console.log('🔥 Sending PDF without sheet context (simple OCR mode)');\r\n        }\r\n\r\n        fetch(`${API_URL}/api/extract-pdf-data`, {\r\n            method: 'POST', \r\n            body: formData,\r\n            credentials: 'include'\r\n        })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                return response.json().then(err => { throw new Error(err.error || 'Failed to extract data') });\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(result => {\r\n            const pdfInfo = { \r\n                name: file.name, \r\n                data: result,\r\n                fileId: result.fileId, // שמירת fileId לפתיחה עתידית\r\n                processingMode: result.processingMode || 'structured', // track processing mode\r\n                isFullText: result.isFullText || false // track if this is full text\r\n            };\r\n            setExtractedPdf(pdfInfo);\r\n            localStorage.setItem('extractedPdf', JSON.stringify(pdfInfo));\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\r\n            \r\n            // Different success messages based on processing mode\r\n            let successMessage;\r\n            if (result.processingMode === 'simple_ocr') {\r\n                successMessage = `✅ טקסט חולץ מ-\"${file.name}\". ניתן לשאול שאלות על התוכן. טען גיליון לניתוח מפורט.`;\r\n            } else {\r\n                successMessage = result.fileId \r\n                    ? `✅ נתונים חולצו בהצלחה מ-\"${file.name}\". כעת ניתן לשאול שאלות על הקובץ או לחזור לקובץ המקורי.`\r\n                    : `✅ נתונים חולצו בהצלחה מ-\"${file.name}\". כעת ניתן לשאול שאלות על הקובץ.`;\r\n            }\r\n            \r\n            setMessages(prev => [...prev, { text: successMessage, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .catch(error => {\r\n            console.error('PDF data extraction failed:', error);\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים')));\r\n            setMessages(prev => [...prev, { text: `❌ שגיאה בחילוץ נתונים מ-\"${file.name}\": ${error.message}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .finally(() => {\r\n            setIsExtractingData(false);\r\n        });\r\n    } else if (fileType === 'Excel') {\r\n        // Ask user if they want to convert to Google Sheets\r\n        const shouldConvert = window.confirm(\r\n            `האם ברצונך להמיר את קובץ ה-Excel \"${file.name}\" ל-Google Sheets?\\n\\n` +\r\n            `כן - העלאה ל-Google Drive והמרה ל-Google Sheets\\n` +\r\n            `לא - חילוץ נתונים מקומי בלבד`\r\n        );\r\n\r\n        if (shouldConvert) {\r\n            // Convert to Google Sheets\r\n            setIsExtractingExcel(true);\r\n            \r\n            setMessages(prev => prev.filter(msg =>\r\n                !msg.text.includes('ממיר') &&\r\n                !msg.text.includes('Google Sheets') &&\r\n                !msg.text.includes('שגיאה בהמרה')\r\n            ));\r\n            \r\n            setMessages(prev => [...prev, {\r\n                text: `🔄 ממיר את \"${file.name}\" ל-Google Sheets...`,\r\n                sender: 'system',\r\n                timestamp: new Date(),\r\n                id: Date.now()\r\n            }]);\r\n            \r\n            const formData = new FormData();\r\n            formData.append('excel', file);\r\n\r\n            fetch(`${API_URL}/api/excel-to-sheets`, {\r\n                method: 'POST',\r\n                body: formData,\r\n                credentials: 'include'\r\n            })\r\n            .then(response => {\r\n                if (!response.ok) {\r\n                    return response.json().then(err => {\r\n                        throw new Error(err.error || 'Failed to convert Excel to Google Sheets')\r\n                    });\r\n                }\r\n                return response.json();\r\n            })\r\n            .then(result => {\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('🔄 ממיר')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `✅ הקובץ \"${file.name}\" הומר בהצלחה ל-Google Sheets ונשמר בתיקיית \"TLV500-AI\"!`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n                \r\n                // Open the created Google Sheet in a new tab\r\n                const sheetUrl = result.spreadsheetUrl || result.url;\r\n                if (sheetUrl) {\r\n                    window.open(sheetUrl, '_blank');\r\n                    setMessages(prev => [...prev, {\r\n                        text: `📊 Google Sheets נפתח בכרטיסייה חדשה`,\r\n                        sender: 'system',\r\n                        timestamp: new Date(),\r\n                        id: Date.now()\r\n                    }]);\r\n                    \r\n                    // Optionally, also load it in the current interface\r\n                    handleGoogleSheetsUrl(sheetUrl);\r\n                }\r\n            })\r\n            .catch(error => {\r\n                console.error('Excel to Google Sheets conversion failed:', error);\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('🔄 ממיר')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `❌ שגיאה בהמרה ל-Google Sheets: ${error.message}`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n            })\r\n            .finally(() => {\r\n                setIsExtractingExcel(false);\r\n            });\r\n        } else {\r\n            // Original local extraction logic\r\n            setExtractedExcel(null);\r\n            localStorage.removeItem('extractedExcel');\r\n            setIsExtractingExcel(true);\r\n            \r\n            setMessages(prev => prev.filter(msg =>\r\n                !msg.text.includes('חולצו מ-Excel') &&\r\n                !msg.text.includes('שגיאה בחילוץ Excel') &&\r\n                !msg.text.includes('נתוני ה-Excel נוקו')\r\n            ));\r\n            \r\n            setMessages(prev => [...prev, {\r\n                text: `⏳ מחלץ נתונים מקובץ Excel \"${file.name}\"...`,\r\n                sender: 'system',\r\n                timestamp: new Date(),\r\n                id: Date.now()\r\n            }]);\r\n            \r\n            const formData = new FormData();\r\n            formData.append('excel', file);\r\n\r\n            fetch(`${API_URL}/api/extract-excel-data`, {\r\n                method: 'POST',\r\n                body: formData\r\n            })\r\n            .then(response => {\r\n                if (!response.ok) {\r\n                    return response.json().then(err => {\r\n                        throw new Error(err.error || 'Failed to extract Excel data')\r\n                    });\r\n                }\r\n                return response.json();\r\n            })\r\n            .then(result => {\r\n                const excelInfo = { name: file.name, data: result.data };\r\n                setExtractedExcel(excelInfo);\r\n                localStorage.setItem('extractedExcel', JSON.stringify(excelInfo));\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `✅ נתונים חולצו בהצלחה מ-Excel \"${file.name}\".`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n            })\r\n            .catch(error => {\r\n                console.error('Excel data extraction failed:', error);\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('⏳ מחלץ נתונים מקובץ Excel')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `❌ שגיאה בחילוץ נתוני Excel: ${error.message}`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n            })\r\n            .finally(() => {\r\n                setIsExtractingExcel(false);\r\n            });\r\n        }\r\n    }\r\n  };\r\n\r\n  const loadAvailableSheets = async (spreadsheetId) => {\r\n    setIsLoadingSheets(true);\r\n    setIsSheetSelected(false); // Reset selection\r\n    setSelectedSheetName(''); // Clear any previous selection\r\n    try {\r\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\r\n      setAvailableSheets(sheets);\r\n      setSheetsMetadata(sheets);\r\n      // רק הודעה שהגליונות נטענו - בלי לבחור גליון אוטומטית\r\n      if (sheets.length > 0) {\r\n        setMessages(prev => [...prev, { \r\n          text: `📋 נמצאו ${sheets.length} גליונות - בחר גליון כדי להתחיל`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      }\r\n    } finally {\r\n      setIsLoadingSheets(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleSheetsUrl = async (url) => {\r\n    setGoogleSheetsUrl(url);\r\n    setIsSheetLoaded(true);\r\n    setIsSheetSelected(false); // Reset sheet selection for new spreadsheet\r\n    setIsAgentMode(false); // Reset agent mode for new spreadsheet\r\n    const spreadsheetId = extractSpreadsheetId(url);\r\n    if (spreadsheetId && accessToken) await loadAvailableSheets(spreadsheetId);\r\n  };\r\n  \r\n  const handleSheetChange = async (newSheetName) => {\r\n    if (newSheetName === selectedSheetName) return;\r\n    \r\n    setSelectedSheetName(newSheetName);\r\n    setIsSheetSelected(true); // מסמן שנבחר גליון\r\n    \r\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n    if (spreadsheetId) {\r\n      // 🔥 שלוף נתוני גליון עם ערכים ונוסחאות\r\n      const sheetData = await getSheetData(spreadsheetId, newSheetName);\r\n      \r\n      setMessages(prev => [...prev, { \r\n        text: `✅ מחובר לגליון: ${newSheetName}`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n\r\n      // 🔥 נתח את הגליון עם Gemini\r\n      if (sheetData) {\r\n        const analysisResult = await analyzeSheetWithGemini(sheetData, newSheetName, extractedPdf);\r\n        \r\n        // 🔥 Reanalyze PDF if it exists and is in simple OCR mode\r\n        if (extractedPdf && extractedPdf.processingMode === 'simple_ocr' && analysisResult) {\r\n          console.log('🔄 PDF found in simple_ocr mode, triggering reanalysis with sheet context...');\r\n          await reanalyzePdfWithSheetContext(sheetData, analysisResult.instructions, analysisResult.summary, newSheetName);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // 🔥 Function to reanalyze PDF when sheet context becomes available\r\n  const reanalyzePdfWithSheetContext = async (sheetData, sheetInstructions, sheetAnalysis, selectedSheetName) => {\r\n    if (!extractedPdf || !extractedPdf.fileId || extractedPdf.processingMode === 'structured') {\r\n      return; // No PDF to reanalyze or already analyzed\r\n    }\r\n\r\n    console.log('🔄 Reanalyzing PDF with new sheet context...');\r\n    \r\n    setMessages(prev => [...prev, { \r\n      text: `🔄 מנתח מחדש את \"${extractedPdf.name}\" עם הקשר הגליון החדש...`, \r\n      sender: 'system', \r\n      timestamp: new Date(), \r\n      id: Date.now() \r\n    }]);\r\n\r\n    try {\r\n      // Create FormData for re-analysis\r\n      const formData = new FormData();\r\n      \r\n      // We need to fetch the PDF file again - check if it exists first\r\n      const pdfResponse = await fetch(`${API_URL}/api/download-pdf/${extractedPdf.fileId}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!pdfResponse.ok) {\r\n        // PDF no longer exists on server - clean up state\r\n        console.log('❌ PDF file no longer exists on server, cleaning up...');\r\n        setExtractedPdf(null);\r\n        localStorage.removeItem('extractedPdf');\r\n        setMessages(prev => prev.filter(msg => !msg.text.includes(extractedPdf.name)));\r\n        return;\r\n      }\r\n      \r\n      const pdfBlob = await pdfResponse.blob();\r\n      formData.append('pdf', pdfBlob, extractedPdf.name);\r\n      \r\n      // Add sheet context data directly to FormData\r\n      console.log('🔄 Reanalyzing PDF with sheet context:', {\r\n        hasSheetData: !!sheetData,\r\n        sheetDataLength: sheetData ? sheetData.length : 0,\r\n        hasInstructions: !!sheetInstructions,\r\n        instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\r\n        hasAnalysis: !!sheetAnalysis,\r\n        analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\r\n        sheetName: selectedSheetName\r\n      });\r\n      \r\n      if (sheetData) {\r\n        formData.append('sheetData', JSON.stringify(sheetData));\r\n      }\r\n      if (sheetInstructions) {\r\n        formData.append('sheetInstructions', sheetInstructions);\r\n      }\r\n      if (sheetAnalysis) {\r\n        formData.append('sheetAnalysis', sheetAnalysis);\r\n      }\r\n      if (selectedSheetName) {\r\n        formData.append('sheetName', selectedSheetName);\r\n      }\r\n      \r\n      const response = await fetch(`${API_URL}/api/extract-pdf-data`, {\r\n        method: 'POST', \r\n        body: formData,\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('Failed to reanalyze PDF');\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      // Update PDF info with new analysis\r\n      const updatedPdfInfo = { \r\n        ...extractedPdf,\r\n        data: result,\r\n        processingMode: result.processingMode || 'structured',\r\n        isFullText: result.isFullText || false\r\n      };\r\n      \r\n      setExtractedPdf(updatedPdfInfo);\r\n      localStorage.setItem('extractedPdf', JSON.stringify(updatedPdfInfo));\r\n      \r\n      setMessages(prev => [...prev, { \r\n        text: `✅ \"${extractedPdf.name}\" נותח מחדש בהצלחה עם הקשר הגליון`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n      \r\n    } catch (error) {\r\n      console.error('Error reanalyzing PDF:', error);\r\n      setMessages(prev => [...prev, { \r\n        text: `❌ שגיאה בניתוח מחדש של \"${extractedPdf.name}\": ${error.message}`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n    }\r\n  };\r\n\r\n  const pickerCallback = (data) => {\r\n    if (data.action === window.google.picker.Action.PICKED) {\r\n      const doc = data.docs[0];\r\n      setFileName(doc.name);\r\n      handleGoogleSheetsUrl(doc.url);\r\n      setSnackbarMessage(`טען גיליון: ${doc.name}`);\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const createPicker = () => {\r\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY;\r\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\r\n    if (!clientId || !developerKey) {\r\n      setAuthError('מפתחות API אינם מוגדרים כראוי.');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\r\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\r\n    const picker = new window.google.picker.PickerBuilder()\r\n      .setAppId(clientId.split('-')[0])\r\n      .setOAuthToken(accessToken)\r\n      .setDeveloperKey(developerKey)\r\n      .addView(view)\r\n      .setCallback(pickerCallback)\r\n      .build();\r\n    picker.setVisible(true);\r\n  };\r\n\r\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\r\n    if (!accessToken) return null;\r\n    try {\r\n      const range = sheetName ? `'${sheetName}'!A1:Z1000` : 'A1:Z1000';\r\n      \r\n      console.log('🔥 Fetching sheet data with values and formulas...');\r\n      \r\n      // 🔥 קריאה 1: שלוף ערכים מעוצבים\r\n      const valuesResponse = await makeGoogleSheetsAPICall(\r\n        spreadsheetId, \r\n        range, \r\n        null, \r\n        'GET',\r\n        'FORMATTED_VALUE'\r\n      );\r\n      \r\n      // 🔥 קריאה 2: שלוף נוסחאות  \r\n      const formulasResponse = await makeGoogleSheetsAPICall(\r\n        spreadsheetId, \r\n        range, \r\n        null, \r\n        'GET',\r\n        'FORMULA'\r\n      );\r\n      \r\n      console.log('📊 Values response:', valuesResponse.values?.length || 0, 'rows');\r\n      console.log('📋 Formulas response:', formulasResponse.values?.length || 0, 'rows');\r\n      \r\n      // 🔥 לוגים נוספים לבדיקה\r\n      if (valuesResponse.values?.length > 0) {\r\n        console.log('📊 Sample values row 0:', valuesResponse.values[0]);\r\n      }\r\n      if (formulasResponse.values?.length > 0) {\r\n        console.log('📋 Sample formulas row 0:', formulasResponse.values[0]);\r\n      }\r\n      \r\n      // 🔥 שלב את שניהם לאובייקט עשיר\r\n      const combinedData = combineValuesAndFormulas(\r\n        valuesResponse.values || [], \r\n        formulasResponse.values || []\r\n      );\r\n      \r\n      // 🔥 הצג הודעה למשתמש על השיפור\r\n      const formulaCount = combinedData.flat().filter(cell => cell.type === 'formula').length;\r\n      if (formulaCount > 0) {\r\n        console.log('🔥 Sample formula cells:', combinedData.flat().filter(cell => cell.type === 'formula').slice(0, 3));\r\n        setMessages(prev => [...prev, { \r\n          text: `✨ גיליון נטען עם ${formulaCount} נוסחאות - כעת ה-AI יכול לראות גם את הנוסחאות וגם את הערכים!`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      } else {\r\n        setMessages(prev => [...prev, { \r\n          text: `📊 גיליון נטען בהצלחה - מכיל נתונים אבל לא נמצאו נוסחאות`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      }\r\n      \r\n      return combinedData;\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to fetch sheet data:', error);\r\n      console.error('Error details:', {\r\n        message: error.message,\r\n        stack: error.stack\r\n      });\r\n      setMessages(prev => [...prev, { text: `❌ שגיאה בטעינת גיליון: ${error.message}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const startNewChat = () => {\r\n    setCurrentSessionId(null);\r\n    setMessages([{ text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n    // אפס מצב Agent Mode אם אין גליון נבחר\r\n    if (!isSheetSelected) {\r\n      setIsAgentMode(false);\r\n    }\r\n    // אפס מצב Undo/Redo\r\n    setCanUndo(false);\r\n    setCanRedo(false);\r\n    setHasGreenCells(false);\r\n    setChangesCount(0);\r\n    setSheetAnalysis(null);\r\n    setSheetInstructions(null);\r\n  };\r\n\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      // Call logout endpoint\r\n      await fetch(`${API_URL}/auth/logout`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      // Clear local state\r\n      setAccessToken('');\r\n      setUser(null);\r\n      setCurrentSessionId(null);\r\n      setIsSheetSelected(false);\r\n      setIsAgentMode(false);\r\n      setCanUndo(false);\r\n      setCanRedo(false);\r\n      setHasGreenCells(false);\r\n      setChangesCount(0);\r\n      setSheetAnalysis(null);\r\n      setSheetInstructions(null);\r\n      localStorage.removeItem('accessToken');\r\n      \r\n      // Reset session ID for new session\r\n      setSessionId(Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15));\r\n      \r\n      // Reset messages\r\n      setMessages([{ text: 'שלום! אני העוזר החכם TLV500. התחבר לחשבון Google ובחר גיליון כדי להתחיל.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n      \r\n      setSnackbarMessage('התנתקת בהצלחה!');\r\n      setShowSnackbar(true);\r\n    } catch (error) {\r\n      console.error('Error during logout:', error);\r\n    }\r\n  };\r\n\r\n  // 🔄 Undo/Redo Functions\r\n  const checkUndoRedoStatus = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\r\n        method: 'GET',\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking undo/redo status:', error);\r\n    }\r\n  };\r\n\r\n  // 🟢 Check for green cells\r\n  const checkForGreenCells = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId || isCheckingGreenCells) return;\r\n    \r\n    setIsCheckingGreenCells(true);\r\n    try {\r\n      // Simple check - if there are undo-able actions of type AI_ACTION that were recently executed\r\n      // we assume there might be green cells\r\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\r\n        credentials: 'include'\r\n      });\r\n      if (response.ok) {\r\n        const status = await response.json();\r\n        // For now, assume green cells exist if there are recent AI actions to undo\r\n        const hasChanges = status.canUndo;\r\n        // Debug: checkForGreenCells result\r\n        console.log('🟢 Full status from backend:', status);\r\n        console.log('🟢 hasGreenCells:', hasChanges, 'changesCount:', status.changesCount);\r\n        setHasGreenCells(hasChanges);\r\n        \r\n        // עדכון ספירת השינויים מהבקענד\r\n        setChangesCount(status.changesCount || 0);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking for green cells:', error);\r\n      setHasGreenCells(false);\r\n      setChangesCount(0);\r\n    } finally {\r\n      setIsCheckingGreenCells(false);\r\n    }\r\n  };\r\n\r\n  // ✅ Approve All Changes\r\n  const approveAllChanges = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\r\n\r\n    try {\r\n      const spreadsheetId = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)?.[1];\r\n      const sheetId = availableSheets.find(s => s.name === selectedSheetName)?.id || 0;\r\n\r\n      const response = await fetch(`${API_URL}/api/action/approve-all`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          spreadsheetId: spreadsheetId,\r\n          selectedSheetName: selectedSheetName,\r\n          sheetId: sheetId,\r\n          sessionId: currentSessionId\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        setSnackbarMessage(result.message || '✅ כל השינויים אושרו');\r\n        setShowSnackbar(true);\r\n        \r\n        // Refresh status\r\n        await checkUndoRedoStatus();\r\n        await checkForGreenCells();\r\n        \r\n        // רענון חלק של הגליון\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 500);\r\n      } else {\r\n        throw new Error('Failed to approve changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error approving all changes:', error);\r\n      setSnackbarMessage('❌ שגיאה באישור השינויים');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  // ❌ Reject All Changes\r\n  const rejectAllChanges = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\r\n\r\n    try {\r\n      const spreadsheetId = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)?.[1];\r\n      const sheetId = availableSheets.find(s => s.name === selectedSheetName)?.id || 0;\r\n\r\n      const response = await fetch(`${API_URL}/api/action/reject-all`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          spreadsheetId: spreadsheetId,\r\n          selectedSheetName: selectedSheetName, \r\n          sheetId: sheetId,\r\n          sessionId: currentSessionId\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        setSnackbarMessage(result.message || '❌ כל השינויים נדחו');\r\n        setShowSnackbar(true);\r\n        \r\n        // Refresh status\r\n        await checkUndoRedoStatus();\r\n        await checkForGreenCells();\r\n        \r\n        // רענון חלק של הגליון\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 500);\r\n      } else {\r\n        throw new Error('Failed to reject changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error rejecting all changes:', error);\r\n      setSnackbarMessage('❌ שגיאה בדחיית השינויים');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const undoAction = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/undo`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ sessionId: currentSessionId })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n        setSnackbarMessage('↩️ ' + data.message);\r\n        setShowSnackbar(true);\r\n        \r\n        // עדכון כפתורי קבל/דחה\r\n        await checkForGreenCells();\r\n        \r\n        // רענון חלק של הגליון\r\n        if (googleSheetsUrl && selectedSheetName) {\r\n          setTimeout(() => {\r\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n            if (iframe) {\r\n              iframe.src = iframe.src;\r\n            }\r\n          }, 500); // השהיה קצרה לפני רענון\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setSnackbarMessage('❌ שגיאה בביטול: ' + error.error);\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in undo action:', error);\r\n      setSnackbarMessage('❌ שגיאה בביטול הפעולה');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const redoAction = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/redo`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ sessionId: currentSessionId })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n        setSnackbarMessage('⤴️ ' + data.message);\r\n        setShowSnackbar(true);\r\n        \r\n        // עדכון כפתורי קבל/דחה\r\n        await checkForGreenCells();\r\n        \r\n        // רענון חלק של הגליון\r\n        if (googleSheetsUrl && selectedSheetName) {\r\n          setTimeout(() => {\r\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n            if (iframe) {\r\n              iframe.src = iframe.src;\r\n            }\r\n          }, 500); // השהיה קצרה לפני רענון\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setSnackbarMessage('❌ שגיאה בשחזור: ' + error.error);\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in redo action:', error);\r\n      setSnackbarMessage('❌ שגיאה בשחזור הפעולה');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (!question.trim() || isStreamingResponse) return;\r\n\r\n    // 🛡️ בדיקה חדשה - אם יש גליון אבל לא נבחר גליון ספציפי\r\n    if (isSheetLoaded && !isSheetSelected) {\r\n      setMessages(prev => [...prev, { \r\n        text: '❌ יש לבחור גליון תחילה מהרשימה למעלה', \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n      return;\r\n    }\r\n\r\n    const currentQuestion = question;\r\n    const userMessage = { text: currentQuestion, sender: 'user', timestamp: new Date(), id: Date.now() };\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setQuestion('');\r\n    setIsStreamingResponse(true);\r\n    \r\n    // Generate session ID if this is a new conversation\r\n    let sessionId = currentSessionId;\r\n    if (!sessionId) {\r\n      sessionId = generateSessionId();\r\n      setCurrentSessionId(sessionId);\r\n    }\r\n    \r\n    const loadingMessageId = Date.now() + 1;\r\n    setMessages(prev => [...prev, { text: '', sender: 'assistant', isLoading: true, timestamp: new Date(), id: loadingMessageId }]);\r\n\r\n    // User message will be saved automatically by backend in /api/chat-stream\r\n\r\n    try {\r\n        const sheetData = (isSheetLoaded && isSheetSelected) ? \r\n          await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\r\n        \r\n        // We need to get the spreadsheetId here to send it\r\n        const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\r\n\r\n        const payload = {\r\n          question: currentQuestion,\r\n          sheetData: sheetData,\r\n          extractedPdfData: extractedPdf ? extractedPdf.data : null,\r\n          extractedExcelData: extractedExcel ? extractedExcel.data : null,\r\n          isAgentMode: isAgentMode,\r\n          isSignificantChange: isSignificantChange,  // 🎚️ הוסף מצב שינוי משמעותי\r\n          conversationHistory: messages.filter(m => !m.isLoading).map(m => ({\r\n              role: m.sender === 'user' ? 'user' : 'model',\r\n              parts: [{ text: m.text }]\r\n          })),\r\n          spreadsheetId: spreadsheetId,\r\n          accessToken: accessToken,\r\n          sessionId: sessionId,  // Include session ID\r\n          sheetsMetadata: sheetsMetadata,       // ודא שהמשתנה הזה קיים ומכיל את המידע\r\n          selectedSheetName: selectedSheetName,  // ודא שהמשתנה הזה קיים ומכיל את שם הגיליון\r\n          sheetInstructions: sheetInstructions,   // 🔥 הוסף הוראות ניתוח\r\n          sheetAnalysis: sheetAnalysis           // 🔥 הוסף ניתוח הגליון\r\n        };\r\n\r\n        console.log('🔥 Sending payload with sheet instructions:', !!sheetInstructions);\r\n        if (sheetInstructions) {\r\n          console.log('📋 Sheet instructions preview:', sheetInstructions.substring(0, 200) + '...');\r\n        }\r\n        \r\n        const response = await fetch(`${API_URL}/api/chat-stream`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            credentials: 'include', // This is crucial for session cookies!\r\n            body: JSON.stringify(payload),\r\n        });\r\n\r\n        if (!response.ok || !response.body) {\r\n            const errorText = await response.text();\r\n            throw new Error(`Server error: ${response.status} ${errorText}`);\r\n        }\r\n\r\n        const reader = response.body.getReader();\r\n        const decoder = new TextDecoder();\r\n        let accumulatedResponse = '';\r\n\r\n        while (true) {\r\n            const { value, done } = await reader.read();\r\n            if (done) break;\r\n            \r\n            accumulatedResponse += decoder.decode(value, { stream: true });\r\n\r\n            const currentResponse = accumulatedResponse;\r\n            setMessages(prev => prev.map(m => {\r\n                if (m.id === loadingMessageId) {\r\n                    // Show the accumulated response directly as text\r\n                    return { ...m, text: currentResponse, isLoading: true };\r\n                }\r\n                return m;\r\n            }));\r\n        }\r\n\r\n        // Final response processing - check if this is a change plan with clarification questions\r\n        const isChangePlanResponse = accumulatedResponse.includes('🤔 שאלות הבהרה') && accumulatedResponse.includes('מזהה תוכנית:');\r\n        \r\n        if (isChangePlanResponse) {\r\n          // Extract plan ID from response\r\n          const planIdMatch = accumulatedResponse.match(/מזהה תוכנית:\\s*`([^`]+)`/);\r\n          if (planIdMatch) {\r\n            const planId = planIdMatch[1];\r\n            setPendingChangePlan({\r\n              id: planId,\r\n              response: accumulatedResponse,\r\n              questions: extractQuestionsFromResponse(accumulatedResponse)\r\n            });\r\n            setIsAnsweringQuestions(true);\r\n            setClarificationAnswers(['', '', '', '', '']); // Reset answers\r\n          }\r\n        }\r\n        \r\n        setMessages(prev => prev.map(m =>\r\n            m.id === loadingMessageId\r\n            ? { ...m, text: accumulatedResponse, isLoading: false }\r\n            : m\r\n        ));\r\n\r\n        // Assistant response is automatically saved by backend in /api/chat-stream\r\n        \r\n                 // אם היה זה פקודת undo/redo, רענן את הגליון\r\n         const questionLower = currentQuestion.toLowerCase().trim();\r\n         const undoRedoKeywords = ['בטל', 'undo', 'שחזר', 'redo', 'בטל פעולה', 'שחזר פעולה'];\r\n         if (undoRedoKeywords.some(keyword => questionLower.includes(keyword))) {\r\n             // רענון חלק של הגליון\r\n             if (googleSheetsUrl && selectedSheetName) {\r\n                 setTimeout(() => {\r\n                     const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n                     if (iframe) {\r\n                         iframe.src = iframe.src;\r\n                     }\r\n                 }, 800); // השהיה מעט יותר ארוכה עבור פקודות צ'אט\r\n             }\r\n         }\r\n\r\n    } catch (error) {\r\n        console.error('Error in sendMessage:', error);\r\n        setMessages(prev => prev.map(m => \r\n            m.id === loadingMessageId \r\n            ? { ...m, text: `אירעה שגיאה: ${error.message}`, isLoading: false, isError: true } \r\n            : m\r\n        ));\r\n    } finally {\r\n        setIsStreamingResponse(false);\r\n        // בדוק סטטוס Undo/Redo ותאים ירוקים אחרי כל הודעה\r\n        console.log('📋 Message completed, checking status...', { isAgentMode, currentSessionId });\r\n        setTimeout(() => {\r\n          console.log('⏰ Running status checks...');\r\n          checkUndoRedoStatus();\r\n          checkForGreenCells();\r\n        }, 1000); // השהיה קצרה כדי לוודא שהבק-אנד סיים\r\n    }\r\n  };\r\n\r\n  const saveAllChanges = () => {\r\n          setMessages(prev => [...prev, { text: `💾 כל השינויים נשמרו לגיליון ${fileName}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n    };\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      \r\n\r\n      \r\n      <Box sx={{ display: 'flex', height: '100vh', bgcolor: 'background.default', overflow: 'hidden' }}>\r\n        <Box sx={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: `radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%), radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%)`, pointerEvents: 'none', zIndex: 0 }} />\r\n        {!isMobile && (\r\n          <Drawer variant=\"permanent\" sx={{ width: drawerWidth, flexShrink: 0, zIndex: 1, '& .MuiDrawer-paper': { width: drawerWidth, boxSizing: 'border-box', bgcolor: 'rgba(10, 10, 10, 0.98)', borderRight: '1px solid rgba(139, 92, 246, 0.4)', backdropFilter: 'blur(20px)' }}}>\r\n            <Box sx={{ p: 3 }}>\r\n              <Typography variant=\"h6\" sx={{ background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)', backgroundClip: 'text', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontWeight: 700 }}>TLV500</Typography>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">AI Assistant</Typography>\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            <Box sx={{ p: 3 }}>\r\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\r\n                <Avatar\r\n                  src={user?.profilePicture}\r\n                  sx={{ width: 45, height: 45, background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' }}\r\n                >\r\n                  {user?.name ? user.name.charAt(0) : <Person />}\r\n                </Avatar>\r\n                <Box sx={{ flex: 1 }}>\r\n                  <Typography variant=\"body2\" fontWeight={600}>\r\n                    {user?.name || 'משתמש אורח'}\r\n                  </Typography>\r\n                  <Typography variant=\"caption\" color=\"text.secondary\">\r\n                    {user?.email || 'לא מחובר'}\r\n                  </Typography>\r\n                </Box>\r\n              </Box>\r\n              {accessToken && (\r\n                <Button\r\n                  variant=\"outlined\"\r\n                  onClick={handleLogout}\r\n                  size=\"small\"\r\n                  fullWidth\r\n                  sx={{\r\n                    borderColor: 'rgba(239, 68, 68, 0.5)',\r\n                    color: 'error.main',\r\n                    '&:hover': {\r\n                      borderColor: 'error.main',\r\n                      bgcolor: 'rgba(239, 68, 68, 0.1)'\r\n                    }\r\n                  }}\r\n                >\r\n                  התנתק\r\n                </Button>\r\n              )}\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            \r\n            {/* Chat History */}\r\n            <Box sx={{ flexGrow: 1, overflow: 'hidden' }}>\r\n              <ChatHistory\r\n                accessToken={accessToken}\r\n                onSessionSelect={handleSessionSelect}\r\n                currentSessionId={currentSessionId}\r\n              />\r\n            </Box>\r\n          </Drawer>\r\n        )}\r\n        <Box sx={{ flexGrow: 1, display: 'flex', flexDirection: isMobile ? 'column' : 'row', zIndex: 1, height: '100vh', overflow: 'hidden' }}>\r\n          <Box sx={{ flex: isMobile ? '1 1 60%' : '0 0 65%', p: 2, display: 'flex', flexDirection: 'column', height: '100%', overflow: 'hidden' }}>\r\n            <Box sx={{ mb: 2, display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: 2 }}>\r\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                <Typography variant=\"h6\" fontWeight={600} color=\"text.primary\">{fileName || 'לא נבחר גיליון'}</Typography>\r\n                {availableSheets.length > 0 && (\r\n                  <FormControl \r\n                    size=\"small\" \r\n                    sx={{ \r\n                      minWidth: 200,\r\n                      '& .MuiOutlinedInput-notchedOutline': { \r\n                        borderColor: !isSheetSelected ? 'rgba(239, 68, 68, 0.7)' : 'rgba(139, 92, 246, 0.5)' \r\n                      },\r\n                      '& .MuiInputLabel-root': {\r\n                        color: !isSheetSelected ? 'error.main' : 'text.secondary'\r\n                      }\r\n                    }}\r\n                    error={!isSheetSelected}\r\n                  >\r\n                    <InputLabel>\r\n                      {!isSheetSelected ? '🔴 בחר גליון (חובה)' : 'גליון נוכחי'}\r\n                    </InputLabel>\r\n                    <Select \r\n                      value={selectedSheetName || ''} \r\n                      onChange={(e) => handleSheetChange(e.target.value)} \r\n                      disabled={isLoadingSheets}\r\n                    >\r\n                      {availableSheets.map(sheet => (\r\n                        <MenuItem key={sheet.id} value={sheet.name}>\r\n                          {sheet.name}\r\n                        </MenuItem>\r\n                      ))}\r\n                    </Select>\r\n                  </FormControl>\r\n                )}\r\n                {isLoadingSheets && <CircularProgress size={20} sx={{ color: 'primary.main' }} />}\r\n              </Box>\r\n              <Box sx={{ display: 'flex', gap: 1 }}>\r\n                {!accessToken ? (\r\n                  <Button variant=\"contained\" href={API_URL}>התחבר עם Google</Button>\r\n                ) : (\r\n                  <Button variant=\"outlined\" onClick={createPicker} disabled={!isPickerReady}>\r\n                    {!isPickerReady ? 'טוען API...' : 'בחר גיליון מ-Drive'}\r\n                  </Button>\r\n                )}\r\n                {accessToken && (\r\n                  <Button variant=\"outlined\" onClick={startNewChat} sx={{ minWidth: 'auto' }}>\r\n                    + שיחה חדשה\r\n                  </Button>\r\n                )}\r\n              </Box>\r\n              {changesCount > 0 && <Chip label={`${changesCount} שינויים לא שמורים`} size=\"small\" color=\"warning\" />}\r\n              <Button variant=\"contained\" startIcon={<Save />} onClick={saveAllChanges} color=\"primary\" size=\"small\">שמור הכל</Button>\r\n            </Box>\r\n            <Paper sx={{ flexGrow: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', background: 'rgba(15, 15, 15, 0.98)', border: '1px solid rgba(139, 92, 246, 0.25)', position: 'relative' }}>\r\n              \r\n\r\n\r\n              {/* שדה קישור - רק כשאין גליון */}\r\n              {!isSheetLoaded && (\r\n                <Box sx={{ p: 1, textAlign: 'center', mt: 2 }}>\r\n                  <TextField \r\n                    placeholder=\"הכנס קישור לגוגל שיטס...\" \r\n                    size=\"small\" \r\n                    sx={{ minWidth: 400 }} \r\n                    onKeyPress={async (e) => { \r\n                      if (e.key === 'Enter' && e.target.value) { \r\n                        await handleGoogleSheetsUrl(e.target.value); \r\n                        e.target.value = ''; \r\n                      } \r\n                    }} \r\n                  />\r\n                </Box>\r\n              )}\r\n              \r\n              {/* כפתורי קבל/דחה מרובעים צמודים למסגרת מבחוץ */}\r\n\r\n              \r\n\r\n              <Box \r\n                ref={iframeContainerRef} \r\n                sx={{ \r\n                  flexGrow: 1, \r\n                  border: '1px solid rgba(139, 92, 246, 0.4)', \r\n                  borderRadius: 1, \r\n                  bgcolor: 'rgba(5, 5, 5, 0.8)', \r\n                  position: 'relative', \r\n                  overflow: 'hidden',\r\n                  m: 0.5, // רווח מינימלי מהקצוות\r\n                  // הגנה על Mac gestures\r\n                  overscrollBehavior: 'contain',\r\n                  touchAction: 'auto',\r\n                  WebkitOverflowScrolling: 'touch'\r\n                }} \r\n                onMouseEnter={() => setIsIframeHovered(true)} \r\n                onMouseLeave={() => setIsIframeHovered(false)}\r\n              >\r\n                {/* כפתורי קבל/דחה צמודים לצד ימין של הקונטיינר */}\r\n                {isSheetLoaded && isSheetSelected && (hasGreenCells || changesCount > 0) && (\r\n                  <div style={{ \r\n                    position: 'absolute',\r\n                    top: '8px',\r\n                    right: '8px',\r\n                    display: 'flex', \r\n                    gap: '0px',\r\n                    zIndex: 1000,\r\n                    backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.3)',\r\n                    borderRadius: '4px',\r\n                    padding: '2px'\r\n                  }}>\r\n                    {/* כפתור קבל */}\r\n                    <div\r\n                      onClick={() => {\r\n                        approveAllChanges();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: '#4caf50',\r\n                        color: 'white',\r\n                        border: '1px solid #2e7d32',\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: 'pointer',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\r\n                      }}\r\n                      title=\"אשר כל השינויים\"\r\n                      onMouseEnter={(e) => {\r\n                        e.target.style.backgroundColor = '#45a049';\r\n                        e.target.style.transform = 'scale(1.05)';\r\n                        e.target.style.boxShadow = '0 4px 8px rgba(76, 175, 80, 0.4)';\r\n                        e.target.style.borderColor = '#4caf50';\r\n                        e.target.textContent = 'קבל הכל';\r\n                        e.target.style.fontSize = '0.6rem';\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        e.target.style.backgroundColor = '#4caf50';\r\n                        e.target.style.transform = 'scale(1)';\r\n                        e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                        e.target.style.borderColor = '#2e7d32';\r\n                        e.target.textContent = `✓ (${changesCount || 0})`;\r\n                        e.target.style.fontSize = '0.65rem';\r\n                      }}\r\n                    >\r\n                      ✓ ({changesCount || 0})\r\n                    </div>\r\n\r\n                    {/* כפתור דחה */}\r\n                    <div\r\n                      onClick={() => {\r\n                        rejectAllChanges();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: '#f44336',\r\n                        color: 'white',\r\n                        border: '1px solid #c62828',\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: 'pointer',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\r\n                      }}\r\n                      title=\"דחה כל השינויים\"\r\n                      onMouseEnter={(e) => {\r\n                        e.target.style.backgroundColor = '#d32f2f';\r\n                        e.target.style.transform = 'scale(1.05)';\r\n                        e.target.style.boxShadow = '0 4px 8px rgba(244, 67, 54, 0.4)';\r\n                        e.target.style.borderColor = '#f44336';\r\n                        e.target.textContent = 'דחה הכל';\r\n                        e.target.style.fontSize = '0.6rem';\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        e.target.style.backgroundColor = '#f44336';\r\n                        e.target.style.transform = 'scale(1)';\r\n                        e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                        e.target.style.borderColor = '#c62828';\r\n                        e.target.textContent = `✕ (${changesCount || 0})`;\r\n                        e.target.style.fontSize = '0.65rem';\r\n                      }}\r\n                    >\r\n                      ✕ ({changesCount || 0})\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* כפתורי Undo/Redo בצד ימין תחתון */}\r\n                {isSheetLoaded && isSheetSelected && (canUndo || canRedo) && (\r\n                  <div style={{ \r\n                    position: 'absolute',\r\n                    bottom: '8px',\r\n                    right: '8px',\r\n                    display: 'flex', \r\n                    gap: '0px',\r\n                    zIndex: 1000,\r\n                    backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.3)',\r\n                    borderRadius: '4px',\r\n                    padding: '2px'\r\n                  }}>\r\n                    {/* כפתור Undo */}\r\n                    <div\r\n                      onClick={() => {\r\n                        if (canUndo) undoAction();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: canUndo ? '#2196f3' : '#666',\r\n                        color: 'white',\r\n                        border: `1px solid ${canUndo ? '#1976d2' : '#555'}`,\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: canUndo ? 'pointer' : 'not-allowed',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n                        opacity: canUndo ? 1 : 0.5\r\n                      }}\r\n                      title=\"בטל פעולה\"\r\n                      onMouseEnter={(e) => {\r\n                        if (canUndo) {\r\n                          e.target.style.backgroundColor = '#1976d2';\r\n                          e.target.style.transform = 'scale(1.05)';\r\n                          e.target.style.boxShadow = '0 4px 8px rgba(33, 150, 243, 0.4)';\r\n                          e.target.style.borderColor = '#2196f3';\r\n                          e.target.textContent = 'בטל';\r\n                          e.target.style.fontSize = '0.6rem';\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        if (canUndo) {\r\n                          e.target.style.backgroundColor = '#2196f3';\r\n                          e.target.style.transform = 'scale(1)';\r\n                          e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                          e.target.style.borderColor = '#1976d2';\r\n                          e.target.textContent = '↩️';\r\n                          e.target.style.fontSize = '0.65rem';\r\n                        }\r\n                      }}\r\n                    >\r\n                      ↩️\r\n                    </div>\r\n\r\n                    {/* כפתור Redo */}\r\n                    <div\r\n                      onClick={() => {\r\n                        if (canRedo) redoAction();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: canRedo ? '#ff9800' : '#666',\r\n                        color: 'white',\r\n                        border: `1px solid ${canRedo ? '#f57c00' : '#555'}`,\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: canRedo ? 'pointer' : 'not-allowed',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n                        opacity: canRedo ? 1 : 0.5\r\n                      }}\r\n                      title=\"שחזר פעולה\"\r\n                      onMouseEnter={(e) => {\r\n                        if (canRedo) {\r\n                          e.target.style.backgroundColor = '#f57c00';\r\n                          e.target.style.transform = 'scale(1.05)';\r\n                          e.target.style.boxShadow = '0 4px 8px rgba(255, 152, 0, 0.4)';\r\n                          e.target.style.borderColor = '#ff9800';\r\n                          e.target.textContent = 'שחזר';\r\n                          e.target.style.fontSize = '0.6rem';\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        if (canRedo) {\r\n                          e.target.style.backgroundColor = '#ff9800';\r\n                          e.target.style.transform = 'scale(1)';\r\n                          e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                          e.target.style.borderColor = '#f57c00';\r\n                          e.target.textContent = '⤴️';\r\n                          e.target.style.fontSize = '0.65rem';\r\n                        }\r\n                      }}\r\n                    >\r\n                      ⤴️\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {isSheetLoaded && isSheetSelected ? (\r\n                  <iframe src={getSheetUrlWithGid(googleSheetsUrl, selectedSheetName)} width=\"100%\" height=\"100%\" style={{ border: 'none', borderRadius: '4px' }} title=\"Google Sheets\" />\r\n                ) : availableSheets.length > 0 && !isSheetSelected ? (\r\n                  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'text.secondary' }}>\r\n                    <TableChart sx={{ fontSize: 60, mb: 2, opacity: 0.5, color: 'error.main' }} />\r\n                    <Typography variant=\"h6\" gutterBottom color=\"error.main\">\r\n                      יש לבחור גליון תחילה\r\n                    </Typography>\r\n                    <Typography variant=\"body2\" textAlign=\"center\" sx={{ maxWidth: 400 }}>\r\n                      בחר גליון מהרשימה למעלה כדי להתחיל לעבוד\r\n                    </Typography>\r\n                  </Box>\r\n                ) : (\r\n                  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'text.secondary' }}>\r\n                    <TableChart sx={{ fontSize: 60, mb: 2, opacity: 0.5 }} />\r\n                    <Typography variant=\"h6\" gutterBottom>טען גיליון גוגל שיטס</Typography>\r\n                    <Typography variant=\"body2\" textAlign=\"center\" sx={{ maxWidth: 400 }}>הכנס קישור לגוגל שיטס בשדה למעלה</Typography>\r\n                  </Box>\r\n                )}\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n          <Box sx={{ width: isMobile ? '100%' : '35%', flex: isMobile ? '1 1 40%' : '0 0 35%', p: 2, height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n            <Paper sx={{ flexGrow: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', background: 'rgba(25, 25, 25, 0.98)', border: '1px solid rgba(139, 92, 246, 0.25)' }}>\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Typography variant=\"h6\" fontWeight={600}>עוזר AI</Typography>\r\n                <Typography variant=\"body2\" color=\"text.secondary\">מוכן לעזור עם הניתוח שלך</Typography>\r\n              </Box>\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                  <Box sx={{ display: 'flex', gap: 1 }}>\r\n                    <Button variant=\"outlined\" component=\"label\" startIcon={<Description />} size=\"small\" disabled={isExtractingData} sx={{ flex: 1, borderColor: 'rgba(139, 92, 246, 0.5)', '&.Mui-disabled': { color: 'text.secondary' } }}>\r\n                      {isExtractingData ? 'מעבד...' : 'PDF'}\r\n                      <input type=\"file\" hidden accept=\".pdf\" onChange={(e) => handleFileUpload(e, 'PDF')} disabled={isExtractingData} />\r\n                    </Button>\r\n                    <Button variant=\"outlined\" component=\"label\" startIcon={<TableChart />} size=\"small\" disabled={isExtractingExcel} sx={{ flex: 1, borderColor: 'rgba(139, 92, 246, 0.5)' }}>\r\n                      {isExtractingExcel ? 'מעבד...' : 'Excel'}\r\n                      <input type=\"file\" hidden accept=\".xlsx,.xls,.csv\" onChange={(e) => handleFileUpload(e, 'Excel')} disabled={isExtractingExcel}/>\r\n                    </Button>\r\n                  </Box>\r\n                  {extractedPdf && (\r\n                    <Box sx={{ \r\n                      display: 'flex', \r\n                      alignItems: 'center', \r\n                      gap: 1, \r\n                      mt: 1, \r\n                      p: 1, \r\n                      bgcolor: extractedPdf.processingMode === 'simple_ocr' ? 'rgba(255, 193, 7, 0.1)' : 'rgba(139, 92, 246, 0.1)', \r\n                      borderRadius: 2, \r\n                      border: extractedPdf.processingMode === 'simple_ocr' ? '1px solid rgba(255, 193, 7, 0.3)' : '1px solid rgba(139, 92, 246, 0.3)'\r\n                    }}>\r\n                      <Description sx={{ \r\n                        color: extractedPdf.processingMode === 'simple_ocr' ? 'warning.main' : 'primary.main', \r\n                        fontSize: 20 \r\n                      }} />\r\n                      <Typography variant=\"body2\" sx={{ \r\n                        flex: 1, \r\n                        whiteSpace: 'nowrap', \r\n                        overflow: 'hidden', \r\n                        textOverflow: 'ellipsis' \r\n                      }}>\r\n                        {extractedPdf.name}\r\n                        {extractedPdf.processingMode === 'simple_ocr' && ' 📑'}\r\n                        {extractedPdf.processingMode === 'structured' && ' 🔍'}\r\n                      </Typography>\r\n                      <Button \r\n                        size=\"small\" \r\n                        onClick={() => { \r\n                          setExtractedPdf(null); \r\n                          localStorage.removeItem('extractedPdf'); \r\n                          setMessages(prev => [...prev, { \r\n                            text: '📄 נתוני ה-PDF נוקו מההקשר.', \r\n                            sender: 'system', \r\n                            timestamp: new Date(), \r\n                            id: Date.now() \r\n                          }]); \r\n                        }} \r\n                        sx={{ color: 'error.main', minWidth: 'auto', p: 0.5 }}\r\n                      >\r\n                        ✕\r\n                      </Button>\r\n                    </Box>\r\n                  )}\r\n                  {extractedExcel && (\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 1, p: 1, bgcolor: 'rgba(16, 185, 129, 0.1)', borderRadius: 2, border: '1px solid rgba(16, 185, 129, 0.3)' }}>\r\n                        <TableChart sx={{ color: 'success.main', fontSize: 20 }} />\r\n                        <Typography variant=\"body2\" sx={{ flex: 1, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{extractedExcel.name}</Typography>\r\n                        <Button size=\"small\" onClick={() => { setExtractedExcel(null); localStorage.removeItem('extractedExcel'); setMessages(prev => [...prev, { text: '📊 נתוני ה-Excel נוקו מההקשר.', sender: 'system', timestamp: new Date(), id: Date.now() }]); }} sx={{ color: 'error.main', minWidth: 'auto', p: 0.5 }}>✕</Button>\r\n                    </Box>\r\n                  )}\r\n                </Box>\r\n              </Box>\r\n              <Box sx={{ flexGrow: 1, overflow: 'auto', p: 2 }}>\r\n                {messages.map((msg, index) => (\r\n                  <Box key={msg.id || index} sx={{ mb: 2 }} className=\"chat-message\">\r\n                    <Box sx={{ display: 'flex', justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start', mb: 1 }}>\r\n                      <Paper sx={{ \r\n                        p: 1.5, \r\n                        maxWidth: '85%', \r\n                        background: msg.sender === 'user' ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' : 'rgba(35, 35, 35, 0.9)', \r\n                        color: 'white', \r\n                        borderRadius: 3\r\n                      }}>\r\n                        {msg.isLoading ? <CircularProgress size={16} color=\"inherit\" /> :\r\n                          <Typography\r\n                            variant=\"body2\"\r\n                            className=\"chat-message-text\"\r\n                            sx={{ whiteSpace: 'pre-wrap' }}\r\n                            dangerouslySetInnerHTML={{\r\n                              __html: formatMixedText(msg.text)\r\n                            }}\r\n                          />\r\n                        }\r\n                      </Paper>\r\n                    </Box>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', textAlign: msg.sender === 'user' ? 'right' : 'left', px: 1 }}>\r\n                      {msg.timestamp.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' })}\r\n                    </Typography>\r\n                  </Box>\r\n                ))}\r\n                <div ref={chatEndRef} />\r\n              </Box>\r\n              \r\n              {/* Clarification Questions UI */}\r\n              {isAnsweringQuestions && pendingChangePlan && (\r\n                <Box sx={{ p: 2, borderTop: '1px solid rgba(139, 92, 246, 0.4)', backgroundColor: 'rgba(139, 92, 246, 0.1)' }}>\r\n                  <Typography variant=\"h6\" sx={{ mb: 2, color: '#8b5cf6' }}>\r\n                    🤔 שאלות הבהרה לביצוע התוכנית\r\n                  </Typography>\r\n                  <Typography variant=\"body2\" sx={{ mb: 2, color: 'text.secondary' }}>\r\n                    אנא ענה על כל 5 השאלות לביצוע מדויק של השינויים:\r\n                  </Typography>\r\n                  \r\n                  {pendingChangePlan.questions.map((question, index) => (\r\n                    <Box key={index} sx={{ mb: 2 }}>\r\n                      <Typography variant=\"body2\" sx={{ mb: 1, fontWeight: 'bold' }}>\r\n                        {index + 1}. {question}\r\n                      </Typography>\r\n                      <TextField\r\n                        fullWidth\r\n                        multiline\r\n                        rows={2}\r\n                        value={clarificationAnswers[index]}\r\n                        onChange={(e) => {\r\n                          const newAnswers = [...clarificationAnswers];\r\n                          newAnswers[index] = e.target.value;\r\n                          setClarificationAnswers(newAnswers);\r\n                        }}\r\n                        placeholder=\"הכנס תשובה...\"\r\n                        variant=\"outlined\"\r\n                        size=\"small\"\r\n                        sx={{\r\n                          '& .MuiOutlinedInput-root': {\r\n                            backgroundColor: 'rgba(255, 255, 255, 0.05)',\r\n                            '& fieldset': {\r\n                              borderColor: 'rgba(139, 92, 246, 0.3)',\r\n                            },\r\n                            '& textarea': {\r\n                              textAlign: 'right',\r\n                              direction: 'rtl',\r\n                            },\r\n                          },\r\n                        }}\r\n                      />\r\n                    </Box>\r\n                  ))}\r\n                  \r\n                  <Box sx={{ display: 'flex', gap: 1, mt: 2 }}>\r\n                    <Button\r\n                      variant=\"contained\"\r\n                      onClick={executeChangePlan}\r\n                      disabled={isStreamingResponse || clarificationAnswers.some(answer => !answer.trim())}\r\n                      sx={{ \r\n                        bgcolor: '#8b5cf6',\r\n                        '&:hover': { bgcolor: '#7c3aed' },\r\n                        flex: 1\r\n                      }}\r\n                    >\r\n                      {isStreamingResponse ? 'מבצע...' : 'בצע תוכנית'}\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      onClick={() => {\r\n                        setIsAnsweringQuestions(false);\r\n                        setPendingChangePlan(null);\r\n                        setClarificationAnswers(['', '', '', '', '']);\r\n                      }}\r\n                      disabled={isStreamingResponse}\r\n                      sx={{ borderColor: 'rgba(139, 92, 246, 0.5)' }}\r\n                    >\r\n                      ביטול\r\n                    </Button>\r\n                  </Box>\r\n                </Box>\r\n              )}\r\n\r\n              <Box sx={{ p: 2, borderTop: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                {/* 🎚️ כפתור בחירת מצב שינוי משמעותי */}\r\n                {isAgentMode && isSheetLoaded && isSheetSelected && (\r\n                  <Box sx={{ mb: 1, display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <Switch \r\n                      checked={isSignificantChange}\r\n                      onChange={(e) => setIsSignificantChange(e.target.checked)}\r\n                      sx={{\r\n                        '& .MuiSwitch-switchBase.Mui-checked': {\r\n                          color: '#8B5CF6',\r\n                        },\r\n                        '& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track': {\r\n                          backgroundColor: '#8B5CF6',\r\n                        },\r\n                      }}\r\n                    />\r\n                    <Typography variant=\"body2\" sx={{ color: isSignificantChange ? '#8B5CF6' : '#666' }}>\r\n                      {isSignificantChange ? '🤔 שינוי משמעותי (עם הבהרות)' : '⚡ שינוי רגיל (מיידי)'}\r\n                    </Typography>\r\n                  </Box>\r\n                )}\r\n                \r\n                <Box sx={{ display: 'flex', gap: 1 }}>\r\n                  <TextField\r\n                    fullWidth\r\n                    variant=\"outlined\"\r\n                    placeholder={isAnsweringQuestions ? \"ענה על השאלות למעלה תחילה...\" : \"שאל אותי כל דבר... (Shift+Enter לשורה חדשה)\"}\r\n                    value={question}\r\n                    onChange={(e) => setQuestion(e.target.value)}\r\n                    onKeyPress={(e) => {\r\n                      if (e.key === 'Enter' && !e.shiftKey) {\r\n                        e.preventDefault(); // Prevents adding a new line\r\n                        sendMessage();\r\n                      }\r\n                    }}\r\n                    multiline\r\n                    minRows={2}\r\n                    maxRows={5}\r\n                    disabled={isStreamingResponse || isAnsweringQuestions}\r\n                    className=\"hebrew-input\"\r\n                    sx={{\r\n                      '& .MuiOutlinedInput-root': {\r\n                        borderRadius: 3,\r\n                      }\r\n                    }}\r\n                  />\r\n                  <Fab \r\n                    color=\"primary\" \r\n                    onClick={sendMessage} \r\n                    size=\"small\"\r\n                    disabled={isStreamingResponse || isAnsweringQuestions}\r\n                  >\r\n                    <Send />\r\n                  </Fab>\r\n                </Box>\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={isAgentMode}\r\n                      onChange={(e) => setIsAgentMode(e.target.checked)}\r\n                      disabled={!googleSheetsUrl || !isSheetSelected}\r\n                    />\r\n                  }\r\n                  label={`Agent Mode: Allow Sheet Editing ${!isSheetSelected ? '(בחר גליון תחילה)' : ''}`}\r\n                  sx={{ \r\n                    color: (!googleSheetsUrl || !isSheetSelected) ? 'text.disabled' : 'text.secondary', \r\n                    mt: 1, \r\n                    mr: 0 \r\n                  }}\r\n                />\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n        </Box>\r\n        <Snackbar open={showSnackbar} autoHideDuration={6000} onClose={() => setShowSnackbar(false)} anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }} sx={{ bottom: { xs: 90, sm: 24 } }}>\r\n          <Alert onClose={() => setShowSnackbar(false)} severity={authError ? \"error\" : \"success\"} sx={{ width: '100%', bgcolor: '#2E2E2E', color: 'white' }}>\r\n            {snackbarMessage || authError}\r\n          </Alert>\r\n        </Snackbar>\r\n      </Box>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}