{"ast":null,"code":"var _jsxFileName = \"/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Box, Drawer, Typography, Paper, TextField, Button, Avatar, Divider, Chip, Fab, useMediaQuery, useTheme, CircularProgress, Alert, Snackbar, CssBaseline, FormControl, InputLabel, Select, MenuItem, Switch, FormControlLabel } from '@mui/material';\nimport { Send, Person, Description, TableChart, Save } from '@mui/icons-material';\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\nimport ChatHistory from './components/ChatHistory';\nimport './App.css';\n\n// API URL configuration\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\nconst theme = createTheme({\n  palette: {\n    mode: 'dark',\n    primary: {\n      main: '#8B5CF6'\n    },\n    secondary: {\n      main: '#6366F1'\n    },\n    background: {\n      default: '#000000',\n      paper: '#0A0A0A'\n    },\n    text: {\n      primary: '#FFFFFF',\n      secondary: '#E5E7EB'\n    },\n    success: {\n      main: '#10B981'\n    },\n    error: {\n      main: '#EF4444'\n    },\n    warning: {\n      main: '#FFC107'\n    }\n  },\n  typography: {\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\n    h4: {\n      fontWeight: 700\n    },\n    h6: {\n      fontWeight: 600\n    }\n  },\n  components: {\n    MuiButton: {\n      styleOverrides: {\n        root: {\n          borderRadius: 12,\n          textTransform: 'none',\n          fontWeight: 600,\n          padding: '10px 20px'\n        },\n        contained: {\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n          '&:hover': {\n            transform: 'translateY(-1px)',\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)'\n          }\n        }\n      }\n    },\n    MuiPaper: {\n      styleOverrides: {\n        root: {\n          background: 'rgba(20, 20, 20, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(139, 92, 246, 0.3)',\n          borderRadius: 16\n        }\n      }\n    }\n  }\n});\nconst drawerWidth = 280;\nfunction App() {\n  _s();\n  const muiTheme = useTheme();\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\n  const [messages, setMessages] = useState([{\n    text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.',\n    sender: 'assistant',\n    timestamp: new Date(),\n    id: Date.now()\n  }]);\n  const [question, setQuestion] = useState('');\n  const [fileName, setFileName] = useState('');\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\n  const [changesCount, setChangesCount] = useState(0);\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\n  const [isPickerReady, setIsPickerReady] = useState(false);\n  const [accessToken, setAccessToken] = useState('');\n  const [sheetsMetadata, setSheetsMetadata] = useState('');\n  const [authError, setAuthError] = useState('');\n  const [showSnackbar, setShowSnackbar] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState('');\n  const [availableSheets, setAvailableSheets] = useState([]);\n  const [selectedSheetName, setSelectedSheetName] = useState('');\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\n  const [extractedPdf, setExtractedPdf] = useState(null);\n  const [isExtractingData, setIsExtractingData] = useState(false);\n  const [extractedExcel, setExtractedExcel] = useState(null);\n  const [isExtractingExcel, setIsExtractingExcel] = useState(false);\n  const [isAgentMode, setIsAgentMode] = useState(false);\n  const [isStreamingResponse, setIsStreamingResponse] = useState(false);\n  const [isSheetSelected, setIsSheetSelected] = useState(false);\n  const [isIframeHovered, setIsIframeHovered] = useState(false);\n\n  // ðŸ”„ Undo/Redo State\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n  const [hasGreenCells, setHasGreenCells] = useState(false);\n  const [isCheckingGreenCells, setIsCheckingGreenCells] = useState(false);\n\n  // Chat History Management\n  const [currentSessionId, setCurrentSessionId] = useState(null);\n  const [user, setUser] = useState(null);\n  const chatEndRef = useRef(null);\n  const iframeContainerRef = useRef(null);\n\n  // ðŸ”¥ State ×—×“×© ×œ× ×™×ª×•×— ×”×’×œ×™×•×Ÿ ×¢× Gemini\n  const [sheetAnalysis, setSheetAnalysis] = useState(null);\n  const [sheetInstructions, setSheetInstructions] = useState(null);\n\n  // ðŸ”¥ State ×—×“×© ×œ×ª×•×›× ×™×•×ª ×©×™× ×•×™×™× ×ž×•×¨×›×‘×•×ª\n  const [pendingChangePlan, setPendingChangePlan] = useState(null);\n  const [clarificationAnswers, setClarificationAnswers] = useState(['', '', '', '', '']);\n  const [isAnsweringQuestions, setIsAnsweringQuestions] = useState(false);\n\n  // ðŸŽšï¸ State ×—×“×© ×œ×‘×—×™×¨×ª ×ž×¦×‘ ×©×™× ×•×™ ×ž×©×ž×¢×•×ª×™\n  const [isSignificantChange, setIsSignificantChange] = useState(false);\n\n  // ðŸ”‘ Session ID for backend session storage\n  const [sessionId, setSessionId] = useState(() => {\n    return Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15);\n  });\n\n  // Helper function to extract questions from change plan response\n  const extractQuestionsFromResponse = response => {\n    console.log('Extracting questions from response:', response);\n    const questionSection = response.split('ðŸ¤” ×©××œ×•×ª ×”×‘×”×¨×”')[1];\n    if (!questionSection) {\n      console.log('No question section found');\n      return [];\n    }\n    console.log('Question section found:', questionSection);\n    const questions = [];\n    // Pattern matches \"**1.** question text\"\n    const questionMatches = questionSection.match(/\\*\\*\\d+\\.\\*\\*\\s*([^\\n*]+)/g);\n    if (questionMatches) {\n      console.log('Raw question matches:', questionMatches);\n      questionMatches.forEach(match => {\n        const question = match.replace(/\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\n        if (question && question.length > 5) {\n          questions.push(question);\n        }\n      });\n    } else {\n      console.log('No question matches found, trying alternative pattern');\n      // Alternative: look for lines that start with numbers\n      const lines = questionSection.split('\\n');\n      for (let line of lines) {\n        line = line.trim();\n        if (line.match(/^\\*\\*\\d+\\.\\*\\*/)) {\n          const question = line.replace(/^\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\n          if (question && question.length > 5) {\n            questions.push(question);\n          }\n        }\n      }\n    }\n    console.log('Frontend extracted questions:', questions);\n    return questions.slice(0, 5); // Ensure max 5 questions\n  };\n\n  // Function to execute change plan with clarification answers\n  const executeChangePlan = async () => {\n    if (!pendingChangePlan || clarificationAnswers.some(answer => !answer.trim())) {\n      setSnackbarMessage('âŒ ×™×© ×œ×¢× ×•×ª ×¢×œ ×›×œ 5 ×”×©××œ×•×ª');\n      setShowSnackbar(true);\n      return;\n    }\n    setIsStreamingResponse(true);\n    const loadingMessageId = Date.now();\n    setMessages(prev => [...prev, {\n      text: '',\n      sender: 'assistant',\n      isLoading: true,\n      timestamp: new Date(),\n      id: loadingMessageId\n    }]);\n    try {\n      const sheetData = isSheetLoaded && isSheetSelected ? await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\n      const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\n      const payload = {\n        planId: pendingChangePlan.id,\n        clarificationAnswers: clarificationAnswers,\n        spreadsheetId: spreadsheetId,\n        accessToken: accessToken,\n        sheetsMetadata: sheetsMetadata,\n        selectedSheetName: selectedSheetName\n      };\n      const response = await fetch(`${API_URL}/api/execute-change-plan`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify(payload)\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Server error: ${response.status} ${errorText}`);\n      }\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let accumulatedResponse = '';\n      while (true) {\n        const {\n          value,\n          done\n        } = await reader.read();\n        if (done) break;\n        accumulatedResponse += decoder.decode(value, {\n          stream: true\n        });\n        setMessages(prev => prev.map(m => {\n          if (m.id === loadingMessageId) {\n            return {\n              ...m,\n              text: accumulatedResponse,\n              isLoading: true\n            };\n          }\n          return m;\n        }));\n      }\n\n      // Final processing\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: accumulatedResponse,\n        isLoading: false\n      } : m));\n\n      // Reset change plan state\n      setPendingChangePlan(null);\n      setIsAnsweringQuestions(false);\n      setClarificationAnswers(['', '', '', '', '']);\n\n      // Refresh the sheet if needed\n      if (googleSheetsUrl && selectedSheetName) {\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 1000);\n      }\n    } catch (error) {\n      console.error('Error executing change plan:', error);\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: `âŒ ×©×’×™××” ×‘×‘×™×¦×•×¢ ×”×ª×•×›× ×™×ª: ${error.message}`,\n        isLoading: false\n      } : m));\n    } finally {\n      setIsStreamingResponse(false);\n    }\n  };\n  useEffect(() => {\n    // Load saved access token ONLY - no chat messages from localStorage\n    const savedToken = localStorage.getItem('accessToken');\n    if (savedToken) {\n      setAccessToken(savedToken);\n    }\n\n    // Only load PDF/Excel data from localStorage (temporary files, not chat history)\n    const savedPdfJson = localStorage.getItem('extractedPdf');\n    if (savedPdfJson) {\n      try {\n        const savedPdf = JSON.parse(savedPdfJson);\n        if (savedPdf && savedPdf.name && savedPdf.data) {\n          // Check if PDF still exists on server if it has a fileId\n          if (savedPdf.fileId) {\n            fetch(`${API_URL}/api/download-pdf/${savedPdf.fileId}`, {\n              method: 'HEAD',\n              credentials: 'include'\n            }).then(response => {\n              if (response.ok) {\n                setExtractedPdf(savedPdf);\n                setMessages(prev => [...prev, {\n                  text: `ðŸ“„ × ×ª×•× ×™× ×§×•×“×ž×™× ×©×—×•×œ×¦×• ×ž-PDF \"${savedPdf.name}\" × ×˜×¢× ×•.`,\n                  sender: 'system',\n                  timestamp: new Date(),\n                  id: Date.now()\n                }]);\n              } else {\n                // PDF no longer exists on server\n                console.log('ðŸ“„ PDF from localStorage no longer exists on server, removing...');\n                localStorage.removeItem('extractedPdf');\n              }\n            }).catch(() => {\n              // Error checking PDF, remove from localStorage\n              localStorage.removeItem('extractedPdf');\n            });\n          } else {\n            // Old PDF without fileId, just load it\n            setExtractedPdf(savedPdf);\n            setMessages(prev => [...prev, {\n              text: `ðŸ“„ × ×ª×•× ×™× ×§×•×“×ž×™× ×©×—×•×œ×¦×• ×ž-PDF \"${savedPdf.name}\" × ×˜×¢× ×•.`,\n              sender: 'system',\n              timestamp: new Date(),\n              id: Date.now()\n            }]);\n          }\n        }\n      } catch (e) {\n        console.error('Failed to parse extracted PDF data from localStorage', e);\n        localStorage.removeItem('extractedPdf');\n      }\n    }\n    const savedExcelJson = localStorage.getItem('extractedExcel');\n    if (savedExcelJson) {\n      try {\n        const savedExcel = JSON.parse(savedExcelJson);\n        if (savedExcel && savedExcel.name && savedExcel.data) {\n          setExtractedExcel(savedExcel);\n          setMessages(prev => [...prev, {\n            text: `ðŸ“Š × ×ª×•× ×™× ×§×•×“×ž×™× ×©×—×•×œ×¦×• ×ž-Excel \"${savedExcel.name}\" × ×˜×¢× ×•.`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }\n      } catch (e) {\n        console.error('Failed to parse extracted Excel data from localStorage', e);\n        localStorage.removeItem('extractedExcel');\n      }\n    }\n  }, []);\n\n  // Fetch user info when access token is available\n  useEffect(() => {\n    if (accessToken) {\n      fetchUserInfo();\n    }\n  }, [accessToken]);\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const token = params.get('token');\n    if (token) {\n      setAccessToken(token);\n      localStorage.setItem('accessToken', token);\n      setSnackbarMessage('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!');\n      setShowSnackbar(true);\n      window.history.replaceState({}, document.title, \"/\");\n    } else {\n      // Check if user is already authenticated\n      checkAuthStatus();\n    }\n  }, []);\n  const checkAuthStatus = async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/user`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n        if (data.accessToken) {\n          setAccessToken(data.accessToken);\n          localStorage.setItem('accessToken', data.accessToken);\n        }\n        setSnackbarMessage('×‘×¨×•×š ×”×‘× ×‘×—×–×¨×”!');\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.log('Not authenticated:', error);\n      // User is not authenticated, show login button\n    }\n  };\n  useEffect(() => {\n    var _chatEndRef$current;\n    (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = 'https://apis.google.com/js/api.js';\n    script.onload = () => window.gapi.load('picker', {\n      'callback': () => setIsPickerReady(true)\n    });\n    document.head.appendChild(script);\n  }, []);\n\n  // × ×™×”×•×œ ×’×œ×™×œ×” ×¢×‘×•×¨ iframe - ×”×’× ×” ×ž×™×•×—×“×ª ×¢×œ Mac gestures\n  useEffect(() => {\n    const handleWheel = e => {\n      if (isIframeHovered) {\n        // ×”×’× ×” ×¡×¤×¦×™×¤×™×ª ×¢×œ horizontal scrolling ×‘×ž××§\n        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\n          // ×–×” ×’×œ×™×œ×” ××•×¤×§×™×ª - ×‘×œ×•×§ ××ª ×”navigation gesture\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      }\n    };\n    const handleTouchStart = e => {\n      if (isIframeHovered) {\n        e.stopPropagation();\n      }\n    };\n    const handleTouchMove = e => {\n      if (isIframeHovered) {\n        e.stopPropagation();\n      }\n    };\n\n    // ×”×•×¡×£ event listeners ×¢× focus ×¢×œ gestures\n    document.addEventListener('wheel', handleWheel, {\n      passive: false\n    });\n    document.addEventListener('touchstart', handleTouchStart, {\n      passive: false\n    });\n    document.addEventListener('touchmove', handleTouchMove, {\n      passive: false\n    });\n    return () => {\n      document.removeEventListener('wheel', handleWheel);\n      document.removeEventListener('touchstart', handleTouchStart);\n      document.removeEventListener('touchmove', handleTouchMove);\n    };\n  }, [isIframeHovered]);\n\n  // ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ××•×˜×•×ž×˜×™×ª ×›×©×’×œ×™×•×Ÿ × ×‘×—×¨\n  useEffect(() => {\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\n      // Auto-check status when sheet is selected\n      // ×‘×“×™×§×” ××•×˜×•×ž×˜×™×ª ××—×¨×™ ×˜×¢×™× ×ª ×”×’×œ×™×•×Ÿ\n      const timer = setTimeout(() => {\n        checkUndoRedoStatus();\n        checkForGreenCells();\n      }, 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [selectedSheetName, isSheetSelected, currentSessionId]);\n  const fetchUserInfo = async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/user`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n      }\n    } catch (error) {\n      console.error('Error fetching user info:', error);\n    }\n  };\n  const handleSessionSelect = async sessionId => {\n    if (!sessionId) {\n      setCurrentSessionId(null);\n      setMessages([{\n        text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.',\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return;\n    }\n    setCurrentSessionId(sessionId);\n    try {\n      const response = await fetch(`${API_URL}/api/chat/session/${sessionId}`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const chatHistory = await response.json();\n        const loadedMessages = chatHistory.messages.map(msg => ({\n          text: msg.content,\n          sender: msg.role === 'user' ? 'user' : 'assistant',\n          timestamp: new Date(msg.timestamp),\n          id: msg._id || Date.now() + Math.random()\n        }));\n        setMessages(loadedMessages);\n        // Chat history loaded\n      }\n    } catch (error) {\n      console.error('Error loading chat session:', error);\n      setSnackbarMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×©×™×—×”');\n      setShowSnackbar(true);\n    }\n  };\n  const generateSessionId = () => {\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n  };\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET', valueRenderOption = 'FORMATTED_VALUE') => {\n    if (!accessToken) throw new Error('No access token available. Please log in.');\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n    try {\n      var _data$error;\n      let url, options;\n      if (method === 'GET') {\n        // ðŸ”¥ ×”×•×¡×£ ××ª valueRenderOption ×œ×§×¨×™××•×ª GET\n        const params = new URLSearchParams({\n          valueRenderOption\n        });\n        url = `${baseUrl}/values/${range}?${params}`;\n        console.log('ðŸ”¥ Google Sheets API call:', url);\n        options = {\n          method,\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          }\n        };\n      } else {\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\n        options = {\n          method,\n          headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            values\n          })\n        };\n      }\n      const response = await fetch(url, options);\n      const data = await response.json();\n      if (!response.ok) throw new Error(((_data$error = data.error) === null || _data$error === void 0 ? void 0 : _data$error.message) || 'API call failed');\n      return data;\n    } catch (error) {\n      console.error('Google Sheets API error:', error);\n      throw error;\n    }\n  };\n\n  // ðŸ”¥ ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ×©×™×œ×•×‘ ×¢×¨×›×™× ×•× ×•×¡×—××•×ª\n  const combineValuesAndFormulas = (values, formulas) => {\n    const combined = [];\n    console.log('ðŸ”¥ Starting combineValuesAndFormulas...');\n    console.log('ðŸ“Š Values:', (values === null || values === void 0 ? void 0 : values.length) || 0, 'rows');\n    console.log('ðŸ“‹ Formulas:', (formulas === null || formulas === void 0 ? void 0 : formulas.length) || 0, 'rows');\n    for (let row = 0; row < Math.max(values.length, formulas.length); row++) {\n      const valueRow = values[row] || [];\n      const formulaRow = formulas[row] || [];\n      const combinedRow = [];\n      for (let col = 0; col < Math.max(valueRow.length, formulaRow.length); col++) {\n        const value = valueRow[col] || '';\n        const formula = formulaRow[col] || '';\n\n        // ðŸ”¥ ×œ×•×’ ×œ×‘×“×™×§×” (×¨×§ ×œ×©×•×¨×” ×¨××©×•× ×”)\n        if (row === 0 && col < 3) {\n          console.log(`Cell [${row},${col}]: value=\"${value}\" (${typeof value}), formula=\"${formula}\" (${typeof formula})`);\n        }\n\n        // ðŸ”¥ ×ª×™×§×•×Ÿ: ×‘×“×•×§ ×©×–×” string ×•×ž×ª×—×™×œ ×‘-= ×œ×¤× ×™ ×©×ž×’×“×™×¨×™× ×›× ×•×¡×—×”\n        if (typeof formula === 'string' && formula.length > 0 && formula.startsWith('=')) {\n          // ×–×• × ×•×¡×—×” ××ž×™×ª×™×ª\n          combinedRow.push({\n            value: value,\n            formula: formula,\n            type: 'formula'\n          });\n        } else {\n          // ×–×” ×¢×¨×š ×¨×’×™×œ (×œ× × ×•×¡×—×”) - ×§×— ××ª ×”×¢×¨×š ××• ××ª ×ž×” ×©×™×© ×‘formula ×× ×”×¢×¨×š ×¨×™×§\n          const finalValue = value !== '' ? value : formula !== '' ? formula : '';\n          combinedRow.push({\n            value: finalValue,\n            type: 'literal'\n          });\n        }\n      }\n      combined.push(combinedRow);\n    }\n    console.log('ðŸ”¥ Combined values and formulas:', combined.slice(0, 2)); // ×¨×§ 2 ×©×•×¨×•×ª ×¨××©×•× ×•×ª\n    return combined;\n  };\n\n  // ðŸ”¥ ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ× ×™×ª×•×— ×”×’×œ×™×•×Ÿ ×¢× Gemini\n  const analyzeSheetWithGemini = async (sheetData, sheetName, currentExtractedPdf = null) => {\n    try {\n      var _result$summary, _result$instructions;\n      setMessages(prev => [...prev, {\n        text: `ðŸ” ×ž× ×ª×— ××ª ×ž×‘× ×” ×”×’×œ×™×•×Ÿ \"${sheetName}\" ×¢× AI...`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      const payload = {\n        sheetData: sheetData,\n        sheetName: sheetName,\n        sessionId: sessionId,\n        analysisType: 'initial_analysis'\n      };\n      const response = await fetch(`${API_URL}/api/analyze-sheet`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify(payload)\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n\n      // ×©×ž×•×¨ ××ª ×”×ª×•×¦××•×ª\n      setSheetAnalysis(result.summary);\n      setSheetInstructions(result.instructions); // ×©×ž×•×¨ ××ª ×”×”×•×¨××•×ª ×©×—×–×¨×• ×ž×”×‘×§×× ×“\n\n      // ×”×¦×’ ××ª ×”×¡×™×›×•× ×œ×ž×©×ª×ž×©\n      setMessages(prev => [...prev, {\n        text: `ðŸ“Š × ×™×ª×•×— ×”×’×œ×™×•×Ÿ:\\n${result.summary}`,\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      console.log('ðŸ”¥ Sheet analysis completed:', result);\n      console.log('ðŸ“ Sheet summary saved:', (_result$summary = result.summary) === null || _result$summary === void 0 ? void 0 : _result$summary.length, 'characters');\n      console.log('ðŸ“‹ Sheet instructions saved:', (_result$instructions = result.instructions) === null || _result$instructions === void 0 ? void 0 : _result$instructions.length, 'characters');\n\n      // ×”×•×“×¢×” ×§×¦×¨×” ×©×”×”×•×¨××•×ª × ×©×ž×¨×•\n      setTimeout(() => {\n        setMessages(prev => [...prev, {\n          text: `âœ… ×”×•×¨××•×ª ×¢×‘×•×“×” ×ž×¤×•×¨×˜×•×ª × ×©×ž×¨×• ×œ×ž×¢×¨×›×ª ×¢×‘×•×¨ ×©×™×—×•×ª ×¢×ª×™×“×™×•×ª`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }, 1000);\n\n      // Return the analysis results for use in handleSheetChange\n      return {\n        instructions: result.instructions,\n        summary: result.summary\n      };\n    } catch (error) {\n      console.error('Error analyzing sheet:', error);\n      setMessages(prev => [...prev, {\n        text: `âŒ ×©×’×™××” ×‘× ×™×ª×•×— ×”×’×œ×™×•×Ÿ: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n    }\n  };\n  const extractSpreadsheetId = url => {\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\n    return match ? match[1] : null;\n  };\n\n  // ×¤×•× ×§×¦×™×” ×œ×™×¦×•×¨ URL ×¢× ×”×’×œ×™×•×Ÿ ×”× ×›×•×Ÿ\n  const getSheetUrlWithGid = (baseUrl, sheetName) => {\n    if (!sheetName || !sheetsMetadata) return baseUrl;\n    const selectedSheet = sheetsMetadata.find(sheet => sheet.name === sheetName);\n    if (!selectedSheet) return baseUrl;\n\n    // ×”×¡×¨ ×›×œ gid ×§×™×™× ×ž×”-URL\n    const cleanUrl = baseUrl.split('#')[0];\n\n    // ×”×•×¡×£ ××ª ×”-gid ×”×—×“×©\n    return `${cleanUrl}#gid=${selectedSheet.id}`;\n  };\n  const getSpreadsheetMetadata = async spreadsheetId => {\n    if (!accessToken) return [];\n    try {\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\n      const response = await fetch(url, {\n        headers: {\n          'Authorization': `Bearer ${accessToken}`\n        }\n      });\n      if (!response.ok) throw new Error('Failed to fetch spreadsheet metadata');\n      const metadata = await response.json();\n      return metadata.sheets.map(sheet => ({\n        name: sheet.properties.title,\n        id: sheet.properties.sheetId\n      }));\n    } catch (error) {\n      console.error('Error fetching spreadsheet metadata:', error);\n      return [];\n    }\n  };\n  const handleFileUpload = async (event, fileType) => {\n    const file = event.target.files[0];\n    if (!file) return;\n    if (file.type === 'application/pdf') {\n      // Clean all previous PDF-related state\n      setExtractedPdf(null);\n      localStorage.removeItem('extractedPdf');\n      setIsExtractingData(true);\n\n      // Remove any previous PDF-related messages\n      setMessages(prev => prev.filter(msg => !msg.text.includes('× ×ª×•× ×™× ×—×•×œ×¦×•') && !msg.text.includes('×©×’×™××” ×‘×—×™×œ×•×¥') && !msg.text.includes('× ×ª×•× ×™ ×”-PDF × ×•×§×•')));\n      setMessages(prev => [...prev, {\n        text: `â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ \"${file.name}\"...`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      const formData = new FormData();\n      formData.append('pdf', file);\n\n      // ðŸ”¥ ×× ×™×© ×’×œ×™×•×Ÿ ×˜×¢×•×Ÿ, ×©×œ×•×£ ××ª ×”× ×ª×•× ×™× ×•×©×œ×— ××•×ª×\n      if (isSheetLoaded && isSheetSelected) {\n        const currentSheetData = await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName);\n        if (currentSheetData) {\n          formData.append('sheetData', JSON.stringify(currentSheetData));\n        }\n        if (sheetInstructions) {\n          formData.append('sheetInstructions', sheetInstructions);\n        }\n        if (sheetAnalysis) {\n          formData.append('sheetAnalysis', sheetAnalysis);\n        }\n        if (selectedSheetName) {\n          formData.append('sheetName', selectedSheetName);\n        }\n        console.log('ðŸ”¥ Sending PDF with full sheet context:', {\n          hasSheetData: !!currentSheetData,\n          sheetDataLength: currentSheetData ? currentSheetData.length : 0,\n          hasInstructions: !!sheetInstructions,\n          instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\n          hasAnalysis: !!sheetAnalysis,\n          analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\n          sheetName: selectedSheetName\n        });\n      } else {\n        console.log('ðŸ”¥ Sending PDF without sheet context (simple OCR mode)');\n      }\n      fetch(`${API_URL}/api/extract-pdf-data`, {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      }).then(response => {\n        if (!response.ok) {\n          return response.json().then(err => {\n            throw new Error(err.error || 'Failed to extract data');\n          });\n        }\n        return response.json();\n      }).then(result => {\n        const pdfInfo = {\n          name: file.name,\n          data: result,\n          fileId: result.fileId,\n          // ×©×ž×™×¨×ª fileId ×œ×¤×ª×™×—×” ×¢×ª×™×“×™×ª\n          processingMode: result.processingMode || 'structured',\n          // track processing mode\n          isFullText: result.isFullText || false // track if this is full text\n        };\n        setExtractedPdf(pdfInfo);\n        localStorage.setItem('extractedPdf', JSON.stringify(pdfInfo));\n        setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™×')));\n\n        // Different success messages based on processing mode\n        let successMessage;\n        if (result.processingMode === 'simple_ocr') {\n          successMessage = `âœ… ×˜×§×¡×˜ ×—×•×œ×¥ ×ž-\"${file.name}\". × ×™×ª×Ÿ ×œ×©××•×œ ×©××œ×•×ª ×¢×œ ×”×ª×•×›×Ÿ. ×˜×¢×Ÿ ×’×™×œ×™×•×Ÿ ×œ× ×™×ª×•×— ×ž×¤×•×¨×˜.`;\n        } else {\n          successMessage = result.fileId ? `âœ… × ×ª×•× ×™× ×—×•×œ×¦×• ×‘×”×¦×œ×—×” ×ž-\"${file.name}\". ×›×¢×ª × ×™×ª×Ÿ ×œ×©××•×œ ×©××œ×•×ª ×¢×œ ×”×§×•×‘×¥ ××• ×œ×—×–×•×¨ ×œ×§×•×‘×¥ ×”×ž×§×•×¨×™.` : `âœ… × ×ª×•× ×™× ×—×•×œ×¦×• ×‘×”×¦×œ×—×” ×ž-\"${file.name}\". ×›×¢×ª × ×™×ª×Ÿ ×œ×©××•×œ ×©××œ×•×ª ×¢×œ ×”×§×•×‘×¥.`;\n        }\n        setMessages(prev => [...prev, {\n          text: successMessage,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).catch(error => {\n        console.error('PDF data extraction failed:', error);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™×')));\n        setMessages(prev => [...prev, {\n          text: `âŒ ×©×’×™××” ×‘×—×™×œ×•×¥ × ×ª×•× ×™× ×ž-\"${file.name}\": ${error.message}`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }).finally(() => {\n        setIsExtractingData(false);\n      });\n    } else if (fileType === 'Excel') {\n      // Ask user if they want to convert to Google Sheets\n      const shouldConvert = window.confirm(`×”×× ×‘×¨×¦×•× ×š ×œ×”×ž×™×¨ ××ª ×§×•×‘×¥ ×”-Excel \"${file.name}\" ×œ-Google Sheets?\\n\\n` + `×›×Ÿ - ×”×¢×œ××” ×œ-Google Drive ×•×”×ž×¨×” ×œ-Google Sheets\\n` + `×œ× - ×—×™×œ×•×¥ × ×ª×•× ×™× ×ž×§×•×ž×™ ×‘×œ×‘×“`);\n      if (shouldConvert) {\n        // Convert to Google Sheets\n        setIsExtractingExcel(true);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('×ž×ž×™×¨') && !msg.text.includes('Google Sheets') && !msg.text.includes('×©×’×™××” ×‘×”×ž×¨×”')));\n        setMessages(prev => [...prev, {\n          text: `ðŸ”„ ×ž×ž×™×¨ ××ª \"${file.name}\" ×œ-Google Sheets...`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n        const formData = new FormData();\n        formData.append('excel', file);\n        fetch(`${API_URL}/api/excel-to-sheets`, {\n          method: 'POST',\n          body: formData,\n          credentials: 'include'\n        }).then(response => {\n          console.log('ðŸ” Response status:', response.status);\n          console.log('ðŸ” Response headers:', Object.fromEntries(response.headers.entries()));\n\n          // Clone the response to read it as text first\n          return response.clone().text().then(responseText => {\n            console.log('ðŸ” Raw response text:', responseText);\n            if (!response.ok) {\n              // Try to parse as JSON for error, but if it fails, use the text\n              try {\n                const errorData = JSON.parse(responseText);\n                throw new Error(errorData.error || 'Failed to convert Excel to Google Sheets');\n              } catch (parseError) {\n                throw new Error(`HTTP ${response.status}: ${responseText}`);\n              }\n            }\n\n            // Try to parse the successful response as JSON\n            try {\n              return JSON.parse(responseText);\n            } catch (parseError) {\n              console.error('ðŸ” JSON parse error:', parseError);\n              throw new Error(`Invalid JSON response: ${responseText.substring(0, 200)}...`);\n            }\n          });\n        }).then(result => {\n          setMessages(prev => prev.filter(msg => !msg.text.includes('ðŸ”„ ×ž×ž×™×¨')));\n          setMessages(prev => [...prev, {\n            text: `âœ… ×”×§×•×‘×¥ \"${file.name}\" ×”×•×ž×¨ ×‘×”×¦×œ×—×” ×œ-Google Sheets!`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n\n          // Open the created Google Sheet in a new tab\n          if (result.url) {\n            window.open(result.url, '_blank');\n            setMessages(prev => [...prev, {\n              text: `ðŸ“Š Google Sheets × ×¤×ª×— ×‘×›×¨×˜×™×¡×™×™×” ×—×“×©×”`,\n              sender: 'system',\n              timestamp: new Date(),\n              id: Date.now()\n            }]);\n\n            // Optionally, also load it in the current interface\n            handleGoogleSheetsUrl(result.url);\n          }\n        }).catch(error => {\n          console.error('Excel to Google Sheets conversion failed:', error);\n          setMessages(prev => prev.filter(msg => !msg.text.includes('ðŸ”„ ×ž×ž×™×¨')));\n          setMessages(prev => [...prev, {\n            text: `âŒ ×©×’×™××” ×‘×”×ž×¨×” ×œ-Google Sheets: ${error.message}`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }).finally(() => {\n          setIsExtractingExcel(false);\n        });\n      } else {\n        // Original local extraction logic\n        setExtractedExcel(null);\n        localStorage.removeItem('extractedExcel');\n        setIsExtractingExcel(true);\n        setMessages(prev => prev.filter(msg => !msg.text.includes('×—×•×œ×¦×• ×ž-Excel') && !msg.text.includes('×©×’×™××” ×‘×—×™×œ×•×¥ Excel') && !msg.text.includes('× ×ª×•× ×™ ×”-Excel × ×•×§×•')));\n        setMessages(prev => [...prev, {\n          text: `â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ Excel \"${file.name}\"...`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n        const formData = new FormData();\n        formData.append('excel', file);\n        fetch(`${API_URL}/api/extract-excel-data`, {\n          method: 'POST',\n          body: formData\n        }).then(response => {\n          if (!response.ok) {\n            return response.json().then(err => {\n              throw new Error(err.error || 'Failed to extract Excel data');\n            });\n          }\n          return response.json();\n        }).then(result => {\n          const excelInfo = {\n            name: file.name,\n            data: result.data\n          };\n          setExtractedExcel(excelInfo);\n          localStorage.setItem('extractedExcel', JSON.stringify(excelInfo));\n          setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ Excel')));\n          setMessages(prev => [...prev, {\n            text: `âœ… × ×ª×•× ×™× ×—×•×œ×¦×• ×‘×”×¦×œ×—×” ×ž-Excel \"${file.name}\".`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }).catch(error => {\n          console.error('Excel data extraction failed:', error);\n          setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ Excel')));\n          setMessages(prev => [...prev, {\n            text: `âŒ ×©×’×™××” ×‘×—×™×œ×•×¥ × ×ª×•× ×™ Excel: ${error.message}`,\n            sender: 'system',\n            timestamp: new Date(),\n            id: Date.now()\n          }]);\n        }).finally(() => {\n          setIsExtractingExcel(false);\n        });\n      }\n    }\n  };\n  const loadAvailableSheets = async spreadsheetId => {\n    setIsLoadingSheets(true);\n    setIsSheetSelected(false); // Reset selection\n    setSelectedSheetName(''); // Clear any previous selection\n    try {\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\n      setAvailableSheets(sheets);\n      setSheetsMetadata(sheets);\n      // ×¨×§ ×”×•×“×¢×” ×©×”×’×œ×™×•× ×•×ª × ×˜×¢× ×• - ×‘×œ×™ ×œ×‘×—×•×¨ ×’×œ×™×•×Ÿ ××•×˜×•×ž×˜×™×ª\n      if (sheets.length > 0) {\n        setMessages(prev => [...prev, {\n          text: `ðŸ“‹ × ×ž×¦××• ${sheets.length} ×’×œ×™×•× ×•×ª - ×‘×—×¨ ×’×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }\n    } finally {\n      setIsLoadingSheets(false);\n    }\n  };\n  const handleGoogleSheetsUrl = async url => {\n    setGoogleSheetsUrl(url);\n    setIsSheetLoaded(true);\n    setIsSheetSelected(false); // Reset sheet selection for new spreadsheet\n    setIsAgentMode(false); // Reset agent mode for new spreadsheet\n    const spreadsheetId = extractSpreadsheetId(url);\n    if (spreadsheetId && accessToken) await loadAvailableSheets(spreadsheetId);\n  };\n  const handleSheetChange = async newSheetName => {\n    if (newSheetName === selectedSheetName) return;\n    setSelectedSheetName(newSheetName);\n    setIsSheetSelected(true); // ×ž×¡×ž×Ÿ ×©× ×‘×—×¨ ×’×œ×™×•×Ÿ\n\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\n    if (spreadsheetId) {\n      // ðŸ”¥ ×©×œ×•×£ × ×ª×•× ×™ ×’×œ×™×•×Ÿ ×¢× ×¢×¨×›×™× ×•× ×•×¡×—××•×ª\n      const sheetData = await getSheetData(spreadsheetId, newSheetName);\n      setMessages(prev => [...prev, {\n        text: `âœ… ×ž×—×•×‘×¨ ×œ×’×œ×™×•×Ÿ: ${newSheetName}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n\n      // ðŸ”¥ × ×ª×— ××ª ×”×’×œ×™×•×Ÿ ×¢× Gemini\n      if (sheetData) {\n        const analysisResult = await analyzeSheetWithGemini(sheetData, newSheetName, extractedPdf);\n\n        // ðŸ”¥ Reanalyze PDF if it exists and is in simple OCR mode\n        if (extractedPdf && extractedPdf.processingMode === 'simple_ocr' && analysisResult) {\n          console.log('ðŸ”„ PDF found in simple_ocr mode, triggering reanalysis with sheet context...');\n          await reanalyzePdfWithSheetContext(sheetData, analysisResult.instructions, analysisResult.summary, newSheetName);\n        }\n      }\n    }\n  };\n\n  // ðŸ”¥ Function to reanalyze PDF when sheet context becomes available\n  const reanalyzePdfWithSheetContext = async (sheetData, sheetInstructions, sheetAnalysis, selectedSheetName) => {\n    if (!extractedPdf || !extractedPdf.fileId || extractedPdf.processingMode === 'structured') {\n      return; // No PDF to reanalyze or already analyzed\n    }\n    console.log('ðŸ”„ Reanalyzing PDF with new sheet context...');\n    setMessages(prev => [...prev, {\n      text: `ðŸ”„ ×ž× ×ª×— ×ž×—×“×© ××ª \"${extractedPdf.name}\" ×¢× ×”×§×©×¨ ×”×’×œ×™×•×Ÿ ×”×—×“×©...`,\n      sender: 'system',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n    try {\n      // Create FormData for re-analysis\n      const formData = new FormData();\n\n      // We need to fetch the PDF file again - check if it exists first\n      const pdfResponse = await fetch(`${API_URL}/api/download-pdf/${extractedPdf.fileId}`, {\n        credentials: 'include'\n      });\n      if (!pdfResponse.ok) {\n        // PDF no longer exists on server - clean up state\n        console.log('âŒ PDF file no longer exists on server, cleaning up...');\n        setExtractedPdf(null);\n        localStorage.removeItem('extractedPdf');\n        setMessages(prev => prev.filter(msg => !msg.text.includes(extractedPdf.name)));\n        return;\n      }\n      const pdfBlob = await pdfResponse.blob();\n      formData.append('pdf', pdfBlob, extractedPdf.name);\n\n      // Add sheet context data directly to FormData\n      console.log('ðŸ”„ Reanalyzing PDF with sheet context:', {\n        hasSheetData: !!sheetData,\n        sheetDataLength: sheetData ? sheetData.length : 0,\n        hasInstructions: !!sheetInstructions,\n        instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\n        hasAnalysis: !!sheetAnalysis,\n        analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\n        sheetName: selectedSheetName\n      });\n      if (sheetData) {\n        formData.append('sheetData', JSON.stringify(sheetData));\n      }\n      if (sheetInstructions) {\n        formData.append('sheetInstructions', sheetInstructions);\n      }\n      if (sheetAnalysis) {\n        formData.append('sheetAnalysis', sheetAnalysis);\n      }\n      if (selectedSheetName) {\n        formData.append('sheetName', selectedSheetName);\n      }\n      const response = await fetch(`${API_URL}/api/extract-pdf-data`, {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      if (!response.ok) {\n        throw new Error('Failed to reanalyze PDF');\n      }\n      const result = await response.json();\n\n      // Update PDF info with new analysis\n      const updatedPdfInfo = {\n        ...extractedPdf,\n        data: result,\n        processingMode: result.processingMode || 'structured',\n        isFullText: result.isFullText || false\n      };\n      setExtractedPdf(updatedPdfInfo);\n      localStorage.setItem('extractedPdf', JSON.stringify(updatedPdfInfo));\n      setMessages(prev => [...prev, {\n        text: `âœ… \"${extractedPdf.name}\" × ×•×ª×— ×ž×—×“×© ×‘×”×¦×œ×—×” ×¢× ×”×§×©×¨ ×”×’×œ×™×•×Ÿ`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n    } catch (error) {\n      console.error('Error reanalyzing PDF:', error);\n      setMessages(prev => [...prev, {\n        text: `âŒ ×©×’×™××” ×‘× ×™×ª×•×— ×ž×—×“×© ×©×œ \"${extractedPdf.name}\": ${error.message}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n    }\n  };\n  const pickerCallback = data => {\n    if (data.action === window.google.picker.Action.PICKED) {\n      const doc = data.docs[0];\n      setFileName(doc.name);\n      handleGoogleSheetsUrl(doc.url);\n      setSnackbarMessage(`×˜×¢×Ÿ ×’×™×œ×™×•×Ÿ: ${doc.name}`);\n      setShowSnackbar(true);\n    }\n  };\n  const createPicker = () => {\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY;\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\n    if (!clientId || !developerKey) {\n      setAuthError('×ž×¤×ª×—×•×ª API ××™× × ×ž×•×’×“×¨×™× ×›×¨××•×™.');\n      setShowSnackbar(true);\n      return;\n    }\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\n    const picker = new window.google.picker.PickerBuilder().setAppId(clientId.split('-')[0]).setOAuthToken(accessToken).setDeveloperKey(developerKey).addView(view).setCallback(pickerCallback).build();\n    picker.setVisible(true);\n  };\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\n    if (!accessToken) return null;\n    try {\n      var _valuesResponse$value, _formulasResponse$val, _valuesResponse$value2, _formulasResponse$val2;\n      const range = sheetName ? `'${sheetName}'!A1:Z1000` : 'A1:Z1000';\n      console.log('ðŸ”¥ Fetching sheet data with values and formulas...');\n\n      // ðŸ”¥ ×§×¨×™××” 1: ×©×œ×•×£ ×¢×¨×›×™× ×ž×¢×•×¦×‘×™×\n      const valuesResponse = await makeGoogleSheetsAPICall(spreadsheetId, range, null, 'GET', 'FORMATTED_VALUE');\n\n      // ðŸ”¥ ×§×¨×™××” 2: ×©×œ×•×£ × ×•×¡×—××•×ª  \n      const formulasResponse = await makeGoogleSheetsAPICall(spreadsheetId, range, null, 'GET', 'FORMULA');\n      console.log('ðŸ“Š Values response:', ((_valuesResponse$value = valuesResponse.values) === null || _valuesResponse$value === void 0 ? void 0 : _valuesResponse$value.length) || 0, 'rows');\n      console.log('ðŸ“‹ Formulas response:', ((_formulasResponse$val = formulasResponse.values) === null || _formulasResponse$val === void 0 ? void 0 : _formulasResponse$val.length) || 0, 'rows');\n\n      // ðŸ”¥ ×œ×•×’×™× × ×•×¡×¤×™× ×œ×‘×“×™×§×”\n      if (((_valuesResponse$value2 = valuesResponse.values) === null || _valuesResponse$value2 === void 0 ? void 0 : _valuesResponse$value2.length) > 0) {\n        console.log('ðŸ“Š Sample values row 0:', valuesResponse.values[0]);\n      }\n      if (((_formulasResponse$val2 = formulasResponse.values) === null || _formulasResponse$val2 === void 0 ? void 0 : _formulasResponse$val2.length) > 0) {\n        console.log('ðŸ“‹ Sample formulas row 0:', formulasResponse.values[0]);\n      }\n\n      // ðŸ”¥ ×©×œ×‘ ××ª ×©× ×™×”× ×œ××•×‘×™×™×§×˜ ×¢×©×™×¨\n      const combinedData = combineValuesAndFormulas(valuesResponse.values || [], formulasResponse.values || []);\n\n      // ðŸ”¥ ×”×¦×’ ×”×•×“×¢×” ×œ×ž×©×ª×ž×© ×¢×œ ×”×©×™×¤×•×¨\n      const formulaCount = combinedData.flat().filter(cell => cell.type === 'formula').length;\n      if (formulaCount > 0) {\n        console.log('ðŸ”¥ Sample formula cells:', combinedData.flat().filter(cell => cell.type === 'formula').slice(0, 3));\n        setMessages(prev => [...prev, {\n          text: `âœ¨ ×’×™×œ×™×•×Ÿ × ×˜×¢×Ÿ ×¢× ${formulaCount} × ×•×¡×—××•×ª - ×›×¢×ª ×”-AI ×™×›×•×œ ×œ×¨××•×ª ×’× ××ª ×”× ×•×¡×—××•×ª ×•×’× ××ª ×”×¢×¨×›×™×!`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      } else {\n        setMessages(prev => [...prev, {\n          text: `ðŸ“Š ×’×™×œ×™×•×Ÿ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×” - ×ž×›×™×œ × ×ª×•× ×™× ××‘×œ ×œ× × ×ž×¦××• × ×•×¡×—××•×ª`,\n          sender: 'system',\n          timestamp: new Date(),\n          id: Date.now()\n        }]);\n      }\n      return combinedData;\n    } catch (error) {\n      console.error('Failed to fetch sheet data:', error);\n      console.error('Error details:', {\n        message: error.message,\n        stack: error.stack\n      });\n      setMessages(prev => [...prev, {\n        text: `âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×’×™×œ×™×•×Ÿ: ${error.message}`,\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return null;\n    }\n  };\n  const startNewChat = () => {\n    setCurrentSessionId(null);\n    setMessages([{\n      text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.',\n      sender: 'assistant',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n    // ××¤×¡ ×ž×¦×‘ Agent Mode ×× ××™×Ÿ ×’×œ×™×•×Ÿ × ×‘×—×¨\n    if (!isSheetSelected) {\n      setIsAgentMode(false);\n    }\n    // ××¤×¡ ×ž×¦×‘ Undo/Redo\n    setCanUndo(false);\n    setCanRedo(false);\n    setHasGreenCells(false);\n    setChangesCount(0);\n    setSheetAnalysis(null);\n    setSheetInstructions(null);\n  };\n  const handleLogout = async () => {\n    try {\n      // Call logout endpoint\n      await fetch(`${API_URL}/auth/logout`, {\n        credentials: 'include'\n      });\n\n      // Clear local state\n      setAccessToken('');\n      setUser(null);\n      setCurrentSessionId(null);\n      setIsSheetSelected(false);\n      setIsAgentMode(false);\n      setCanUndo(false);\n      setCanRedo(false);\n      setHasGreenCells(false);\n      setChangesCount(0);\n      setSheetAnalysis(null);\n      setSheetInstructions(null);\n      localStorage.removeItem('accessToken');\n\n      // Reset session ID for new session\n      setSessionId(Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15));\n\n      // Reset messages\n      setMessages([{\n        text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.',\n        sender: 'assistant',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      setSnackbarMessage('×”×ª× ×ª×§×ª ×‘×”×¦×œ×—×”!');\n      setShowSnackbar(true);\n    } catch (error) {\n      console.error('Error during logout:', error);\n    }\n  };\n\n  // ðŸ”„ Undo/Redo Functions\n  const checkUndoRedoStatus = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\n        method: 'GET',\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n      }\n    } catch (error) {\n      console.error('Error checking undo/redo status:', error);\n    }\n  };\n\n  // ðŸŸ¢ Check for green cells\n  const checkForGreenCells = async () => {\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId || isCheckingGreenCells) return;\n    setIsCheckingGreenCells(true);\n    try {\n      // Simple check - if there are undo-able actions of type AI_ACTION that were recently executed\n      // we assume there might be green cells\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const status = await response.json();\n        // For now, assume green cells exist if there are recent AI actions to undo\n        const hasChanges = status.canUndo;\n        // Debug: checkForGreenCells result\n        console.log('ðŸŸ¢ Full status from backend:', status);\n        console.log('ðŸŸ¢ hasGreenCells:', hasChanges, 'changesCount:', status.changesCount);\n        setHasGreenCells(hasChanges);\n\n        // ×¢×“×›×•×Ÿ ×¡×¤×™×¨×ª ×”×©×™× ×•×™×™× ×ž×”×‘×§×¢× ×“\n        setChangesCount(status.changesCount || 0);\n      }\n    } catch (error) {\n      console.error('Error checking for green cells:', error);\n      setHasGreenCells(false);\n      setChangesCount(0);\n    } finally {\n      setIsCheckingGreenCells(false);\n    }\n  };\n\n  // âœ… Approve All Changes\n  const approveAllChanges = async () => {\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\n    try {\n      var _googleSheetsUrl$matc, _availableSheets$find;\n      const spreadsheetId = (_googleSheetsUrl$matc = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)) === null || _googleSheetsUrl$matc === void 0 ? void 0 : _googleSheetsUrl$matc[1];\n      const sheetId = ((_availableSheets$find = availableSheets.find(s => s.name === selectedSheetName)) === null || _availableSheets$find === void 0 ? void 0 : _availableSheets$find.id) || 0;\n      const response = await fetch(`${API_URL}/api/action/approve-all`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          spreadsheetId: spreadsheetId,\n          selectedSheetName: selectedSheetName,\n          sheetId: sheetId,\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const result = await response.json();\n        setSnackbarMessage(result.message || 'âœ… ×›×œ ×”×©×™× ×•×™×™× ××•×©×¨×•');\n        setShowSnackbar(true);\n\n        // Refresh status\n        await checkUndoRedoStatus();\n        await checkForGreenCells();\n\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 500);\n      } else {\n        throw new Error('Failed to approve changes');\n      }\n    } catch (error) {\n      console.error('Error approving all changes:', error);\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘××™×©×•×¨ ×”×©×™× ×•×™×™×');\n      setShowSnackbar(true);\n    }\n  };\n\n  // âŒ Reject All Changes\n  const rejectAllChanges = async () => {\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\n    try {\n      var _googleSheetsUrl$matc2, _availableSheets$find2;\n      const spreadsheetId = (_googleSheetsUrl$matc2 = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)) === null || _googleSheetsUrl$matc2 === void 0 ? void 0 : _googleSheetsUrl$matc2[1];\n      const sheetId = ((_availableSheets$find2 = availableSheets.find(s => s.name === selectedSheetName)) === null || _availableSheets$find2 === void 0 ? void 0 : _availableSheets$find2.id) || 0;\n      const response = await fetch(`${API_URL}/api/action/reject-all`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          spreadsheetId: spreadsheetId,\n          selectedSheetName: selectedSheetName,\n          sheetId: sheetId,\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const result = await response.json();\n        setSnackbarMessage(result.message || 'âŒ ×›×œ ×”×©×™× ×•×™×™× × ×“×—×•');\n        setShowSnackbar(true);\n\n        // Refresh status\n        await checkUndoRedoStatus();\n        await checkForGreenCells();\n\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\n        setTimeout(() => {\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n          if (iframe) {\n            iframe.src = iframe.src;\n          }\n        }, 500);\n      } else {\n        throw new Error('Failed to reject changes');\n      }\n    } catch (error) {\n      console.error('Error rejecting all changes:', error);\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘×“×—×™×™×ª ×”×©×™× ×•×™×™×');\n      setShowSnackbar(true);\n    }\n  };\n  const undoAction = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/undo`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n        setSnackbarMessage('â†©ï¸ ' + data.message);\n        setShowSnackbar(true);\n\n        // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×§×‘×œ/×“×—×”\n        await checkForGreenCells();\n\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 500); // ×”×©×”×™×” ×§×¦×¨×” ×œ×¤× ×™ ×¨×¢× ×•×Ÿ\n        }\n      } else {\n        const error = await response.json();\n        setSnackbarMessage('âŒ ×©×’×™××” ×‘×‘×™×˜×•×œ: ' + error.error);\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.error('Error in undo action:', error);\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘×‘×™×˜×•×œ ×”×¤×¢×•×œ×”');\n      setShowSnackbar(true);\n    }\n  };\n  const redoAction = async () => {\n    if (!currentSessionId) return;\n    try {\n      const response = await fetch(`${API_URL}/api/action/redo`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          sessionId: currentSessionId\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setCanUndo(data.canUndo);\n        setCanRedo(data.canRedo);\n        setSnackbarMessage('â¤´ï¸ ' + data.message);\n        setShowSnackbar(true);\n\n        // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×§×‘×œ/×“×—×”\n        await checkForGreenCells();\n\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 500); // ×”×©×”×™×” ×§×¦×¨×” ×œ×¤× ×™ ×¨×¢× ×•×Ÿ\n        }\n      } else {\n        const error = await response.json();\n        setSnackbarMessage('âŒ ×©×’×™××” ×‘×©×—×–×•×¨: ' + error.error);\n        setShowSnackbar(true);\n      }\n    } catch (error) {\n      console.error('Error in redo action:', error);\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘×©×—×–×•×¨ ×”×¤×¢×•×œ×”');\n      setShowSnackbar(true);\n    }\n  };\n  const sendMessage = async () => {\n    if (!question.trim() || isStreamingResponse) return;\n\n    // ðŸ›¡ï¸ ×‘×“×™×§×” ×—×“×©×” - ×× ×™×© ×’×œ×™×•×Ÿ ××‘×œ ×œ× × ×‘×—×¨ ×’×œ×™×•×Ÿ ×¡×¤×¦×™×¤×™\n    if (isSheetLoaded && !isSheetSelected) {\n      setMessages(prev => [...prev, {\n        text: 'âŒ ×™×© ×œ×‘×—×•×¨ ×’×œ×™×•×Ÿ ×ª×—×™×œ×” ×ž×”×¨×©×™×ž×” ×œ×ž×¢×œ×”',\n        sender: 'system',\n        timestamp: new Date(),\n        id: Date.now()\n      }]);\n      return;\n    }\n    const currentQuestion = question;\n    const userMessage = {\n      text: currentQuestion,\n      sender: 'user',\n      timestamp: new Date(),\n      id: Date.now()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    setQuestion('');\n    setIsStreamingResponse(true);\n\n    // Generate session ID if this is a new conversation\n    let sessionId = currentSessionId;\n    if (!sessionId) {\n      sessionId = generateSessionId();\n      setCurrentSessionId(sessionId);\n    }\n    const loadingMessageId = Date.now() + 1;\n    setMessages(prev => [...prev, {\n      text: '',\n      sender: 'assistant',\n      isLoading: true,\n      timestamp: new Date(),\n      id: loadingMessageId\n    }]);\n\n    // User message will be saved automatically by backend in /api/chat-stream\n\n    try {\n      const sheetData = isSheetLoaded && isSheetSelected ? await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\n\n      // We need to get the spreadsheetId here to send it\n      const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\n      const payload = {\n        question: currentQuestion,\n        sheetData: sheetData,\n        extractedPdfData: extractedPdf ? extractedPdf.data : null,\n        extractedExcelData: extractedExcel ? extractedExcel.data : null,\n        isAgentMode: isAgentMode,\n        isSignificantChange: isSignificantChange,\n        // ðŸŽšï¸ ×”×•×¡×£ ×ž×¦×‘ ×©×™× ×•×™ ×ž×©×ž×¢×•×ª×™\n        conversationHistory: messages.filter(m => !m.isLoading).map(m => ({\n          role: m.sender === 'user' ? 'user' : 'model',\n          parts: [{\n            text: m.text\n          }]\n        })),\n        spreadsheetId: spreadsheetId,\n        accessToken: accessToken,\n        sessionId: sessionId,\n        // Include session ID\n        sheetsMetadata: sheetsMetadata,\n        // ×•×“× ×©×”×ž×©×ª× ×” ×”×–×” ×§×™×™× ×•×ž×›×™×œ ××ª ×”×ž×™×“×¢\n        selectedSheetName: selectedSheetName,\n        // ×•×“× ×©×”×ž×©×ª× ×” ×”×–×” ×§×™×™× ×•×ž×›×™×œ ××ª ×©× ×”×’×™×œ×™×•×Ÿ\n        sheetInstructions: sheetInstructions,\n        // ðŸ”¥ ×”×•×¡×£ ×”×•×¨××•×ª × ×™×ª×•×—\n        sheetAnalysis: sheetAnalysis // ðŸ”¥ ×”×•×¡×£ × ×™×ª×•×— ×”×’×œ×™×•×Ÿ\n      };\n      console.log('ðŸ”¥ Sending payload with sheet instructions:', !!sheetInstructions);\n      if (sheetInstructions) {\n        console.log('ðŸ“‹ Sheet instructions preview:', sheetInstructions.substring(0, 200) + '...');\n      }\n      const response = await fetch(`${API_URL}/api/chat-stream`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        // This is crucial for session cookies!\n        body: JSON.stringify(payload)\n      });\n      if (!response.ok || !response.body) {\n        const errorText = await response.text();\n        throw new Error(`Server error: ${response.status} ${errorText}`);\n      }\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let accumulatedResponse = '';\n      while (true) {\n        const {\n          value,\n          done\n        } = await reader.read();\n        if (done) break;\n        accumulatedResponse += decoder.decode(value, {\n          stream: true\n        });\n        const currentResponse = accumulatedResponse;\n        setMessages(prev => prev.map(m => {\n          if (m.id === loadingMessageId) {\n            // Show the accumulated response directly as text\n            return {\n              ...m,\n              text: currentResponse,\n              isLoading: true\n            };\n          }\n          return m;\n        }));\n      }\n\n      // Final response processing - check if this is a change plan with clarification questions\n      const isChangePlanResponse = accumulatedResponse.includes('ðŸ¤” ×©××œ×•×ª ×”×‘×”×¨×”') && accumulatedResponse.includes('×ž×–×”×” ×ª×•×›× ×™×ª:');\n      if (isChangePlanResponse) {\n        // Extract plan ID from response\n        const planIdMatch = accumulatedResponse.match(/×ž×–×”×” ×ª×•×›× ×™×ª:\\s*`([^`]+)`/);\n        if (planIdMatch) {\n          const planId = planIdMatch[1];\n          setPendingChangePlan({\n            id: planId,\n            response: accumulatedResponse,\n            questions: extractQuestionsFromResponse(accumulatedResponse)\n          });\n          setIsAnsweringQuestions(true);\n          setClarificationAnswers(['', '', '', '', '']); // Reset answers\n        }\n      }\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: accumulatedResponse,\n        isLoading: false\n      } : m));\n\n      // Assistant response is automatically saved by backend in /api/chat-stream\n\n      // ×× ×”×™×” ×–×” ×¤×§×•×“×ª undo/redo, ×¨×¢× ×Ÿ ××ª ×”×’×œ×™×•×Ÿ\n      const questionLower = currentQuestion.toLowerCase().trim();\n      const undoRedoKeywords = ['×‘×˜×œ', 'undo', '×©×—×–×¨', 'redo', '×‘×˜×œ ×¤×¢×•×œ×”', '×©×—×–×¨ ×¤×¢×•×œ×”'];\n      if (undoRedoKeywords.some(keyword => questionLower.includes(keyword))) {\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\n        if (googleSheetsUrl && selectedSheetName) {\n          setTimeout(() => {\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          }, 800); // ×”×©×”×™×” ×ž×¢×˜ ×™×•×ª×¨ ××¨×•×›×” ×¢×‘×•×¨ ×¤×§×•×“×•×ª ×¦'××˜\n        }\n      }\n    } catch (error) {\n      console.error('Error in sendMessage:', error);\n      setMessages(prev => prev.map(m => m.id === loadingMessageId ? {\n        ...m,\n        text: `××™×¨×¢×” ×©×’×™××”: ${error.message}`,\n        isLoading: false,\n        isError: true\n      } : m));\n    } finally {\n      setIsStreamingResponse(false);\n      // ×‘×“×•×§ ×¡×˜×˜×•×¡ Undo/Redo ×•×ª××™× ×™×¨×•×§×™× ××—×¨×™ ×›×œ ×”×•×“×¢×”\n      console.log('ðŸ“‹ Message completed, checking status...', {\n        isAgentMode,\n        currentSessionId\n      });\n      setTimeout(() => {\n        console.log('â° Running status checks...');\n        checkUndoRedoStatus();\n        checkForGreenCells();\n      }, 1000); // ×”×©×”×™×” ×§×¦×¨×” ×›×“×™ ×œ×•×•×“× ×©×”×‘×§-×× ×“ ×¡×™×™×\n    }\n  };\n  const saveAllChanges = () => {\n    setMessages(prev => [...prev, {\n      text: `ðŸ’¾ ×›×œ ×”×©×™× ×•×™×™× × ×©×ž×¨×• ×œ×’×™×œ×™×•×Ÿ ${fileName}`,\n      sender: 'system',\n      timestamp: new Date(),\n      id: Date.now()\n    }]);\n  };\n  return /*#__PURE__*/_jsxDEV(ThemeProvider, {\n    theme: theme,\n    children: [/*#__PURE__*/_jsxDEV(CssBaseline, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1651,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        display: 'flex',\n        height: '100vh',\n        bgcolor: 'background.default',\n        overflow: 'hidden'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          background: `radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%), radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%)`,\n          pointerEvents: 'none',\n          zIndex: 0\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1656,\n        columnNumber: 9\n      }, this), !isMobile && /*#__PURE__*/_jsxDEV(Drawer, {\n        variant: \"permanent\",\n        sx: {\n          width: drawerWidth,\n          flexShrink: 0,\n          zIndex: 1,\n          '& .MuiDrawer-paper': {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            bgcolor: 'rgba(10, 10, 10, 0.98)',\n            borderRight: '1px solid rgba(139, 92, 246, 0.4)',\n            backdropFilter: 'blur(20px)'\n          }\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            sx: {\n              background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\n              backgroundClip: 'text',\n              WebkitBackgroundClip: 'text',\n              WebkitTextFillColor: 'transparent',\n              fontWeight: 700\n            },\n            children: \"TLV500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1660,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            color: \"text.secondary\",\n            children: \"AI Assistant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1661,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1659,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1663,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: 2,\n              mb: 2\n            },\n            children: [/*#__PURE__*/_jsxDEV(Avatar, {\n              src: user === null || user === void 0 ? void 0 : user.profilePicture,\n              sx: {\n                width: 45,\n                height: 45,\n                background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)'\n              },\n              children: user !== null && user !== void 0 && user.name ? user.name.charAt(0) : /*#__PURE__*/_jsxDEV(Person, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1670,\n                columnNumber: 55\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1666,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flex: 1\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                fontWeight: 600,\n                children: (user === null || user === void 0 ? void 0 : user.name) || '×ž×©×ª×ž×© ××•×¨×—'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1673,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"caption\",\n                color: \"text.secondary\",\n                children: (user === null || user === void 0 ? void 0 : user.email) || '×œ× ×ž×—×•×‘×¨'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1676,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1672,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1665,\n            columnNumber: 15\n          }, this), accessToken && /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: handleLogout,\n            size: \"small\",\n            fullWidth: true,\n            sx: {\n              borderColor: 'rgba(239, 68, 68, 0.5)',\n              color: 'error.main',\n              '&:hover': {\n                borderColor: 'error.main',\n                bgcolor: 'rgba(239, 68, 68, 0.1)'\n              }\n            },\n            children: \"\\u05D4\\u05EA\\u05E0\\u05EA\\u05E7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1682,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1664,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          sx: {\n            borderColor: 'rgba(139, 92, 246, 0.4)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1700,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            flexGrow: 1,\n            overflow: 'hidden'\n          },\n          children: /*#__PURE__*/_jsxDEV(ChatHistory, {\n            accessToken: accessToken,\n            onSessionSelect: handleSessionSelect,\n            currentSessionId: currentSessionId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1704,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1703,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1658,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          flexGrow: 1,\n          display: 'flex',\n          flexDirection: isMobile ? 'column' : 'row',\n          zIndex: 1,\n          height: '100vh',\n          overflow: 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            flex: isMobile ? '1 1 60%' : '0 0 65%',\n            p: 2,\n            display: 'flex',\n            flexDirection: 'column',\n            height: '100%',\n            overflow: 'hidden'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              mb: 2,\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              flexWrap: 'wrap',\n              gap: 2\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: 2\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                color: \"text.primary\",\n                children: fileName || '×œ× × ×‘×—×¨ ×’×™×œ×™×•×Ÿ'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1716,\n                columnNumber: 17\n              }, this), availableSheets.length > 0 && /*#__PURE__*/_jsxDEV(FormControl, {\n                size: \"small\",\n                sx: {\n                  minWidth: 200,\n                  '& .MuiOutlinedInput-notchedOutline': {\n                    borderColor: !isSheetSelected ? 'rgba(239, 68, 68, 0.7)' : 'rgba(139, 92, 246, 0.5)'\n                  },\n                  '& .MuiInputLabel-root': {\n                    color: !isSheetSelected ? 'error.main' : 'text.secondary'\n                  }\n                },\n                error: !isSheetSelected,\n                children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                  children: !isSheetSelected ? 'ðŸ”´ ×‘×—×¨ ×’×œ×™×•×Ÿ (×—×•×‘×”)' : '×’×œ×™×•×Ÿ × ×•×›×—×™'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1731,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Select, {\n                  value: selectedSheetName || '',\n                  onChange: e => handleSheetChange(e.target.value),\n                  disabled: isLoadingSheets,\n                  children: availableSheets.map(sheet => /*#__PURE__*/_jsxDEV(MenuItem, {\n                    value: sheet.name,\n                    children: sheet.name\n                  }, sheet.id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1740,\n                    columnNumber: 25\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1734,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1718,\n                columnNumber: 19\n              }, this), isLoadingSheets && /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                sx: {\n                  color: 'primary.main'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1747,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1715,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                gap: 1\n              },\n              children: [!accessToken ? /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                href: API_URL,\n                children: \"\\u05D4\\u05EA\\u05D7\\u05D1\\u05E8 \\u05E2\\u05DD Google\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1751,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                onClick: createPicker,\n                disabled: !isPickerReady,\n                children: !isPickerReady ? '×˜×•×¢×Ÿ API...' : '×‘×—×¨ ×’×™×œ×™×•×Ÿ ×ž-Drive'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1753,\n                columnNumber: 19\n              }, this), accessToken && /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                onClick: startNewChat,\n                sx: {\n                  minWidth: 'auto'\n                },\n                children: \"+ \\u05E9\\u05D9\\u05D7\\u05D4 \\u05D7\\u05D3\\u05E9\\u05D4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1758,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1749,\n              columnNumber: 15\n            }, this), changesCount > 0 && /*#__PURE__*/_jsxDEV(Chip, {\n              label: `${changesCount} ×©×™× ×•×™×™× ×œ× ×©×ž×•×¨×™×`,\n              size: \"small\",\n              color: \"warning\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1763,\n              columnNumber: 36\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1764,\n                columnNumber: 54\n              }, this),\n              onClick: saveAllChanges,\n              color: \"primary\",\n              size: \"small\",\n              children: \"\\u05E9\\u05DE\\u05D5\\u05E8 \\u05D4\\u05DB\\u05DC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1764,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1714,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(15, 15, 15, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)',\n              position: 'relative'\n            },\n            children: [!isSheetLoaded && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 1,\n                textAlign: 'center',\n                mt: 2\n              },\n              children: /*#__PURE__*/_jsxDEV(TextField, {\n                placeholder: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1...\",\n                size: \"small\",\n                sx: {\n                  minWidth: 400\n                },\n                onKeyPress: async e => {\n                  if (e.key === 'Enter' && e.target.value) {\n                    await handleGoogleSheetsUrl(e.target.value);\n                    e.target.value = '';\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1773,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1772,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              ref: iframeContainerRef,\n              sx: {\n                flexGrow: 1,\n                border: '1px solid rgba(139, 92, 246, 0.4)',\n                borderRadius: 1,\n                bgcolor: 'rgba(5, 5, 5, 0.8)',\n                position: 'relative',\n                overflow: 'hidden',\n                m: 0.5,\n                // ×¨×•×•×— ×ž×™× ×™×ž×œ×™ ×ž×”×§×¦×•×•×ª\n                // ×”×’× ×” ×¢×œ Mac gestures\n                overscrollBehavior: 'contain',\n                touchAction: 'auto',\n                WebkitOverflowScrolling: 'touch'\n              },\n              onMouseEnter: () => setIsIframeHovered(true),\n              onMouseLeave: () => setIsIframeHovered(false),\n              children: [isSheetLoaded && isSheetSelected && (hasGreenCells || changesCount > 0) && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  top: '8px',\n                  right: '8px',\n                  display: 'flex',\n                  gap: '0px',\n                  zIndex: 1000,\n                  backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                  border: '1px solid rgba(255, 255, 255, 0.3)',\n                  borderRadius: '4px',\n                  padding: '2px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    approveAllChanges();\n                  },\n                  style: {\n                    backgroundColor: '#4caf50',\n                    color: 'white',\n                    border: '1px solid #2e7d32',\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: 'pointer',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n                  },\n                  title: \"\\u05D0\\u05E9\\u05E8 \\u05DB\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD\",\n                  onMouseEnter: e => {\n                    e.target.style.backgroundColor = '#45a049';\n                    e.target.style.transform = 'scale(1.05)';\n                    e.target.style.boxShadow = '0 4px 8px rgba(76, 175, 80, 0.4)';\n                    e.target.style.borderColor = '#4caf50';\n                    e.target.textContent = '×§×‘×œ ×”×›×œ';\n                    e.target.style.fontSize = '0.6rem';\n                  },\n                  onMouseLeave: e => {\n                    e.target.style.backgroundColor = '#4caf50';\n                    e.target.style.transform = 'scale(1)';\n                    e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                    e.target.style.borderColor = '#2e7d32';\n                    e.target.textContent = `âœ“ (${changesCount || 0})`;\n                    e.target.style.fontSize = '0.65rem';\n                  },\n                  children: [\"\\u2713 (\", changesCount || 0, \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1824,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    rejectAllChanges();\n                  },\n                  style: {\n                    backgroundColor: '#f44336',\n                    color: 'white',\n                    border: '1px solid #c62828',\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: 'pointer',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n                  },\n                  title: \"\\u05D3\\u05D7\\u05D4 \\u05DB\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD\",\n                  onMouseEnter: e => {\n                    e.target.style.backgroundColor = '#d32f2f';\n                    e.target.style.transform = 'scale(1.05)';\n                    e.target.style.boxShadow = '0 4px 8px rgba(244, 67, 54, 0.4)';\n                    e.target.style.borderColor = '#f44336';\n                    e.target.textContent = '×“×—×” ×”×›×œ';\n                    e.target.style.fontSize = '0.6rem';\n                  },\n                  onMouseLeave: e => {\n                    e.target.style.backgroundColor = '#f44336';\n                    e.target.style.transform = 'scale(1)';\n                    e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                    e.target.style.borderColor = '#c62828';\n                    e.target.textContent = `âœ• (${changesCount || 0})`;\n                    e.target.style.fontSize = '0.65rem';\n                  },\n                  children: [\"\\u2715 (\", changesCount || 0, \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1867,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1811,\n                columnNumber: 19\n              }, this), isSheetLoaded && isSheetSelected && (canUndo || canRedo) && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  bottom: '8px',\n                  right: '8px',\n                  display: 'flex',\n                  gap: '0px',\n                  zIndex: 1000,\n                  backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                  border: '1px solid rgba(255, 255, 255, 0.3)',\n                  borderRadius: '4px',\n                  padding: '2px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    if (canUndo) undoAction();\n                  },\n                  style: {\n                    backgroundColor: canUndo ? '#2196f3' : '#666',\n                    color: 'white',\n                    border: `1px solid ${canUndo ? '#1976d2' : '#555'}`,\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: canUndo ? 'pointer' : 'not-allowed',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                    opacity: canUndo ? 1 : 0.5\n                  },\n                  title: \"\\u05D1\\u05D8\\u05DC \\u05E4\\u05E2\\u05D5\\u05DC\\u05D4\",\n                  onMouseEnter: e => {\n                    if (canUndo) {\n                      e.target.style.backgroundColor = '#1976d2';\n                      e.target.style.transform = 'scale(1.05)';\n                      e.target.style.boxShadow = '0 4px 8px rgba(33, 150, 243, 0.4)';\n                      e.target.style.borderColor = '#2196f3';\n                      e.target.textContent = '×‘×˜×œ';\n                      e.target.style.fontSize = '0.6rem';\n                    }\n                  },\n                  onMouseLeave: e => {\n                    if (canUndo) {\n                      e.target.style.backgroundColor = '#2196f3';\n                      e.target.style.transform = 'scale(1)';\n                      e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                      e.target.style.borderColor = '#1976d2';\n                      e.target.textContent = 'â†©ï¸';\n                      e.target.style.fontSize = '0.65rem';\n                    }\n                  },\n                  children: \"\\u21A9\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1926,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => {\n                    if (canRedo) redoAction();\n                  },\n                  style: {\n                    backgroundColor: canRedo ? '#ff9800' : '#666',\n                    color: 'white',\n                    border: `1px solid ${canRedo ? '#f57c00' : '#555'}`,\n                    width: '45px',\n                    height: '20px',\n                    fontSize: '0.65rem',\n                    fontWeight: 'bold',\n                    borderRadius: '0px',\n                    cursor: canRedo ? 'pointer' : 'not-allowed',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    userSelect: 'none',\n                    transition: 'all 0.2s ease',\n                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                    opacity: canRedo ? 1 : 0.5\n                  },\n                  title: \"\\u05E9\\u05D7\\u05D6\\u05E8 \\u05E4\\u05E2\\u05D5\\u05DC\\u05D4\",\n                  onMouseEnter: e => {\n                    if (canRedo) {\n                      e.target.style.backgroundColor = '#f57c00';\n                      e.target.style.transform = 'scale(1.05)';\n                      e.target.style.boxShadow = '0 4px 8px rgba(255, 152, 0, 0.4)';\n                      e.target.style.borderColor = '#ff9800';\n                      e.target.textContent = '×©×—×–×¨';\n                      e.target.style.fontSize = '0.6rem';\n                    }\n                  },\n                  onMouseLeave: e => {\n                    if (canRedo) {\n                      e.target.style.backgroundColor = '#ff9800';\n                      e.target.style.transform = 'scale(1)';\n                      e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n                      e.target.style.borderColor = '#f57c00';\n                      e.target.textContent = 'â¤´ï¸';\n                      e.target.style.fontSize = '0.65rem';\n                    }\n                  },\n                  children: \"\\u2934\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1974,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1913,\n                columnNumber: 19\n              }, this), isSheetLoaded && isSheetSelected ? /*#__PURE__*/_jsxDEV(\"iframe\", {\n                src: getSheetUrlWithGid(googleSheetsUrl, selectedSheetName),\n                width: \"100%\",\n                height: \"100%\",\n                style: {\n                  border: 'none',\n                  borderRadius: '4px'\n                },\n                title: \"Google Sheets\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2024,\n                columnNumber: 19\n              }, this) : availableSheets.length > 0 && !isSheetSelected ? /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  height: '100%',\n                  color: 'text.secondary'\n                },\n                children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                  sx: {\n                    fontSize: 60,\n                    mb: 2,\n                    opacity: 0.5,\n                    color: 'error.main'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2027,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  gutterBottom: true,\n                  color: \"error.main\",\n                  children: \"\\u05D9\\u05E9 \\u05DC\\u05D1\\u05D7\\u05D5\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF \\u05EA\\u05D7\\u05D9\\u05DC\\u05D4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2028,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  textAlign: \"center\",\n                  sx: {\n                    maxWidth: 400\n                  },\n                  children: \"\\u05D1\\u05D7\\u05E8 \\u05D2\\u05DC\\u05D9\\u05D5\\u05DF \\u05DE\\u05D4\\u05E8\\u05E9\\u05D9\\u05DE\\u05D4 \\u05DC\\u05DE\\u05E2\\u05DC\\u05D4 \\u05DB\\u05D3\\u05D9 \\u05DC\\u05D4\\u05EA\\u05D7\\u05D9\\u05DC \\u05DC\\u05E2\\u05D1\\u05D5\\u05D3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2031,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2026,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  height: '100%',\n                  color: 'text.secondary'\n                },\n                children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                  sx: {\n                    fontSize: 60,\n                    mb: 2,\n                    opacity: 0.5\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2037,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  gutterBottom: true,\n                  children: \"\\u05D8\\u05E2\\u05DF \\u05D2\\u05D9\\u05DC\\u05D9\\u05D5\\u05DF \\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2038,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  textAlign: \"center\",\n                  sx: {\n                    maxWidth: 400\n                  },\n                  children: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05E7\\u05D9\\u05E9\\u05D5\\u05E8 \\u05DC\\u05D2\\u05D5\\u05D2\\u05DC \\u05E9\\u05D9\\u05D8\\u05E1 \\u05D1\\u05E9\\u05D3\\u05D4 \\u05DC\\u05DE\\u05E2\\u05DC\\u05D4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2039,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2036,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1791,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1766,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1713,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            width: isMobile ? '100%' : '35%',\n            flex: isMobile ? '1 1 40%' : '0 0 35%',\n            p: 2,\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column'\n          },\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            sx: {\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              overflow: 'hidden',\n              background: 'rgba(25, 25, 25, 0.98)',\n              border: '1px solid rgba(139, 92, 246, 0.25)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 600,\n                children: \"\\u05E2\\u05D5\\u05D6\\u05E8 AI\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2048,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"text.secondary\",\n                children: \"\\u05DE\\u05D5\\u05DB\\u05DF \\u05DC\\u05E2\\u05D6\\u05D5\\u05E8 \\u05E2\\u05DD \\u05D4\\u05E0\\u05D9\\u05EA\\u05D5\\u05D7 \\u05E9\\u05DC\\u05DA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2049,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2047,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderBottom: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    gap: 1\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(Description, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2054,\n                      columnNumber: 77\n                    }, this),\n                    size: \"small\",\n                    disabled: isExtractingData,\n                    sx: {\n                      flex: 1,\n                      borderColor: 'rgba(139, 92, 246, 0.5)',\n                      '&.Mui-disabled': {\n                        color: 'text.secondary'\n                      }\n                    },\n                    children: [isExtractingData ? '×ž×¢×‘×“...' : 'PDF', /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".pdf\",\n                      onChange: e => handleFileUpload(e, 'PDF'),\n                      disabled: isExtractingData\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2056,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2054,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outlined\",\n                    component: \"label\",\n                    startIcon: /*#__PURE__*/_jsxDEV(TableChart, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2058,\n                      columnNumber: 77\n                    }, this),\n                    size: \"small\",\n                    disabled: isExtractingExcel,\n                    sx: {\n                      flex: 1,\n                      borderColor: 'rgba(139, 92, 246, 0.5)'\n                    },\n                    children: [isExtractingExcel ? '×ž×¢×‘×“...' : 'Excel', /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      hidden: true,\n                      accept: \".xlsx,.xls,.csv\",\n                      onChange: e => handleFileUpload(e, 'Excel'),\n                      disabled: isExtractingExcel\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2060,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2058,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2053,\n                  columnNumber: 19\n                }, this), extractedPdf && /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    mt: 1,\n                    p: 1,\n                    bgcolor: extractedPdf.processingMode === 'simple_ocr' ? 'rgba(255, 193, 7, 0.1)' : 'rgba(139, 92, 246, 0.1)',\n                    borderRadius: 2,\n                    border: extractedPdf.processingMode === 'simple_ocr' ? '1px solid rgba(255, 193, 7, 0.3)' : '1px solid rgba(139, 92, 246, 0.3)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Description, {\n                    sx: {\n                      color: extractedPdf.processingMode === 'simple_ocr' ? 'warning.main' : 'primary.main',\n                      fontSize: 20\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2074,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    sx: {\n                      flex: 1,\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis'\n                    },\n                    children: [extractedPdf.name, extractedPdf.processingMode === 'simple_ocr' && ' ðŸ“‘', extractedPdf.processingMode === 'structured' && ' ðŸ”']\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2078,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    onClick: () => {\n                      setExtractedPdf(null);\n                      localStorage.removeItem('extractedPdf');\n                      setMessages(prev => [...prev, {\n                        text: 'ðŸ“„ × ×ª×•× ×™ ×”-PDF × ×•×§×• ×ž×”×”×§×©×¨.',\n                        sender: 'system',\n                        timestamp: new Date(),\n                        id: Date.now()\n                      }]);\n                    },\n                    sx: {\n                      color: 'error.main',\n                      minWidth: 'auto',\n                      p: 0.5\n                    },\n                    children: \"\\u2715\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2088,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2064,\n                  columnNumber: 21\n                }, this), extractedExcel && /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    mt: 1,\n                    p: 1,\n                    bgcolor: 'rgba(16, 185, 129, 0.1)',\n                    borderRadius: 2,\n                    border: '1px solid rgba(16, 185, 129, 0.3)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(TableChart, {\n                    sx: {\n                      color: 'success.main',\n                      fontSize: 20\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2108,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    sx: {\n                      flex: 1,\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis'\n                    },\n                    children: extractedExcel.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2109,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    onClick: () => {\n                      setExtractedExcel(null);\n                      localStorage.removeItem('extractedExcel');\n                      setMessages(prev => [...prev, {\n                        text: 'ðŸ“Š × ×ª×•× ×™ ×”-Excel × ×•×§×• ×ž×”×”×§×©×¨.',\n                        sender: 'system',\n                        timestamp: new Date(),\n                        id: Date.now()\n                      }]);\n                    },\n                    sx: {\n                      color: 'error.main',\n                      minWidth: 'auto',\n                      p: 0.5\n                    },\n                    children: \"\\u2715\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2110,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2107,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2052,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2051,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                flexGrow: 1,\n                overflow: 'auto',\n                p: 2\n              },\n              children: [messages.map((msg, index) => /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 2\n                },\n                className: \"chat-message\",\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    display: 'flex',\n                    justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start',\n                    mb: 1\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    sx: {\n                      p: 1.5,\n                      maxWidth: '85%',\n                      background: msg.sender === 'user' ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' : 'rgba(35, 35, 35, 0.9)',\n                      color: 'white',\n                      borderRadius: 3\n                    },\n                    children: msg.isLoading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                      size: 16,\n                      color: \"inherit\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2126,\n                      columnNumber: 42\n                    }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n                      variant: \"body2\",\n                      sx: {\n                        whiteSpace: 'pre-wrap'\n                      },\n                      children: msg.text\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2126,\n                      columnNumber: 91\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2119,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2118,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  color: \"text.secondary\",\n                  sx: {\n                    display: 'block',\n                    textAlign: msg.sender === 'user' ? 'right' : 'left',\n                    px: 1\n                  },\n                  children: msg.timestamp.toLocaleTimeString('he-IL', {\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  })\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2129,\n                  columnNumber: 21\n                }, this)]\n              }, msg.id || index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2117,\n                columnNumber: 19\n              }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n                ref: chatEndRef\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2134,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2115,\n              columnNumber: 15\n            }, this), isAnsweringQuestions && pendingChangePlan && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderTop: '1px solid rgba(139, 92, 246, 0.4)',\n                backgroundColor: 'rgba(139, 92, 246, 0.1)'\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                sx: {\n                  mb: 2,\n                  color: '#8b5cf6'\n                },\n                children: \"\\uD83E\\uDD14 \\u05E9\\u05D0\\u05DC\\u05D5\\u05EA \\u05D4\\u05D1\\u05D4\\u05E8\\u05D4 \\u05DC\\u05D1\\u05D9\\u05E6\\u05D5\\u05E2 \\u05D4\\u05EA\\u05D5\\u05DB\\u05E0\\u05D9\\u05EA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2140,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mb: 2,\n                  color: 'text.secondary'\n                },\n                children: \"\\u05D0\\u05E0\\u05D0 \\u05E2\\u05E0\\u05D4 \\u05E2\\u05DC \\u05DB\\u05DC 5 \\u05D4\\u05E9\\u05D0\\u05DC\\u05D5\\u05EA \\u05DC\\u05D1\\u05D9\\u05E6\\u05D5\\u05E2 \\u05DE\\u05D3\\u05D5\\u05D9\\u05E7 \\u05E9\\u05DC \\u05D4\\u05E9\\u05D9\\u05E0\\u05D5\\u05D9\\u05D9\\u05DD:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2143,\n                columnNumber: 19\n              }, this), pendingChangePlan.questions.map((question, index) => /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  sx: {\n                    mb: 1,\n                    fontWeight: 'bold'\n                  },\n                  children: [index + 1, \". \", question]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2149,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(TextField, {\n                  fullWidth: true,\n                  multiline: true,\n                  rows: 2,\n                  value: clarificationAnswers[index],\n                  onChange: e => {\n                    const newAnswers = [...clarificationAnswers];\n                    newAnswers[index] = e.target.value;\n                    setClarificationAnswers(newAnswers);\n                  },\n                  placeholder: \"\\u05D4\\u05DB\\u05E0\\u05E1 \\u05EA\\u05E9\\u05D5\\u05D1\\u05D4...\",\n                  variant: \"outlined\",\n                  size: \"small\",\n                  sx: {\n                    '& .MuiOutlinedInput-root': {\n                      backgroundColor: 'rgba(255, 255, 255, 0.05)',\n                      '& fieldset': {\n                        borderColor: 'rgba(139, 92, 246, 0.3)'\n                      },\n                      '& textarea': {\n                        textAlign: 'right',\n                        direction: 'rtl'\n                      }\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2152,\n                  columnNumber: 23\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2148,\n                columnNumber: 21\n              }, this)), /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  gap: 1,\n                  mt: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  onClick: executeChangePlan,\n                  disabled: isStreamingResponse || clarificationAnswers.some(answer => !answer.trim()),\n                  sx: {\n                    bgcolor: '#8b5cf6',\n                    '&:hover': {\n                      bgcolor: '#7c3aed'\n                    },\n                    flex: 1\n                  },\n                  children: isStreamingResponse ? '×ž×‘×¦×¢...' : '×‘×¦×¢ ×ª×•×›× ×™×ª'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2182,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outlined\",\n                  onClick: () => {\n                    setIsAnsweringQuestions(false);\n                    setPendingChangePlan(null);\n                    setClarificationAnswers(['', '', '', '', '']);\n                  },\n                  disabled: isStreamingResponse,\n                  sx: {\n                    borderColor: 'rgba(139, 92, 246, 0.5)'\n                  },\n                  children: \"\\u05D1\\u05D9\\u05D8\\u05D5\\u05DC\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2194,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2181,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2139,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                borderTop: '1px solid rgba(139, 92, 246, 0.4)'\n              },\n              children: [isAgentMode && isSheetLoaded && isSheetSelected && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mb: 1,\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(Switch, {\n                  checked: isSignificantChange,\n                  onChange: e => setIsSignificantChange(e.target.checked),\n                  sx: {\n                    '& .MuiSwitch-switchBase.Mui-checked': {\n                      color: '#8B5CF6'\n                    },\n                    '& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track': {\n                      backgroundColor: '#8B5CF6'\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2214,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  sx: {\n                    color: isSignificantChange ? '#8B5CF6' : '#666'\n                  },\n                  children: isSignificantChange ? 'ðŸ¤” ×©×™× ×•×™ ×ž×©×ž×¢×•×ª×™ (×¢× ×”×‘×”×¨×•×ª)' : 'âš¡ ×©×™× ×•×™ ×¨×’×™×œ (×ž×™×™×“×™)'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2226,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2213,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  gap: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(TextField, {\n                  fullWidth: true,\n                  variant: \"outlined\",\n                  placeholder: isAnsweringQuestions ? \"×¢× ×” ×¢×œ ×”×©××œ×•×ª ×œ×ž×¢×œ×” ×ª×—×™×œ×”...\" : \"×©××œ ××•×ª×™ ×›×œ ×“×‘×¨... (Shift+Enter ×œ×©×•×¨×” ×—×“×©×”)\",\n                  value: question,\n                  onChange: e => setQuestion(e.target.value),\n                  onKeyPress: e => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault(); // Prevents adding a new line\n                      sendMessage();\n                    }\n                  },\n                  multiline: true,\n                  minRows: 2,\n                  maxRows: 5,\n                  disabled: isStreamingResponse || isAnsweringQuestions,\n                  sx: {\n                    direction: 'rtl',\n                    '& .MuiOutlinedInput-root': {\n                      borderRadius: 3,\n                      direction: 'rtl',\n                      '& textarea': {\n                        textAlign: 'right',\n                        direction: 'rtl'\n                      },\n                      '& input': {\n                        textAlign: 'right',\n                        direction: 'rtl'\n                      }\n                    },\n                    '& .MuiInputLabel-root': {\n                      right: 'auto',\n                      left: 0,\n                      transformOrigin: 'top right',\n                      direction: 'rtl'\n                    },\n                    '& .MuiFormLabel-root': {\n                      textAlign: 'right',\n                      direction: 'rtl'\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2233,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Fab, {\n                  color: \"primary\",\n                  onClick: sendMessage,\n                  size: \"small\",\n                  disabled: isStreamingResponse || isAnsweringQuestions,\n                  children: /*#__PURE__*/_jsxDEV(Send, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2281,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2275,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2232,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(FormControlLabel, {\n                control: /*#__PURE__*/_jsxDEV(Switch, {\n                  checked: isAgentMode,\n                  onChange: e => setIsAgentMode(e.target.checked),\n                  disabled: !googleSheetsUrl || !isSheetSelected\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2286,\n                  columnNumber: 21\n                }, this),\n                label: `Agent Mode: Allow Sheet Editing ${!isSheetSelected ? '(×‘×—×¨ ×’×œ×™×•×Ÿ ×ª×—×™×œ×”)' : ''}`,\n                sx: {\n                  color: !googleSheetsUrl || !isSheetSelected ? 'text.disabled' : 'text.secondary',\n                  mt: 1,\n                  mr: 0\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2284,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2210,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2046,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2045,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1712,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n        open: showSnackbar,\n        autoHideDuration: 6000,\n        onClose: () => setShowSnackbar(false),\n        anchorOrigin: {\n          vertical: 'bottom',\n          horizontal: 'center'\n        },\n        sx: {\n          bottom: {\n            xs: 90,\n            sm: 24\n          }\n        },\n        children: /*#__PURE__*/_jsxDEV(Alert, {\n          onClose: () => setShowSnackbar(false),\n          severity: authError ? \"error\" : \"success\",\n          sx: {\n            width: '100%',\n            bgcolor: '#2E2E2E',\n            color: 'white'\n          },\n          children: snackbarMessage || authError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2304,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2303,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1655,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1650,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"rarNfky2Cq1Zc/y/K6zb+jttjms=\", false, function () {\n  return [useTheme, useMediaQuery];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Box","Drawer","Typography","Paper","TextField","Button","Avatar","Divider","Chip","Fab","useMediaQuery","useTheme","CircularProgress","Alert","Snackbar","CssBaseline","FormControl","InputLabel","Select","MenuItem","Switch","FormControlLabel","Send","Person","Description","TableChart","Save","createTheme","ThemeProvider","ChatHistory","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","theme","palette","mode","primary","main","secondary","background","default","paper","text","success","error","warning","typography","fontFamily","h4","fontWeight","h6","components","MuiButton","styleOverrides","root","borderRadius","textTransform","padding","contained","boxShadow","transform","MuiPaper","backdropFilter","border","drawerWidth","App","_s","muiTheme","isMobile","breakpoints","down","messages","setMessages","sender","timestamp","Date","id","now","question","setQuestion","fileName","setFileName","googleSheetsUrl","setGoogleSheetsUrl","changesCount","setChangesCount","isSheetLoaded","setIsSheetLoaded","isPickerReady","setIsPickerReady","accessToken","setAccessToken","sheetsMetadata","setSheetsMetadata","authError","setAuthError","showSnackbar","setShowSnackbar","snackbarMessage","setSnackbarMessage","availableSheets","setAvailableSheets","selectedSheetName","setSelectedSheetName","isLoadingSheets","setIsLoadingSheets","extractedPdf","setExtractedPdf","isExtractingData","setIsExtractingData","extractedExcel","setExtractedExcel","isExtractingExcel","setIsExtractingExcel","isAgentMode","setIsAgentMode","isStreamingResponse","setIsStreamingResponse","isSheetSelected","setIsSheetSelected","isIframeHovered","setIsIframeHovered","canUndo","setCanUndo","canRedo","setCanRedo","hasGreenCells","setHasGreenCells","isCheckingGreenCells","setIsCheckingGreenCells","currentSessionId","setCurrentSessionId","user","setUser","chatEndRef","iframeContainerRef","sheetAnalysis","setSheetAnalysis","sheetInstructions","setSheetInstructions","pendingChangePlan","setPendingChangePlan","clarificationAnswers","setClarificationAnswers","isAnsweringQuestions","setIsAnsweringQuestions","isSignificantChange","setIsSignificantChange","sessionId","setSessionId","toString","Math","random","substring","extractQuestionsFromResponse","response","console","log","questionSection","split","questions","questionMatches","match","forEach","replace","trim","length","push","lines","line","slice","executeChangePlan","some","answer","loadingMessageId","prev","isLoading","sheetData","getSheetData","extractSpreadsheetId","spreadsheetId","payload","planId","fetch","method","headers","credentials","body","JSON","stringify","ok","errorText","Error","status","reader","getReader","decoder","TextDecoder","accumulatedResponse","value","done","read","decode","stream","map","m","setTimeout","iframe","document","querySelector","src","message","savedToken","localStorage","getItem","savedPdfJson","savedPdf","parse","name","data","fileId","then","removeItem","catch","e","savedExcelJson","savedExcel","fetchUserInfo","params","URLSearchParams","window","location","search","token","get","setItem","history","replaceState","title","checkAuthStatus","json","_chatEndRef$current","current","scrollIntoView","behavior","script","createElement","onload","gapi","load","callback","head","appendChild","handleWheel","abs","deltaX","deltaY","preventDefault","stopPropagation","handleTouchStart","handleTouchMove","addEventListener","passive","removeEventListener","timer","checkUndoRedoStatus","checkForGreenCells","clearTimeout","handleSessionSelect","chatHistory","loadedMessages","msg","content","role","_id","generateSessionId","substr","makeGoogleSheetsAPICall","range","values","valueRenderOption","baseUrl","_data$error","url","options","combineValuesAndFormulas","formulas","combined","row","max","valueRow","formulaRow","combinedRow","col","formula","startsWith","type","finalValue","analyzeSheetWithGemini","sheetName","currentExtractedPdf","_result$summary","_result$instructions","analysisType","result","summary","instructions","getSheetUrlWithGid","selectedSheet","find","sheet","cleanUrl","getSpreadsheetMetadata","metadata","sheets","properties","sheetId","handleFileUpload","event","fileType","file","target","files","filter","includes","formData","FormData","append","currentSheetData","hasSheetData","sheetDataLength","hasInstructions","instructionsLength","hasAnalysis","analysisLength","err","pdfInfo","processingMode","isFullText","successMessage","finally","shouldConvert","confirm","Object","fromEntries","entries","clone","responseText","errorData","parseError","open","handleGoogleSheetsUrl","excelInfo","loadAvailableSheets","handleSheetChange","newSheetName","analysisResult","reanalyzePdfWithSheetContext","pdfResponse","pdfBlob","blob","updatedPdfInfo","pickerCallback","action","google","picker","Action","PICKED","doc","docs","createPicker","developerKey","REACT_APP_GEMINI_API_KEY","clientId","REACT_APP_GOOGLE_CLIENT_ID","view","View","ViewId","SPREADSHEETS","setMimeTypes","PickerBuilder","setAppId","setOAuthToken","setDeveloperKey","addView","setCallback","build","setVisible","_valuesResponse$value","_formulasResponse$val","_valuesResponse$value2","_formulasResponse$val2","valuesResponse","formulasResponse","combinedData","formulaCount","flat","cell","stack","startNewChat","handleLogout","hasChanges","approveAllChanges","_googleSheetsUrl$matc","_availableSheets$find","s","rejectAllChanges","_googleSheetsUrl$matc2","_availableSheets$find2","undoAction","redoAction","sendMessage","currentQuestion","userMessage","extractedPdfData","extractedExcelData","conversationHistory","parts","currentResponse","isChangePlanResponse","planIdMatch","questionLower","toLowerCase","undoRedoKeywords","keyword","isError","saveAllChanges","children","_jsxFileName","lineNumber","columnNumber","sx","display","height","bgcolor","overflow","position","top","left","right","bottom","pointerEvents","zIndex","variant","width","flexShrink","boxSizing","borderRight","p","backgroundClip","WebkitBackgroundClip","WebkitTextFillColor","color","borderColor","alignItems","gap","mb","profilePicture","charAt","flex","email","onClick","size","fullWidth","flexGrow","onSessionSelect","flexDirection","justifyContent","flexWrap","minWidth","onChange","disabled","href","label","startIcon","textAlign","mt","placeholder","onKeyPress","key","ref","overscrollBehavior","touchAction","WebkitOverflowScrolling","onMouseEnter","onMouseLeave","style","backgroundColor","fontSize","cursor","userSelect","transition","textContent","opacity","gutterBottom","maxWidth","borderBottom","component","hidden","accept","whiteSpace","textOverflow","index","className","px","toLocaleTimeString","hour","minute","borderTop","multiline","rows","newAnswers","direction","checked","shiftKey","minRows","maxRows","transformOrigin","control","mr","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","xs","sm","severity","_c","$RefreshReg$"],"sources":["/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-modelAssistant/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Drawer,\r\n  Typography,\r\n  Paper,\r\n  TextField,\r\n  Button,\r\n  Avatar,\r\n  Divider,\r\n  Chip,\r\n  Fab,\r\n  useMediaQuery,\r\n  useTheme,\r\n  CircularProgress,\r\n  Alert,\r\n  Snackbar,\r\n  CssBaseline,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  Switch,\r\n  FormControlLabel\r\n} from '@mui/material';\r\nimport {\r\n  Send,\r\n  Person,\r\n  Description,\r\n  TableChart,\r\n  Save\r\n} from '@mui/icons-material';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\nimport ChatHistory from './components/ChatHistory';\r\nimport './App.css';\r\n\r\n// API URL configuration\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    mode: 'dark',\r\n    primary: { main: '#8B5CF6' },\r\n    secondary: { main: '#6366F1' },\r\n    background: { default: '#000000', paper: '#0A0A0A' },\r\n    text: { primary: '#FFFFFF', secondary: '#E5E7EB' },\r\n    success: { main: '#10B981' },\r\n    error: { main: '#EF4444' },\r\n    warning: { main: '#FFC107' }\r\n  },\r\n  typography: {\r\n    fontFamily: '\"Inter\", \"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\r\n    h4: { fontWeight: 700 },\r\n    h6: { fontWeight: 600 }\r\n  },\r\n  components: {\r\n    MuiButton: {\r\n      styleOverrides: {\r\n        root: { borderRadius: 12, textTransform: 'none', fontWeight: 600, padding: '10px 20px' },\r\n        contained: {\r\n          boxShadow: '0 4px 20px rgba(139, 92, 246, 0.4)',\r\n          background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)',\r\n          '&:hover': {\r\n            transform: 'translateY(-1px)',\r\n            boxShadow: '0 6px 30px rgba(139, 92, 246, 0.6)',\r\n            background: 'linear-gradient(135deg, #A78BFA 0%, #818CF8 100%)',\r\n          }\r\n        },\r\n      },\r\n    },\r\n    MuiPaper: {\r\n      styleOverrides: {\r\n        root: {\r\n          background: 'rgba(20, 20, 20, 0.95)',\r\n          backdropFilter: 'blur(20px)',\r\n          border: '1px solid rgba(139, 92, 246, 0.3)',\r\n          borderRadius: 16,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nconst drawerWidth = 280;\r\n\r\nfunction App() {\r\n  const muiTheme = useTheme();\r\n  const isMobile = useMediaQuery(muiTheme.breakpoints.down('md'));\r\n  \r\n  const [messages, setMessages] = useState([\r\n    { text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.', sender: 'assistant', timestamp: new Date(), id: Date.now() }\r\n  ]);\r\n  const [question, setQuestion] = useState('');\r\n  const [fileName, setFileName] = useState('');\r\n  const [googleSheetsUrl, setGoogleSheetsUrl] = useState('');\r\n  const [changesCount, setChangesCount] = useState(0);\r\n  const [isSheetLoaded, setIsSheetLoaded] = useState(false);\r\n\r\n  const [isPickerReady, setIsPickerReady] = useState(false);\r\n  const [accessToken, setAccessToken] = useState('');\r\n  const [sheetsMetadata, setSheetsMetadata] = useState('');\r\n  const [authError, setAuthError] = useState('');\r\n  const [showSnackbar, setShowSnackbar] = useState(false);\r\n  const [snackbarMessage, setSnackbarMessage] = useState('');\r\n  const [availableSheets, setAvailableSheets] = useState([]);\r\n  const [selectedSheetName, setSelectedSheetName] = useState('');\r\n  const [isLoadingSheets, setIsLoadingSheets] = useState(false);\r\n  const [extractedPdf, setExtractedPdf] = useState(null);\r\n  const [isExtractingData, setIsExtractingData] = useState(false);\r\n  const [extractedExcel, setExtractedExcel] = useState(null);\r\n  const [isExtractingExcel, setIsExtractingExcel] = useState(false);\r\n  const [isAgentMode, setIsAgentMode] = useState(false);\r\n  const [isStreamingResponse, setIsStreamingResponse] = useState(false);\r\n  const [isSheetSelected, setIsSheetSelected] = useState(false);\r\n  const [isIframeHovered, setIsIframeHovered] = useState(false);\r\n  \r\n  // ðŸ”„ Undo/Redo State\r\n  const [canUndo, setCanUndo] = useState(false);\r\n  const [canRedo, setCanRedo] = useState(false);\r\n  const [hasGreenCells, setHasGreenCells] = useState(false);\r\n  const [isCheckingGreenCells, setIsCheckingGreenCells] = useState(false);\r\n  \r\n  // Chat History Management\r\n  const [currentSessionId, setCurrentSessionId] = useState(null);\r\n  const [user, setUser] = useState(null);\r\n  \r\n  const chatEndRef = useRef(null);\r\n  const iframeContainerRef = useRef(null);\r\n\r\n  // ðŸ”¥ State ×—×“×© ×œ× ×™×ª×•×— ×”×’×œ×™×•×Ÿ ×¢× Gemini\r\n  const [sheetAnalysis, setSheetAnalysis] = useState(null);\r\n  const [sheetInstructions, setSheetInstructions] = useState(null);\r\n  \r\n  // ðŸ”¥ State ×—×“×© ×œ×ª×•×›× ×™×•×ª ×©×™× ×•×™×™× ×ž×•×¨×›×‘×•×ª\r\n  const [pendingChangePlan, setPendingChangePlan] = useState(null);\r\n  const [clarificationAnswers, setClarificationAnswers] = useState(['', '', '', '', '']);\r\n  const [isAnsweringQuestions, setIsAnsweringQuestions] = useState(false);\r\n  \r\n  // ðŸŽšï¸ State ×—×“×© ×œ×‘×—×™×¨×ª ×ž×¦×‘ ×©×™× ×•×™ ×ž×©×ž×¢×•×ª×™\r\n  const [isSignificantChange, setIsSignificantChange] = useState(false);\r\n  \r\n  // ðŸ”‘ Session ID for backend session storage\r\n  const [sessionId, setSessionId] = useState(() => {\r\n    return Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15);\r\n  });\r\n\r\n  // Helper function to extract questions from change plan response\r\n  const extractQuestionsFromResponse = (response) => {\r\n    console.log('Extracting questions from response:', response);\r\n    const questionSection = response.split('ðŸ¤” ×©××œ×•×ª ×”×‘×”×¨×”')[1];\r\n    if (!questionSection) {\r\n      console.log('No question section found');\r\n      return [];\r\n    }\r\n    \r\n    console.log('Question section found:', questionSection);\r\n    \r\n    const questions = [];\r\n    // Pattern matches \"**1.** question text\"\r\n    const questionMatches = questionSection.match(/\\*\\*\\d+\\.\\*\\*\\s*([^\\n*]+)/g);\r\n    \r\n    if (questionMatches) {\r\n      console.log('Raw question matches:', questionMatches);\r\n      questionMatches.forEach(match => {\r\n        const question = match.replace(/\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\r\n        if (question && question.length > 5) {\r\n          questions.push(question);\r\n        }\r\n      });\r\n    } else {\r\n      console.log('No question matches found, trying alternative pattern');\r\n      // Alternative: look for lines that start with numbers\r\n      const lines = questionSection.split('\\n');\r\n      for (let line of lines) {\r\n        line = line.trim();\r\n        if (line.match(/^\\*\\*\\d+\\.\\*\\*/)) {\r\n          const question = line.replace(/^\\*\\*\\d+\\.\\*\\*\\s*/, '').trim();\r\n          if (question && question.length > 5) {\r\n            questions.push(question);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    console.log('Frontend extracted questions:', questions);\r\n    return questions.slice(0, 5); // Ensure max 5 questions\r\n  };\r\n\r\n  // Function to execute change plan with clarification answers\r\n  const executeChangePlan = async () => {\r\n    if (!pendingChangePlan || clarificationAnswers.some(answer => !answer.trim())) {\r\n      setSnackbarMessage('âŒ ×™×© ×œ×¢× ×•×ª ×¢×œ ×›×œ 5 ×”×©××œ×•×ª');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n\r\n    setIsStreamingResponse(true);\r\n    const loadingMessageId = Date.now();\r\n    setMessages(prev => [...prev, { \r\n      text: '', \r\n      sender: 'assistant', \r\n      isLoading: true, \r\n      timestamp: new Date(), \r\n      id: loadingMessageId \r\n    }]);\r\n\r\n    try {\r\n      const sheetData = (isSheetLoaded && isSheetSelected) ? \r\n        await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\r\n      const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\r\n\r\n      const payload = {\r\n        planId: pendingChangePlan.id,\r\n        clarificationAnswers: clarificationAnswers,\r\n        spreadsheetId: spreadsheetId,\r\n        accessToken: accessToken,\r\n        sheetsMetadata: sheetsMetadata,\r\n        selectedSheetName: selectedSheetName\r\n      };\r\n\r\n      const response = await fetch(`${API_URL}/api/execute-change-plan`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw new Error(`Server error: ${response.status} ${errorText}`);\r\n      }\r\n\r\n      const reader = response.body.getReader();\r\n      const decoder = new TextDecoder();\r\n      let accumulatedResponse = '';\r\n\r\n      while (true) {\r\n        const { value, done } = await reader.read();\r\n        if (done) break;\r\n        \r\n        accumulatedResponse += decoder.decode(value, { stream: true });\r\n\r\n        setMessages(prev => prev.map(m => {\r\n          if (m.id === loadingMessageId) {\r\n            return { ...m, text: accumulatedResponse, isLoading: true };\r\n          }\r\n          return m;\r\n        }));\r\n      }\r\n\r\n      // Final processing\r\n      setMessages(prev => prev.map(m =>\r\n        m.id === loadingMessageId\r\n        ? { ...m, text: accumulatedResponse, isLoading: false }\r\n        : m\r\n      ));\r\n\r\n      // Reset change plan state\r\n      setPendingChangePlan(null);\r\n      setIsAnsweringQuestions(false);\r\n      setClarificationAnswers(['', '', '', '', '']);\r\n\r\n      // Refresh the sheet if needed\r\n      if (googleSheetsUrl && selectedSheetName) {\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 1000);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error executing change plan:', error);\r\n      setMessages(prev => prev.map(m =>\r\n        m.id === loadingMessageId\r\n        ? { ...m, text: `âŒ ×©×’×™××” ×‘×‘×™×¦×•×¢ ×”×ª×•×›× ×™×ª: ${error.message}`, isLoading: false }\r\n        : m\r\n      ));\r\n    } finally {\r\n      setIsStreamingResponse(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Load saved access token ONLY - no chat messages from localStorage\r\n    const savedToken = localStorage.getItem('accessToken');\r\n    if (savedToken) {\r\n      setAccessToken(savedToken);\r\n    }\r\n\r\n    // Only load PDF/Excel data from localStorage (temporary files, not chat history)\r\n    const savedPdfJson = localStorage.getItem('extractedPdf');\r\n    if (savedPdfJson) {\r\n      try {\r\n        const savedPdf = JSON.parse(savedPdfJson);\r\n        if (savedPdf && savedPdf.name && savedPdf.data) {\r\n          // Check if PDF still exists on server if it has a fileId\r\n          if (savedPdf.fileId) {\r\n            fetch(`${API_URL}/api/download-pdf/${savedPdf.fileId}`, {\r\n              method: 'HEAD',\r\n              credentials: 'include'\r\n            }).then(response => {\r\n              if (response.ok) {\r\n                setExtractedPdf(savedPdf);\r\n                setMessages(prev => [...prev, { text: `ðŸ“„ × ×ª×•× ×™× ×§×•×“×ž×™× ×©×—×•×œ×¦×• ×ž-PDF \"${savedPdf.name}\" × ×˜×¢× ×•.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n              } else {\r\n                // PDF no longer exists on server\r\n                console.log('ðŸ“„ PDF from localStorage no longer exists on server, removing...');\r\n                localStorage.removeItem('extractedPdf');\r\n              }\r\n            }).catch(() => {\r\n              // Error checking PDF, remove from localStorage\r\n              localStorage.removeItem('extractedPdf');\r\n            });\r\n          } else {\r\n            // Old PDF without fileId, just load it\r\n            setExtractedPdf(savedPdf);\r\n            setMessages(prev => [...prev, { text: `ðŸ“„ × ×ª×•× ×™× ×§×•×“×ž×™× ×©×—×•×œ×¦×• ×ž-PDF \"${savedPdf.name}\" × ×˜×¢× ×•.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to parse extracted PDF data from localStorage', e);\r\n        localStorage.removeItem('extractedPdf');\r\n      }\r\n    }\r\n\r\n    const savedExcelJson = localStorage.getItem('extractedExcel');\r\n    if (savedExcelJson) {\r\n        try {\r\n            const savedExcel = JSON.parse(savedExcelJson);\r\n            if (savedExcel && savedExcel.name && savedExcel.data) {\r\n                setExtractedExcel(savedExcel);\r\n                setMessages(prev => [...prev, { text: `ðŸ“Š × ×ª×•× ×™× ×§×•×“×ž×™× ×©×—×•×œ×¦×• ×ž-Excel \"${savedExcel.name}\" × ×˜×¢× ×•.`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to parse extracted Excel data from localStorage', e);\r\n            localStorage.removeItem('extractedExcel');\r\n        }\r\n    }\r\n  }, []);\r\n\r\n  // Fetch user info when access token is available\r\n  useEffect(() => {\r\n    if (accessToken) {\r\n      fetchUserInfo();\r\n    }\r\n  }, [accessToken]);\r\n\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const token = params.get('token');\r\n    if (token) {\r\n      setAccessToken(token);\r\n      localStorage.setItem('accessToken', token);\r\n      setSnackbarMessage('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!');\r\n      setShowSnackbar(true);\r\n      window.history.replaceState({}, document.title, \"/\");\r\n    } else {\r\n      // Check if user is already authenticated\r\n      checkAuthStatus();\r\n    }\r\n  }, []);\r\n\r\n  const checkAuthStatus = async () => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/api/user`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUser(data.user);\r\n        if (data.accessToken) {\r\n          setAccessToken(data.accessToken);\r\n          localStorage.setItem('accessToken', data.accessToken);\r\n        }\r\n        setSnackbarMessage('×‘×¨×•×š ×”×‘× ×‘×—×–×¨×”!');\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.log('Not authenticated:', error);\r\n      // User is not authenticated, show login button\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    const script = document.createElement('script');\r\n    script.src = 'https://apis.google.com/js/api.js';\r\n    script.onload = () => window.gapi.load('picker', { 'callback': () => setIsPickerReady(true) });\r\n    document.head.appendChild(script);\r\n  }, []);\r\n\r\n  // × ×™×”×•×œ ×’×œ×™×œ×” ×¢×‘×•×¨ iframe - ×”×’× ×” ×ž×™×•×—×“×ª ×¢×œ Mac gestures\r\n  useEffect(() => {\r\n    const handleWheel = (e) => {\r\n      if (isIframeHovered) {\r\n        // ×”×’× ×” ×¡×¤×¦×™×¤×™×ª ×¢×œ horizontal scrolling ×‘×ž××§\r\n        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n          // ×–×” ×’×œ×™×œ×” ××•×¤×§×™×ª - ×‘×œ×•×§ ××ª ×”navigation gesture\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleTouchStart = (e) => {\r\n      if (isIframeHovered) {\r\n        e.stopPropagation();\r\n      }\r\n    };\r\n\r\n    const handleTouchMove = (e) => {\r\n      if (isIframeHovered) {\r\n        e.stopPropagation();\r\n      }\r\n    };\r\n\r\n    // ×”×•×¡×£ event listeners ×¢× focus ×¢×œ gestures\r\n    document.addEventListener('wheel', handleWheel, { passive: false });\r\n    document.addEventListener('touchstart', handleTouchStart, { passive: false });\r\n    document.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n\r\n    return () => {\r\n      document.removeEventListener('wheel', handleWheel);\r\n      document.removeEventListener('touchstart', handleTouchStart);\r\n      document.removeEventListener('touchmove', handleTouchMove);\r\n    };\r\n  }, [isIframeHovered]);\r\n\r\n  // ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ××•×˜×•×ž×˜×™×ª ×›×©×’×œ×™×•×Ÿ × ×‘×—×¨\r\n  useEffect(() => {\r\n    if (isSheetSelected && selectedSheetName && currentSessionId) {\r\n      // Auto-check status when sheet is selected\r\n      // ×‘×“×™×§×” ××•×˜×•×ž×˜×™×ª ××—×¨×™ ×˜×¢×™× ×ª ×”×’×œ×™×•×Ÿ\r\n      const timer = setTimeout(() => {\r\n        checkUndoRedoStatus();\r\n        checkForGreenCells();\r\n      }, 2000);\r\n      \r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [selectedSheetName, isSheetSelected, currentSessionId]);\r\n\r\n  const fetchUserInfo = async () => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/api/user`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUser(data.user);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching user info:', error);\r\n    }\r\n  };\r\n\r\n  const handleSessionSelect = async (sessionId) => {\r\n    if (!sessionId) {\r\n      setCurrentSessionId(null);\r\n      setMessages([{ text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n      return;\r\n    }\r\n\r\n    setCurrentSessionId(sessionId);\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/chat/session/${sessionId}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const chatHistory = await response.json();\r\n        const loadedMessages = chatHistory.messages.map(msg => ({\r\n          text: msg.content,\r\n          sender: msg.role === 'user' ? 'user' : 'assistant',\r\n          timestamp: new Date(msg.timestamp),\r\n          id: msg._id || Date.now() + Math.random()\r\n        }));\r\n        \r\n        setMessages(loadedMessages);\r\n        // Chat history loaded\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading chat session:', error);\r\n      setSnackbarMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×©×™×—×”');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const generateSessionId = () => {\r\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n  };\r\n\r\n\r\n\r\n\r\n  \r\n  const makeGoogleSheetsAPICall = async (spreadsheetId, range, values = null, method = 'GET', valueRenderOption = 'FORMATTED_VALUE') => {\r\n    if (!accessToken) throw new Error('No access token available. Please log in.');\r\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n    try {\r\n      let url, options;\r\n      if (method === 'GET') {\r\n        // ðŸ”¥ ×”×•×¡×£ ××ª valueRenderOption ×œ×§×¨×™××•×ª GET\r\n        const params = new URLSearchParams({ valueRenderOption });\r\n        url = `${baseUrl}/values/${range}?${params}`;\r\n        console.log('ðŸ”¥ Google Sheets API call:', url);\r\n        options = { method, headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' }};\r\n      } else {\r\n        url = `${baseUrl}/values/${range}?valueInputOption=RAW`;\r\n        options = { method, headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' }, body: JSON.stringify({ values }) };\r\n      }\r\n      const response = await fetch(url, options);\r\n      const data = await response.json();\r\n      if (!response.ok) throw new Error(data.error?.message || 'API call failed');\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Google Sheets API error:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // ðŸ”¥ ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ×©×™×œ×•×‘ ×¢×¨×›×™× ×•× ×•×¡×—××•×ª\r\n  const combineValuesAndFormulas = (values, formulas) => {\r\n    const combined = [];\r\n    \r\n    console.log('ðŸ”¥ Starting combineValuesAndFormulas...');\r\n    console.log('ðŸ“Š Values:', values?.length || 0, 'rows');\r\n    console.log('ðŸ“‹ Formulas:', formulas?.length || 0, 'rows');\r\n    \r\n    for (let row = 0; row < Math.max(values.length, formulas.length); row++) {\r\n      const valueRow = values[row] || [];\r\n      const formulaRow = formulas[row] || [];\r\n      const combinedRow = [];\r\n      \r\n      for (let col = 0; col < Math.max(valueRow.length, formulaRow.length); col++) {\r\n        const value = valueRow[col] || '';\r\n        const formula = formulaRow[col] || '';\r\n        \r\n        // ðŸ”¥ ×œ×•×’ ×œ×‘×“×™×§×” (×¨×§ ×œ×©×•×¨×” ×¨××©×•× ×”)\r\n        if (row === 0 && col < 3) {\r\n          console.log(`Cell [${row},${col}]: value=\"${value}\" (${typeof value}), formula=\"${formula}\" (${typeof formula})`);\r\n        }\r\n        \r\n        // ðŸ”¥ ×ª×™×§×•×Ÿ: ×‘×“×•×§ ×©×–×” string ×•×ž×ª×—×™×œ ×‘-= ×œ×¤× ×™ ×©×ž×’×“×™×¨×™× ×›× ×•×¡×—×”\r\n        if (typeof formula === 'string' && formula.length > 0 && formula.startsWith('=')) {\r\n          // ×–×• × ×•×¡×—×” ××ž×™×ª×™×ª\r\n          combinedRow.push({\r\n            value: value,\r\n            formula: formula,\r\n            type: 'formula'\r\n          });\r\n        } else {\r\n          // ×–×” ×¢×¨×š ×¨×’×™×œ (×œ× × ×•×¡×—×”) - ×§×— ××ª ×”×¢×¨×š ××• ××ª ×ž×” ×©×™×© ×‘formula ×× ×”×¢×¨×š ×¨×™×§\r\n          const finalValue = value !== '' ? value : (formula !== '' ? formula : '');\r\n          combinedRow.push({\r\n            value: finalValue,\r\n            type: 'literal'\r\n          });\r\n        }\r\n      }\r\n      combined.push(combinedRow);\r\n    }\r\n    \r\n    console.log('ðŸ”¥ Combined values and formulas:', combined.slice(0, 2)); // ×¨×§ 2 ×©×•×¨×•×ª ×¨××©×•× ×•×ª\r\n    return combined;\r\n  };\r\n\r\n  // ðŸ”¥ ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ× ×™×ª×•×— ×”×’×œ×™×•×Ÿ ×¢× Gemini\r\n  const analyzeSheetWithGemini = async (sheetData, sheetName, currentExtractedPdf = null) => {\r\n    try {\r\n      setMessages(prev => [...prev, { \r\n        text: `ðŸ” ×ž× ×ª×— ××ª ×ž×‘× ×” ×”×’×œ×™×•×Ÿ \"${sheetName}\" ×¢× AI...`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n\r\n      const payload = {\r\n        sheetData: sheetData,\r\n        sheetName: sheetName,\r\n        sessionId: sessionId,\r\n        analysisType: 'initial_analysis'\r\n      };\r\n\r\n      const response = await fetch(`${API_URL}/api/analyze-sheet`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      \r\n      // ×©×ž×•×¨ ××ª ×”×ª×•×¦××•×ª\r\n      setSheetAnalysis(result.summary);\r\n      setSheetInstructions(result.instructions); // ×©×ž×•×¨ ××ª ×”×”×•×¨××•×ª ×©×—×–×¨×• ×ž×”×‘×§×× ×“\r\n\r\n      // ×”×¦×’ ××ª ×”×¡×™×›×•× ×œ×ž×©×ª×ž×©\r\n      setMessages(prev => [...prev, { \r\n        text: `ðŸ“Š × ×™×ª×•×— ×”×’×œ×™×•×Ÿ:\\n${result.summary}`, \r\n        sender: 'assistant', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n\r\n      console.log('ðŸ”¥ Sheet analysis completed:', result);\r\n      console.log('ðŸ“ Sheet summary saved:', result.summary?.length, 'characters');\r\n      console.log('ðŸ“‹ Sheet instructions saved:', result.instructions?.length, 'characters');\r\n\r\n      // ×”×•×“×¢×” ×§×¦×¨×” ×©×”×”×•×¨××•×ª × ×©×ž×¨×•\r\n      setTimeout(() => {\r\n        setMessages(prev => [...prev, { \r\n          text: `âœ… ×”×•×¨××•×ª ×¢×‘×•×“×” ×ž×¤×•×¨×˜×•×ª × ×©×ž×¨×• ×œ×ž×¢×¨×›×ª ×¢×‘×•×¨ ×©×™×—×•×ª ×¢×ª×™×“×™×•×ª`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      }, 1000);\r\n\r\n      // Return the analysis results for use in handleSheetChange\r\n      return {\r\n        instructions: result.instructions,\r\n        summary: result.summary\r\n      };\r\n\r\n    } catch (error) {\r\n      console.error('Error analyzing sheet:', error);\r\n      setMessages(prev => [...prev, { \r\n        text: `âŒ ×©×’×™××” ×‘× ×™×ª×•×— ×”×’×œ×™×•×Ÿ: ${error.message}`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n    }\r\n  };\r\n\r\n  const extractSpreadsheetId = (url) => {\r\n    const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\r\n    return match ? match[1] : null;\r\n  };\r\n  \r\n  // ×¤×•× ×§×¦×™×” ×œ×™×¦×•×¨ URL ×¢× ×”×’×œ×™×•×Ÿ ×”× ×›×•×Ÿ\r\n  const getSheetUrlWithGid = (baseUrl, sheetName) => {\r\n    if (!sheetName || !sheetsMetadata) return baseUrl;\r\n    \r\n    const selectedSheet = sheetsMetadata.find(sheet => sheet.name === sheetName);\r\n    if (!selectedSheet) return baseUrl;\r\n    \r\n    // ×”×¡×¨ ×›×œ gid ×§×™×™× ×ž×”-URL\r\n    const cleanUrl = baseUrl.split('#')[0];\r\n    \r\n    // ×”×•×¡×£ ××ª ×”-gid ×”×—×“×©\r\n    return `${cleanUrl}#gid=${selectedSheet.id}`;\r\n  };\r\n\r\n  const getSpreadsheetMetadata = async (spreadsheetId) => {\r\n    if (!accessToken) return [];\r\n    try {\r\n      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;\r\n      const response = await fetch(url, { headers: { 'Authorization': `Bearer ${accessToken}` } });\r\n      if (!response.ok) throw new Error('Failed to fetch spreadsheet metadata');\r\n      const metadata = await response.json();\r\n      return metadata.sheets.map(sheet => ({ name: sheet.properties.title, id: sheet.properties.sheetId }));\r\n    } catch (error) {\r\n      console.error('Error fetching spreadsheet metadata:', error);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (event, fileType) => {\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n\r\n    if (file.type === 'application/pdf') {\r\n        // Clean all previous PDF-related state\r\n        setExtractedPdf(null);\r\n        localStorage.removeItem('extractedPdf');\r\n        setIsExtractingData(true);\r\n        \r\n        // Remove any previous PDF-related messages\r\n        setMessages(prev => prev.filter(msg => \r\n            !msg.text.includes('× ×ª×•× ×™× ×—×•×œ×¦×•') && \r\n            !msg.text.includes('×©×’×™××” ×‘×—×™×œ×•×¥') &&\r\n            !msg.text.includes('× ×ª×•× ×™ ×”-PDF × ×•×§×•')\r\n        ));\r\n        \r\n        setMessages(prev => [...prev, { text: `â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ \"${file.name}\"...`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        \r\n        const formData = new FormData();\r\n        formData.append('pdf', file);\r\n        \r\n        // ðŸ”¥ ×× ×™×© ×’×œ×™×•×Ÿ ×˜×¢×•×Ÿ, ×©×œ×•×£ ××ª ×”× ×ª×•× ×™× ×•×©×œ×— ××•×ª×\r\n        if (isSheetLoaded && isSheetSelected) {\r\n          const currentSheetData = await getSheetData(\r\n            extractSpreadsheetId(googleSheetsUrl), \r\n            selectedSheetName\r\n          );\r\n          \r\n          if (currentSheetData) {\r\n            formData.append('sheetData', JSON.stringify(currentSheetData));\r\n          }\r\n          if (sheetInstructions) {\r\n            formData.append('sheetInstructions', sheetInstructions);\r\n          }\r\n          if (sheetAnalysis) {\r\n            formData.append('sheetAnalysis', sheetAnalysis);\r\n          }\r\n          if (selectedSheetName) {\r\n            formData.append('sheetName', selectedSheetName);\r\n          }\r\n          \r\n          console.log('ðŸ”¥ Sending PDF with full sheet context:', {\r\n            hasSheetData: !!currentSheetData,\r\n            sheetDataLength: currentSheetData ? currentSheetData.length : 0,\r\n            hasInstructions: !!sheetInstructions,\r\n            instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\r\n            hasAnalysis: !!sheetAnalysis,\r\n            analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\r\n            sheetName: selectedSheetName\r\n          });\r\n        } else {\r\n          console.log('ðŸ”¥ Sending PDF without sheet context (simple OCR mode)');\r\n        }\r\n\r\n        fetch(`${API_URL}/api/extract-pdf-data`, {\r\n            method: 'POST', \r\n            body: formData,\r\n            credentials: 'include'\r\n        })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                return response.json().then(err => { throw new Error(err.error || 'Failed to extract data') });\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(result => {\r\n            const pdfInfo = { \r\n                name: file.name, \r\n                data: result,\r\n                fileId: result.fileId, // ×©×ž×™×¨×ª fileId ×œ×¤×ª×™×—×” ×¢×ª×™×“×™×ª\r\n                processingMode: result.processingMode || 'structured', // track processing mode\r\n                isFullText: result.isFullText || false // track if this is full text\r\n            };\r\n            setExtractedPdf(pdfInfo);\r\n            localStorage.setItem('extractedPdf', JSON.stringify(pdfInfo));\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™×')));\r\n            \r\n            // Different success messages based on processing mode\r\n            let successMessage;\r\n            if (result.processingMode === 'simple_ocr') {\r\n                successMessage = `âœ… ×˜×§×¡×˜ ×—×•×œ×¥ ×ž-\"${file.name}\". × ×™×ª×Ÿ ×œ×©××•×œ ×©××œ×•×ª ×¢×œ ×”×ª×•×›×Ÿ. ×˜×¢×Ÿ ×’×™×œ×™×•×Ÿ ×œ× ×™×ª×•×— ×ž×¤×•×¨×˜.`;\r\n            } else {\r\n                successMessage = result.fileId \r\n                    ? `âœ… × ×ª×•× ×™× ×—×•×œ×¦×• ×‘×”×¦×œ×—×” ×ž-\"${file.name}\". ×›×¢×ª × ×™×ª×Ÿ ×œ×©××•×œ ×©××œ×•×ª ×¢×œ ×”×§×•×‘×¥ ××• ×œ×—×–×•×¨ ×œ×§×•×‘×¥ ×”×ž×§×•×¨×™.`\r\n                    : `âœ… × ×ª×•× ×™× ×—×•×œ×¦×• ×‘×”×¦×œ×—×” ×ž-\"${file.name}\". ×›×¢×ª × ×™×ª×Ÿ ×œ×©××•×œ ×©××œ×•×ª ×¢×œ ×”×§×•×‘×¥.`;\r\n            }\r\n            \r\n            setMessages(prev => [...prev, { text: successMessage, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .catch(error => {\r\n            console.error('PDF data extraction failed:', error);\r\n            setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™×')));\r\n            setMessages(prev => [...prev, { text: `âŒ ×©×’×™××” ×‘×—×™×œ×•×¥ × ×ª×•× ×™× ×ž-\"${file.name}\": ${error.message}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n        })\r\n        .finally(() => {\r\n            setIsExtractingData(false);\r\n        });\r\n    } else if (fileType === 'Excel') {\r\n        // Ask user if they want to convert to Google Sheets\r\n        const shouldConvert = window.confirm(\r\n            `×”×× ×‘×¨×¦×•× ×š ×œ×”×ž×™×¨ ××ª ×§×•×‘×¥ ×”-Excel \"${file.name}\" ×œ-Google Sheets?\\n\\n` +\r\n            `×›×Ÿ - ×”×¢×œ××” ×œ-Google Drive ×•×”×ž×¨×” ×œ-Google Sheets\\n` +\r\n            `×œ× - ×—×™×œ×•×¥ × ×ª×•× ×™× ×ž×§×•×ž×™ ×‘×œ×‘×“`\r\n        );\r\n\r\n        if (shouldConvert) {\r\n            // Convert to Google Sheets\r\n            setIsExtractingExcel(true);\r\n            \r\n            setMessages(prev => prev.filter(msg =>\r\n                !msg.text.includes('×ž×ž×™×¨') &&\r\n                !msg.text.includes('Google Sheets') &&\r\n                !msg.text.includes('×©×’×™××” ×‘×”×ž×¨×”')\r\n            ));\r\n            \r\n            setMessages(prev => [...prev, {\r\n                text: `ðŸ”„ ×ž×ž×™×¨ ××ª \"${file.name}\" ×œ-Google Sheets...`,\r\n                sender: 'system',\r\n                timestamp: new Date(),\r\n                id: Date.now()\r\n            }]);\r\n            \r\n            const formData = new FormData();\r\n            formData.append('excel', file);\r\n\r\n            fetch(`${API_URL}/api/excel-to-sheets`, {\r\n                method: 'POST',\r\n                body: formData,\r\n                credentials: 'include'\r\n            })\r\n            .then(response => {\r\n                console.log('ðŸ” Response status:', response.status);\r\n                console.log('ðŸ” Response headers:', Object.fromEntries(response.headers.entries()));\r\n                \r\n                // Clone the response to read it as text first\r\n                return response.clone().text().then(responseText => {\r\n                    console.log('ðŸ” Raw response text:', responseText);\r\n                    \r\n                    if (!response.ok) {\r\n                        // Try to parse as JSON for error, but if it fails, use the text\r\n                        try {\r\n                            const errorData = JSON.parse(responseText);\r\n                            throw new Error(errorData.error || 'Failed to convert Excel to Google Sheets');\r\n                        } catch (parseError) {\r\n                            throw new Error(`HTTP ${response.status}: ${responseText}`);\r\n                        }\r\n                    }\r\n                    \r\n                    // Try to parse the successful response as JSON\r\n                    try {\r\n                        return JSON.parse(responseText);\r\n                    } catch (parseError) {\r\n                        console.error('ðŸ” JSON parse error:', parseError);\r\n                        throw new Error(`Invalid JSON response: ${responseText.substring(0, 200)}...`);\r\n                    }\r\n                });\r\n            })\r\n            .then(result => {\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('ðŸ”„ ×ž×ž×™×¨')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `âœ… ×”×§×•×‘×¥ \"${file.name}\" ×”×•×ž×¨ ×‘×”×¦×œ×—×” ×œ-Google Sheets!`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n                \r\n                // Open the created Google Sheet in a new tab\r\n                if (result.url) {\r\n                    window.open(result.url, '_blank');\r\n                    setMessages(prev => [...prev, {\r\n                        text: `ðŸ“Š Google Sheets × ×¤×ª×— ×‘×›×¨×˜×™×¡×™×™×” ×—×“×©×”`,\r\n                        sender: 'system',\r\n                        timestamp: new Date(),\r\n                        id: Date.now()\r\n                    }]);\r\n                    \r\n                    // Optionally, also load it in the current interface\r\n                    handleGoogleSheetsUrl(result.url);\r\n                }\r\n            })\r\n            .catch(error => {\r\n                console.error('Excel to Google Sheets conversion failed:', error);\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('ðŸ”„ ×ž×ž×™×¨')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `âŒ ×©×’×™××” ×‘×”×ž×¨×” ×œ-Google Sheets: ${error.message}`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n            })\r\n            .finally(() => {\r\n                setIsExtractingExcel(false);\r\n            });\r\n        } else {\r\n            // Original local extraction logic\r\n            setExtractedExcel(null);\r\n            localStorage.removeItem('extractedExcel');\r\n            setIsExtractingExcel(true);\r\n            \r\n            setMessages(prev => prev.filter(msg =>\r\n                !msg.text.includes('×—×•×œ×¦×• ×ž-Excel') &&\r\n                !msg.text.includes('×©×’×™××” ×‘×—×™×œ×•×¥ Excel') &&\r\n                !msg.text.includes('× ×ª×•× ×™ ×”-Excel × ×•×§×•')\r\n            ));\r\n            \r\n            setMessages(prev => [...prev, {\r\n                text: `â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ Excel \"${file.name}\"...`,\r\n                sender: 'system',\r\n                timestamp: new Date(),\r\n                id: Date.now()\r\n            }]);\r\n            \r\n            const formData = new FormData();\r\n            formData.append('excel', file);\r\n\r\n            fetch(`${API_URL}/api/extract-excel-data`, {\r\n                method: 'POST',\r\n                body: formData\r\n            })\r\n            .then(response => {\r\n                if (!response.ok) {\r\n                    return response.json().then(err => {\r\n                        throw new Error(err.error || 'Failed to extract Excel data')\r\n                    });\r\n                }\r\n                return response.json();\r\n            })\r\n            .then(result => {\r\n                const excelInfo = { name: file.name, data: result.data };\r\n                setExtractedExcel(excelInfo);\r\n                localStorage.setItem('extractedExcel', JSON.stringify(excelInfo));\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ Excel')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `âœ… × ×ª×•× ×™× ×—×•×œ×¦×• ×‘×”×¦×œ×—×” ×ž-Excel \"${file.name}\".`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n            })\r\n            .catch(error => {\r\n                console.error('Excel data extraction failed:', error);\r\n                setMessages(prev => prev.filter(msg => !msg.text.includes('â³ ×ž×—×œ×¥ × ×ª×•× ×™× ×ž×§×•×‘×¥ Excel')));\r\n                setMessages(prev => [...prev, {\r\n                    text: `âŒ ×©×’×™××” ×‘×—×™×œ×•×¥ × ×ª×•× ×™ Excel: ${error.message}`,\r\n                    sender: 'system',\r\n                    timestamp: new Date(),\r\n                    id: Date.now()\r\n                }]);\r\n            })\r\n            .finally(() => {\r\n                setIsExtractingExcel(false);\r\n            });\r\n        }\r\n    }\r\n  };\r\n\r\n  const loadAvailableSheets = async (spreadsheetId) => {\r\n    setIsLoadingSheets(true);\r\n    setIsSheetSelected(false); // Reset selection\r\n    setSelectedSheetName(''); // Clear any previous selection\r\n    try {\r\n      const sheets = await getSpreadsheetMetadata(spreadsheetId);\r\n      setAvailableSheets(sheets);\r\n      setSheetsMetadata(sheets);\r\n      // ×¨×§ ×”×•×“×¢×” ×©×”×’×œ×™×•× ×•×ª × ×˜×¢× ×• - ×‘×œ×™ ×œ×‘×—×•×¨ ×’×œ×™×•×Ÿ ××•×˜×•×ž×˜×™×ª\r\n      if (sheets.length > 0) {\r\n        setMessages(prev => [...prev, { \r\n          text: `ðŸ“‹ × ×ž×¦××• ${sheets.length} ×’×œ×™×•× ×•×ª - ×‘×—×¨ ×’×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      }\r\n    } finally {\r\n      setIsLoadingSheets(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleSheetsUrl = async (url) => {\r\n    setGoogleSheetsUrl(url);\r\n    setIsSheetLoaded(true);\r\n    setIsSheetSelected(false); // Reset sheet selection for new spreadsheet\r\n    setIsAgentMode(false); // Reset agent mode for new spreadsheet\r\n    const spreadsheetId = extractSpreadsheetId(url);\r\n    if (spreadsheetId && accessToken) await loadAvailableSheets(spreadsheetId);\r\n  };\r\n  \r\n  const handleSheetChange = async (newSheetName) => {\r\n    if (newSheetName === selectedSheetName) return;\r\n    \r\n    setSelectedSheetName(newSheetName);\r\n    setIsSheetSelected(true); // ×ž×¡×ž×Ÿ ×©× ×‘×—×¨ ×’×œ×™×•×Ÿ\r\n    \r\n    const spreadsheetId = extractSpreadsheetId(googleSheetsUrl);\r\n    if (spreadsheetId) {\r\n      // ðŸ”¥ ×©×œ×•×£ × ×ª×•× ×™ ×’×œ×™×•×Ÿ ×¢× ×¢×¨×›×™× ×•× ×•×¡×—××•×ª\r\n      const sheetData = await getSheetData(spreadsheetId, newSheetName);\r\n      \r\n      setMessages(prev => [...prev, { \r\n        text: `âœ… ×ž×—×•×‘×¨ ×œ×’×œ×™×•×Ÿ: ${newSheetName}`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n\r\n      // ðŸ”¥ × ×ª×— ××ª ×”×’×œ×™×•×Ÿ ×¢× Gemini\r\n      if (sheetData) {\r\n        const analysisResult = await analyzeSheetWithGemini(sheetData, newSheetName, extractedPdf);\r\n        \r\n        // ðŸ”¥ Reanalyze PDF if it exists and is in simple OCR mode\r\n        if (extractedPdf && extractedPdf.processingMode === 'simple_ocr' && analysisResult) {\r\n          console.log('ðŸ”„ PDF found in simple_ocr mode, triggering reanalysis with sheet context...');\r\n          await reanalyzePdfWithSheetContext(sheetData, analysisResult.instructions, analysisResult.summary, newSheetName);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // ðŸ”¥ Function to reanalyze PDF when sheet context becomes available\r\n  const reanalyzePdfWithSheetContext = async (sheetData, sheetInstructions, sheetAnalysis, selectedSheetName) => {\r\n    if (!extractedPdf || !extractedPdf.fileId || extractedPdf.processingMode === 'structured') {\r\n      return; // No PDF to reanalyze or already analyzed\r\n    }\r\n\r\n    console.log('ðŸ”„ Reanalyzing PDF with new sheet context...');\r\n    \r\n    setMessages(prev => [...prev, { \r\n      text: `ðŸ”„ ×ž× ×ª×— ×ž×—×“×© ××ª \"${extractedPdf.name}\" ×¢× ×”×§×©×¨ ×”×’×œ×™×•×Ÿ ×”×—×“×©...`, \r\n      sender: 'system', \r\n      timestamp: new Date(), \r\n      id: Date.now() \r\n    }]);\r\n\r\n    try {\r\n      // Create FormData for re-analysis\r\n      const formData = new FormData();\r\n      \r\n      // We need to fetch the PDF file again - check if it exists first\r\n      const pdfResponse = await fetch(`${API_URL}/api/download-pdf/${extractedPdf.fileId}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!pdfResponse.ok) {\r\n        // PDF no longer exists on server - clean up state\r\n        console.log('âŒ PDF file no longer exists on server, cleaning up...');\r\n        setExtractedPdf(null);\r\n        localStorage.removeItem('extractedPdf');\r\n        setMessages(prev => prev.filter(msg => !msg.text.includes(extractedPdf.name)));\r\n        return;\r\n      }\r\n      \r\n      const pdfBlob = await pdfResponse.blob();\r\n      formData.append('pdf', pdfBlob, extractedPdf.name);\r\n      \r\n      // Add sheet context data directly to FormData\r\n      console.log('ðŸ”„ Reanalyzing PDF with sheet context:', {\r\n        hasSheetData: !!sheetData,\r\n        sheetDataLength: sheetData ? sheetData.length : 0,\r\n        hasInstructions: !!sheetInstructions,\r\n        instructionsLength: sheetInstructions ? sheetInstructions.length : 0,\r\n        hasAnalysis: !!sheetAnalysis,\r\n        analysisLength: sheetAnalysis ? sheetAnalysis.length : 0,\r\n        sheetName: selectedSheetName\r\n      });\r\n      \r\n      if (sheetData) {\r\n        formData.append('sheetData', JSON.stringify(sheetData));\r\n      }\r\n      if (sheetInstructions) {\r\n        formData.append('sheetInstructions', sheetInstructions);\r\n      }\r\n      if (sheetAnalysis) {\r\n        formData.append('sheetAnalysis', sheetAnalysis);\r\n      }\r\n      if (selectedSheetName) {\r\n        formData.append('sheetName', selectedSheetName);\r\n      }\r\n      \r\n      const response = await fetch(`${API_URL}/api/extract-pdf-data`, {\r\n        method: 'POST', \r\n        body: formData,\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('Failed to reanalyze PDF');\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      // Update PDF info with new analysis\r\n      const updatedPdfInfo = { \r\n        ...extractedPdf,\r\n        data: result,\r\n        processingMode: result.processingMode || 'structured',\r\n        isFullText: result.isFullText || false\r\n      };\r\n      \r\n      setExtractedPdf(updatedPdfInfo);\r\n      localStorage.setItem('extractedPdf', JSON.stringify(updatedPdfInfo));\r\n      \r\n      setMessages(prev => [...prev, { \r\n        text: `âœ… \"${extractedPdf.name}\" × ×•×ª×— ×ž×—×“×© ×‘×”×¦×œ×—×” ×¢× ×”×§×©×¨ ×”×’×œ×™×•×Ÿ`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n      \r\n    } catch (error) {\r\n      console.error('Error reanalyzing PDF:', error);\r\n      setMessages(prev => [...prev, { \r\n        text: `âŒ ×©×’×™××” ×‘× ×™×ª×•×— ×ž×—×“×© ×©×œ \"${extractedPdf.name}\": ${error.message}`, \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n    }\r\n  };\r\n\r\n  const pickerCallback = (data) => {\r\n    if (data.action === window.google.picker.Action.PICKED) {\r\n      const doc = data.docs[0];\r\n      setFileName(doc.name);\r\n      handleGoogleSheetsUrl(doc.url);\r\n      setSnackbarMessage(`×˜×¢×Ÿ ×’×™×œ×™×•×Ÿ: ${doc.name}`);\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const createPicker = () => {\r\n    const developerKey = process.env.REACT_APP_GEMINI_API_KEY;\r\n    const clientId = process.env.REACT_APP_GOOGLE_CLIENT_ID;\r\n    if (!clientId || !developerKey) {\r\n      setAuthError('×ž×¤×ª×—×•×ª API ××™× × ×ž×•×’×“×¨×™× ×›×¨××•×™.');\r\n      setShowSnackbar(true);\r\n      return;\r\n    }\r\n    const view = new window.google.picker.View(window.google.picker.ViewId.SPREADSHEETS);\r\n    view.setMimeTypes(\"application/vnd.google-apps.spreadsheet\");\r\n    const picker = new window.google.picker.PickerBuilder()\r\n      .setAppId(clientId.split('-')[0])\r\n      .setOAuthToken(accessToken)\r\n      .setDeveloperKey(developerKey)\r\n      .addView(view)\r\n      .setCallback(pickerCallback)\r\n      .build();\r\n    picker.setVisible(true);\r\n  };\r\n\r\n  const getSheetData = async (spreadsheetId, sheetName = null) => {\r\n    if (!accessToken) return null;\r\n    try {\r\n      const range = sheetName ? `'${sheetName}'!A1:Z1000` : 'A1:Z1000';\r\n      \r\n      console.log('ðŸ”¥ Fetching sheet data with values and formulas...');\r\n      \r\n      // ðŸ”¥ ×§×¨×™××” 1: ×©×œ×•×£ ×¢×¨×›×™× ×ž×¢×•×¦×‘×™×\r\n      const valuesResponse = await makeGoogleSheetsAPICall(\r\n        spreadsheetId, \r\n        range, \r\n        null, \r\n        'GET',\r\n        'FORMATTED_VALUE'\r\n      );\r\n      \r\n      // ðŸ”¥ ×§×¨×™××” 2: ×©×œ×•×£ × ×•×¡×—××•×ª  \r\n      const formulasResponse = await makeGoogleSheetsAPICall(\r\n        spreadsheetId, \r\n        range, \r\n        null, \r\n        'GET',\r\n        'FORMULA'\r\n      );\r\n      \r\n      console.log('ðŸ“Š Values response:', valuesResponse.values?.length || 0, 'rows');\r\n      console.log('ðŸ“‹ Formulas response:', formulasResponse.values?.length || 0, 'rows');\r\n      \r\n      // ðŸ”¥ ×œ×•×’×™× × ×•×¡×¤×™× ×œ×‘×“×™×§×”\r\n      if (valuesResponse.values?.length > 0) {\r\n        console.log('ðŸ“Š Sample values row 0:', valuesResponse.values[0]);\r\n      }\r\n      if (formulasResponse.values?.length > 0) {\r\n        console.log('ðŸ“‹ Sample formulas row 0:', formulasResponse.values[0]);\r\n      }\r\n      \r\n      // ðŸ”¥ ×©×œ×‘ ××ª ×©× ×™×”× ×œ××•×‘×™×™×§×˜ ×¢×©×™×¨\r\n      const combinedData = combineValuesAndFormulas(\r\n        valuesResponse.values || [], \r\n        formulasResponse.values || []\r\n      );\r\n      \r\n      // ðŸ”¥ ×”×¦×’ ×”×•×“×¢×” ×œ×ž×©×ª×ž×© ×¢×œ ×”×©×™×¤×•×¨\r\n      const formulaCount = combinedData.flat().filter(cell => cell.type === 'formula').length;\r\n      if (formulaCount > 0) {\r\n        console.log('ðŸ”¥ Sample formula cells:', combinedData.flat().filter(cell => cell.type === 'formula').slice(0, 3));\r\n        setMessages(prev => [...prev, { \r\n          text: `âœ¨ ×’×™×œ×™×•×Ÿ × ×˜×¢×Ÿ ×¢× ${formulaCount} × ×•×¡×—××•×ª - ×›×¢×ª ×”-AI ×™×›×•×œ ×œ×¨××•×ª ×’× ××ª ×”× ×•×¡×—××•×ª ×•×’× ××ª ×”×¢×¨×›×™×!`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      } else {\r\n        setMessages(prev => [...prev, { \r\n          text: `ðŸ“Š ×’×™×œ×™×•×Ÿ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×” - ×ž×›×™×œ × ×ª×•× ×™× ××‘×œ ×œ× × ×ž×¦××• × ×•×¡×—××•×ª`, \r\n          sender: 'system', \r\n          timestamp: new Date(), \r\n          id: Date.now() \r\n        }]);\r\n      }\r\n      \r\n      return combinedData;\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to fetch sheet data:', error);\r\n      console.error('Error details:', {\r\n        message: error.message,\r\n        stack: error.stack\r\n      });\r\n      setMessages(prev => [...prev, { text: `âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×’×™×œ×™×•×Ÿ: ${error.message}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const startNewChat = () => {\r\n    setCurrentSessionId(null);\r\n    setMessages([{ text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n    // ××¤×¡ ×ž×¦×‘ Agent Mode ×× ××™×Ÿ ×’×œ×™×•×Ÿ × ×‘×—×¨\r\n    if (!isSheetSelected) {\r\n      setIsAgentMode(false);\r\n    }\r\n    // ××¤×¡ ×ž×¦×‘ Undo/Redo\r\n    setCanUndo(false);\r\n    setCanRedo(false);\r\n    setHasGreenCells(false);\r\n    setChangesCount(0);\r\n    setSheetAnalysis(null);\r\n    setSheetInstructions(null);\r\n  };\r\n\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      // Call logout endpoint\r\n      await fetch(`${API_URL}/auth/logout`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      // Clear local state\r\n      setAccessToken('');\r\n      setUser(null);\r\n      setCurrentSessionId(null);\r\n      setIsSheetSelected(false);\r\n      setIsAgentMode(false);\r\n      setCanUndo(false);\r\n      setCanRedo(false);\r\n      setHasGreenCells(false);\r\n      setChangesCount(0);\r\n      setSheetAnalysis(null);\r\n      setSheetInstructions(null);\r\n      localStorage.removeItem('accessToken');\r\n      \r\n      // Reset session ID for new session\r\n      setSessionId(Date.now().toString() + '_' + Math.random().toString(36).substring(2, 15));\r\n      \r\n      // Reset messages\r\n      setMessages([{ text: '×©×œ×•×! ×× ×™ TLV500 AI Assistant. ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ Google ×•×‘×—×¨ ×’×™×œ×™×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.', sender: 'assistant', timestamp: new Date(), id: Date.now() }]);\r\n      \r\n      setSnackbarMessage('×”×ª× ×ª×§×ª ×‘×”×¦×œ×—×”!');\r\n      setShowSnackbar(true);\r\n    } catch (error) {\r\n      console.error('Error during logout:', error);\r\n    }\r\n  };\r\n\r\n  // ðŸ”„ Undo/Redo Functions\r\n  const checkUndoRedoStatus = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\r\n        method: 'GET',\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking undo/redo status:', error);\r\n    }\r\n  };\r\n\r\n  // ðŸŸ¢ Check for green cells\r\n  const checkForGreenCells = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId || isCheckingGreenCells) return;\r\n    \r\n    setIsCheckingGreenCells(true);\r\n    try {\r\n      // Simple check - if there are undo-able actions of type AI_ACTION that were recently executed\r\n      // we assume there might be green cells\r\n      const response = await fetch(`${API_URL}/api/action/status/${currentSessionId}`, {\r\n        credentials: 'include'\r\n      });\r\n      if (response.ok) {\r\n        const status = await response.json();\r\n        // For now, assume green cells exist if there are recent AI actions to undo\r\n        const hasChanges = status.canUndo;\r\n        // Debug: checkForGreenCells result\r\n        console.log('ðŸŸ¢ Full status from backend:', status);\r\n        console.log('ðŸŸ¢ hasGreenCells:', hasChanges, 'changesCount:', status.changesCount);\r\n        setHasGreenCells(hasChanges);\r\n        \r\n        // ×¢×“×›×•×Ÿ ×¡×¤×™×¨×ª ×”×©×™× ×•×™×™× ×ž×”×‘×§×¢× ×“\r\n        setChangesCount(status.changesCount || 0);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking for green cells:', error);\r\n      setHasGreenCells(false);\r\n      setChangesCount(0);\r\n    } finally {\r\n      setIsCheckingGreenCells(false);\r\n    }\r\n  };\r\n\r\n  // âœ… Approve All Changes\r\n  const approveAllChanges = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\r\n\r\n    try {\r\n      const spreadsheetId = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)?.[1];\r\n      const sheetId = availableSheets.find(s => s.name === selectedSheetName)?.id || 0;\r\n\r\n      const response = await fetch(`${API_URL}/api/action/approve-all`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          spreadsheetId: spreadsheetId,\r\n          selectedSheetName: selectedSheetName,\r\n          sheetId: sheetId,\r\n          sessionId: currentSessionId\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        setSnackbarMessage(result.message || 'âœ… ×›×œ ×”×©×™× ×•×™×™× ××•×©×¨×•');\r\n        setShowSnackbar(true);\r\n        \r\n        // Refresh status\r\n        await checkUndoRedoStatus();\r\n        await checkForGreenCells();\r\n        \r\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 500);\r\n      } else {\r\n        throw new Error('Failed to approve changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error approving all changes:', error);\r\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘××™×©×•×¨ ×”×©×™× ×•×™×™×');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  // âŒ Reject All Changes\r\n  const rejectAllChanges = async () => {\r\n    if (!googleSheetsUrl || !selectedSheetName || !currentSessionId) return;\r\n\r\n    try {\r\n      const spreadsheetId = googleSheetsUrl.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/)?.[1];\r\n      const sheetId = availableSheets.find(s => s.name === selectedSheetName)?.id || 0;\r\n\r\n      const response = await fetch(`${API_URL}/api/action/reject-all`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          spreadsheetId: spreadsheetId,\r\n          selectedSheetName: selectedSheetName, \r\n          sheetId: sheetId,\r\n          sessionId: currentSessionId\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        setSnackbarMessage(result.message || 'âŒ ×›×œ ×”×©×™× ×•×™×™× × ×“×—×•');\r\n        setShowSnackbar(true);\r\n        \r\n        // Refresh status\r\n        await checkUndoRedoStatus();\r\n        await checkForGreenCells();\r\n        \r\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\r\n        setTimeout(() => {\r\n          const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n          if (iframe) {\r\n            iframe.src = iframe.src;\r\n          }\r\n        }, 500);\r\n      } else {\r\n        throw new Error('Failed to reject changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error rejecting all changes:', error);\r\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘×“×—×™×™×ª ×”×©×™× ×•×™×™×');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const undoAction = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/undo`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ sessionId: currentSessionId })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n        setSnackbarMessage('â†©ï¸ ' + data.message);\r\n        setShowSnackbar(true);\r\n        \r\n        // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×§×‘×œ/×“×—×”\r\n        await checkForGreenCells();\r\n        \r\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\r\n        if (googleSheetsUrl && selectedSheetName) {\r\n          setTimeout(() => {\r\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n            if (iframe) {\r\n              iframe.src = iframe.src;\r\n            }\r\n          }, 500); // ×”×©×”×™×” ×§×¦×¨×” ×œ×¤× ×™ ×¨×¢× ×•×Ÿ\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setSnackbarMessage('âŒ ×©×’×™××” ×‘×‘×™×˜×•×œ: ' + error.error);\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in undo action:', error);\r\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘×‘×™×˜×•×œ ×”×¤×¢×•×œ×”');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const redoAction = async () => {\r\n    if (!currentSessionId) return;\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/action/redo`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ sessionId: currentSessionId })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCanUndo(data.canUndo);\r\n        setCanRedo(data.canRedo);\r\n        setSnackbarMessage('â¤´ï¸ ' + data.message);\r\n        setShowSnackbar(true);\r\n        \r\n        // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×§×‘×œ/×“×—×”\r\n        await checkForGreenCells();\r\n        \r\n        // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\r\n        if (googleSheetsUrl && selectedSheetName) {\r\n          setTimeout(() => {\r\n            const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n            if (iframe) {\r\n              iframe.src = iframe.src;\r\n            }\r\n          }, 500); // ×”×©×”×™×” ×§×¦×¨×” ×œ×¤× ×™ ×¨×¢× ×•×Ÿ\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setSnackbarMessage('âŒ ×©×’×™××” ×‘×©×—×–×•×¨: ' + error.error);\r\n        setShowSnackbar(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in redo action:', error);\r\n      setSnackbarMessage('âŒ ×©×’×™××” ×‘×©×—×–×•×¨ ×”×¤×¢×•×œ×”');\r\n      setShowSnackbar(true);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (!question.trim() || isStreamingResponse) return;\r\n\r\n    // ðŸ›¡ï¸ ×‘×“×™×§×” ×—×“×©×” - ×× ×™×© ×’×œ×™×•×Ÿ ××‘×œ ×œ× × ×‘×—×¨ ×’×œ×™×•×Ÿ ×¡×¤×¦×™×¤×™\r\n    if (isSheetLoaded && !isSheetSelected) {\r\n      setMessages(prev => [...prev, { \r\n        text: 'âŒ ×™×© ×œ×‘×—×•×¨ ×’×œ×™×•×Ÿ ×ª×—×™×œ×” ×ž×”×¨×©×™×ž×” ×œ×ž×¢×œ×”', \r\n        sender: 'system', \r\n        timestamp: new Date(), \r\n        id: Date.now() \r\n      }]);\r\n      return;\r\n    }\r\n\r\n    const currentQuestion = question;\r\n    const userMessage = { text: currentQuestion, sender: 'user', timestamp: new Date(), id: Date.now() };\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setQuestion('');\r\n    setIsStreamingResponse(true);\r\n    \r\n    // Generate session ID if this is a new conversation\r\n    let sessionId = currentSessionId;\r\n    if (!sessionId) {\r\n      sessionId = generateSessionId();\r\n      setCurrentSessionId(sessionId);\r\n    }\r\n    \r\n    const loadingMessageId = Date.now() + 1;\r\n    setMessages(prev => [...prev, { text: '', sender: 'assistant', isLoading: true, timestamp: new Date(), id: loadingMessageId }]);\r\n\r\n    // User message will be saved automatically by backend in /api/chat-stream\r\n\r\n    try {\r\n        const sheetData = (isSheetLoaded && isSheetSelected) ? \r\n          await getSheetData(extractSpreadsheetId(googleSheetsUrl), selectedSheetName) : null;\r\n        \r\n        // We need to get the spreadsheetId here to send it\r\n        const spreadsheetId = isSheetLoaded ? extractSpreadsheetId(googleSheetsUrl) : null;\r\n\r\n        const payload = {\r\n          question: currentQuestion,\r\n          sheetData: sheetData,\r\n          extractedPdfData: extractedPdf ? extractedPdf.data : null,\r\n          extractedExcelData: extractedExcel ? extractedExcel.data : null,\r\n          isAgentMode: isAgentMode,\r\n          isSignificantChange: isSignificantChange,  // ðŸŽšï¸ ×”×•×¡×£ ×ž×¦×‘ ×©×™× ×•×™ ×ž×©×ž×¢×•×ª×™\r\n          conversationHistory: messages.filter(m => !m.isLoading).map(m => ({\r\n              role: m.sender === 'user' ? 'user' : 'model',\r\n              parts: [{ text: m.text }]\r\n          })),\r\n          spreadsheetId: spreadsheetId,\r\n          accessToken: accessToken,\r\n          sessionId: sessionId,  // Include session ID\r\n          sheetsMetadata: sheetsMetadata,       // ×•×“× ×©×”×ž×©×ª× ×” ×”×–×” ×§×™×™× ×•×ž×›×™×œ ××ª ×”×ž×™×“×¢\r\n          selectedSheetName: selectedSheetName,  // ×•×“× ×©×”×ž×©×ª× ×” ×”×–×” ×§×™×™× ×•×ž×›×™×œ ××ª ×©× ×”×’×™×œ×™×•×Ÿ\r\n          sheetInstructions: sheetInstructions,   // ðŸ”¥ ×”×•×¡×£ ×”×•×¨××•×ª × ×™×ª×•×—\r\n          sheetAnalysis: sheetAnalysis           // ðŸ”¥ ×”×•×¡×£ × ×™×ª×•×— ×”×’×œ×™×•×Ÿ\r\n        };\r\n\r\n        console.log('ðŸ”¥ Sending payload with sheet instructions:', !!sheetInstructions);\r\n        if (sheetInstructions) {\r\n          console.log('ðŸ“‹ Sheet instructions preview:', sheetInstructions.substring(0, 200) + '...');\r\n        }\r\n        \r\n        const response = await fetch(`${API_URL}/api/chat-stream`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            credentials: 'include', // This is crucial for session cookies!\r\n            body: JSON.stringify(payload),\r\n        });\r\n\r\n        if (!response.ok || !response.body) {\r\n            const errorText = await response.text();\r\n            throw new Error(`Server error: ${response.status} ${errorText}`);\r\n        }\r\n\r\n        const reader = response.body.getReader();\r\n        const decoder = new TextDecoder();\r\n        let accumulatedResponse = '';\r\n\r\n        while (true) {\r\n            const { value, done } = await reader.read();\r\n            if (done) break;\r\n            \r\n            accumulatedResponse += decoder.decode(value, { stream: true });\r\n\r\n            const currentResponse = accumulatedResponse;\r\n            setMessages(prev => prev.map(m => {\r\n                if (m.id === loadingMessageId) {\r\n                    // Show the accumulated response directly as text\r\n                    return { ...m, text: currentResponse, isLoading: true };\r\n                }\r\n                return m;\r\n            }));\r\n        }\r\n\r\n        // Final response processing - check if this is a change plan with clarification questions\r\n        const isChangePlanResponse = accumulatedResponse.includes('ðŸ¤” ×©××œ×•×ª ×”×‘×”×¨×”') && accumulatedResponse.includes('×ž×–×”×” ×ª×•×›× ×™×ª:');\r\n        \r\n        if (isChangePlanResponse) {\r\n          // Extract plan ID from response\r\n          const planIdMatch = accumulatedResponse.match(/×ž×–×”×” ×ª×•×›× ×™×ª:\\s*`([^`]+)`/);\r\n          if (planIdMatch) {\r\n            const planId = planIdMatch[1];\r\n            setPendingChangePlan({\r\n              id: planId,\r\n              response: accumulatedResponse,\r\n              questions: extractQuestionsFromResponse(accumulatedResponse)\r\n            });\r\n            setIsAnsweringQuestions(true);\r\n            setClarificationAnswers(['', '', '', '', '']); // Reset answers\r\n          }\r\n        }\r\n        \r\n        setMessages(prev => prev.map(m =>\r\n            m.id === loadingMessageId\r\n            ? { ...m, text: accumulatedResponse, isLoading: false }\r\n            : m\r\n        ));\r\n\r\n        // Assistant response is automatically saved by backend in /api/chat-stream\r\n        \r\n                 // ×× ×”×™×” ×–×” ×¤×§×•×“×ª undo/redo, ×¨×¢× ×Ÿ ××ª ×”×’×œ×™×•×Ÿ\r\n         const questionLower = currentQuestion.toLowerCase().trim();\r\n         const undoRedoKeywords = ['×‘×˜×œ', 'undo', '×©×—×–×¨', 'redo', '×‘×˜×œ ×¤×¢×•×œ×”', '×©×—×–×¨ ×¤×¢×•×œ×”'];\r\n         if (undoRedoKeywords.some(keyword => questionLower.includes(keyword))) {\r\n             // ×¨×¢× ×•×Ÿ ×—×œ×§ ×©×œ ×”×’×œ×™×•×Ÿ\r\n             if (googleSheetsUrl && selectedSheetName) {\r\n                 setTimeout(() => {\r\n                     const iframe = document.querySelector('iframe[title=\"Google Sheets\"]');\r\n                     if (iframe) {\r\n                         iframe.src = iframe.src;\r\n                     }\r\n                 }, 800); // ×”×©×”×™×” ×ž×¢×˜ ×™×•×ª×¨ ××¨×•×›×” ×¢×‘×•×¨ ×¤×§×•×“×•×ª ×¦'××˜\r\n             }\r\n         }\r\n\r\n    } catch (error) {\r\n        console.error('Error in sendMessage:', error);\r\n        setMessages(prev => prev.map(m => \r\n            m.id === loadingMessageId \r\n            ? { ...m, text: `××™×¨×¢×” ×©×’×™××”: ${error.message}`, isLoading: false, isError: true } \r\n            : m\r\n        ));\r\n    } finally {\r\n        setIsStreamingResponse(false);\r\n        // ×‘×“×•×§ ×¡×˜×˜×•×¡ Undo/Redo ×•×ª××™× ×™×¨×•×§×™× ××—×¨×™ ×›×œ ×”×•×“×¢×”\r\n        console.log('ðŸ“‹ Message completed, checking status...', { isAgentMode, currentSessionId });\r\n        setTimeout(() => {\r\n          console.log('â° Running status checks...');\r\n          checkUndoRedoStatus();\r\n          checkForGreenCells();\r\n        }, 1000); // ×”×©×”×™×” ×§×¦×¨×” ×›×“×™ ×œ×•×•×“× ×©×”×‘×§-×× ×“ ×¡×™×™×\r\n    }\r\n  };\r\n\r\n  const saveAllChanges = () => {\r\n          setMessages(prev => [...prev, { text: `ðŸ’¾ ×›×œ ×”×©×™× ×•×™×™× × ×©×ž×¨×• ×œ×’×™×œ×™×•×Ÿ ${fileName}`, sender: 'system', timestamp: new Date(), id: Date.now() }]);\r\n    };\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      \r\n\r\n      \r\n      <Box sx={{ display: 'flex', height: '100vh', bgcolor: 'background.default', overflow: 'hidden' }}>\r\n        <Box sx={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: `radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.08) 0%, transparent 60%), radial-gradient(circle at 80% 70%, rgba(99, 102, 241, 0.06) 0%, transparent 60%)`, pointerEvents: 'none', zIndex: 0 }} />\r\n        {!isMobile && (\r\n          <Drawer variant=\"permanent\" sx={{ width: drawerWidth, flexShrink: 0, zIndex: 1, '& .MuiDrawer-paper': { width: drawerWidth, boxSizing: 'border-box', bgcolor: 'rgba(10, 10, 10, 0.98)', borderRight: '1px solid rgba(139, 92, 246, 0.4)', backdropFilter: 'blur(20px)' }}}>\r\n            <Box sx={{ p: 3 }}>\r\n              <Typography variant=\"h6\" sx={{ background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)', backgroundClip: 'text', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontWeight: 700 }}>TLV500</Typography>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">AI Assistant</Typography>\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            <Box sx={{ p: 3 }}>\r\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\r\n                <Avatar\r\n                  src={user?.profilePicture}\r\n                  sx={{ width: 45, height: 45, background: 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' }}\r\n                >\r\n                  {user?.name ? user.name.charAt(0) : <Person />}\r\n                </Avatar>\r\n                <Box sx={{ flex: 1 }}>\r\n                  <Typography variant=\"body2\" fontWeight={600}>\r\n                    {user?.name || '×ž×©×ª×ž×© ××•×¨×—'}\r\n                  </Typography>\r\n                  <Typography variant=\"caption\" color=\"text.secondary\">\r\n                    {user?.email || '×œ× ×ž×—×•×‘×¨'}\r\n                  </Typography>\r\n                </Box>\r\n              </Box>\r\n              {accessToken && (\r\n                <Button\r\n                  variant=\"outlined\"\r\n                  onClick={handleLogout}\r\n                  size=\"small\"\r\n                  fullWidth\r\n                  sx={{\r\n                    borderColor: 'rgba(239, 68, 68, 0.5)',\r\n                    color: 'error.main',\r\n                    '&:hover': {\r\n                      borderColor: 'error.main',\r\n                      bgcolor: 'rgba(239, 68, 68, 0.1)'\r\n                    }\r\n                  }}\r\n                >\r\n                  ×”×ª× ×ª×§\r\n                </Button>\r\n              )}\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(139, 92, 246, 0.4)' }} />\r\n            \r\n            {/* Chat History */}\r\n            <Box sx={{ flexGrow: 1, overflow: 'hidden' }}>\r\n              <ChatHistory\r\n                accessToken={accessToken}\r\n                onSessionSelect={handleSessionSelect}\r\n                currentSessionId={currentSessionId}\r\n              />\r\n            </Box>\r\n          </Drawer>\r\n        )}\r\n        <Box sx={{ flexGrow: 1, display: 'flex', flexDirection: isMobile ? 'column' : 'row', zIndex: 1, height: '100vh', overflow: 'hidden' }}>\r\n          <Box sx={{ flex: isMobile ? '1 1 60%' : '0 0 65%', p: 2, display: 'flex', flexDirection: 'column', height: '100%', overflow: 'hidden' }}>\r\n            <Box sx={{ mb: 2, display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: 2 }}>\r\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                <Typography variant=\"h6\" fontWeight={600} color=\"text.primary\">{fileName || '×œ× × ×‘×—×¨ ×’×™×œ×™×•×Ÿ'}</Typography>\r\n                {availableSheets.length > 0 && (\r\n                  <FormControl \r\n                    size=\"small\" \r\n                    sx={{ \r\n                      minWidth: 200,\r\n                      '& .MuiOutlinedInput-notchedOutline': { \r\n                        borderColor: !isSheetSelected ? 'rgba(239, 68, 68, 0.7)' : 'rgba(139, 92, 246, 0.5)' \r\n                      },\r\n                      '& .MuiInputLabel-root': {\r\n                        color: !isSheetSelected ? 'error.main' : 'text.secondary'\r\n                      }\r\n                    }}\r\n                    error={!isSheetSelected}\r\n                  >\r\n                    <InputLabel>\r\n                      {!isSheetSelected ? 'ðŸ”´ ×‘×—×¨ ×’×œ×™×•×Ÿ (×—×•×‘×”)' : '×’×œ×™×•×Ÿ × ×•×›×—×™'}\r\n                    </InputLabel>\r\n                    <Select \r\n                      value={selectedSheetName || ''} \r\n                      onChange={(e) => handleSheetChange(e.target.value)} \r\n                      disabled={isLoadingSheets}\r\n                    >\r\n                      {availableSheets.map(sheet => (\r\n                        <MenuItem key={sheet.id} value={sheet.name}>\r\n                          {sheet.name}\r\n                        </MenuItem>\r\n                      ))}\r\n                    </Select>\r\n                  </FormControl>\r\n                )}\r\n                {isLoadingSheets && <CircularProgress size={20} sx={{ color: 'primary.main' }} />}\r\n              </Box>\r\n              <Box sx={{ display: 'flex', gap: 1 }}>\r\n                {!accessToken ? (\r\n                  <Button variant=\"contained\" href={API_URL}>×”×ª×—×‘×¨ ×¢× Google</Button>\r\n                ) : (\r\n                  <Button variant=\"outlined\" onClick={createPicker} disabled={!isPickerReady}>\r\n                    {!isPickerReady ? '×˜×•×¢×Ÿ API...' : '×‘×—×¨ ×’×™×œ×™×•×Ÿ ×ž-Drive'}\r\n                  </Button>\r\n                )}\r\n                {accessToken && (\r\n                  <Button variant=\"outlined\" onClick={startNewChat} sx={{ minWidth: 'auto' }}>\r\n                    + ×©×™×—×” ×—×“×©×”\r\n                  </Button>\r\n                )}\r\n              </Box>\r\n              {changesCount > 0 && <Chip label={`${changesCount} ×©×™× ×•×™×™× ×œ× ×©×ž×•×¨×™×`} size=\"small\" color=\"warning\" />}\r\n              <Button variant=\"contained\" startIcon={<Save />} onClick={saveAllChanges} color=\"primary\" size=\"small\">×©×ž×•×¨ ×”×›×œ</Button>\r\n            </Box>\r\n            <Paper sx={{ flexGrow: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', background: 'rgba(15, 15, 15, 0.98)', border: '1px solid rgba(139, 92, 246, 0.25)', position: 'relative' }}>\r\n              \r\n\r\n\r\n              {/* ×©×“×” ×§×™×©×•×¨ - ×¨×§ ×›×©××™×Ÿ ×’×œ×™×•×Ÿ */}\r\n              {!isSheetLoaded && (\r\n                <Box sx={{ p: 1, textAlign: 'center', mt: 2 }}>\r\n                  <TextField \r\n                    placeholder=\"×”×›× ×¡ ×§×™×©×•×¨ ×œ×’×•×’×œ ×©×™×˜×¡...\" \r\n                    size=\"small\" \r\n                    sx={{ minWidth: 400 }} \r\n                    onKeyPress={async (e) => { \r\n                      if (e.key === 'Enter' && e.target.value) { \r\n                        await handleGoogleSheetsUrl(e.target.value); \r\n                        e.target.value = ''; \r\n                      } \r\n                    }} \r\n                  />\r\n                </Box>\r\n              )}\r\n              \r\n              {/* ×›×¤×ª×•×¨×™ ×§×‘×œ/×“×—×” ×ž×¨×•×‘×¢×™× ×¦×ž×•×“×™× ×œ×ž×¡×’×¨×ª ×ž×‘×—×•×¥ */}\r\n\r\n              \r\n\r\n              <Box \r\n                ref={iframeContainerRef} \r\n                sx={{ \r\n                  flexGrow: 1, \r\n                  border: '1px solid rgba(139, 92, 246, 0.4)', \r\n                  borderRadius: 1, \r\n                  bgcolor: 'rgba(5, 5, 5, 0.8)', \r\n                  position: 'relative', \r\n                  overflow: 'hidden',\r\n                  m: 0.5, // ×¨×•×•×— ×ž×™× ×™×ž×œ×™ ×ž×”×§×¦×•×•×ª\r\n                  // ×”×’× ×” ×¢×œ Mac gestures\r\n                  overscrollBehavior: 'contain',\r\n                  touchAction: 'auto',\r\n                  WebkitOverflowScrolling: 'touch'\r\n                }} \r\n                onMouseEnter={() => setIsIframeHovered(true)} \r\n                onMouseLeave={() => setIsIframeHovered(false)}\r\n              >\r\n                {/* ×›×¤×ª×•×¨×™ ×§×‘×œ/×“×—×” ×¦×ž×•×“×™× ×œ×¦×“ ×™×ž×™×Ÿ ×©×œ ×”×§×•× ×˜×™×™× ×¨ */}\r\n                {isSheetLoaded && isSheetSelected && (hasGreenCells || changesCount > 0) && (\r\n                  <div style={{ \r\n                    position: 'absolute',\r\n                    top: '8px',\r\n                    right: '8px',\r\n                    display: 'flex', \r\n                    gap: '0px',\r\n                    zIndex: 1000,\r\n                    backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.3)',\r\n                    borderRadius: '4px',\r\n                    padding: '2px'\r\n                  }}>\r\n                    {/* ×›×¤×ª×•×¨ ×§×‘×œ */}\r\n                    <div\r\n                      onClick={() => {\r\n                        approveAllChanges();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: '#4caf50',\r\n                        color: 'white',\r\n                        border: '1px solid #2e7d32',\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: 'pointer',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\r\n                      }}\r\n                      title=\"××©×¨ ×›×œ ×”×©×™× ×•×™×™×\"\r\n                      onMouseEnter={(e) => {\r\n                        e.target.style.backgroundColor = '#45a049';\r\n                        e.target.style.transform = 'scale(1.05)';\r\n                        e.target.style.boxShadow = '0 4px 8px rgba(76, 175, 80, 0.4)';\r\n                        e.target.style.borderColor = '#4caf50';\r\n                        e.target.textContent = '×§×‘×œ ×”×›×œ';\r\n                        e.target.style.fontSize = '0.6rem';\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        e.target.style.backgroundColor = '#4caf50';\r\n                        e.target.style.transform = 'scale(1)';\r\n                        e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                        e.target.style.borderColor = '#2e7d32';\r\n                        e.target.textContent = `âœ“ (${changesCount || 0})`;\r\n                        e.target.style.fontSize = '0.65rem';\r\n                      }}\r\n                    >\r\n                      âœ“ ({changesCount || 0})\r\n                    </div>\r\n\r\n                    {/* ×›×¤×ª×•×¨ ×“×—×” */}\r\n                    <div\r\n                      onClick={() => {\r\n                        rejectAllChanges();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: '#f44336',\r\n                        color: 'white',\r\n                        border: '1px solid #c62828',\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: 'pointer',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\r\n                      }}\r\n                      title=\"×“×—×” ×›×œ ×”×©×™× ×•×™×™×\"\r\n                      onMouseEnter={(e) => {\r\n                        e.target.style.backgroundColor = '#d32f2f';\r\n                        e.target.style.transform = 'scale(1.05)';\r\n                        e.target.style.boxShadow = '0 4px 8px rgba(244, 67, 54, 0.4)';\r\n                        e.target.style.borderColor = '#f44336';\r\n                        e.target.textContent = '×“×—×” ×”×›×œ';\r\n                        e.target.style.fontSize = '0.6rem';\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        e.target.style.backgroundColor = '#f44336';\r\n                        e.target.style.transform = 'scale(1)';\r\n                        e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                        e.target.style.borderColor = '#c62828';\r\n                        e.target.textContent = `âœ• (${changesCount || 0})`;\r\n                        e.target.style.fontSize = '0.65rem';\r\n                      }}\r\n                    >\r\n                      âœ• ({changesCount || 0})\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* ×›×¤×ª×•×¨×™ Undo/Redo ×‘×¦×“ ×™×ž×™×Ÿ ×ª×—×ª×•×Ÿ */}\r\n                {isSheetLoaded && isSheetSelected && (canUndo || canRedo) && (\r\n                  <div style={{ \r\n                    position: 'absolute',\r\n                    bottom: '8px',\r\n                    right: '8px',\r\n                    display: 'flex', \r\n                    gap: '0px',\r\n                    zIndex: 1000,\r\n                    backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.3)',\r\n                    borderRadius: '4px',\r\n                    padding: '2px'\r\n                  }}>\r\n                    {/* ×›×¤×ª×•×¨ Undo */}\r\n                    <div\r\n                      onClick={() => {\r\n                        if (canUndo) undoAction();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: canUndo ? '#2196f3' : '#666',\r\n                        color: 'white',\r\n                        border: `1px solid ${canUndo ? '#1976d2' : '#555'}`,\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: canUndo ? 'pointer' : 'not-allowed',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n                        opacity: canUndo ? 1 : 0.5\r\n                      }}\r\n                      title=\"×‘×˜×œ ×¤×¢×•×œ×”\"\r\n                      onMouseEnter={(e) => {\r\n                        if (canUndo) {\r\n                          e.target.style.backgroundColor = '#1976d2';\r\n                          e.target.style.transform = 'scale(1.05)';\r\n                          e.target.style.boxShadow = '0 4px 8px rgba(33, 150, 243, 0.4)';\r\n                          e.target.style.borderColor = '#2196f3';\r\n                          e.target.textContent = '×‘×˜×œ';\r\n                          e.target.style.fontSize = '0.6rem';\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        if (canUndo) {\r\n                          e.target.style.backgroundColor = '#2196f3';\r\n                          e.target.style.transform = 'scale(1)';\r\n                          e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                          e.target.style.borderColor = '#1976d2';\r\n                          e.target.textContent = 'â†©ï¸';\r\n                          e.target.style.fontSize = '0.65rem';\r\n                        }\r\n                      }}\r\n                    >\r\n                      â†©ï¸\r\n                    </div>\r\n\r\n                    {/* ×›×¤×ª×•×¨ Redo */}\r\n                    <div\r\n                      onClick={() => {\r\n                        if (canRedo) redoAction();\r\n                      }}\r\n                      style={{\r\n                        backgroundColor: canRedo ? '#ff9800' : '#666',\r\n                        color: 'white',\r\n                        border: `1px solid ${canRedo ? '#f57c00' : '#555'}`,\r\n                        width: '45px',\r\n                        height: '20px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 'bold',\r\n                        borderRadius: '0px',\r\n                        cursor: canRedo ? 'pointer' : 'not-allowed',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        userSelect: 'none',\r\n                        transition: 'all 0.2s ease',\r\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n                        opacity: canRedo ? 1 : 0.5\r\n                      }}\r\n                      title=\"×©×—×–×¨ ×¤×¢×•×œ×”\"\r\n                      onMouseEnter={(e) => {\r\n                        if (canRedo) {\r\n                          e.target.style.backgroundColor = '#f57c00';\r\n                          e.target.style.transform = 'scale(1.05)';\r\n                          e.target.style.boxShadow = '0 4px 8px rgba(255, 152, 0, 0.4)';\r\n                          e.target.style.borderColor = '#ff9800';\r\n                          e.target.textContent = '×©×—×–×¨';\r\n                          e.target.style.fontSize = '0.6rem';\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        if (canRedo) {\r\n                          e.target.style.backgroundColor = '#ff9800';\r\n                          e.target.style.transform = 'scale(1)';\r\n                          e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\r\n                          e.target.style.borderColor = '#f57c00';\r\n                          e.target.textContent = 'â¤´ï¸';\r\n                          e.target.style.fontSize = '0.65rem';\r\n                        }\r\n                      }}\r\n                    >\r\n                      â¤´ï¸\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {isSheetLoaded && isSheetSelected ? (\r\n                  <iframe src={getSheetUrlWithGid(googleSheetsUrl, selectedSheetName)} width=\"100%\" height=\"100%\" style={{ border: 'none', borderRadius: '4px' }} title=\"Google Sheets\" />\r\n                ) : availableSheets.length > 0 && !isSheetSelected ? (\r\n                  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'text.secondary' }}>\r\n                    <TableChart sx={{ fontSize: 60, mb: 2, opacity: 0.5, color: 'error.main' }} />\r\n                    <Typography variant=\"h6\" gutterBottom color=\"error.main\">\r\n                      ×™×© ×œ×‘×—×•×¨ ×’×œ×™×•×Ÿ ×ª×—×™×œ×”\r\n                    </Typography>\r\n                    <Typography variant=\"body2\" textAlign=\"center\" sx={{ maxWidth: 400 }}>\r\n                      ×‘×—×¨ ×’×œ×™×•×Ÿ ×ž×”×¨×©×™×ž×” ×œ×ž×¢×œ×” ×›×“×™ ×œ×”×ª×—×™×œ ×œ×¢×‘×•×“\r\n                    </Typography>\r\n                  </Box>\r\n                ) : (\r\n                  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'text.secondary' }}>\r\n                    <TableChart sx={{ fontSize: 60, mb: 2, opacity: 0.5 }} />\r\n                    <Typography variant=\"h6\" gutterBottom>×˜×¢×Ÿ ×’×™×œ×™×•×Ÿ ×’×•×’×œ ×©×™×˜×¡</Typography>\r\n                    <Typography variant=\"body2\" textAlign=\"center\" sx={{ maxWidth: 400 }}>×”×›× ×¡ ×§×™×©×•×¨ ×œ×’×•×’×œ ×©×™×˜×¡ ×‘×©×“×” ×œ×ž×¢×œ×”</Typography>\r\n                  </Box>\r\n                )}\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n          <Box sx={{ width: isMobile ? '100%' : '35%', flex: isMobile ? '1 1 40%' : '0 0 35%', p: 2, height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n            <Paper sx={{ flexGrow: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', background: 'rgba(25, 25, 25, 0.98)', border: '1px solid rgba(139, 92, 246, 0.25)' }}>\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Typography variant=\"h6\" fontWeight={600}>×¢×•×–×¨ AI</Typography>\r\n                <Typography variant=\"body2\" color=\"text.secondary\">×ž×•×›×Ÿ ×œ×¢×–×•×¨ ×¢× ×”× ×™×ª×•×— ×©×œ×š</Typography>\r\n              </Box>\r\n              <Box sx={{ p: 2, borderBottom: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                  <Box sx={{ display: 'flex', gap: 1 }}>\r\n                    <Button variant=\"outlined\" component=\"label\" startIcon={<Description />} size=\"small\" disabled={isExtractingData} sx={{ flex: 1, borderColor: 'rgba(139, 92, 246, 0.5)', '&.Mui-disabled': { color: 'text.secondary' } }}>\r\n                      {isExtractingData ? '×ž×¢×‘×“...' : 'PDF'}\r\n                      <input type=\"file\" hidden accept=\".pdf\" onChange={(e) => handleFileUpload(e, 'PDF')} disabled={isExtractingData} />\r\n                    </Button>\r\n                    <Button variant=\"outlined\" component=\"label\" startIcon={<TableChart />} size=\"small\" disabled={isExtractingExcel} sx={{ flex: 1, borderColor: 'rgba(139, 92, 246, 0.5)' }}>\r\n                      {isExtractingExcel ? '×ž×¢×‘×“...' : 'Excel'}\r\n                      <input type=\"file\" hidden accept=\".xlsx,.xls,.csv\" onChange={(e) => handleFileUpload(e, 'Excel')} disabled={isExtractingExcel}/>\r\n                    </Button>\r\n                  </Box>\r\n                  {extractedPdf && (\r\n                    <Box sx={{ \r\n                      display: 'flex', \r\n                      alignItems: 'center', \r\n                      gap: 1, \r\n                      mt: 1, \r\n                      p: 1, \r\n                      bgcolor: extractedPdf.processingMode === 'simple_ocr' ? 'rgba(255, 193, 7, 0.1)' : 'rgba(139, 92, 246, 0.1)', \r\n                      borderRadius: 2, \r\n                      border: extractedPdf.processingMode === 'simple_ocr' ? '1px solid rgba(255, 193, 7, 0.3)' : '1px solid rgba(139, 92, 246, 0.3)'\r\n                    }}>\r\n                      <Description sx={{ \r\n                        color: extractedPdf.processingMode === 'simple_ocr' ? 'warning.main' : 'primary.main', \r\n                        fontSize: 20 \r\n                      }} />\r\n                      <Typography variant=\"body2\" sx={{ \r\n                        flex: 1, \r\n                        whiteSpace: 'nowrap', \r\n                        overflow: 'hidden', \r\n                        textOverflow: 'ellipsis' \r\n                      }}>\r\n                        {extractedPdf.name}\r\n                        {extractedPdf.processingMode === 'simple_ocr' && ' ðŸ“‘'}\r\n                        {extractedPdf.processingMode === 'structured' && ' ðŸ”'}\r\n                      </Typography>\r\n                      <Button \r\n                        size=\"small\" \r\n                        onClick={() => { \r\n                          setExtractedPdf(null); \r\n                          localStorage.removeItem('extractedPdf'); \r\n                          setMessages(prev => [...prev, { \r\n                            text: 'ðŸ“„ × ×ª×•× ×™ ×”-PDF × ×•×§×• ×ž×”×”×§×©×¨.', \r\n                            sender: 'system', \r\n                            timestamp: new Date(), \r\n                            id: Date.now() \r\n                          }]); \r\n                        }} \r\n                        sx={{ color: 'error.main', minWidth: 'auto', p: 0.5 }}\r\n                      >\r\n                        âœ•\r\n                      </Button>\r\n                    </Box>\r\n                  )}\r\n                  {extractedExcel && (\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 1, p: 1, bgcolor: 'rgba(16, 185, 129, 0.1)', borderRadius: 2, border: '1px solid rgba(16, 185, 129, 0.3)' }}>\r\n                        <TableChart sx={{ color: 'success.main', fontSize: 20 }} />\r\n                        <Typography variant=\"body2\" sx={{ flex: 1, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{extractedExcel.name}</Typography>\r\n                        <Button size=\"small\" onClick={() => { setExtractedExcel(null); localStorage.removeItem('extractedExcel'); setMessages(prev => [...prev, { text: 'ðŸ“Š × ×ª×•× ×™ ×”-Excel × ×•×§×• ×ž×”×”×§×©×¨.', sender: 'system', timestamp: new Date(), id: Date.now() }]); }} sx={{ color: 'error.main', minWidth: 'auto', p: 0.5 }}>âœ•</Button>\r\n                    </Box>\r\n                  )}\r\n                </Box>\r\n              </Box>\r\n              <Box sx={{ flexGrow: 1, overflow: 'auto', p: 2 }}>\r\n                {messages.map((msg, index) => (\r\n                  <Box key={msg.id || index} sx={{ mb: 2 }} className=\"chat-message\">\r\n                    <Box sx={{ display: 'flex', justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start', mb: 1 }}>\r\n                      <Paper sx={{ \r\n                        p: 1.5, \r\n                        maxWidth: '85%', \r\n                        background: msg.sender === 'user' ? 'linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%)' : 'rgba(35, 35, 35, 0.9)', \r\n                        color: 'white', \r\n                        borderRadius: 3\r\n                      }}>\r\n                        {msg.isLoading ? <CircularProgress size={16} color=\"inherit\" /> : <Typography variant=\"body2\" sx={{ whiteSpace: 'pre-wrap' }}>{msg.text}</Typography>}\r\n                      </Paper>\r\n                    </Box>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', textAlign: msg.sender === 'user' ? 'right' : 'left', px: 1 }}>\r\n                      {msg.timestamp.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' })}\r\n                    </Typography>\r\n                  </Box>\r\n                ))}\r\n                <div ref={chatEndRef} />\r\n              </Box>\r\n              \r\n              {/* Clarification Questions UI */}\r\n              {isAnsweringQuestions && pendingChangePlan && (\r\n                <Box sx={{ p: 2, borderTop: '1px solid rgba(139, 92, 246, 0.4)', backgroundColor: 'rgba(139, 92, 246, 0.1)' }}>\r\n                  <Typography variant=\"h6\" sx={{ mb: 2, color: '#8b5cf6' }}>\r\n                    ðŸ¤” ×©××œ×•×ª ×”×‘×”×¨×” ×œ×‘×™×¦×•×¢ ×”×ª×•×›× ×™×ª\r\n                  </Typography>\r\n                  <Typography variant=\"body2\" sx={{ mb: 2, color: 'text.secondary' }}>\r\n                    ×× × ×¢× ×” ×¢×œ ×›×œ 5 ×”×©××œ×•×ª ×œ×‘×™×¦×•×¢ ×ž×“×•×™×§ ×©×œ ×”×©×™× ×•×™×™×:\r\n                  </Typography>\r\n                  \r\n                  {pendingChangePlan.questions.map((question, index) => (\r\n                    <Box key={index} sx={{ mb: 2 }}>\r\n                      <Typography variant=\"body2\" sx={{ mb: 1, fontWeight: 'bold' }}>\r\n                        {index + 1}. {question}\r\n                      </Typography>\r\n                      <TextField\r\n                        fullWidth\r\n                        multiline\r\n                        rows={2}\r\n                        value={clarificationAnswers[index]}\r\n                        onChange={(e) => {\r\n                          const newAnswers = [...clarificationAnswers];\r\n                          newAnswers[index] = e.target.value;\r\n                          setClarificationAnswers(newAnswers);\r\n                        }}\r\n                        placeholder=\"×”×›× ×¡ ×ª×©×•×‘×”...\"\r\n                        variant=\"outlined\"\r\n                        size=\"small\"\r\n                        sx={{\r\n                          '& .MuiOutlinedInput-root': {\r\n                            backgroundColor: 'rgba(255, 255, 255, 0.05)',\r\n                            '& fieldset': {\r\n                              borderColor: 'rgba(139, 92, 246, 0.3)',\r\n                            },\r\n                            '& textarea': {\r\n                              textAlign: 'right',\r\n                              direction: 'rtl',\r\n                            },\r\n                          },\r\n                        }}\r\n                      />\r\n                    </Box>\r\n                  ))}\r\n                  \r\n                  <Box sx={{ display: 'flex', gap: 1, mt: 2 }}>\r\n                    <Button\r\n                      variant=\"contained\"\r\n                      onClick={executeChangePlan}\r\n                      disabled={isStreamingResponse || clarificationAnswers.some(answer => !answer.trim())}\r\n                      sx={{ \r\n                        bgcolor: '#8b5cf6',\r\n                        '&:hover': { bgcolor: '#7c3aed' },\r\n                        flex: 1\r\n                      }}\r\n                    >\r\n                      {isStreamingResponse ? '×ž×‘×¦×¢...' : '×‘×¦×¢ ×ª×•×›× ×™×ª'}\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      onClick={() => {\r\n                        setIsAnsweringQuestions(false);\r\n                        setPendingChangePlan(null);\r\n                        setClarificationAnswers(['', '', '', '', '']);\r\n                      }}\r\n                      disabled={isStreamingResponse}\r\n                      sx={{ borderColor: 'rgba(139, 92, 246, 0.5)' }}\r\n                    >\r\n                      ×‘×™×˜×•×œ\r\n                    </Button>\r\n                  </Box>\r\n                </Box>\r\n              )}\r\n\r\n              <Box sx={{ p: 2, borderTop: '1px solid rgba(139, 92, 246, 0.4)' }}>\r\n                {/* ðŸŽšï¸ ×›×¤×ª×•×¨ ×‘×—×™×¨×ª ×ž×¦×‘ ×©×™× ×•×™ ×ž×©×ž×¢×•×ª×™ */}\r\n                {isAgentMode && isSheetLoaded && isSheetSelected && (\r\n                  <Box sx={{ mb: 1, display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <Switch \r\n                      checked={isSignificantChange}\r\n                      onChange={(e) => setIsSignificantChange(e.target.checked)}\r\n                      sx={{\r\n                        '& .MuiSwitch-switchBase.Mui-checked': {\r\n                          color: '#8B5CF6',\r\n                        },\r\n                        '& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track': {\r\n                          backgroundColor: '#8B5CF6',\r\n                        },\r\n                      }}\r\n                    />\r\n                    <Typography variant=\"body2\" sx={{ color: isSignificantChange ? '#8B5CF6' : '#666' }}>\r\n                      {isSignificantChange ? 'ðŸ¤” ×©×™× ×•×™ ×ž×©×ž×¢×•×ª×™ (×¢× ×”×‘×”×¨×•×ª)' : 'âš¡ ×©×™× ×•×™ ×¨×’×™×œ (×ž×™×™×“×™)'}\r\n                    </Typography>\r\n                  </Box>\r\n                )}\r\n                \r\n                <Box sx={{ display: 'flex', gap: 1 }}>\r\n                  <TextField \r\n                    fullWidth \r\n                    variant=\"outlined\" \r\n                    placeholder={isAnsweringQuestions ? \"×¢× ×” ×¢×œ ×”×©××œ×•×ª ×œ×ž×¢×œ×” ×ª×—×™×œ×”...\" : \"×©××œ ××•×ª×™ ×›×œ ×“×‘×¨... (Shift+Enter ×œ×©×•×¨×” ×—×“×©×”)\"} \r\n                    value={question} \r\n                    onChange={(e) => setQuestion(e.target.value)} \r\n                    onKeyPress={(e) => {\r\n                      if (e.key === 'Enter' && !e.shiftKey) {\r\n                        e.preventDefault(); // Prevents adding a new line\r\n                        sendMessage();\r\n                      }\r\n                    }} \r\n                    multiline\r\n                    minRows={2}\r\n                    maxRows={5}\r\n                    disabled={isStreamingResponse || isAnsweringQuestions}\r\n                    sx={{\r\n                      direction: 'rtl',\r\n                      '& .MuiOutlinedInput-root': {\r\n                        borderRadius: 3,\r\n                        direction: 'rtl',\r\n                        '& textarea': {\r\n                          textAlign: 'right',\r\n                          direction: 'rtl',\r\n                        },\r\n                        '& input': {\r\n                          textAlign: 'right',\r\n                          direction: 'rtl',\r\n                        },\r\n                      },\r\n                      '& .MuiInputLabel-root': {\r\n                        right: 'auto',\r\n                        left: 0,\r\n                        transformOrigin: 'top right',\r\n                        direction: 'rtl',\r\n                      },\r\n                      '& .MuiFormLabel-root': {\r\n                        textAlign: 'right',\r\n                        direction: 'rtl',\r\n                      },\r\n                    }}\r\n                  />\r\n                  <Fab \r\n                    color=\"primary\" \r\n                    onClick={sendMessage} \r\n                    size=\"small\"\r\n                    disabled={isStreamingResponse || isAnsweringQuestions}\r\n                  >\r\n                    <Send />\r\n                  </Fab>\r\n                </Box>\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={isAgentMode}\r\n                      onChange={(e) => setIsAgentMode(e.target.checked)}\r\n                      disabled={!googleSheetsUrl || !isSheetSelected}\r\n                    />\r\n                  }\r\n                  label={`Agent Mode: Allow Sheet Editing ${!isSheetSelected ? '(×‘×—×¨ ×’×œ×™×•×Ÿ ×ª×—×™×œ×”)' : ''}`}\r\n                  sx={{ \r\n                    color: (!googleSheetsUrl || !isSheetSelected) ? 'text.disabled' : 'text.secondary', \r\n                    mt: 1, \r\n                    mr: 0 \r\n                  }}\r\n                />\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n        </Box>\r\n        <Snackbar open={showSnackbar} autoHideDuration={6000} onClose={() => setShowSnackbar(false)} anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }} sx={{ bottom: { xs: 90, sm: 24 } }}>\r\n          <Alert onClose={() => setShowSnackbar(false)} severity={authError ? \"error\" : \"success\"} sx={{ width: '100%', bgcolor: '#2E2E2E', color: 'white' }}>\r\n            {snackbarMessage || authError}\r\n          </Alert>\r\n        </Snackbar>\r\n      </Box>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}