{"ast":null,"code":"import _objectSpread from\"/Users/naamasharir/Documents/personal/TLV500ModelAssistant/TLV500-Frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Box,List,ListItem,ListItemText,ListItemIcon,Typography,IconButton,Button,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Chip,Menu,MenuItem,Divider,CircularProgress,Tooltip}from'@mui/material';import{Chat,Add,MoreVert,Edit,Delete,History,SmartToy,Person}from'@mui/icons-material';// API URL configuration\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:3001';const ChatHistory=_ref=>{let{accessToken,onSessionSelect,currentSessionId}=_ref;const[sessions,setSessions]=useState([]);const[loading,setLoading]=useState(false);const[newSessionDialog,setNewSessionDialog]=useState(false);const[newSessionTitle,setNewSessionTitle]=useState('');const[editDialog,setEditDialog]=useState(false);const[editingSession,setEditingSession]=useState(null);const[editTitle,setEditTitle]=useState('');const[menuAnchor,setMenuAnchor]=useState(null);const[selectedSession,setSelectedSession]=useState(null);useEffect(()=>{if(accessToken){fetchSessions();}},[accessToken]);const fetchSessions=async()=>{setLoading(true);try{const response=await fetch(\"\".concat(API_URL,\"/api/chat/sessions\"),{credentials:'include'});if(response.ok){const data=await response.json();console.log('Fetched sessions:',data);setSessions(data);}else{console.error('Failed to fetch sessions:',response.status);}}catch(error){console.error('Error fetching chat sessions:',error);}finally{setLoading(false);}};const createNewSession=async()=>{if(!newSessionTitle.trim())return;try{const response=await fetch(\"\".concat(API_URL,\"/api/chat/session/new\"),{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({title:newSessionTitle})});if(response.ok){const newSession=await response.json();setSessions(prev=>[newSession,...prev]);setNewSessionDialog(false);setNewSessionTitle('');onSessionSelect(newSession.sessionId);}}catch(error){console.error('Error creating new session:',error);}};const updateSessionTitle=async()=>{if(!editTitle.trim()||!editingSession)return;try{const response=await fetch(\"\".concat(API_URL,\"/api/chat/session/\").concat(editingSession.sessionId,\"/title\"),{method:'PUT',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({title:editTitle})});if(response.ok){setSessions(prev=>prev.map(session=>session.sessionId===editingSession.sessionId?_objectSpread(_objectSpread({},session),{},{title:editTitle}):session));setEditDialog(false);setEditingSession(null);setEditTitle('');}}catch(error){console.error('Error updating session title:',error);}};const deleteSession=async sessionId=>{try{const response=await fetch(\"\".concat(API_URL,\"/api/chat/session/\").concat(sessionId),{method:'DELETE',credentials:'include'});if(response.ok){setSessions(prev=>prev.filter(session=>session.sessionId!==sessionId));if(currentSessionId===sessionId){onSessionSelect(null);}}}catch(error){console.error('Error deleting session:',error);}};const handleMenuClick=(event,session)=>{event.stopPropagation();setMenuAnchor(event.currentTarget);setSelectedSession(session);};const handleMenuClose=()=>{setMenuAnchor(null);setSelectedSession(null);};const handleEdit=()=>{setEditingSession(selectedSession);setEditTitle(selectedSession.title);setEditDialog(true);handleMenuClose();};const handleDelete=()=>{if(selectedSession){deleteSession(selectedSession.sessionId);}handleMenuClose();};const formatDate=dateString=>{const date=new Date(dateString);const now=new Date();const diffInHours=(now-date)/(1000*60*60);if(diffInHours<1){return'לפני דקות';}else if(diffInHours<24){return\"\\u05DC\\u05E4\\u05E0\\u05D9 \".concat(Math.floor(diffInHours),\" \\u05E9\\u05E2\\u05D5\\u05EA\");}else{return date.toLocaleDateString('he-IL');}};if(!accessToken){return/*#__PURE__*/_jsx(Box,{sx:{p:2,textAlign:'center'},children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"\\u05D4\\u05EA\\u05D7\\u05D1\\u05E8 \\u05DB\\u05D3\\u05D9 \\u05DC\\u05E8\\u05D0\\u05D5\\u05EA \\u05D4\\u05D9\\u05E1\\u05D8\\u05D5\\u05E8\\u05D9\\u05D9\\u05EA \\u05E9\\u05D9\\u05D7\\u05D5\\u05EA\"})});}return/*#__PURE__*/_jsxs(Box,{sx:{height:'100%',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(Box,{sx:{p:2,borderBottom:'1px solid rgba(139, 92, 246, 0.4)'},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(History,{}),\"\\u05D4\\u05D9\\u05E1\\u05D8\\u05D5\\u05E8\\u05D9\\u05D9\\u05EA \\u05E9\\u05D9\\u05D7\\u05D5\\u05EA\"]}),/*#__PURE__*/_jsx(Tooltip,{title:\"\\u05E9\\u05D9\\u05D7\\u05D4 \\u05D7\\u05D3\\u05E9\\u05D4\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>setNewSessionDialog(true),sx:{bgcolor:'rgba(139, 92, 246, 0.1)','&:hover':{bgcolor:'rgba(139, 92, 246, 0.2)'}},children:/*#__PURE__*/_jsx(Add,{})})})]})}),/*#__PURE__*/_jsx(Box,{sx:{flex:1,overflow:'auto'},children:loading?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',p:2},children:/*#__PURE__*/_jsx(CircularProgress,{size:24})}):/*#__PURE__*/_jsxs(List,{dense:true,children:[sessions.map(session=>/*#__PURE__*/_jsxs(ListItem,{button:true,selected:currentSessionId===session.sessionId,onClick:()=>onSessionSelect(session.sessionId),sx:{mb:1,mx:1,borderRadius:2,border:currentSessionId===session.sessionId?'1px solid rgba(139, 92, 246, 0.5)':'1px solid transparent','&:hover':{bgcolor:'rgba(139, 92, 246, 0.1)',border:'1px solid rgba(139, 92, 246, 0.3)'},'&.Mui-selected':{bgcolor:'rgba(139, 92, 246, 0.15)','&:hover':{bgcolor:'rgba(139, 92, 246, 0.2)'}}},children:[/*#__PURE__*/_jsx(ListItemIcon,{sx:{minWidth:36},children:/*#__PURE__*/_jsx(Chat,{sx:{color:'primary.main',fontSize:20}})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",className:\"chat-message-text\",sx:{fontWeight:currentSessionId===session.sessionId?600:400,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},children:session.title}),secondary:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mt:0.5},children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:formatDate(session.lastActivity)}),/*#__PURE__*/_jsx(Chip,{label:session.totalMessages,size:\"small\",sx:{height:16,fontSize:'0.6rem',bgcolor:'rgba(139, 92, 246, 0.2)',color:'primary.main'}})]})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:e=>handleMenuClick(e,session),sx:{ml:1},children:/*#__PURE__*/_jsx(MoreVert,{fontSize:\"small\"})})]},session.sessionId)),sessions.length===0&&!loading&&/*#__PURE__*/_jsxs(Box,{sx:{p:3,textAlign:'center'},children:[/*#__PURE__*/_jsx(SmartToy,{sx:{fontSize:48,color:'text.secondary',mb:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"\\u05D0\\u05D9\\u05DF \\u05E2\\u05D3\\u05D9\\u05D9\\u05DF \\u05E9\\u05D9\\u05D7\\u05D5\\u05EA\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:\"\\u05D4\\u05EA\\u05D7\\u05DC \\u05E9\\u05D9\\u05D7\\u05D4 \\u05D7\\u05D3\\u05E9\\u05D4 \\u05DB\\u05D3\\u05D9 \\u05DC\\u05E8\\u05D0\\u05D5\\u05EA \\u05D0\\u05D5\\u05EA\\u05D4 \\u05DB\\u05D0\\u05DF\"})]})]})}),/*#__PURE__*/_jsxs(Menu,{anchorEl:menuAnchor,open:Boolean(menuAnchor),onClose:handleMenuClose,children:[/*#__PURE__*/_jsxs(MenuItem,{onClick:handleEdit,children:[/*#__PURE__*/_jsx(Edit,{fontSize:\"small\",sx:{mr:1}}),\"\\u05E2\\u05E8\\u05D5\\u05DA \\u05DB\\u05D5\\u05EA\\u05E8\\u05EA\"]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleDelete,sx:{color:'error.main'},children:[/*#__PURE__*/_jsx(Delete,{fontSize:\"small\",sx:{mr:1}}),\"\\u05DE\\u05D7\\u05E7 \\u05E9\\u05D9\\u05D7\\u05D4\"]})]}),/*#__PURE__*/_jsxs(Dialog,{open:newSessionDialog,onClose:()=>setNewSessionDialog(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"\\u05E9\\u05D9\\u05D7\\u05D4 \\u05D7\\u05D3\\u05E9\\u05D4\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"\\u05DB\\u05D5\\u05EA\\u05E8\\u05EA \\u05D4\\u05E9\\u05D9\\u05D7\\u05D4\",fullWidth:true,variant:\"outlined\",className:\"hebrew-input\",value:newSessionTitle,onChange:e=>setNewSessionTitle(e.target.value),onKeyPress:e=>{if(e.key==='Enter'){createNewSession();}}})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setNewSessionDialog(false),children:\"\\u05D1\\u05D9\\u05D8\\u05D5\\u05DC\"}),/*#__PURE__*/_jsx(Button,{onClick:createNewSession,variant:\"contained\",children:\"\\u05E6\\u05D5\\u05E8 \\u05E9\\u05D9\\u05D7\\u05D4\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:editDialog,onClose:()=>setEditDialog(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"\\u05E2\\u05E8\\u05D5\\u05DA \\u05DB\\u05D5\\u05EA\\u05E8\\u05EA \\u05E9\\u05D9\\u05D7\\u05D4\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"\\u05DB\\u05D5\\u05EA\\u05E8\\u05EA \\u05D4\\u05E9\\u05D9\\u05D7\\u05D4\",fullWidth:true,variant:\"outlined\",className:\"hebrew-input\",value:editTitle,onChange:e=>setEditTitle(e.target.value),onKeyPress:e=>{if(e.key==='Enter'){updateSessionTitle();}}})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setEditDialog(false),children:\"\\u05D1\\u05D9\\u05D8\\u05D5\\u05DC\"}),/*#__PURE__*/_jsx(Button,{onClick:updateSessionTitle,variant:\"contained\",children:\"\\u05E9\\u05DE\\u05D5\\u05E8\"})]})]})]});};export default ChatHistory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}